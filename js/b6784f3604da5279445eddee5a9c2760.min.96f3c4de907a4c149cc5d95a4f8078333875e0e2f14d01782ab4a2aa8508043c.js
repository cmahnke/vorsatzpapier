/*! Bundled license information:

tify/dist/tify.js:
  (*!
  TIFY v0.35.0
  (c) 2017-2026 GÃ¶ttingen State and University Library (https://www.sub.uni-goettingen.de/)
  AGPL-3.0
  https://tify.rocks/
  *)
  (**
  * @vue/shared v3.5.27
  * (c) 2018-present Yuxi (Evan) You and Vue contributors
  * @license MIT
  **)
  (**
  * @vue/reactivity v3.5.27
  * (c) 2018-present Yuxi (Evan) You and Vue contributors
  * @license MIT
  **)
  (**
  * @vue/runtime-core v3.5.27
  * (c) 2018-present Yuxi (Evan) You and Vue contributors
  * @license MIT
  **)

tify/dist/tify.js:
  (**
  * @vue/runtime-dom v3.5.27
  * (c) 2018-present Yuxi (Evan) You and Vue contributors
  * @license MIT
  **)
  (*! openseadragon 5.0.1 *)
  (*! Built on 2024-12-09 *)
  (*! Git commit: v5.0.1-0-480de92d *)
  (*! http://openseadragon.github.io *)
  (*! License: http://openseadragon.github.io/license/ *)
*/(()=>{function m(e,t){if(!e)throw new Error(t)}E={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Cr(e){const t=We();for(let n=0,s=e.length;n<s;++n)Rs(t,e[n]);return t}function hh(e,t,n){const s=Math.min.apply(null,e),o=Math.min.apply(null,t),i=Math.max.apply(null,e),a=Math.max.apply(null,t);return Ot(s,o,i,a,n)}function dh(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e.slice()}function Pr(e,t,n){let s,o;return t<e[0]?s=e[0]-t:e[2]<t?s=t-e[2]:s=0,n<e[1]?o=e[1]-n:e[3]<n?o=n-e[3]:o=0,s*s+o*o}function to(e,t){return bc(e,t[0],t[1])}function bc(e,t,n){return e[0]<=t&&t<=e[2]&&e[1]<=n&&n<=e[3]}function Ac(e,t){const i=e[0],a=e[1],r=e[2],c=e[3],s=t[0],o=t[1];let n=E.UNKNOWN;return s<i?n=n|E.LEFT:s>r&&(n=n|E.RIGHT),o<a?n=n|E.BELOW:o>c&&(n=n|E.ABOVE),n===E.UNKNOWN&&(n=E.INTERSECTING),n}function We(){return[1/0,1/0,-(1/0),-(1/0)]}function Ot(e,t,n,s,o){return o?(o[0]=e,o[1]=t,o[2]=n,o[3]=s,o):[e,t,n,s]}function Rt(e){return Ot(1/0,1/0,-(1/0),-(1/0),e)}function H3(e,t){const n=e[0],s=e[1];return Ot(n,s,n,s,t)}function L3(e,t,n,s,o){const i=Rt(o);return Bc(i,e,t,n,s)}function ro(e,t){return e[0]==t[0]&&e[2]==t[2]&&e[1]==t[1]&&e[3]==t[3]}function D3(e,t){return t[0]<e[0]&&(e[0]=t[0]),t[2]>e[2]&&(e[2]=t[2]),t[1]<e[1]&&(e[1]=t[1]),t[3]>e[3]&&(e[3]=t[3]),e}function Rs(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function Bc(e,t,n,s,o){for(;n<s;n+=o)E3(e,t[n],t[n+1]);return e}function E3(e,t,n){e[0]=Math.min(e[0],t),e[1]=Math.min(e[1],n),e[2]=Math.max(e[2],t),e[3]=Math.max(e[3],n)}function ul(e,t){let n;return n=t(Fs(e)),n||(n=t(Ms(e)),n||(n=t(Cs(e)),n||(n=t(Te(e)),n)))}function Oo(e){let t=0;return on(e)||(t=f(e)*$(e)),t}function Fs(e){return[e[0],e[1]]}function Ms(e){return[e[2],e[1]]}function gt(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function r3(e,t){let n;if(t==="bottom-left")n=Fs(e);else if(t==="bottom-right")n=Ms(e);else if(t==="top-left")n=Te(e);else if(t==="top-right")n=Cs(e);else throw new Error("Invalid corner");return n}function So(e,t,n,s,o){const[i,a,r,c,l,d,u,h]=vd(e,t,n,s);return Ot(Math.min(i,r,l,u),Math.min(a,c,d,h),Math.max(i,r,l,u),Math.max(a,c,d,h),o)}function vd(e,t,n,s){const d=t*s[0]/2,u=t*s[1]/2,h=Math.cos(n),m=Math.sin(n),o=d*h,i=d*m,a=u*h,r=u*m,c=e[0],l=e[1];return[c-o+r,l-i-a,c-o-r,l-i+a,c+o-r,l+i+a,c+o+r,l+i-a,c-o+r,l-i-a]}function $(e){return e[3]-e[1]}function Ie(e,t,n){const s=n||We();return nn(e,t)?(e[0]>t[0]?s[0]=e[0]:s[0]=t[0],e[1]>t[1]?s[1]=e[1]:s[1]=t[1],e[2]<t[2]?s[2]=e[2]:s[2]=t[2],e[3]<t[3]?s[3]=e[3]:s[3]=t[3]):Rt(s),s}function Te(e){return[e[0],e[3]]}function Cs(e){return[e[2],e[3]]}function f(e){return e[2]-e[0]}function nn(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}function on(e){return e[2]<e[0]||e[3]<e[1]}function p2(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e}function m2(e,t,n){let s=!1;const o=Ac(e,t),i=Ac(e,n);if(o===E.INTERSECTING||i===E.INTERSECTING)s=!0;else{const u=e[0],h=e[1],m=e[2],f=e[3],p=t[0],g=t[1],c=n[0],l=n[1],d=(l-g)/(c-p);let a,r;!!(i&E.ABOVE)&&!(o&E.ABOVE)&&(a=c-(l-f)/d,s=a>=u&&a<=m),!s&&!!(i&E.RIGHT)&&!(o&E.RIGHT)&&(r=l-(c-m)*d,s=r>=h&&r<=f),!s&&!!(i&E.BELOW)&&!(o&E.BELOW)&&(a=c-(l-h)/d,s=a>=u&&a<=m),!s&&!!(i&E.LEFT)&&!(o&E.LEFT)&&(r=l-(c-u)*d,s=r>=h&&r<=f)}return s}function u2(e,t,n,s){if(on(e))return Rt(n);let o=[];if(s>1){const t=e[2]-e[0],n=e[3]-e[1];for(let i=0;i<s;++i)o.push(e[0]+t*i/s,e[1],e[2],e[1]+n*i/s,e[2]-t*i/s,e[3],e[0],e[3]-n*i/s)}else o=[e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]];t(o,o,2);const i=[],a=[];for(let e=0,t=o.length;e<t;e+=2)i.push(o[e]),a.push(o[e+1]);return hh(i,a,n)}function d2(e,t){const n=t.getExtent(),s=gt(e);if(t.canWrapX()&&(s[0]<n[0]||s[0]>=n[2])){const t=f(n),i=Math.floor((s[0]-n[0])/t),o=i*t;e[0]-=o,e[2]-=o}return e}function l2(e,t,n){if(t.canWrapX()){const s=t.getExtent();if(!isFinite(e[0])||!isFinite(e[2]))return[[s[0],e[1],s[2],e[3]]];d2(e,t);const o=f(s);if(f(e)>o&&!n)return[[s[0],e[1],s[2],e[3]]];if(e[0]<s[0])return[[e[0]+o,e[1],s[2],e[3]],[s[0],e[1],e[2],e[3]]];if(e[2]>s[2])return[[e[0],e[1],s[2],e[3]],[s[0],e[1],e[2]-o,e[3]]]}return[e]}y={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},Ee={},Ee[y.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}},Ee[y.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}},Ee[y.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}},Ee.none={none:{supports:[],formats:[],qualities:[]}},Cd=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,Do=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,Nu=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function T0(e){let t=e.getComplianceLevelSupportedFeatures();return t===0[0]&&(t=Ee[y.VERSION1].level0),{url:e.imageInfo["@id"]===0[0]?0[0]:e.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:t.supports,formats:[...t.formats,e.imageInfo.formats===0[0]?[]:e.imageInfo.formats],qualities:[...t.qualities,e.imageInfo.qualities===0[0]?[]:e.imageInfo.qualities],resolutions:e.imageInfo.scale_factors,tileSize:e.imageInfo.tile_width!==0[0]?e.imageInfo.tile_height!==0[0]?[e.imageInfo.tile_width,e.imageInfo.tile_height]:[e.imageInfo.tile_width,e.imageInfo.tile_width]:e.imageInfo.tile_height!=0[0]?[e.imageInfo.tile_height,e.imageInfo.tile_height]:0[0]}}function k0(e){const t=e.getComplianceLevelSupportedFeatures(),n=Array.isArray(e.imageInfo.profile)&&e.imageInfo.profile.length>1,s=n&&e.imageInfo.profile[1].supports?e.imageInfo.profile[1].supports:[],o=n&&e.imageInfo.profile[1].formats?e.imageInfo.profile[1].formats:[],i=n&&e.imageInfo.profile[1].qualities?e.imageInfo.profile[1].qualities:[];return{url:e.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:e.imageInfo.sizes===0[0]?0[0]:e.imageInfo.sizes.map(function(e){return[e.width,e.height]}),tileSize:e.imageInfo.tiles===0[0]?0[0]:[e.imageInfo.tiles.map(function(e){return e.width})[0],e.imageInfo.tiles.map(function(e){return e.height===0[0]?e.width:e.height})[0]],resolutions:e.imageInfo.tiles===0[0]?0[0]:e.imageInfo.tiles.map(function(e){return e.scaleFactors})[0],supports:[...t.supports,...s],formats:[...t.formats,...o],qualities:[...t.qualities,...i]}}function y0(e){const t=e.getComplianceLevelSupportedFeatures(),n=e.imageInfo.extraFormats===0[0]?t.formats:[...t.formats,...e.imageInfo.extraFormats],s=e.imageInfo.preferredFormats!==0[0]&&Array.isArray(e.imageInfo.preferredFormats)&&e.imageInfo.preferredFormats.length>0?e.imageInfo.preferredFormats.filter(function(e){return["jpg","png","gif"].includes(e)}).reduce(function(e,t){return e===0[0]&&n.includes(t)?t:e},0[0]):0[0];return{url:e.imageInfo.id,sizes:e.imageInfo.sizes===0[0]?0[0]:e.imageInfo.sizes.map(function(e){return[e.width,e.height]}),tileSize:e.imageInfo.tiles===0[0]?0[0]:[e.imageInfo.tiles.map(function(e){return e.width})[0],e.imageInfo.tiles.map(function(e){return e.height})[0]],resolutions:e.imageInfo.tiles===0[0]?0[0]:e.imageInfo.tiles.map(function(e){return e.scaleFactors})[0],supports:e.imageInfo.extraFeatures===0[0]?t.supports:[...t.supports,...e.imageInfo.extraFeatures],formats:n,qualities:e.imageInfo.extraQualities===0[0]?t.qualities:[...t.qualities,...e.imageInfo.extraQualities],preferredFormat:s}}gn={},gn[y.VERSION1]=T0,gn[y.VERSION2]=k0,gn[y.VERSION3]=y0,g1=class{constructor(e){this.setImageInfo(e)}setImageInfo(e){typeof e=="string"?this.imageInfo=JSON.parse(e):this.imageInfo=e}getImageApiVersion(){if(this.imageInfo===0[0])return 0[0];let e=this.imageInfo["@context"]||"ol-no-context";typeof e=="string"&&(e=[e]);for(let t=0;t<e.length;t++)switch(e[t]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return y.VERSION1;case"http://iiif.io/api/image/2/context.json":return y.VERSION2;case"http://iiif.io/api/image/3/context.json":return y.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(y.VERSION1)&&this.imageInfo.identifier)return y.VERSION1;break;default:}m(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(e){if(this.imageInfo===0[0]||this.imageInfo.profile===0[0])return 0[0];switch(e===0[0]&&(e=this.getImageApiVersion()),e){case y.VERSION1:if(Cd.test(this.imageInfo.profile))return this.imageInfo.profile;break;case y.VERSION3:if(Nu.test(this.imageInfo.profile))return this.imageInfo.profile;break;case y.VERSION2:if(typeof this.imageInfo.profile=="string"&&Do.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&Do.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break;default:}}getComplianceLevelFromProfile(e){const t=this.getComplianceLevelEntryFromProfile(e);if(t===0[0])return 0[0];const n=t.match(/level[0-2](?:\.json)?$/g);return Array.isArray(n)?n[0].replace(".json",""):0[0]}getComplianceLevelSupportedFeatures(){if(this.imageInfo===0[0])return 0[0];const e=this.getImageApiVersion(),t=this.getComplianceLevelFromProfile(e);return t===0[0]?Ee.none.none:Ee[e][t]}getTileSourceOptions(e){const n=e||{},s=this.getImageApiVersion();if(s===0[0])return 0[0];const t=s===0[0]?0[0]:gn[s](this);return t===0[0]?0[0]:{url:t.url,version:s,size:[this.imageInfo.width,this.imageInfo.height],sizes:t.sizes,format:n.format!==0[0]&&t.formats.includes(n.format)?n.format:t.preferredFormat!==0[0]?t.preferredFormat:"jpg",supports:t.supports,quality:n.quality&&t.qualities.includes(n.quality)?n.quality:t.qualities.includes("native")?"native":"default",resolutions:Array.isArray(t.resolutions)?t.resolutions.sort(function(e,t){return t-e}):0[0],tileSize:t.tileSize}}},Ko=g1;function x1(e){return e[0]>0&&e[1]>0}function h0(e,t,n){return n===0[0]&&(n=[0,0]),n[0]=e[0]*t+.5|0,n[1]=e[1]*t+.5|0,n}function D(e,t){return Array.isArray(e)?e:(t===0[0]?t=[e,e]:(t[0]=e,t[1]=e),t)}Go=class{constructor(e,t,n,s){this.minX=e,this.maxX=t,this.minY=n,this.maxY=s}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}};function dt(e,t,n,s,o){return o!==0[0]?(o.minX=e,o.maxX=t,o.minY=n,o.maxY=s,o):new Go(e,t,n,s)}Qo=Go;function ss(e,t){return e>t?1:e<t?-1:0}function Zo(e,t,n){if(e[0]<=t)return 0;const s=e.length;if(t<=e[s-1])return s-1;if(typeof n=="function"){for(let o=1;o<s;++o){const i=e[o];if(i===t)return o;if(i<t)return n(t,e[o-1],i)>0?o-1:o}return s-1}if(n>0){for(let n=1;n<s;++n)if(e[n]<t)return n-1;return s-1}if(n<0){for(let n=1;n<s;++n)if(e[n]<=t)return n;return s-1}for(let n=1;n<s;++n){if(e[n]==t)return n;if(e[n]<t)return e[n-1]-t<t-e[n]?n-1:n}return s-1}function P4(e,t){const n=Array.isArray(t)?t:[t],s=n.length;for(let t=0;t<s;t++)e[e.length]=n[t]}function ts(e,t){const n=e.length;if(n!==t.length)return!1;for(let s=0;s<n;s++)if(e[s]!==t[s])return!1;return!0}function z4(e,t,n){const s=t||ss;return e.every(function(t,o){if(o===0)return!0;const i=s(e[o-1],t);return!(i>0||n&&i===0)})}function A2(e,t,n,s,o){const i=ul(o,function(o){return!Be(e,t,n,s,o[0],o[1])});return!i}function Be(e,t,n,s,o,i){let c=0,r=e[n-s],a=e[n-s+1];for(;t<n;t+=s){const d=e[t],l=e[t+1];a<=i?l>i&&(d-r)*(i-a)-(o-r)*(l-a)>0&&c++:l<=i&&(d-r)*(i-a)-(o-r)*(l-a)<0&&c--,r=d,a=l}return c!==0}function m4(e,t,n,s,o,i){if(n.length===0)return!1;if(!Be(e,t,n[0],s,o,i))return!1;for(let t=1,a=n.length;t<a;++t)if(Be(e,n[t-1],n[t],s,o,i))return!1;return!0}function L4(e,t,n,s,o){let i;for(t+=s;t<n;t+=s)if(i=o(e.slice(t-s,t),e.slice(t,t+s)),i)return i;return!1}function a4(e,t,n,s,o,i){return i=i??Bc(We(),e,t,n,s),!!nn(o,i)&&(i[0]>=o[0]&&i[2]<=o[2]||i[1]>=o[1]&&i[3]<=o[3]||L4(e,t,n,s,function(e,t){return m2(o,e,t)}))}function Z1(e,t,n,s,o){return!!a4(e,t,n,s,o)||!!Be(e,t,n,s,o[0],o[1])||!!Be(e,t,n,s,o[0],o[3])||!!Be(e,t,n,s,o[2],o[1])||!!Be(e,t,n,s,o[2],o[3])}function B4(e,t,n,s,o){if(!Z1(e,t,n[0],s,o))return!1;if(n.length===1)return!0;for(let t=1,i=n.length;t<i;++t)if(A2(e,n[t-1],n[t],s,o)&&!a4(e,n[t-1],n[t],s,o))return!1;return!0}function j(e,t,n){return Math.min(Math.max(e,t),n)}function U4(e,t,n,s,o,i){const a=o-n,r=i-s;if(a!==0||r!==0){const c=((e-n)*a+(t-s)*r)/(a*a+r*r);c>1?(n=o,s=i):c>0&&(n+=a*c,s+=r*c)}return Ct(e,t,n,s)}function Ct(e,t,n,s){const o=n-e,i=s-t;return o*o+i*i}function q4(e){const t=e.length;for(let n=0;n<t;n++){let s=n,o=Math.abs(e[n][n]);for(let i=n+1;i<t;i++){const a=Math.abs(e[i][n]);a>o&&(o=a,s=i)}if(o===0)return null;const i=e[s];e[s]=e[n],e[n]=i;for(let s=n+1;s<t;s++){const o=-e[s][n]/e[n][n];for(let i=n;i<t+1;i++)n==i?e[s][i]=0:e[s][i]+=o*e[n][i]}}const n=new Array(t);for(let s=t-1;s>=0;s--){n[s]=e[s][t]/e[s][s];for(let o=s-1;o>=0;o--)e[o][t]-=e[o][s]*n[s]}return n}function $1(e){return e*180/Math.PI}function xe(e){return e*Math.PI/180}function Tt(e,t){const n=e%t;return n*t<0?n+t:n}function Q4(e,t,n){return e+n*(t-e)}function _i(e,t){const n=10**t;return Math.round(e*n)/n}function Pn(e,t){return Math.floor(_i(e,t))}function Hn(e,t){return Math.ceil(_i(e,t))}function wi(e,t,n){if(e>=t&&e<n)return e;const s=n-t;return((e-t)%s+s)%s+t}function l(){throw new Error("Unimplemented abstract method.")}M1=0;function A(e){return e.ol_uid||(e.ol_uid=String(++M1))}function Un(e,t,n,s){return s!==0[0]?(s[0]=e,s[1]=t,s[2]=n,s):[e,t,n]}function a0(e,t,n){return e+"/"+t+"/"+n}function Kn(e,t,n,s,o){return`${A(e)},${t},${a0(n,s,o)}`}function l0(e){return u0(e[0],e[1],e[2])}function u0(e,t,n){return(t<<e)+n}function p0(e,t){const n=e[0],o=e[1],i=e[2];if(t.getMinZoom()>n||n>t.getMaxZoom())return!1;const s=t.getFullTileRange(n);return!s||s.containsXY(o,i)}O1=42,nt=256,Re=[0,0,0],ue=5,y1=class{constructor(e){this.minZoom=e.minZoom!==0[0]?e.minZoom:0,this.resolutions_=e.resolutions,m(z4(this.resolutions_,(e,t)=>t-e,!0),"`resolutions` must be sorted in descending order");let n;if(!e.origins)for(let e=0,t=this.resolutions_.length-1;e<t;++e)if(n){if(this.resolutions_[e]/this.resolutions_[e+1]!==n){n=0[0];break}}else n=this.resolutions_[e]/this.resolutions_[e+1];this.zoomFactor_=n,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==0[0]?e.origin:null,this.origins_=null,e.origins!==0[0]&&(this.origins_=e.origins,m(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const t=e.extent;t!==0[0]&&!this.origin_&&!this.origins_&&(this.origin_=Te(t)),m(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==0[0]&&(this.tileSizes_=e.tileSizes,m(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==0[0]?e.tileSize:this.tileSizes_?null:nt,m(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=t!==0[0]?t:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==0[0]?this.fullTileRanges_=e.sizes.map((e,n)=>{const s=new Qo(Math.min(0,e[0]),Math.max(e[0]-1,-1),Math.min(0,e[1]),Math.max(e[1]-1,-1));if(t){const e=this.getTileRangeForExtentAndZ(t,n);s.minX=Math.max(e.minX,s.minX),s.maxX=Math.min(e.maxX,s.maxX),s.minY=Math.max(e.minY,s.minY),s.maxY=Math.min(e.maxY,s.maxY)}return s}):t&&this.calculateTileRanges_(t)}forEachTileCoord(e,t,n){const s=this.getTileRangeForExtentAndZ(e,t);for(let e=s.minX,o=s.maxX;e<=o;++e)for(let o=s.minY,i=s.maxY;o<=i;++o)n([t,e,o])}forEachTileCoordParentTileRange(e,t,n,s){let r,o,i,c=null,a=e[0]-1;for(this.zoomFactor_===2?(o=e[1],i=e[2]):c=this.getTileCoordExtent(e,s);a>=this.minZoom;){if(o!==0[0]&&i!==0[0]?(o=Math.floor(o/2),i=Math.floor(i/2),r=dt(o,o,i,i,n)):r=this.getTileRangeForExtentAndZ(c,a,n),t(a,r))return!0;--a}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getOrigins(){return this.origins_}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,n){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const n=e[1]*2,s=e[2]*2;return dt(n,n+1,s,s+1,t)}const s=this.getTileCoordExtent(e,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,n){if(t>this.maxZoom||t<this.minZoom)return null;const i=e[0],s=e[1],o=e[2];if(t===i)return dt(s,o,s,o,n);if(this.zoomFactor_){const e=this.zoomFactor_**(t-i),a=Math.floor(s*e),r=Math.floor(o*e);if(t<i)return dt(a,a,r,r,n);const c=Math.floor(e*(s+1))-1,l=Math.floor(e*(o+1))-1;return dt(a,c,r,l,n)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,n)}getTileRangeForExtentAndZ(e,t,n){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,Re);const s=Re[1],o=Re[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,Re);const i=Re[1],a=Re[2];return dt(s,i,o,a,n)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),n=this.getResolution(e[0]),s=D(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*s[0]*n,t[1]-(e[2]+.5)*s[1]*n]}getTileCoordExtent(e,t){const o=this.getOrigin(e[0]),n=this.getResolution(e[0]),s=D(this.getTileSize(e[0]),this.tmpSize_),i=o[0]+e[1]*s[0]*n,a=o[1]-(e[2]+1)*s[1]*n,r=i+s[0]*n,c=a+s[1]*n;return Ot(i,a,r,c,t)}getTileCoordForCoordAndResolution(e,t,n){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,n)}getTileCoordForXYAndResolution_(e,t,n,s,o){const r=this.getZForResolution(n),c=n/this.getResolution(r),l=this.getOrigin(r),d=D(this.getTileSize(r),this.tmpSize_);let i=c*(e-l[0])/n/d[0],a=c*(l[1]-t)/n/d[1];return s?(i=Hn(i,ue)-1,a=Hn(a,ue)-1):(i=Pn(i,ue),a=Pn(a,ue)),Un(r,i,a,o)}getTileCoordForXYAndZ_(e,t,n,s,o){const r=this.getOrigin(n),c=this.getResolution(n),l=D(this.getTileSize(n),this.tmpSize_);let i=(e-r[0])/c/l[0],a=(r[1]-t)/c/l[1];return s?(i=Hn(i,ue)-1,a=Hn(a,ue)-1):(i=Pn(i,ue),a=Pn(a,ue)),Un(n,i,a,o)}getTileCoordForCoordAndZ(e,t,n){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,n)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const n=Zo(this.resolutions_,e,t||0);return j(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return Z1(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,n=new Array(t);for(let s=this.minZoom;s<t;++s)n[s]=this.getTileRangeForExtentAndZ(e,s);this.fullTileRanges_=n}},Ei=y1,r={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},a={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"},v1=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}},jn=v1;function rs(){return!0}function cs(){return!1}function us(){}function j0(e){let n,t,s;return function(){const o=Array.prototype.slice.call(arguments);return(!t||this!==s||!ts(o,t))&&(s=this,t=o,n=e.apply(this,arguments)),n}}function _0(e){function t(){let t;try{t=e()}catch(e){return Promise.reject(e)}return t instanceof Promise?t:Promise.resolve(t)}return t()}function hs(e){for(const t in e)delete e[t]}function f1(e){let t;for(t in e)return!1;return!t}u1=class{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}},ve=u1,l1=class extends jn{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const n=this.listeners_||(this.listeners_={}),s=n[e]||(n[e]=[]);s.includes(t)||s.push(t)}dispatchEvent(e){const r=typeof e=="string",t=r?e:e.type,n=this.listeners_&&this.listeners_[t];if(!n)return;const s=r?new ve(e):e;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});t in o||(o[t]=0,a[t]=0),++o[t];let i;for(let e=0,t=n.length;e<t;++e)if("handleEvent"in n[e]?i=n[e].handleEvent(s):i=n[e].call(this,s),i===!1||s.propagationStopped){i=!1;break}if(--o[t]===0){let e=a[t];for(delete a[t];e--;)this.removeEventListener(t,us);delete o[t]}return i}disposeInternal(){this.listeners_&&hs(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||0[0]}hasListener(e){return!!this.listeners_&&(e?e in this.listeners_:Object.keys(this.listeners_).length>0)}removeEventListener(e,t){if(!this.listeners_)return;const n=this.listeners_[e];if(!n)return;const s=n.indexOf(t);s!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(n[s]=us,++this.pendingRemovals_[e]):(n.splice(s,1),n.length===0&&delete this.listeners_[e]))}},cn=l1;function h(e,t,n,s,o){if(o){const o=n;n=function(i){return e.removeEventListener(t,n),o.call(s??this,i)}}else s&&s!==e&&(n=n.bind(s));const i={target:e,type:t,listener:n};return e.addEventListener(t,n),i}function bs(e,t,n,s){return h(e,t,n,s,!0)}function b(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),hs(e))}we=typeof navigator!="undefined"&&typeof navigator.userAgent!="undefined"?navigator.userAgent.toLowerCase():"",i1=we.includes("safari")&&!we.includes("chrom"),x0=i1&&(we.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(we)),n1=we.includes("webkit")&&!we.includes("edge"),Mi=we.includes("macintosh"),Xu=typeof devicePixelRatio!="undefined"?devicePixelRatio:1,se=typeof WorkerGlobalScope!="undefined"&&typeof OffscreenCanvas!="undefined"&&self instanceof WorkerGlobalScope,zi=typeof Image!="undefined"&&Image.prototype.decode,Ni=function(){let e=!1;try{const t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return e}();function S0(e,t,n){const s=e;let o=!0,i=!1,r=!1;const c=[bs(s,a.LOAD,function(){r=!0,i||t()})];return s.src&&zi?(i=!0,s.decode().then(function(){o&&t()}).catch(function(){o&&(r?t():n())})):c.push(bs(s,a.ERROR,n)),function(){o=!1,c.forEach(b)}}function F0(e,t){return new Promise((n,s)=>{function o(){a(),n(e)}function i(){a(),s(new Error("Image load error"))}function a(){e.removeEventListener("load",o),e.removeEventListener("error",i)}e.addEventListener("load",o),e.addEventListener("error",i),t&&(e.src=t)})}function z0(e,t){return t&&(e.src=t),e.src&&zi?new Promise((t,n)=>e.decode().then(()=>t(e)).catch(s=>e.complete&&e.width?t(e):n(s))):F0(e)}n={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Lu(e){return e**3}function jt(e){return 1-Lu(1-e)}function R0(e){return 3*e*e-2*e*e*e}function P0(e){return e}ju=class extends cn{constructor(e,t,n){super(),n=n||{},this.tileCoord=e,this.state=t,this.key="",this.transition_=n.transition===0[0]?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(a.CHANGE)}release(){this.setState(n.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state===n.EMPTY)return;if(this.state!==n.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){l()}getAlpha(e,t){if(!this.transition_)return 1;let n=this.transitionStarts_[e];if(n){if(n===-1)return 1}else n=t,this.transitionStarts_[e]=n;const s=t-n+1e3/60;return s>=this.transition_?1:Lu(s/this.transition_)}inTransition(e){return!!this.transition_&&this.transitionStarts_[e]!==-1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}disposeInternal(){this.release(),super.disposeInternal()}},ks=ju;function L(e,t,n,s){let o;return n&&n.length?o=n.shift():se?o=new class extends OffscreenCanvas{style={}}(e??300,t??150):o=document.createElement("canvas"),e&&(o.width=e),t&&(o.height=t),o.getContext("2d",s)}function As(){return Bi||(Bi=L(1,1)),Bi}function Zi(e){const t=e.canvas;t.width=1,t.height=1,e.clearRect(0,0,1,1)}function Ss(e,t){const n=t.parentNode;n&&n.replaceChild(e,t)}function a2(e){for(;e.lastChild;)e.lastChild.remove()}function b2(e,t){const n=e.childNodes;for(let i=0;!0;++i){const s=n[i],o=t[i];if(!s&&!o)break;if(s===o)continue;if(!s){e.appendChild(o);continue}if(!o){e.removeChild(s),--i;continue}e.insertBefore(o,s)}}function yd(){const e=new Proxy({childNodes:[],appendChild:function(e){return this.childNodes.push(e),e},remove:function(){},removeChild:function(e){const t=this.childNodes.indexOf(e);if(t===-1)throw new Error("Node to remove was not found");return this.childNodes.splice(t,1),e},insertBefore:function(e,t){const n=this.childNodes.indexOf(t);if(n===-1)throw new Error("Reference node not found");return this.childNodes.splice(n,0,e),e},style:{}},{get(e,t,n){return t==="firstElementChild"?e.childNodes.length>0?e.childNodes[0]:null:Reflect.get(e,t,n)}});return e}function Oe(e){return typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas}bd=class extends ks{constructor(e,t,n,s,o,i){super(e,t,i),this.crossOrigin_=s?.crossOrigin,this.referrerPolicy_=s?.referrerPolicy,this.src_=n,this.key=n,this.image_,se?this.image_=new OffscreenCanvas(1,1):(this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_),this.referrerPolicy_!==0[0]&&(this.image_.referrerPolicy=this.referrerPolicy_)),this.unlisten_=null,this.tileLoadFunction_=o}getImage(){return this.image_}setImage(e){this.image_=e,this.state=n.LOADED,this.unlistenImage_(),this.changed()}getCrossOrigin(){return this.crossOrigin_}getReferrerPolicy(){return this.referrerPolicy_}handleImageError_(){this.state=n.ERROR,this.unlistenImage_(),this.image_=j2(),this.changed()}handleImageLoad_(){if(se)this.state=n.LOADED;else{const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=n.LOADED:this.state=n.EMPTY}this.unlistenImage_(),this.changed()}load(){this.state==n.ERROR&&(this.state=n.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_),this.referrerPolicy_!==0[0]&&(this.image_.referrerPolicy=this.referrerPolicy_)),this.state==n.IDLE&&(this.state=n.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=S0(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}};function j2(){const e=L(1,1);return e.fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),e.canvas}In=bd,ta={info:1,warn:2,error:3,none:4},fd=ta.info;function tr(...e){if(fd>ta.warn)return;console.warn(...e)}function D2(e,t){return e[0]+=+t[0],e[1]+=+t[1],e}function Bs(e,t){let n=!0;for(let s=e.length-1;s>=0;--s)if(e[s]!=t[s]){n=!1;break}return n}function na(e,t){const n=Math.cos(t),s=Math.sin(t),o=e[0]*n-e[1]*s,i=e[1]*n+e[0]*s;return e[0]=o,e[1]=i,e}function Y2(e,t){return e[0]*=t,e[1]*=t,e}function G2(e,t){if(t.canWrapX()){const n=f(t.getExtent()),s=n3(e,t,n);s&&(e[0]-=s*n)}return e}function n3(e,t,n){const s=t.getExtent();let o=0;return t.canWrapX()&&(e[0]<s[0]||e[0]>s[2])&&(n=n||f(s),o=Math.floor((e[0]-s[0])/n)),o}St={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937},wl=class{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==0[0]?e.extent:null,this.worldExtent_=e.worldExtent!==0[0]?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==0[0]?e.axisOrientation:"enu",this.global_=e.global!==0[0]&&e.global,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||St[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}},zs=wl,At=6378137,Ze=Math.PI*At,yl=[-Ze,-Ze,Ze,Ze],jl=[-180,-85,180,85],Zt=At*Math.log(Math.tan(Math.PI/2)),$e=class extends zs{constructor(e){super({code:e,units:"m",extent:yl,global:!0,worldExtent:jl,getPointResolution:function(e,t){return e/Math.cosh(t[1]/At)}})}},ja=[new $e("EPSG:3857"),new $e("EPSG:102100"),new $e("EPSG:102113"),new $e("EPSG:900913"),new $e("http://www.opengis.net/def/crs/EPSG/0/3857"),new $e("http://www.opengis.net/gml/srs/epsg.xml#3857")];function v3(e,t,n,s){const o=e.length;n=n>1?n:2,s=s??n,t===0[0]&&(n>2?t=e.slice():t=new Array(o));for(let n=0;n<o;n+=s){t[n]=Ze*e[n]/180;let i=At*Math.log(Math.tan(Math.PI*(+e[n+1]+90)/360));i>Zt?i=Zt:i<-Zt&&(i=-Zt),t[n+1]=i}return t}function b3(e,t,n,s){const o=e.length;n=n>1?n:2,s=s??n,t===0[0]&&(n>2?t=e.slice():t=new Array(o));for(let n=0;n<o;n+=s)t[n]=180*e[n]/Ze,t[n+1]=360*Math.atan(Math.exp(e[n+1]/At))/Math.PI-90;return t}el=6378137,_a=[-180,-90,180,90],Wc=Math.PI*el/180,_e=class extends zs{constructor(e,t){super({code:e,units:"degrees",extent:_a,axisOrientation:t,global:!0,metersPerUnit:Wc,worldExtent:_a})}},wa=[new _e("CRS:84"),new _e("EPSG:4326","neu"),new _e("urn:ogc:def:crs:OGC:1.3:CRS84"),new _e("urn:ogc:def:crs:OGC:2:84"),new _e("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new _e("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new _e("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],gs={};function T3(e){return gs[e]||gs[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function z3(e,t){gs[e]=t}qe={};function mn(e,t,n){const s=e.getCode(),o=t.getCode();s in qe||(qe[s]={}),qe[s][o]=n}function Ca(e,t){return e in qe&&t in qe[e]?qe[e][t]:null}pn=.9996,W=.00669438,vn=W*W,bn=vn*W,Me=W/(1-W),Ea=(1-W)**.5,He=(1-Ea)/(1+Ea),Sa=He*He,os=Sa*He,Zn=os*He,Ma=Zn*He,Ta=1-W/4-3*vn/64-5*bn/256,Cc=3*W/8+3*vn/32+45*bn/1024,xc=15*vn/256+45*bn/1024,Oc=35*bn/3072,wc=3/2*He-27/32*os+269/512*Ma,_c=21/16*Sa-55/32*Zn,yc=151/96*os-417/128*Ma,jc=1097/512*Zn,Dn=6378137;function V3(e,t,n){const _=e-5e5,k=n.north?t:t-1e7,y=k/pn,a=y/(Dn*Ta),c=a+wc*Math.sin(2*a)+_c*Math.sin(4*a)+yc*Math.sin(6*a)+jc*Math.sin(8*a),l=Math.sin(c),f=l*l,u=Math.cos(c),h=l/u,i=h*h,b=i*i,w=1-W*f,x=(1-W*f)**.5,O=Dn/x,j=(1-W)/w,o=Me*u**2,d=o*o,s=_/(O*pn),m=s*s,v=m*s,g=v*s,p=g*s,C=p*s,E=c-h/j*(m/2-g/24*(5+3*i+10*o-4*d-9*Me))+C/720*(61+90*i+298*o+45*b-252*Me-3*d);let r=(s-v/6*(1+2*i+o)+p/120*(5-2*o+28*i-3*d+8*Me+24*b))/u;return r=wi(r+xe(Yr(n.number)),-Math.PI,Math.PI),[$1(r),$1(E)]}Na=-80,Ka=84,ac=-180,nc=180;function th(e,t,n){e=wi(e,ac,nc),t<Na?t=Na:t>Ka&&(t=Ka);const i=xe(t),f=Math.sin(i),r=Math.cos(i),c=f/r,o=c*c,l=o*o,v=xe(e),b=Yr(n.number),w=xe(b),h=Dn/(1-W*f**2)**.5,a=Me*r**2,s=r*wi(v-w,-Math.PI,Math.PI),p=s*s,g=p*s,d=g*s,m=d*s,j=m*s,y=Dn*(Ta*i-Cc*Math.sin(2*i)+xc*Math.sin(4*i)-Oc*Math.sin(6*i)),_=pn*h*(s+g/6*(1-o+a)+m/120*(5-18*o+l+72*a-58*Me))+5e5;let u=pn*(y+h*c*(p/2+d/24*(5-o+9*a+4*a**2)+j/720*(61-58*o+l+600*a-330*Me)));return n.north||(u+=1e7),[_,u]}function Yr(e){return(e-1)*6-180+3}Kr=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function Ur(e){let t=0;for(const s of Kr){const n=e.match(s);if(n){t=parseInt(n[1]);break}}if(!t)return null;let n=0,s=!1;return t>32700&&t<32761?n=t-32700:t>32600&&t<32661&&(s=!0,n=t-32600),n?{number:n,north:s}:null}function Br(e,t){return function(n,s,o,i){const a=n.length;o=o>1?o:2,i=i??o,s||(o>2?s=n.slice():s=new Array(a));for(let o=0;o<a;o+=i){const c=n[o],l=n[o+1],r=e(c,l,t);s[o]=r[0],s[o+1]=r[1]}return s}}function mh(e){const t=Ur(e);return t?new zs({code:e,units:"m"}):null}function jh(e){const t=Ur(e.getCode());return t?{forward:Br(th,t),inverse:Br(V3,t)}:null}Nr=6371008.8;function Fr(e,t,n){n=n||Nr;const s=xe(e[1]),o=xe(t[1]),i=(o-s)/2,a=xe(t[0]-e[0])/2,r=Math.sin(i)*Math.sin(i)+Math.sin(a)*Math.sin(a)*Math.cos(s)*Math.cos(o);return 2*n*Math.atan2(r**.5,(1-r)**.5)}Sr=[jh],Er=[mh],Qn=!0;function wh(e){const t=e===0[0]||e;Qn=!t}function Qa(e,t){if(t!==0[0]){for(let n=0,s=e.length;n<s;++n)t[n]=e[n];t=t}else t=e.slice();return t}function Ja(e){z3(e.getCode(),e),mn(e,e,Qa)}function Ch(e){e.forEach(Ja)}function Z(e){if(typeof e!="string")return e;const t=T3(e);if(t)return t;for(const n of Er){const t=n(e);if(t)return t}return null}function br(e,t,n,s){e=Z(e);let o;const i=e.getPointResolutionFunc();if(i){if(o=i(t,n),s&&s!==e.getUnits()){const t=e.getMetersPerUnit();t&&(o=o*t/St[s])}}else{const i=e.getUnits();if(i=="degrees"&&!s||s=="degrees")o=t;else{const a=Ba(e,Z("EPSG:4326"));if(!a&&i!=="degrees")o=t*e.getMetersPerUnit();else{let e=[n[0]-t/2,n[1],n[0]+t/2,n[1],n[0],n[1]-t/2,n[0],n[1]+t/2];e=a(e,e,2);const s=Fr(e.slice(0,2),e.slice(2,4)),i=Fr(e.slice(4,6),e.slice(6,8));o=(s+i)/2}const r=s?St[s]:e.getMetersPerUnit();r!==0[0]&&(o/=r)}}return o}function or(e){Ch(e),e.forEach(function(t){e.forEach(function(e){t!==e&&mn(t,e,Qa)})})}function xh(e,t,n,s){e.forEach(function(e){t.forEach(function(t){mn(e,t,n),mn(t,e,s)})})}function Za(e,t){return e?typeof e=="string"?Z(e):e:Z(t)}function Z3(e){return function(t,n,s,o){const i=t.length;s=s!==0[0]?s:2,o=o??s,n=n!==0[0]?n:new Array(i);for(let a=0;a<i;a+=o){const r=e(t.slice(a,a+s)),c=r.length;for(let e=0,s=o;e<s;++e)n[a+e]=e>=c?t[a+e]:r[e]}return n}}function ls(e,t){if(e===t)return!0;const n=e.getUnits()===t.getUnits();if(e.getCode()===t.getCode())return n;const s=Ba(e,t);return s===Qa&&n}function Ba(e,t){const i=e.getCode(),a=t.getCode();let n=Ca(i,a);if(n)return n;let s=null,o=null;for(const n of Sr)s||(s=n(e)),o||(o=n(t));if(!s&&!o)return null;const r="EPSG:4326";if(o)if(s)n=Aa(s.inverse,o.forward);else{const e=Ca(i,r);e&&(n=Aa(e,o.forward))}else{const e=Ca(r,a);e&&(n=Aa(s.inverse,e))}return n&&(Ja(e),Ja(t),mn(e,t,n)),n}function Aa(e,t){return function(n,s,o,i){return s=e(n,s,o,i),t(s,s,o,i)}}function dn(e,t){const n=Z(e),s=Z(t);return Ba(n,s)}function Ln(e,t,n){const s=dn(t,n);if(!s){const e=Z(t).getCode(),s=Z(n).getCode();throw new Error(`No transform available between ${e} and ${s}`)}return s(e,0[0],e.length)}function kl(e,t,n,s){const o=dn(t,n);return u2(e,o,0[0],s)}ie=null;function o3(){return ie}function ca(e,t){return ie?Ln(e,t,ie):e}function ae(e,t){return ie?Ln(e,ie,t):(Qn&&!Bs(e,[0,0])&&e[0]>=-180&&e[0]<=180&&e[1]>=-90&&e[1]<=90&&(Qn=!1,tr("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),e)}function s3(e,t){return ie?kl(e,t,ie):e}function ye(e,t){return ie?kl(e,ie,t):e}function t3(){or(ja),or(wa),xh(wa,ja,v3,b3)}t3(),Ue=[];function Md(e,t,n,s,o){e.beginPath(),e.moveTo(0,0),e.lineTo(t,n),e.lineTo(s,o),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,s)+1,Math.max(n,o)),e.restore()}function Ai(e,t){return Math.abs(e[t*4]-210)>2||Math.abs(e[t*4+3]-.75*255)>2}function R4(){if(ea===0[0]){const e=L(6,6,Ue);e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",Md(e,4,5,4,0),Md(e,4,5,0,5);const t=e.getImageData(0,0,3,3).data;ea=Ai(t,0)||Ai(t,4)||Ai(t,8),Zi(e),Ue.push(e.canvas)}return ea}function H1(e,t,n,s){const i=Ln(n,t,e);let o=br(t,s,n);const a=t.getMetersPerUnit();a!==0[0]&&(o*=a);const r=e.getMetersPerUnit();r!==0[0]&&(o/=r);const c=e.getExtent();if(!c||to(c,i)){const t=br(e,o,i)/o;isFinite(t)&&t>0&&(o/=t)}return o}function e0(e,t,n,s){const i=gt(n);let o=H1(e,t,i,s);return(!isFinite(o)||o<=0)&&ul(n,function(n){return o=H1(e,t,n,s),isFinite(o)&&o>0}),o}function m0(e,t,n,s,o,i,a,r,c,l,d,u,h,m){const p=L(Math.round(n*e),Math.round(n*t),Ue);if(u||(p.imageSmoothingEnabled=!1),c.length===0)return p.canvas;p.scale(n,n);function y(e){return Math.round(e*n)/n}p.globalCompositeOperation="lighter";const j=We();c.forEach(function(e){D3(j,e.extent)});let v;const g=n/s,_=(u?1:1+2**-24)/g;if(!h||c.length!==1||l!==0){if(v=L(Math.round(f(j)*g),Math.round($(j)*g),Ue),u||(v.imageSmoothingEnabled=!1),o&&m){const e=(o[0]-j[0])*g,t=-(o[3]-j[3])*g,n=f(o)*g,s=$(o)*g;v.rect(e,t,n,s),v.clip()}c.forEach(function(e){if(e.image.width>0&&e.image.height>0){if(e.clipExtent){v.save();const t=(e.clipExtent[0]-j[0])*g,n=-(e.clipExtent[3]-j[3])*g,s=f(e.clipExtent)*g,o=$(e.clipExtent)*g;v.rect(u?t:Math.round(t),u?n:Math.round(n),u?s:Math.round(t+s)-Math.round(t),u?o:Math.round(n+o)-Math.round(n)),v.clip()}const t=(e.extent[0]-j[0])*g,n=-(e.extent[3]-j[3])*g,s=f(e.extent)*g,o=$(e.extent)*g;v.drawImage(e.image,l,l,e.image.width-2*l,e.image.height-2*l,u?t:Math.round(t),u?n:Math.round(n),u?s:Math.round(t+s)-Math.round(t),u?o:Math.round(n+o)-Math.round(n)),e.clipExtent&&v.restore()}})}const b=Te(a);return r.getTriangles().forEach(function(e){const o=e.source,s=e.target;let M=o[0][0],S=o[0][1],g=o[1][0],x=o[1][1],O=o[2][0],w=o[2][1];const l=y((s[0][0]-b[0])/i),m=y(-(s[0][1]-b[1])/i),r=y((s[1][0]-b[0])/i),a=y(-(s[1][1]-b[1])/i),C=y((s[2][0]-b[0])/i),E=y(-(s[2][1]-b[1])/i),k=M,A=S;M=0,S=0,g-=k,x-=A,O-=k,w-=A;const F=[[g,x,0,0,r-l],[O,w,0,0,C-l],[0,0,g,x,a-m],[0,0,O,w,E-m]],h=q4(F);if(!h)return;if(p.save(),p.beginPath(),R4()||!u){p.moveTo(r,a);const e=4,t=l-r,n=m-a;for(let s=0;s<e;s++)p.lineTo(r+y((s+1)*t/e),a+y(s*n/(e-1))),s!=e-1&&p.lineTo(r+y((s+1)*t/e),a+y((s+1)*n/(e-1)));p.lineTo(C,E)}else p.moveTo(r,a),p.lineTo(l,m),p.lineTo(C,E);p.clip(),p.transform(h[0],h[2],h[1],h[3],l,m),p.translate(j[0]-k,j[3]-A);let d;if(v)d=v.canvas,p.scale(_,-_);else{const e=c[0],t=e.extent;d=e.image,p.scale(f(t)/d.width,-$(t)/d.height)}p.drawImage(d,0,0),p.restore()}),v&&(Zi(v),Ue.push(v.canvas)),d&&(p.save(),p.globalCompositeOperation="source-over",p.strokeStyle="black",p.lineWidth=1,r.getTriangles().forEach(function(e){const s=e.target,o=(s[0][0]-b[0])/i,a=-(s[0][1]-b[1])/i,r=(s[1][0]-b[0])/i,c=-(s[1][1]-b[1])/i,l=(s[2][0]-b[0])/i,d=-(s[2][1]-b[1])/i;p.beginPath(),p.moveTo(r,c),p.lineTo(o,a),p.lineTo(l,d),p.closePath(),p.stroke()}),p.restore()),p.canvas}g0=new Array(6);function vt(){return[1,0,0,1,0,0]}function q(e,t){const n=t[0],s=t[1];return t[0]=e[0]*n+e[2]*s+e[4],t[1]=e[1]*n+e[3]*s+e[5],t}function qt(e,t,n,s,o,i,a,r){const c=Math.sin(i),l=Math.cos(i);return e[0]=s*l,e[1]=o*c,e[2]=-s*c,e[3]=o*l,e[4]=a*s*l-r*s*c+t,e[5]=a*o*c+r*o*l+n,e}function p1(e,t){const n=A0(t);m(n!==0,"Transformation matrix cannot be inverted");const s=t[0],o=t[1],i=t[2],a=t[3],r=t[4],c=t[5];return e[0]=a/n,e[1]=-o/n,e[2]=-i/n,e[3]=s/n,e[4]=(i*c-a*r)/n,e[5]=-(s*c-o*r)/n,e}function A0(e){return e[0]*e[3]-e[1]*e[2]}Hu=[1e5,1e5,1e5,1e5,2,2];function M0(e){const t="matrix("+e.join(", ")+")";return t}function Po(e){const t=e.substring(7,e.length-1).split(",");return t.map(parseFloat)}function K0(e,t){const n=Po(e),s=Po(t);for(let e=0;e<6;++e)if(Math.round((n[e]-s[e])*Hu[e])!==0)return!1;return!0}Nd=10,To=.25,ud=class{constructor(e,t,n,s,o,i,a){this.sourceProj_=e,this.targetProj_=t;let r={};const h=a?Z3(e=>q(a,Ln(e,this.targetProj_,this.sourceProj_))):dn(this.targetProj_,this.sourceProj_);this.transformInv_=function(e){const t=e[0]+"/"+e[1];return r[t]||(r[t]=h(e)),r[t]},this.maxSourceExtent_=s,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&f(s)>=f(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?f(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?f(this.targetProj_.getExtent()):null;const c=Te(n),l=Cs(n),d=Ms(n),u=Fs(n),m=this.transformInv_(c),p=this.transformInv_(l),g=this.transformInv_(d),v=this.transformInv_(u),b=Nd+(i?Math.max(0,Math.ceil(Math.log2(Oo(n)/(i*i*256*256)))):0);if(this.addQuad_(c,l,d,u,m,p,g,v,b),this.wrapsXInSource_){let e=1/0;this.triangles_.forEach(function(t){e=Math.min(e,t.source[0][0],t.source[1][0],t.source[2][0])}),this.triangles_.forEach(t=>{if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-e>this.sourceWorldWidth_/2){const n=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];n[0][0]-e>this.sourceWorldWidth_/2&&(n[0][0]-=this.sourceWorldWidth_),n[1][0]-e>this.sourceWorldWidth_/2&&(n[1][0]-=this.sourceWorldWidth_),n[2][0]-e>this.sourceWorldWidth_/2&&(n[2][0]-=this.sourceWorldWidth_);const s=Math.min(n[0][0],n[1][0],n[2][0]),o=Math.max(n[0][0],n[1][0],n[2][0]);o-s<this.sourceWorldWidth_/2&&(t.source=n)}})}r={}}addTriangle_(e,t,n,s,o,i){this.triangles_.push({source:[s,o,i],target:[e,t,n]})}addQuad_(e,t,n,s,o,i,a,r,c){const u=Cr([o,i,a,r]),h=this.sourceWorldWidth_?f(u)/this.sourceWorldWidth_:null,m=this.sourceWorldWidth_,p=this.sourceProj_.canWrapX()&&h>.5&&h<1;let l=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const o=Cr([e,t,n,s]),i=f(o)/this.targetWorldWidth_;l=i>To||l}!p&&this.sourceProj_.isGlobal()&&h&&(l=h>To||l)}if(!l&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!nn(u,this.maxSourceExtent_))return;let d=0;if(!l&&(!isFinite(o[0])||!isFinite(o[1])||!isFinite(i[0])||!isFinite(i[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(r[0])||!isFinite(r[1])))if(c>0)l=!0;else if(d=(!isFinite(o[0])||!isFinite(o[1])?8:0)+(!isFinite(i[0])||!isFinite(i[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(r[0])||!isFinite(r[1])?1:0),d!=1&&d!=2&&d!=4&&d!=8)return;if(c>0){if(!l){const r=[(e[0]+n[0])/2,(e[1]+n[1])/2],s=this.transformInv_(r);let t;if(p){const e=(Tt(o[0],m)+Tt(a[0],m))/2;t=e-Tt(s[0],m)}else t=(o[0]+a[0])/2-s[0];const i=(o[1]+a[1])/2-s[1],c=t*t+i*i;l=c>this.errorThresholdSquared_}if(l){if(Math.abs(e[0]-n[0])<=Math.abs(e[1]-n[1])){const l=[(t[0]+n[0])/2,(t[1]+n[1])/2],u=this.transformInv_(l),d=[(s[0]+e[0])/2,(s[1]+e[1])/2],h=this.transformInv_(d);this.addQuad_(e,t,l,d,o,i,u,h,c-1),this.addQuad_(d,l,n,s,h,u,a,r,c-1)}else{const l=[(e[0]+t[0])/2,(e[1]+t[1])/2],u=this.transformInv_(l),d=[(n[0]+s[0])/2,(n[1]+s[1])/2],h=this.transformInv_(d);this.addQuad_(e,l,d,s,o,u,h,r,c-1),this.addQuad_(l,t,n,d,u,i,a,h,c-1)}return}}if(p){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(d&11)==0&&this.addTriangle_(e,n,s,o,a,r),(d&14)==0&&this.addTriangle_(e,n,t,o,a,i),d&&((d&13)==0&&this.addTriangle_(t,s,e,i,r,o),(d&7)==0&&this.addTriangle_(t,s,n,i,r,a))}calculateSourceExtent(){const e=We();return this.triangles_.forEach(function(t){const o=t.source;Rs(e,o[0]),Rs(e,o[1]),Rs(e,o[2])}),e}getTriangles(){return this.triangles_}},cl=ud,Gc=.5,Nc=class extends ks{constructor(e,t,s,o,i,a,r,c,l,d,u,h){super(i,n.IDLE,h),this.renderEdges_=u!==0[0]&&u,this.pixelRatio_=r,this.gutter_=c,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=o,this.wrappedTileCoord_=a||i,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():0[0];const y=o.getTileCoordExtent(this.wrappedTileCoord_),_=this.targetTileGrid_.getExtent();let m=this.sourceTileGrid_.getExtent();const b=_?Ie(y,_):y;if(Oo(b)===0){this.state=n.EMPTY;return}const g=e.getExtent();g&&(m?m=Ie(m,g):m=g);const w=o.getResolution(this.wrappedTileCoord_[0]),v=e0(e,s,b,w);if(!isFinite(v)||v<=0){this.state=n.EMPTY;return}const O=d!==0[0]?d:Gc;if(this.triangulation_=new cl(e,s,b,m,v*O,w),this.triangulation_.getTriangles().length===0){this.state=n.EMPTY;return}this.sourceZ_=t.getZForResolution(v);let p=this.triangulation_.calculateSourceExtent();if(m&&(e.canWrapX()?(p[1]=j(p[1],m[1],m[3]),p[3]=j(p[3],m[1],m[3])):p=Ie(p,m)),Oo(p)){let s=0,o=0;e.canWrapX()&&(s=f(g),o=Math.floor((p[0]-g[0])/s));const i=l2(p.slice(),e,!0);i.forEach(e=>{const n=t.getTileRangeForExtentAndZ(e,this.sourceZ_);for(let e=n.minX;e<=n.maxX;e++)for(let t=n.minY;t<=n.maxY;t++){const i=o*s;this.sourceTiles_.push({getTile:()=>l(this.sourceZ_,e,t,r),offset:i})}++o}),this.sourceTiles_.length===0&&(this.state=n.EMPTY)}else this.state=n.EMPTY}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{const s=t.tile;if(s&&s.getState()==n.LOADED){const o=this.sourceTileGrid_.getTileCoordExtent(s.tileCoord);o[0]+=t.offset,o[2]+=t.offset;const n=this.clipExtent_?.slice();n&&(n[0]+=t.offset,n[2]+=t.offset),e.push({extent:o,clipExtent:n,image:s.getImage()})}}),this.sourceTiles_.length=0,e.length===0)this.state=n.ERROR;else{const s=this.wrappedTileCoord_[0],t=this.targetTileGrid_.getTileSize(s),o=typeof t=="number"?t:t[0],i=typeof t=="number"?t:t[1],a=this.targetTileGrid_.getResolution(s),r=this.sourceTileGrid_.getResolution(this.sourceZ_),c=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=m0(o,i,this.pixelRatio_,r,this.sourceTileGrid_.getExtent(),a,c,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=n.LOADED}this.changed()}load(){for(const e of this.sourceTiles_)e.tile=e.getTile();if(this.state==n.IDLE){this.state=n.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const s=t.getState();if(s==n.IDLE||s==n.LOADING){e++;const s=h(t,a.CHANGE,o=>{const i=t.getState();(i==n.LOADED||i==n.ERROR||i==n.EMPTY)&&(b(s),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(s)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e}){const o=e.getState();o==n.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(b),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Zi(this.canvas_.getContext("2d")),Ue.push(this.canvas_),this.canvas_=null),this.sourceTiles_.length=0,super.release()}},co=Nc;function Hd(e){let t=e.getDefaultTileGrid();return t||(t=ah(e),e.setDefaultTileGrid(t)),t}function Oh(e,t,n){const i=t[0],s=e.getTileCoordCenter(t),o=$r(n);if(!to(o,s)){const t=f(o),n=Math.ceil((o[0]-s[0])/t);return s[0]+=t*n,e.getTileCoordForCoordAndZ(s,i)}return t}function ph(e,t,n,s){s=s!==0[0]?s:"top-left";const o=uh(e,t,n);return new Ei({extent:e,origin:r3(e,s),resolutions:o,tileSize:n})}function uh(e,t,n,s){t=t!==0[0]?t:O1,n=D(n!==0[0]?n:nt);const a=$(e),r=f(e);s=s>0?s:Math.max(r/n[0],a/n[1]);const o=t+1,i=new Array(o);for(let e=0;e<o;++e)i[e]=s/2**e;return i}function ah(e,t,n,s){const o=$r(e);return ph(o,t,n,s)}function $r(e){e=Z(e);let t=e.getExtent();if(!t){const n=180*St.degrees/e.getMetersPerUnit();t=Ot(-n,-n,n,n)}return t}Xr=/\{z\}/g,tc=/\{x\}/g,cc=/\{y\}/g,lc=/\{-y\}/g;function Q3(e,t,n,s,o){return e.replace(Xr,t.toString()).replace(tc,n.toString()).replace(cc,s.toString()).replace(lc,function(){if(o===0[0])throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(o-s).toString()})}function U3(e){const n=[];let t=/\{([a-z])-([a-z])\}/.exec(e);if(t){const o=t[1].charCodeAt(0),i=t[2].charCodeAt(0);let s;for(s=o;s<=i;++s)n.push(e.replace(t[0],String.fromCharCode(s)));return n}if(t=/\{(\d+)-(\d+)\}/.exec(e),t){const s=parseInt(t[2],10);for(let o=parseInt(t[1],10);o<=s;o++)n.push(e.replace(t[0],o.toString()));return n}return n.push(e),n}function I3(e,t){return function(n){if(!n)return 0[0];let i;const a=n[0];if(t){const e=t.getFullTileRange(a);e&&(i=e.getHeight()-1)}return Q3(e,a,n[1],n[2],i)}}function P3(e,t){const n=e.length,s=new Array(n);for(let o=0;o<n;++o)s[o]=I3(e[o],t);return N3(s)}function N3(e){return e.length===1?e[0]:function(t,n,s){if(!t)return 0[0];const o=l0(t),i=Tt(o,e.length);return e[i](t,n,s)}}wt={PROPERTYCHANGE:"propertychange"},Lt=class extends cn{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(a.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const n=e.length,s=new Array(n);for(let o=0;o<n;++o)s[o]=h(this,e[o],t);return s}return h(this,e,t)}onceInternal(e,t){let n;if(Array.isArray(e)){const s=e.length;n=new Array(s);for(let o=0;o<s;++o)n[o]=bs(this,e[o],t)}else n=bs(this,e,t);return t.ol_key=n,n}unInternal(e,t){const n=t.ol_key;if(n)A3(n);else if(Array.isArray(e))for(let n=0,s=e.length;n<s;++n)this.removeEventListener(e[n],t);else this.removeEventListener(e,t)}},Lt.prototype.on,Lt.prototype.once,Lt.prototype.un;function A3(e){if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)b(e[t]);else b(e)}ho=Lt,mo=class extends ve{constructor(e,t,n){super(e),this.key=t,this.oldValue=n}},qc=class extends ho{constructor(e){super(),this.on,this.once,this.un,A(this),this.values_=null,e!==0[0]&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let n;n=`change:${e}`,this.hasListener(n)&&this.dispatchEvent(new mo(n,e,t)),n=wt.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new mo(n,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,n){const s=this.values_||(this.values_={});if(n)s[e]=t;else{const n=s[e];s[e]=t,n!==t&&this.notify(e,n)}}setProperties(e,t){for(const n in e)this.set(n,e[n],t)}applyProperties(e){if(!e.values_)return;Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const n=this.values_[e];delete this.values_[e],f1(this.values_)&&(this.values_=null),t||this.notify(e,n)}}},ce=qc,Xc=class extends ce{constructor(e){super(),this.projection=Z(e.projection),this.attributions_=Zc(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible??!0,this.loading=!1,this.state_=e.state!==0[0]?e.state:"ready",this.wrapX_=e.wrapX!==0[0]&&e.wrapX,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(e,n){t.viewResolver=e,t.viewRejector=n})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=Zc(e),this.changed()}setState(e){this.state_=e,this.changed()}};function Zc(e){return e?typeof e=="function"?e:(Array.isArray(e)||(e=[e]),t=>e):null}Jc=Xc,tl=class extends Jc{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=e.tilePixelRatio!==0[0]?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==0[0]?e.tileGrid:null;const t=[256,256];this.tileGrid&&D(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tmpSize=[0,0],this.key_=e.key||A(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(){return l()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:Hd(e)}getTilePixelRatio(){return this.tilePixelRatio_}getTilePixelSize(e,t,n){const i=this.getTileGridForProjection(n),s=this.getTilePixelRatio(t),o=D(i.getTileSize(e),this.tmpSize);return s==1?o:h0(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){const n=t!==0[0]?t:this.getProjection(),s=t!==0[0]?this.getTileGridForProjection(n):this.tileGrid||this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(e=Oh(s,e,n)),p0(e,s)?e:null}clear(){}refresh(){this.clear(),super.refresh()}},ol=class extends ve{constructor(e,t){super(e),this.tile=t}},rl=tl,$s={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},fl=class _UrlTile extends rl{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===_UrlTile.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const s=e.target,o=A(s),i=s.getState();let t;i==n.LOADING?(this.tileLoadingKeys_[o]=!0,t=$s.TILELOADSTART):o in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[o],t=i==n.ERROR?$s.TILELOADERROR:i==n.LOADED?$s.TILELOADEND:0[0]),t!=null&&this.dispatchEvent(new ol(t,s))}setTileLoadFunction(e){this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,typeof t!="undefined"?this.setKey(t):this.changed()}setUrl(e){const t=U3(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(P3(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(){}},gl=fl,Pl=class extends gl{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:e3,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate===0[0]||e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==0[0]?e.crossOrigin:null,this.referrerPolicy=e.referrerPolicy,this.tileClass=e.tileClass!==0[0]?e.tileClass:In,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!ls(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getTileGridForProjection(e){const n=this.getProjection();if(this.tileGrid&&(!n||ls(n,e)))return this.tileGrid;const t=A(e);return t in this.tileGridForProjection||(this.tileGridForProjection[t]=Hd(e)),this.tileGridForProjection[t]}createTile_(e,t,s,o,i,r){const d=[e,t,s],u=this.getTileCoordForTileUrlFunction(d,i),c=u?this.tileUrlFunction(u,o,i):0[0],l=new this.tileClass(d,c!==0[0]?n.IDLE:n.EMPTY,c!==0[0]?c:"",{crossOrigin:this.crossOrigin,referrerPolicy:this.referrerPolicy},this.tileLoadFunction,this.tileOptions);return l.key=r,l.addEventListener(a.CHANGE,this.handleTileChange.bind(this)),l}getTile(e,t,n,s,o,i){const a=this.getProjection();if(!a||!o||ls(a,o))return this.getTileInternal(e,t,n,s,a||o);const r=[e,t,n],l=this.getKey(),d=this.getTileGridForProjection(a),u=this.getTileGridForProjection(o),h=this.getTileCoordForTileUrlFunction(r,o),c=new co(a,d,o,u,r,h,this.getTilePixelRatio(s),this.getGutter(),(e,t,n,s)=>this.getTileInternal(e,t,n,s,a,i),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return c.key=l,c}getTileInternal(e,t,n,s,o,i){const r=this.getKey(),a=Kn(this,r,e,t,n);if(i&&i.containsKey(a)){const e=i.get(a);return e}const c=this.createTile_(e,t,n,s,o,r);return i?.set(a,c),c}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_==e)return;this.renderReprojectionEdges_=e,this.changed()}setTileGridForProjection(e,t){const n=Z(e);if(n){const e=A(n);e in this.tileGridForProjection||(this.tileGridForProjection[e]=t)}}};function e3(e,t){if(se){const n=e.getCrossOrigin();let s="same-origin",o="same-origin";n==="anonymous"||n===""?(s="cors",o="omit"):n==="use-credentials"&&(s="cors",o="include");const i={mode:s,credentials:o,referrerPolicy:e.getReferrerPolicy()};fetch(t,i).then(e=>{if(!e.ok)throw new Error(`HTTP ${e.status}`);return e.blob()}).then(e=>createImageBitmap(e)).then(t=>{const n=e.getImage();n.width=t.width,n.height=t.height;const s=n.getContext("2d");s.drawImage(t,0,0),t.close?.(),n.dispatchEvent(new Event("load"))}).catch(()=>{const t=e.getImage();t.dispatchEvent(new Event("error"))});return}e.getImage().src=t}Yl=Pl,dd=class extends In{constructor(e,t,n,s,o,i,a){super(t,n,s,o,i,a),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==n.LOADED){const t=this.tileSize_;if(e.width==t[0]&&e.height==t[1])return this.zoomifyImage_=e,e;const n=L(t[0],t[1]);return n.drawImage(e,0,0),this.zoomifyImage_=n.canvas,n.canvas}return e}};function Pt(e){return e.toLocaleString("en",{maximumFractionDigits:10})}Ad=class extends Yl{constructor(e){const n=e||{};let h=n.url||"";h=h+(h.lastIndexOf("/")===h.length-1||h===""?"":"/");const p=n.version||y.VERSION2,l=n.sizes||[],d=n.size;m(d!=null&&Array.isArray(d)&&d.length==2&&!isNaN(d[0])&&d[0]>0&&!isNaN(d[1])&&d[1]>0,"Missing or invalid `size`");const o=d[0],r=d[1],t=n.tileSize,w=n.tilePixelRatio||1,_=n.format||"jpg",j=n.quality||(n.version==y.VERSION1?"native":"default");let c=n.resolutions||[];const s=n.supports||[],b=n.extent||[0,-r,o,0],v=l!=null&&Array.isArray(l)&&l.length>0,g=t!==0[0]&&(typeof t=="number"&&Number.isInteger(t)&&t>0||Array.isArray(t)&&t.length>0),f=s!=null&&Array.isArray(s)&&(s.includes("regionByPx")||s.includes("regionByPct"))&&(s.includes("sizeByWh")||s.includes("sizeByH")||s.includes("sizeByW")||s.includes("sizeByPct"));let i,a,u;if(c.sort(function(e,t){return t-e}),g||f)if(t!=null&&(typeof t=="number"&&Number.isInteger(t)&&t>0?(i=t,a=t):Array.isArray(t)&&t.length>0&&((t.length==1||t[1]==0[0]&&Number.isInteger(t[0]))&&(i=t[0],a=t[0]),t.length==2&&(Number.isInteger(t[0])&&Number.isInteger(t[1])?(i=t[0],a=t[1]):t[0]==0[0]&&Number.isInteger(t[1])&&(i=t[1],a=t[1])))),(i===0[0]||a===0[0])&&(i=nt,a=nt),c.length==0){u=Math.max(Math.ceil(Math.log(o/i)/Math.LN2),Math.ceil(Math.log(r/a)/Math.LN2));for(let e=u;e>=0;e--)c.push(2**e)}else{const e=Math.max(...c);u=Math.round(Math.log(e)/Math.LN2)}else if(i=o,a=r,c=[],v){{l.sort(function(e,t){return e[0]-t[0]}),u=-1;const e=[];for(let t=0;t<l.length;t++){const n=o/l[t][0];if(c.length>0&&c[c.length-1]==n){e.push(t);continue}c.push(n),u++}if(e.length>0)for(let t=0;t<e.length;t++)l.splice(e[t]-t,1)}}else c.push(1),l.push([o,r]),u=0;const O=new Ei({tileSize:[i,a],extent:b,origin:Te(b),resolutions:c}),x=function(e){let b,m;const w=e[0];if(w>u)return;const O=e[1],x=e[2],d=c[w];if(O===0[0]||x===0[0]||d===0[0]||O<0||Math.ceil(o/d/i)<=O||x<0||Math.ceil(r/d/a)<=x)return;if(f||g){const e=O*i*d,t=x*a*d;let n=i*d,c=a*d,l=i,u=a;if(e+n>o&&(n=o-e),t+c>r&&(c=r-t),e+i*d>o&&(l=Math.floor((o-e+d-1)/d)),t+a*d>r&&(u=Math.floor((r-t+d-1)/d)),e==0&&n==o&&t==0&&c==r)b="full";else if(!f||s.includes("regionByPx"))b=e+","+t+","+n+","+c;else if(s.includes("regionByPct")){const s=Pt(e/o*100),i=Pt(t/r*100),a=Pt(n/o*100),l=Pt(c/r*100);b="pct:"+s+","+i+","+a+","+l}p==y.VERSION3&&(!f||s.includes("sizeByWh"))?m=l+","+u:!f||s.includes("sizeByW")?m=l+",":s.includes("sizeByH")?m=","+u:s.includes("sizeByWh")?m=l+","+u:s.includes("sizeByPct")&&(m="pct:"+Pt(100/d))}else if(b="full",v){const e=l[w][0],t=l[w][1];p==y.VERSION3?e==o&&t==r?m="max":m=e+","+t:e==o?m="full":m=e+","}else m=p==y.VERSION3?"max":"full";return h+b+"/"+m+"/0/"+j+"."+_},C=dd.bind(null,D(t||256).map(function(e){return e*w}));super({attributions:n.attributions,attributionsCollapsible:n.attributionsCollapsible,cacheSize:n.cacheSize,crossOrigin:n.crossOrigin,interpolate:n.interpolate,projection:n.projection,reprojectionErrorThreshold:n.reprojectionErrorThreshold,state:n.state,tileClass:C,tileGrid:O,tilePixelRatio:n.tilePixelRatio,tileUrlFunction:x,transition:n.transition}),this.zDirection=n.zDirection}},Fo=Ad,H={ADD:"add",REMOVE:"remove"},zo={LENGTH:"length"},$t=class extends ve{constructor(e,t,n){super(e),this.element=t,this.index=n}},$d=class extends ce{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e??[],this.unique_)for(let e=1,t=this.array_.length;e<t;++e)this.assertUnique_(this.array_[e],e);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,n=e.length;t<n;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let n=0,s=t.length;n<s;++n)e(t[n],n,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(zo.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new $t(H.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let n=0,s=t.length;n<s;++n)if(t[n]===e)return this.removeAt(n)}removeAt(e){if(e<0||e>=this.getLength())return 0[0];const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new $t(H.REMOVE,t,e)),t}setAt(e,t){const n=this.getLength();if(e>=n){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const s=this.array_[e];this.array_[e]=t,this.dispatchEvent(new $t(H.REMOVE,s,e)),this.dispatchEvent(new $t(H.ADD,t,e))}updateLength_(){this.set(zo.LENGTH,this.array_.length)}assertUnique_(e,t){const n=this.array_;for(let s=0,o=n.length;s<o;++s)if(n[s]===e&&s!==t)throw new Error("Duplicate item added to a unique collection")}},G=$d,Ru=class extends ve{constructor(e,t,n){super(e),this.map=t,this.frameState=n!==0[0]?n:null}},Ve=Ru,Pu=class extends Ve{constructor(e,t,n,s,o,i){super(e,t,o),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=s!==0[0]&&s,this.activePointers=i}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}},fe=Pu,v={SINGLECLICK:"singleclick",CLICK:a.CLICK,DBLCLICK:a.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Ns={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},t1=class extends cn{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===0[0]?1:t,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=h(n,Ns.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=h(n,Ns.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(a.TOUCHMOVE,this.boundHandleTouchMove_,!!Ni&&{passive:!1})}emulateClick_(e){let t=new fe(v.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==0[0]?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=0[0],t=new fe(v.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=0[0];const t=new fe(v.SINGLECLICK,this.map_,e);this.dispatchEvent(t)},250)}updateActivePointers_(e){const t=e,n=t.pointerId;if(t.type==v.POINTERUP||t.type==v.POINTERCANCEL){{delete this.trackedTouches_[n];for(const e in this.trackedTouches_)if(this.trackedTouches_[e].target!==t.target){delete this.trackedTouches_[e];break}}}else(t.type==v.POINTERDOWN||t.type==v.POINTERMOVE)&&(this.trackedTouches_[n]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new fe(v.POINTERUP,this.map_,e,0[0],0[0],this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(b),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new fe(v.POINTERDOWN,this.map_,e,0[0],0[0],this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const e=this.map_.getOwnerDocument();this.dragListenerKeys_.push(h(e,v.POINTERMOVE,this.handlePointerMove_,this),h(e,v.POINTERUP,this.handlePointerUp_,this),h(this.element_,v.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==e&&this.dragListenerKeys_.push(h(this.element_.getRootNode(),v.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new fe(v.POINTERDRAG,this.map_,e,this.dragging_,0[0],this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new fe(v.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(b(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(a.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(b(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(b),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},h1=t1,me={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},x={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Yt=1/0,C1=class{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,hs(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,n=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const s=this.keyFunction_(n);return delete this.queuedElements_[s],n}enqueue(e){m(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=Yt&&(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const n=this.elements_,t=this.priorities_,s=n.length,o=n[e],i=t[e],a=e;for(;e<s>>1;){const a=this.getLeftChildIndex_(e),o=this.getRightChildIndex_(e),i=o<s&&t[o]<t[a]?o:a;n[e]=n[i],t[e]=t[i],e=i}n[e]=o,t[e]=i,this.siftDown_(a,e)}siftDown_(e,t){const s=this.elements_,n=this.priorities_,i=s[t],o=n[t];for(;t>e;){const e=this.getParentIndex_(t);if(n[e]>o)s[t]=s[e],n[t]=n[e],t=e;else break}s[t]=i,n[t]=o}reprioritize(){const a=this.priorityFunction_,e=this.elements_,i=this.priorities_;let t=0;const r=e.length;let n,s,o;for(s=0;s<r;++s)n=e[s],o=a(n),o==Yt?delete this.queuedElements_[this.keyFunction_(n)]:(i[t]=o,e[t++]=n);e.length=t,i.length=t,this.heapify_()}},E1=C1,A1=class extends E1{constructor(e,t){super(t=>e.apply(null,t),e=>e[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);if(t){const t=e[0];t.addEventListener(a.CHANGE,this.boundHandleTileChange_)}return t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const s=e.target,t=s.getState();if(t===n.LOADED||t===n.ERROR||t===n.EMPTY){t!==n.ERROR&&s.removeEventListener(a.CHANGE,this.boundHandleTileChange_);const e=s.getKey();e in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[e],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let s=0;for(;this.tilesLoading_<e&&s<t&&this.getCount()>0;){const e=this.dequeue()[0],t=e.getKey(),o=e.getState();o===n.IDLE&&!(t in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[t]=!0,++this.tilesLoading_,++s,e.load())}}},T1=A1;function s0(e,t,n,s,o){if(!e||!(n in e.wantedTiles))return Yt;if(!e.wantedTiles[n][t.getKey()])return Yt;const i=e.viewState.center,a=s[0]-i[0],r=s[1]-i[1];return 65536*Math.log(o)+(a*a+r*r)**.5/o}I={ANIMATING:0,INTERACTING:1},X={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function G1(e,t,n){return function(s,o,i,a,r){if(!s)return 0[0];if(!o&&!t)return s;const h=t?0:i[0]*o,m=t?0:i[1]*o,f=r?r[0]:0,p=r?r[1]:0;let c=e[0]+h/2+f,d=e[2]-h/2+f,l=e[1]+m/2+p,u=e[3]-m/2+p;c>d&&(c=(d+c)/2,d=c),l>u&&(l=(u+l)/2,u=l);let g=j(s[0],c,d),v=j(s[1],l,u);if(a&&n&&o){const e=30*o;g+=-e*Math.log(1+Math.max(0,c-s[0])/e)+e*Math.log(1+Math.max(0,s[0]-d)/e),v+=-e*Math.log(1+Math.max(0,l-s[1])/e)+e*Math.log(1+Math.max(0,s[1]-u)/e)}return[g,v]}}function K4(e){return e}function I4(e,t,n,s,o,i,a){i=i||[],a=a||2;let r=0;for(let c=t;c<n;c+=s){const l=e[c],d=e[c+1];i[r++]=o[0]*l+o[2]*d+o[4],i[r++]=o[1]*l+o[3]*d+o[5];for(let t=2;t<a;t++)i[r++]=e[c+t]}return i&&i.length!=r&&(i.length=r),i}function D4(e,t,n,s,o,i,a){a=a||[];const c=Math.cos(o),l=Math.sin(o),d=i[0],u=i[1];let r=0;for(let o=t;o<n;o+=s){const i=e[o]-d,h=e[o+1]-u;a[r++]=d+i*c-h*l,a[r++]=u+i*l+h*c;for(let t=o+2;t<o+s;++t)a[r++]=e[t]}return a&&a.length!=r&&(a.length=r),a}function T4(e,t,n,s,o,i,a,r){r=r||[];const l=a[0],d=a[1];let c=0;for(let a=t;a<n;a+=s){const u=e[a]-l,h=e[a+1]-d;r[c++]=l+o*u,r[c++]=d+i*h;for(let t=a+2;t<a+s;++t)r[c++]=e[t]}return r&&r.length!=c&&(r.length=c),r}function F4(e,t,n,s,o,i,a){a=a||[];let r=0;for(let c=t;c<n;c+=s){a[r++]=e[c]+o,a[r++]=e[c+1]+i;for(let t=c+2;t<c+s;++t)a[r++]=e[t]}return a&&a.length!=r&&(a.length=r),a}ri=vt(),_4=[NaN,NaN],b4=class extends ce{constructor(){super(),this.extent_=We(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=j0((e,t,n)=>{if(!n)return this.getSimplifiedGeometry(t);const s=this.clone();return s.applyTransform(n),s.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return l()}closestPointXY(){return l()}containsXY(e,t){return this.closestPointXY(e,t,_4,Number.MIN_VALUE)===0}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(){return l()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Rt(e),this.extentRevision_=this.getRevision()}return p2(this.extent_,e)}rotate(){l()}scale(){l()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(){return l()}getType(){return l()}applyTransform(){l()}intersectsExtent(){return l()}translate(){l()}transform(e,t){const n=Z(e),s=n.getUnits()=="tile-pixels"?function(e,s,o){const l=n.getExtent(),i=n.getWorldExtent(),r=$(i)/$(l);qt(ri,i[0],i[3],r,-r,0,0,0);const a=I4(e,0,e.length,o,ri,s),c=dn(n,t);return c?c(a,a,o):a}:dn(n,t);return this.applyTransform(s),this}},v4=b4,g4=class extends v4{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return L3(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return l()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e),n=t.getFlatCoordinates();return n.length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=h4(e),this.layout=e,this.flatCoordinates=t}setCoordinates(){l()}setLayout(e,t,n){let s;if(e)s=h4(e);else{for(let e=0;e<n;++e){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}s=t.length,e=M4(s)}this.layout=e,this.stride=s}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(e,t){const n=this.getFlatCoordinates();if(n){const s=this.getStride();D4(n,0,n.length,s,e,t,n),this.changed()}}scale(e,t,n){t===0[0]&&(t=e),n||(n=gt(this.getExtent()));const s=this.getFlatCoordinates();if(s){const o=this.getStride();T4(s,0,s.length,o,e,t,n,s),this.changed()}}translate(e,t){const n=this.getFlatCoordinates();if(n){const s=this.getStride();F4(n,0,n.length,s,e,t,n),this.changed()}}};function M4(e){let t;return e==2?t="XY":e==3?t="XYZ":e==4&&(t="XYZM"),t}function h4(e){let t;return e=="XY"?t=2:e=="XYZ"||e=="XYM"?t=3:e=="XYZM"&&(t=4),t}Es=g4;function s4(e,t,n,s){let o=0;const r=e[n-s],c=e[n-s+1];let i=0,a=0;for(;t<n;t+=s){const l=e[t]-r,d=e[t+1]-c;o+=a*l-i*d,i=l,a=d}return o/2}function H4(e,t,n,s){let o=0;for(let i=0,r=n.length;i<r;++i){const a=n[i];o+=s4(e,t,a,s),t=a}return o}function t4(e,t,n,s,o,i,a){const d=e[t],u=e[t+1],r=e[n]-d,c=e[n+1]-u;let l;if(r===0&&c===0)l=t;else{const h=((o-d)*r+(i-u)*c)/(r*r+c*c);if(h>1)l=n;else if(h>0){for(let o=0;o<s;++o)a[o]=Q4(e[t+o],e[n+o],h);a.length=s;return}else l=t}for(let t=0;t<s;++t)a[t]=e[l+t];a.length=s}function J1(e,t,n,s,o){let i=e[t],a=e[t+1];for(t+=s;t<n;t+=s){const r=e[t],c=e[t+1],l=Ct(i,a,r,c);l>o&&(o=l),i=r,a=c}return o}function G4(e,t,n,s,o){for(let i=0,r=n.length;i<r;++i){const a=n[i];o=J1(e,t,a,s,o),t=a}return o}function I1(e,t,n,s,o,i,a,r,c,l,d){if(t==n)return l;let u,h;if(o===0){if(h=Ct(a,r,e[t],e[t+1]),h<l){for(u=0;u<s;++u)c[u]=e[t+u];return c.length=s,h}return l}d=d||[NaN,NaN];let m=t+s;for(;m<n;)if(t4(e,m-s,m,s,a,r,d),h=Ct(a,r,d[0],d[1]),h<l){l=h;for(u=0;u<s;++u)c[u]=d[u];c.length=s,m+=s}else m+=s*Math.max((h**.5-l**.5)/o|0,1);if(i&&(t4(e,n-s,t,s,a,r,d),h=Ct(a,r,d[0],d[1]),h<l)){l=h;for(u=0;u<s;++u)c[u]=d[u];c.length=s}return l}function Z4(e,t,n,s,o,i,a,r,c,l,d){d=d||[NaN,NaN];for(let u=0,m=n.length;u<m;++u){const h=n[u];l=I1(e,t,h,s,o,i,a,r,c,l,d),t=h}return l}function o0(e,t,n){for(let s=0,o=n.length;s<o;++s)e[t++]=n[s];return t}function F1(e,t,n,s){for(let o=0,i=n.length;o<i;++o){const a=n[o];for(let n=0;n<s;++n)e[t++]=a[n]}return t}function i0(e,t,n,s,o){o=o||[];let i=0;for(let a=0,c=n.length;a<c;++a){const r=F1(e,t,n[a],s);o[i++]=r,t=r}return o.length=i,o}function w1(e,t,n,s,o){o=o!==0[0]?o:[];let i=0;for(let a=t;a<n;a+=s)o[i++]=e.slice(a,a+s);return o.length=i,o}function v0(e,t,n,s,o){o=o!==0[0]?o:[];let i=0;for(let a=0,c=n.length;a<c;++a){const r=n[a];o[i++]=w1(e,t,r,s,o[i]),t=r}return o.length=i,o}function b0(e,t,n,s,o,i,a){const l=(n-t)/s;if(l<3){for(;t<n;t+=s)i[a++]=e[t],i[a++]=e[t+1];return a}const d=new Array(l);d[0]=1,d[l-1]=1;const c=[t,n-s];let r=0;for(;c.length>0;){const n=c.pop(),i=c.pop();let a=0;const l=e[i],u=e[i+1],h=e[n],m=e[n+1];for(let t=i+s;t<n;t+=s){const c=e[t],d=e[t+1],o=U4(c,d,l,u,h,m);o>a&&(r=t,a=o)}a>o&&(d[(r-t)/s]=1,i+s<r&&c.push(i,r),r+s<n&&c.push(r,n))}for(let n=0;n<l;++n)d[n]&&(i[a++]=e[t+n*s],i[a++]=e[t+n*s+1]);return a}function ut(e,t){return t*Math.round(e/t)}function O0(e,t,n,s,o,i,a){if(t==n)return a;let l=ut(e[t],o),d=ut(e[t+1],o);t+=s,i[a++]=l,i[a++]=d;let r,c;do if(r=ut(e[t],o),c=ut(e[t+1],o),t+=s,t==n)return i[a++]=r,i[a++]=c,a;while(r==l&&c==d)for(;t<n;){const h=ut(e[t],o),m=ut(e[t+1],o);if(t+=s,h==r&&m==c)continue;const n=r-l,u=c-d,f=h-l,p=m-d;if(n*p==u*f&&(n<0&&f<n||n==f||n>0&&f>n)&&(u<0&&p<u||u==p||u>0&&p>u)){r=h,c=m;continue}i[a++]=r,i[a++]=c,l=r,d=c,r=h,c=m}return i[a++]=r,i[a++]=c,a}function C0(e,t,n,s,o,i,a,r){for(let c=0,d=n.length;c<d;++c){const l=n[c];a=O0(e,t,l,s,o,i,a),r.push(a),t=l}return a}Qu=class _LinearRing extends Es{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==0[0]&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new _LinearRing(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,n,s){return s<Pr(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=J1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)**.5,this.maxDeltaRevision_=this.getRevision()),I1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,n,s))}getArea(){return s4(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return w1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=b0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new _LinearRing(t,"XY")}getType(){return"LinearRing"}intersectsExtent(){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=F1(this.flatCoordinates,0,e,this.stride),this.changed()}},Ti=Qu,Gu=class _Point extends Es{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new _Point(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,s){const o=this.flatCoordinates,i=Ct(e,t,o[0],o[1]);if(i<s){const e=this.stride;for(let t=0;t<e;++t)n[t]=o[t];return n.length=e,i}return s}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return H3(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return bc(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=o0(this.flatCoordinates,0,e,this.stride),this.changed()}},Ku=Gu;function E0(e,t,n,s,o,i,a){let r,v,h,c,d,u,m;const l=o[i+1],f=[];for(let o=0,a=n.length;o<a;++o){const i=n[o];c=e[i-s],u=e[i-s+1];for(r=t;r<i;r+=s)d=e[r],m=e[r+1],(l<=u&&m<=l||u<=l&&l<=m)&&(h=(l-u)/(m-u)*(d-c)+c,f.push(h)),c=d,u=m}let p=NaN,g=-(1/0);f.sort(ss),c=f[0];for(r=1,v=f.length;r<v;++r){d=f[r];const o=Math.abs(d-c);o>g&&(h=(c+d)/2,m4(e,t,n,s,h,l)&&(p=h,g=o)),c=d}return isNaN(p)&&(p=o[i]),a?(a.push(p,l,g),a):[p,l,g]}function $0(e,t,n,s){for(;t<n-s;){for(let o=0;o<s;++o){const i=e[t+o];e[t+o]=e[n-s+o],e[n-s+o]=i}t+=s,n-=s}}function xu(e,t,n,s){let o=0,i=e[n-s],a=e[n-s+1];for(;t<n;t+=s){const r=e[t],c=e[t+1];o+=(r-i)*(c+a),i=r,a=c}return o===0?0[0]:o>0}function W0(e,t,n,s,o){o=o!==0[0]&&o;for(let i=0,c=n.length;i<c;++i){const r=n[i],a=xu(e,t,r,s);if(i===0){if(o&&a||!o&&!a)return!1}else if(o&&!a||!o&&a)return!1;t=r}return!0}function fu(e,t,n,s,o){o=o!==0[0]&&o;for(let i=0,c=n.length;i<c;++i){const r=n[i],a=xu(e,t,r,s),l=i===0?o&&a||!o&&!a:o&&!a||!o&&a;l&&$0(e,t,r,s),t=r}return t}Ii=class _Polygon extends Es{constructor(e,t,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==0[0]&&n?(this.setFlatCoordinates(t,e),this.ends_=n):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?P4(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new _Polygon(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,n,s){return s<Pr(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=G4(this.flatCoordinates,0,this.ends_,this.stride,0)**.5,this.maxDeltaRevision_=this.getRevision()),Z4(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,n,s))}containsXY(e,t){return m4(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return H4(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==0[0]?(t=this.getOrientedFlatCoordinates().slice(),fu(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,v0(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=gt(this.getExtent());this.flatInteriorPoint_=E0(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Ku(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new Ti(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const s=this.layout,o=this.flatCoordinates,e=this.ends_,t=[];let n=0;for(let i=0,r=e.length;i<r;++i){const a=e[i],c=new Ti(o.slice(n,a),s);t.push(c),n=a}return t}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;W0(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=fu(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=C0(this.flatCoordinates,0,this.ends_,this.stride,e**.5,t,0,n),new _Polygon(t,"XY",n)}getType(){return"Polygon"}intersectsExtent(e){return B4(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=i0(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}},du=Ii;function ou(e){if(on(e))throw new Error("Cannot create polygon from empty extent");const t=e[0],n=e[1],s=e[2],o=e[3],i=[t,n,t,o,s,o,s,n,t,n];return new Ii(i,"XY",[i.length])}function $i(e,t,n,s){const o=f(t)/n[0],i=$(t)/n[1];return s?Math.min(e,Math.max(o,i)):Math.min(e,Math.min(o,i))}function Wi(e,t,n){let s=Math.min(e,t);const o=50;return s*=Math.log(1+o*Math.max(0,e/t-1))/o+1,n&&(s=Math.max(s,n),s/=Math.log(1+o*Math.max(0,n/e-1))/o+1),j(s,n/2,t*2)}function Y0(e,t,n,s){return t=t===0[0]||t,function(o,i,a,r){if(o!==0[0]){const d=e[0],u=e[e.length-1],c=n?$i(d,n,a,s):d;if(r)return t?Wi(o,c,u):j(o,u,c);const h=Math.min(c,o),l=Math.floor(Zo(e,h,i));return e[l]>c&&l<e.length-1?e[l+1]:e[l]}}}function G0(e,t,n,s,o,i){return s=s===0[0]||s,n=n!==0[0]?n:0,function(a,r,c,l){if(a!==0[0]){const d=o?$i(t,o,c,i):t;if(l)return s?Wi(a,d,n):j(a,n,d);const u=1e-9,h=Math.ceil(Math.log(t/d)/Math.log(e)-u),m=-r*(.5-u)+.5,f=Math.min(d,a),p=Math.floor(Math.log(t/f)/Math.log(e)+m),g=Math.max(h,p),v=t/e**g;return j(v,n,d)}}}function Qd(e,t,n,s,o){return n=n===0[0]||n,function(i,a,r,c){if(i!==0[0]){const a=s?$i(e,s,r,o):e;return!n||!c?j(i,t,a):Wi(i,a,t)}}}function Yi(e){return e!==0[0]?0:0[0]}function Bd(e){return e!==0[0]?e:0[0]}function J0(e){const t=2*Math.PI/e;return function(e,n){return n?e:e!==0[0]?(e=Math.floor(e/t+.5)*t,e):0[0]}}function s2(e){const t=e===0[0]?xe(5):e;return function(e,n){return n||e===0[0]?e:(e<0?-e:e)<=t?0:e}}xs=0,Od=class extends ce{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Za(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=0[0],e.projection&&wh(),e.center&&(e.center=ae(e.center,this.projection_)),e.extent&&(e.extent=ye(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const n=Object.assign({},e);for(const e in X)delete n[e];this.setProperties(n,!0);const t=P2(e);this.maxResolution_=t.maxResolution,this.minResolution_=t.minResolution,this.zoomFactor_=t.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=t.minZoom;const s=O2(e),o=t.constraint,i=$2(e);this.constraints_={center:s,resolution:o,rotation:i},this.setRotation(e.rotation!==0[0]?e.rotation:0),this.setCenterInternal(e.center!==0[0]?e.center:null),e.resolution!==0[0]?this.setResolution(e.resolution):e.zoom!==0[0]&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const n=this.getCenterInternal();if(n){const s=e||[0,0,0,0];t=t||[0,0,0,0];const o=this.getResolution(),i=o/2*(s[3]-t[3]+t[1]-s[1]),a=o/2*(s[0]-t[0]+t[2]-s[2]);this.setCenterInternal([n[0]+i,n[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==0[0]?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let n=0;n<t.length;++n){let e=arguments[n];e.center&&(e=Object.assign({},e),e.center=ae(e.center,this.getProjection())),e.anchor&&(e=Object.assign({},e),e.anchor=ae(e.anchor,this.getProjection())),t[n]=e}this.animateInternal.apply(this,t)}animateInternal(){let t=arguments.length,s;t>1&&typeof arguments[t-1]=="function"&&(s=arguments[t-1],--t);let n=0;for(;n<t&&!this.isDef();++n){const e=arguments[n];e.center&&this.setCenterInternal(e.center),e.zoom!==0[0]?this.setZoom(e.zoom):e.resolution&&this.setResolution(e.resolution),e.rotation!==0[0]&&this.setRotation(e.rotation)}if(n===t){s&&ws(s,!0);return}let a=Date.now(),r=this.targetCenter_.slice(),o=this.targetResolution_,i=this.targetRotation_;const c=[];for(;n<t;++n){const l=arguments[n],e={start:a,complete:!1,anchor:l.anchor,duration:l.duration!==0[0]?l.duration:1e3,easing:l.easing||R0,callback:s};if(l.center&&(e.sourceCenter=r,e.targetCenter=l.center.slice(),r=e.targetCenter),l.zoom!==0[0]?(e.sourceResolution=o,e.targetResolution=this.getResolutionForZoom(l.zoom),o=e.targetResolution):l.resolution&&(e.sourceResolution=o,e.targetResolution=l.resolution,o=e.targetResolution),l.rotation!==0[0]){e.sourceRotation=i;const t=Tt(l.rotation-i+Math.PI,2*Math.PI)-Math.PI;e.targetRotation=i+t,i=e.targetRotation}J2(e)?e.complete=!0:a+=e.duration,c.push(e)}this.animations_.push(c),this.setHint(I.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[I.ANIMATING]>0}getInteracting(){return this.hints_[I.INTERACTING]>0}cancelAnimations(){this.setHint(I.ANIMATING,-this.hints_[I.ANIMATING]);let e;for(let n=0,s=this.animations_.length;n<s;++n){const t=this.animations_[n];if(t[0].callback&&ws(t[0].callback,!1),!e)for(let n=0,o=t.length;n<o;++n){const s=t[n];if(!s.complete){e=s.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==0[0]&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=0[0]),!this.getAnimating())return;const t=Date.now();let e=!1;for(let n=this.animations_.length-1;n>=0;--n){const s=this.animations_[n];let o=!0;for(let a=0,c=s.length;a<c;++a){const n=s[a];if(n.complete)continue;const l=t-n.start;let r=n.duration>0?l/n.duration:1;r>=1?(n.complete=!0,r=1):o=!1;const i=n.easing(r);if(n.sourceCenter){const e=n.sourceCenter[0],t=n.sourceCenter[1],s=n.targetCenter[0],o=n.targetCenter[1];this.nextCenter_=n.targetCenter;const a=e+i*(s-e),r=t+i*(o-t);this.targetCenter_=[a,r]}if(n.sourceResolution&&n.targetResolution){const e=i===1?n.targetResolution:n.sourceResolution+i*(n.targetResolution-n.sourceResolution);if(n.anchor){const t=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(e,0,t,!0);this.targetCenter_=this.calculateCenterZoom(s,n.anchor)}this.nextResolution_=n.targetResolution,this.targetResolution_=e,this.applyTargetState_(!0)}if(n.sourceRotation!==0[0]&&n.targetRotation!==0[0]){const e=i===1?Tt(n.targetRotation+Math.PI,2*Math.PI)-Math.PI:n.sourceRotation+i*(n.targetRotation-n.sourceRotation);if(n.anchor){const t=this.constraints_.rotation(e,!0);this.targetCenter_=this.calculateCenterRotate(t,n.anchor)}this.nextRotation_=n.targetRotation,this.targetRotation_=e}if(this.applyTargetState_(!0),e=!0,!n.complete)break}if(o){this.animations_[n]=null,this.setHint(I.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const e=s[0].callback;e&&ws(e,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===0[0]&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let n;const s=this.getCenterInternal();return s!==0[0]&&(n=[s[0]-t[0],s[1]-t[1]],na(n,e-this.getRotation()),D2(n,t)),n}calculateCenterZoom(e,t){let o;const n=this.getCenterInternal(),s=this.getResolution();if(n!==0[0]&&s!==0[0]){const i=t[0]-e*(t[0]-n[0])/s,a=t[1]-e*(t[1]-n[1])/s;o=[i,a]}return o}getViewportSize_(e){const t=this.viewportSize_;if(e){const n=t[0],s=t[1];return[Math.abs(n*Math.cos(e))+Math.abs(s*Math.sin(e)),Math.abs(n*Math.sin(e))+Math.abs(s*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&ca(e,this.getProjection())}getCenterInternal(){return this.get(X.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==0[0]?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return s3(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();m(t,"The view center is not defined");const n=this.getResolution();m(n!==0[0],"The view resolution is not defined");const s=this.getRotation();return m(s!==0[0],"The view rotation is not defined"),So(t,n,s,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(X.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(ye(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const n=f(e)/t[0],s=$(e)/t[1];return Math.max(n,s)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,s=Math.log(t/n)/Math.log(e);return function(n){const o=t/e**(n*s);return o}}getRotation(){return this.get(X.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),n=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,o=Math.log(n/s)/t;return function(e){const s=Math.log(n/e)/t/o;return s}}getViewportSizeMinusPadding_(e){let n=this.getViewportSize_(e);const t=this.padding_;return t&&(n=[n[0]-t[1]-t[3],n[1]-t[0]-t[2]]),n}getState(){const n=this.getProjection(),s=this.getResolution(),o=this.getRotation();let e=this.getCenterInternal();const t=this.padding_;if(t){const n=this.getViewportSizeMinusPadding_();e=ia(e,this.getViewportSize_(),[n[0]/2+t[3],n[1]/2+t[0]],s,o)}return{center:e.slice(0),projection:n!==0[0]?n:null,resolution:s,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:o,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==0[0]&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let s=this.minZoom_||0,t,n;if(this.resolutions_){const o=Zo(this.resolutions_,e,1);s=o,t=this.resolutions_[o],o==this.resolutions_.length-1?n=2:n=t/this.resolutions_[o+1]}else t=this.maxResolution_,n=this.zoomFactor_;return s+Math.log(t/e)/Math.log(n)}getResolutionForZoom(e){if(this.resolutions_?.length){if(this.resolutions_.length===1)return this.resolutions_[0];const t=j(Math.floor(e),0,this.resolutions_.length-2),n=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/n**j(e-t,0,1)}return this.maxResolution_/this.zoomFactor_**(e-this.minZoom_)}fit(e,t){let n;if(m(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){m(!on(e),"Cannot fit empty extent provided as `geometry`");const t=ye(e,this.getProjection());n=ou(t)}else if(e.getType()==="Circle"){const t=ye(e.getExtent(),this.getProjection());n=ou(t),n.rotate(this.getRotation(),gt(t))}else{const t=o3();t?n=e.clone().transform(t,this.getProjection()):n=e}this.fitInternal(n,t)}rotatedExtentForGeometry(e){const a=this.getRotation(),r=Math.cos(a),c=Math.sin(-a),t=e.getFlatCoordinates(),l=e.getStride();let n=1/0,s=1/0,o=-(1/0),i=-(1/0);for(let e=0,u=t.length;e<u;e+=l){const a=t[e]*r-t[e+1]*c,d=t[e]*c+t[e+1]*r;n=Math.min(n,a),s=Math.min(s,d),o=Math.max(o,a),i=Math.max(i,d)}return[n,s,o,i]}fitInternal(e,t){t=t||{};let a=t.size;a||(a=this.getViewportSizeMinusPadding_());const s=t.padding!==0[0]?t.padding:[0,0,0,0],m=t.nearest!==0[0]&&t.nearest;let i;t.minResolution!==0[0]?i=t.minResolution:t.maxZoom!==0[0]?i=this.getResolutionForZoom(t.maxZoom):i=0;const r=this.rotatedExtentForGeometry(e);let n=this.getResolutionForExtentInternal(r,[a[0]-s[1]-s[3],a[1]-s[0]-s[2]]);n=isNaN(n)?i:Math.max(n,i),n=this.getConstrainedResolution(n,m?0:1);const c=this.getRotation(),l=Math.sin(c),d=Math.cos(c),o=gt(r);o[0]+=(s[1]-s[3])/2*n,o[1]+=(s[0]-s[2])/2*n;const f=o[0]*d-o[1]*l,p=o[1]*d+o[0]*l,u=this.getConstrainedCenter([f,p],n),h=t.callback?t.callback:us;t.duration!==0[0]?this.animateInternal({resolution:n,center:u,duration:t.duration,easing:t.easing},h):(this.targetResolution_=n,this.targetCenter_=u,this.applyTargetState_(!1,!0),ws(h,!0))}centerOn(e,t,n){this.centerOnInternal(ae(e,this.getProjection()),t,n)}centerOnInternal(e,t,n){this.setCenterInternal(ia(e,t,n,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,n,s){let i;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-n),r=ia(e,s,[a[0]/2+o[3],a[1]/2+o[0]],t,n);i=[e[0]-r[0],e[1]-r[1]]}return i}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==0[0]}adjustCenter(e){const t=ca(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&ae(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const n=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),o=this.constraints_.resolution(this.targetResolution_*e,0,s,n);t&&(this.targetCenter_=this.calculateCenterZoom(o,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(this.zoomFactor_**-e,t)}adjustRotation(e,t){t&&(t=ae(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const n=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+e,n);t&&(this.targetCenter_=this.calculateCenterRotate(s,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&ae(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const o=this.getAnimating()||this.getInteracting()||t,n=this.constraints_.rotation(this.targetRotation_,o),i=this.getViewportSize_(n),s=this.constraints_.resolution(this.targetResolution_,0,i,o),a=this.constraints_.center(this.targetCenter_,s,i,o,this.calculateCenterShift(this.targetCenter_,s,n,i));this.get(X.ROTATION)!==n&&this.set(X.ROTATION,n),this.get(X.RESOLUTION)!==s&&(this.set(X.RESOLUTION,s),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(X.CENTER)||!Bs(this.get(X.CENTER),a))&&this.set(X.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=0[0]}resolveConstraints(e,t,n){e=e!==0[0]?e:200;const r=t||0,s=this.constraints_.rotation(this.targetRotation_),i=this.getViewportSize_(s),o=this.constraints_.resolution(this.targetResolution_,r,i),a=this.constraints_.center(this.targetCenter_,o,i,!1,this.calculateCenterShift(this.targetCenter_,o,s,i));if(e===0&&!this.cancelAnchor_){this.targetResolution_=o,this.targetRotation_=s,this.targetCenter_=a,this.applyTargetState_();return}n=n||(e===0?this.cancelAnchor_:0[0]),this.cancelAnchor_=0[0],(this.getResolution()!==o||this.getRotation()!==s||!this.getCenterInternal()||!Bs(this.getCenterInternal(),a))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:a,resolution:o,duration:e,easing:jt,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(I.INTERACTING,1)}endInteraction(e,t,n){n=n&&ae(n,this.getProjection()),this.endInteractionInternal(e,t,n)}endInteractionInternal(e,t,n){if(!this.getInteracting())return;this.setHint(I.INTERACTING,-1),this.resolveConstraints(e,t,n)}getConstrainedCenter(e,t){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),n)}getConstrainedZoom(e,t){const n=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(n,t))}getConstrainedResolution(e,t){t=t||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,n)}};function ws(e,t){setTimeout(function(){e(t)},0)}function O2(e){if(e.extent!==0[0]){const t=e.smoothExtentConstraint===0[0]||e.smoothExtentConstraint;return G1(e.extent,e.constrainOnlyCenter,t)}const t=Za(e.projection,"EPSG:3857");if(e.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-(1/0),e[2]=1/0,G1(e,!1,!1)}return K4}function P2(e){let r,n,t;const p=28,m=2;let i=e.minZoom!==0[0]?e.minZoom:xs,a=e.maxZoom!==0[0]?e.maxZoom:p;const s=e.zoomFactor!==0[0]?e.zoomFactor:m,g=e.multiWorld!==0[0]&&e.multiWorld,l=e.smoothResolutionConstraint===0[0]||e.smoothResolutionConstraint,d=e.showFullExtent!==0[0]&&e.showFullExtent,h=Za(e.projection,"EPSG:3857"),u=h.getExtent();let c=e.constrainOnlyCenter,o=e.extent;if(!g&&!o&&h.isGlobal()&&(c=!1,o=u),e.resolutions!==0[0]){const s=e.resolutions;n=s[i],t=s[a]!==0[0]?s[a]:s[s.length-1],e.constrainResolution?r=Y0(s,l,!c&&o,d):r=Qd(n,t,l,!c&&o,d)}else{const v=u?Math.max(f(u),$(u)):360*St.degrees/h.getMetersPerUnit(),g=v/nt/m**xs,b=g/m**(p-xs);n=e.maxResolution,n!==0[0]?i=0:n=g/s**i,t=e.minResolution,t===0[0]&&(e.maxZoom!==0[0]?e.maxResolution!==0[0]?t=n/s**a:t=g/s**a:t=b),a=i+Math.floor(Math.log(n/t)/Math.log(s)),t=n/s**(a-i),e.constrainResolution?r=G0(s,n,t,l,!c&&o,d):r=Qd(n,t,l,!c&&o,d)}return{constraint:r,maxResolution:n,minResolution:t,minZoom:i,zoomFactor:s}}function $2(e){const t=e.enableRotation===0[0]||e.enableRotation;if(t){const t=e.constrainRotation;return t===0[0]||t===!0?s2():t===!1?Bd:typeof t=="number"?J0(t):Bd}return Yi}function J2(e){return!(e.sourceCenter&&e.targetCenter&&!Bs(e.sourceCenter,e.targetCenter))&&e.sourceResolution===e.targetResolution&&e.sourceRotation===e.targetRotation}function ia(e,t,n,s,o){const a=Math.cos(-o);let i=Math.sin(-o),r=e[0]*a-e[1]*i,c=e[1]*a+e[0]*i;r+=(t[0]/2-n[0])*s,c+=(n[1]-t[1]/2)*s,i=-i;const l=r*a-c*i,d=c*a+r*i;return[l,d]}Q=Od,an="ol-hidden",ct="ol-unselectable",la="ol-unsupported",ln="ol-control",ua="ol-collapsed",C4=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),Al=class extends ce{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){this.element?.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&this.element?.remove();for(let e=0,t=this.listenerKeys.length;e<t;++e)b(this.listenerKeys[e]);if(this.listenerKeys.length=0,this.map_=e,e){const t=this.target_??e.getOverlayContainerStopEvent();this.element&&t.appendChild(this.element),this.render!==us&&this.listenerKeys.push(h(e,me.POSTRENDER,this.render,this)),e.render()}}render(){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}},Xe=Al,El=class extends Xe{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed===0[0]||e.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==0[0],this.collapsible_=e.collapsible===0[0]||e.collapsible,this.collapsible_||(this.collapsed_=!1),this.attributions_=e.attributions;const t=e.className!==0[0]?e.className:"ol-attribution",i=e.tipLabel!==0[0]?e.tipLabel:"Attributions",r=e.expandClassName!==0[0]?e.expandClassName:t+"-expand",n=e.collapseLabel!==0[0]?e.collapseLabel:"âº",c=e.collapseClassName!==0[0]?e.collapseClassName:t+"-collapse";typeof n=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=n,this.collapseLabel_.className=c):this.collapseLabel_=n;const s=e.label!==0[0]?e.label:"i";typeof s=="string"?(this.label_=document.createElement("span"),this.label_.textContent=s,this.label_.className=r):this.label_=s;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(a.CLICK,this.handleClick_.bind(this),!1);const d=t+" "+ct+" "+ln+(this.collapsed_&&this.collapsible_?" "+ua:"")+(this.collapsible_?"":" ol-uncollapsible"),o=this.element;o.className=d,o.appendChild(this.toggleButton_),o.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const n=this.getMap().getAllLayers(),t=new Set(n.flatMap(t=>t.getAttributions(e)));if(this.attributions_!==0[0]&&(Array.isArray(this.attributions_)?this.attributions_.forEach(e=>t.add(e)):t.add(this.attributions_)),!this.overrideCollapsible_){const e=!n.some(e=>e.getSource()?.getAttributionsCollapsible()===!1);this.setCollapsible(e)}return Array.from(t)}async updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=await Promise.all(this.collectSourceAttributions_(e).map(e=>_0(()=>e))),n=t.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),ts(t,this.renderedAttributions_))return;a2(this.ulElement_);for(let e=0,s=t.length;e<s;++e){const n=document.createElement("li");n.innerHTML=t[e],this.ulElement_.appendChild(n)}this.renderedAttributions_=t}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(ua),this.collapsed_?Ss(this.collapseLabel_,this.label_):Ss(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){if(this.collapsible_===e)return;this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_()}setCollapsed(e){if(this.userCollapsed_=e,!this.collapsible_||this.collapsed_===e)return;this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}},_l=El,bl=class extends Xe{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const s=e.className!==0[0]?e.className:"ol-rotate",n=e.label!==0[0]?e.label:"â§",o=e.compassClassName!==0[0]?e.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=o,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(o));const r=e.tipLabel?e.tipLabel:"Reset rotation",t=document.createElement("button");t.className=s+"-reset",t.setAttribute("type","button"),t.title=r,t.appendChild(this.label_),t.addEventListener(a.CLICK,this.handleClick_.bind(this),!1);const c=s+" "+ct+" "+ln,i=this.element;i.className=c,i.appendChild(t),this.callResetNorth_=e.resetNorth?e.resetNorth:0[0],this.duration_=e.duration!==0[0]?e.duration:250,this.autoHide_=e.autoHide===0[0]||e.autoHide,this.rotation_=0[0],this.autoHide_&&this.element.classList.add(an)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==0[0]?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const n=this.getMap(),e=n.getView();if(!e)return;const t=e.getRotation();t!==0[0]&&(this.duration_>0&&t%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:jt}):e.setRotation(0))}render(e){const n=e.frameState;if(!n)return;const t=n.viewState.rotation;if(t!=this.rotation_){const e="rotate("+t+"rad)";if(this.autoHide_){const e=this.element.classList.contains(an);!e&&t===0?this.element.classList.add(an):e&&t!==0&&this.element.classList.remove(an)}this.label_.style.transform=e}this.rotation_=t}},ba=bl,pl=class extends Xe{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const s=e.className!==0[0]?e.className:"ol-zoom",c=e.delta!==0[0]?e.delta:1,l=e.zoomInClassName!==0[0]?e.zoomInClassName:s+"-in",d=e.zoomOutClassName!==0[0]?e.zoomOutClassName:s+"-out",o=e.zoomInLabel!==0[0]?e.zoomInLabel:"+",i=e.zoomOutLabel!==0[0]?e.zoomOutLabel:"â",u=e.zoomInTipLabel!==0[0]?e.zoomInTipLabel:"Zoom in",h=e.zoomOutTipLabel!==0[0]?e.zoomOutTipLabel:"Zoom out",t=document.createElement("button");t.className=l,t.setAttribute("type","button"),t.title=u,t.appendChild(typeof o=="string"?document.createTextNode(o):o),t.addEventListener(a.CLICK,this.handleClick_.bind(this,c),!1);const n=document.createElement("button");n.className=d,n.setAttribute("type","button"),n.title=h,n.appendChild(typeof i=="string"?document.createTextNode(i):i),n.addEventListener(a.CLICK,this.handleClick_.bind(this,-c),!1);const m=s+" "+ct+" "+ln,r=this.element;r.className=m,r.appendChild(t),r.appendChild(n),this.duration_=e.duration!==0[0]?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const s=this.getMap(),t=s.getView();if(!t)return;const n=t.getZoom();if(n!==0[0]){const s=t.getConstrainedZoom(n+e);this.duration_>0?(t.getAnimating()&&t.cancelAnimations(),t.animate({zoom:s,duration:this.duration_,easing:jt})):t.setZoom(s)}}},ya=pl;function k3(e){e=e||{};const t=new G,n=e.zoom===0[0]||e.zoom;n&&t.push(new ya(e.zoomOptions));const s=e.rotate===0[0]||e.rotate;s&&t.push(new ba(e.rotateOptions));const o=e.attribution===0[0]||e.attribution;return o&&t.push(new _l(e.attributionOptions)),t}$c=class{constructor(e,t,n){this.decay_=e,this.minVelocity_=t,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const o=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<o)return!1;let e=t-3;for(;e>0&&this.points_[e+2]>o;)e-=3;const i=this.points_[t+2]-this.points_[e+2];if(i<1e3/60)return!1;const n=this.points_[t]-this.points_[e],s=this.points_[t+1]-this.points_[e+1];return this.angle_=Math.atan2(s,n),this.initialVelocity_=(n*n+s*s)**.5/i,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}},Vc=$c,xa={ACTIVE:"active"},Tc=class extends ce{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(xa.ACTIVE)}getMap(){return this.map_}handleEvent(){return!0}setActive(e){this.set(xa.ACTIVE,e)}setMap(e){this.map_=e}};function R3(e,t,n){const s=e.getCenterInternal();if(s){const o=[s[0]+t[0],s[1]+t[1]];e.animateInternal({duration:n!==0[0]?n:250,easing:P0,center:e.getConstrainedCenter(o)})}}function ka(e,t,n,s){const o=e.getZoom();if(o===0[0])return;const i=e.getConstrainedZoom(o+t),a=e.getResolutionForZoom(i);e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:a,anchor:n,duration:s!==0[0]?s:250,easing:jt})}ot=Tc,Mc=class extends ot{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==0[0]?e.duration:250}handleEvent(e){let t=!1;if(e.type==v.DBLCLICK){const n=e.originalEvent,s=e.map,o=e.coordinate,i=n.shiftKey?-this.delta_:this.delta_,a=s.getView();ka(a,i,o,this.duration_),n.preventDefault(),t=!0}return!t}},Sc=Mc;function Fa(){const t=arguments;return function(e){let n=!0;for(let s=0,o=t.length;s<o;++s)if(n=n&&t[s](e),!n)break;return n}}Ec=function(e){const t=e.originalEvent;return t.altKey&&!t.metaKey&&!t.ctrlKey&&t.shiftKey},vc=function(e){const t=e.map.getTargetElement(),n=t.getRootNode(),s=e.map.getOwnerDocument().activeElement;return n instanceof ShadowRoot?n.host.contains(s):t.contains(s)},Da=function(e){const t=e.map.getTargetElement(),n=t.getRootNode(),s=n instanceof ShadowRoot?n.host:t;return!s.hasAttribute("tabindex")||vc(e)},gc=rs,La=function(e){const t=e.originalEvent;return"pointerId"in t&&t.button==0&&!(n1&&Mi&&t.ctrlKey)},Ra=function(e){const t=e.originalEvent;return!t.altKey&&!t.metaKey&&!t.ctrlKey&&!t.shiftKey},pc=function(e){const t=e.originalEvent;return Mi?t.metaKey:t.ctrlKey},hc=function(e){const t=e.originalEvent;return!t.altKey&&!t.metaKey&&!t.ctrlKey&&t.shiftKey},Ia=function(e){const n=e.originalEvent,t=n.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!n.target.isContentEditable},ds=function(e){const t=e.originalEvent;return"pointerId"in t&&t.pointerType=="mouse"},uc=function(e){const t=e.originalEvent;return"pointerId"in t&&t.isPrimary&&t.button===0},dc=class extends ot{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(){return!1}handleDragEvent(){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==v.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==v.POINTERUP){const t=this.handleUpEvent(e);this.handlingDownUpSequence=t&&this.targetPointers.length>0}}else if(e.type==v.POINTERDOWN){const n=this.handleDownEvent(e);this.handlingDownUpSequence=n,t=this.stopDown(n)}else e.type==v.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(){}handleUpEvent(){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}};function Wa(e){const t=e.length;let n=0,s=0;for(let o=0;o<t;o++)n+=e[o].clientX,s+=e[o].clientY;return{clientX:n/t,clientY:s/t}}at=dc,rc=class extends at{constructor(e){super({stopDown:cs}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:Fa(Ra,uc);this.condition_=e.onFocusOnly?Fa(Da,t):t,this.noKinetic_=!1}handleDragEvent(e){const s=e.map;this.panning_||(this.panning_=!0,s.getView().beginInteraction());const n=this.targetPointers,t=s.getEventPixel(Wa(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(t[0],t[1]),this.lastCentroid){const n=[this.lastCentroid[0]-t[0],t[1]-this.lastCentroid[1]],o=e.map,s=o.getView();Y2(n,s.getResolution()),na(n,s.getRotation()),s.adjustCenterInternal(n)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=t,this.lastPointersCount_=n.length,e.originalEvent.preventDefault()}handleUpEvent(e){const n=e.map,t=n.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const e=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),i=t.getCenterInternal(),o=n.getPixelFromCoordinateInternal(i),a=n.getCoordinateFromPixelInternal([o[0]-e*Math.cos(s),o[1]-e*Math.sin(s)]);t.animateInternal({center:t.getConstrainedCenter(a),duration:500,easing:jt})}return this.panning_&&(this.panning_=!1,t.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const n=e.map,t=n.getView();return this.lastCentroid=null,t.getAnimating()&&t.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},Gr=rc,Wr=class extends at{constructor(e){e=e||{},super({stopDown:cs}),this.condition_=e.condition?e.condition:Ec,this.lastAngle_=0[0],this.duration_=e.duration!==0[0]?e.duration:250}handleDragEvent(e){if(!ds(e))return;const t=e.map,n=t.getView();if(n.getConstraints().rotation===Yi)return;const s=t.getSize(),o=e.pixel,i=Math.atan2(s[1]/2-o[1],o[0]-s[0]/2);if(this.lastAngle_!==0[0]){const e=i-this.lastAngle_;n.adjustRotationInternal(-e)}this.lastAngle_=i}handleUpEvent(e){if(!ds(e))return!0;const t=e.map,n=t.getView();return n.endInteraction(this.duration_),!1}handleDownEvent(e){if(!ds(e))return!1;if(La(e)&&this.condition_(e)){const t=e.map;return t.getView().beginInteraction(),this.lastAngle_=0[0],!0}return!1}},Ir=Wr,Ar=class extends jn{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,n="px",s=this.element_.style;s.left=Math.min(e[0],t[0])+n,s.top=Math.min(e[1],t[1])+n,s.width=Math.abs(t[0]-e[0])+n,s.height=Math.abs(t[1]-e[1])+n}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const t=this.startPixel_,n=this.endPixel_,s=[t,[t[0],n[1]],n,[n[0],t[1]]],e=s.map(this.map_.getCoordinateFromPixelInternal,this.map_);e[4]=e[0].slice(),this.geometry_?this.geometry_.setCoordinates([e]):this.geometry_=new du([e])}getGeometry(){return this.geometry_}},Or=Ar,Qe={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"},rt=class extends ve{constructor(e,t,n){super(e),this.coordinate=t,this.mapBrowserEvent=n}},yr=class extends at{constructor(e){super(),this.on,this.once,this.un,e=e??{},this.box_=new Or(e.className||"ol-dragbox"),this.minArea_=e.minArea??64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition??La,this.boxEndCondition_=e.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,n){const s=n[0]-t[0],o=n[1]-t[1];return s*s+o*o>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){if(!this.startPixel_)return;this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new rt(Qe.BOXDRAG,e.coordinate,e))}handleUpEvent(e){if(!this.startPixel_)return!1;const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new rt(t?Qe.BOXEND:Qe.BOXCANCEL,e.coordinate,e)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(e){return!!this.condition_(e)&&(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new rt(Qe.BOXSTART,e.coordinate,e)),!0)}onBoxEnd(){}setActive(e){e||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new rt(Qe.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(e)}setMap(e){const t=this.getMap();t&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new rt(Qe.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(e)}},Dl=yr,nr=class extends Dl{constructor(e){e=e||{};const t=e.condition?e.condition:hc;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==0[0]?e.duration:200,this.out_=e.out!==0[0]&&e.out}onBoxEnd(){const s=this.getMap(),n=s.getView();let t=this.getGeometry();if(this.out_){const s=n.rotatedExtentForGeometry(t),o=n.getResolutionForExtentInternal(s),e=n.getResolution()/o;t=t.clone(),t.scale(e*e)}n.fitInternal(t,{duration:this.duration_,easing:jt})}},sr=nr,ke={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"},ir=class extends ot{constructor(e){super(),e=e||{},this.defaultCondition_=function(e){return Ra(e)&&Ia(e)},this.condition_=e.condition!==0[0]?e.condition:this.defaultCondition_,this.duration_=e.duration!==0[0]?e.duration:100,this.pixelDelta_=e.pixelDelta!==0[0]?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==a.KEYDOWN){const s=e.originalEvent,n=s.key;if(this.condition_(e)&&(n==ke.DOWN||n==ke.LEFT||n==ke.RIGHT||n==ke.UP)){const l=e.map,i=l.getView(),o=i.getResolution()*this.pixelDelta_;let a=0,r=0;n==ke.DOWN?r=-o:n==ke.LEFT?a=-o:n==ke.RIGHT?a=o:r=o;const c=[a,r];na(c,i.getRotation()),R3(i,c,this.duration_),s.preventDefault(),t=!0}}return!t}},ar=ir,rr=class extends ot{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(e){return!pc(e)&&Ia(e)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==0[0]?e.duration:100}handleEvent(e){let t=!1;if(e.type==a.KEYDOWN||e.type==a.KEYPRESS){const s=e.originalEvent,n=s.key;if(this.condition_(e)&&(n==="+"||n==="-")){const o=e.map,i=n==="+"?this.delta_:-this.delta_,a=o.getView();ka(a,i,0[0],this.duration_),s.preventDefault(),t=!0}}return!t}},cr=rr,lr=40,dr=300,ur=class extends ot{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==0[0]?e.maxDelta:1,this.duration_=e.duration!==0[0]?e.duration:250,this.timeout_=e.timeout!==0[0]?e.timeout:80,this.useAnchor_=e.useAnchor===0[0]||e.useAnchor,this.constrainResolution_=e.constrainResolution!==0[0]&&e.constrainResolution;const t=e.condition?e.condition:gc;this.condition_=e.onFocusOnly?Fa(Da,t):t,this.lastAnchor_=null,this.startTime_=0[0],this.timeoutId_,this.mode_=0[0],this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=0[0];const e=this.getMap();if(!e)return;const t=e.getView();t.endInteraction(0[0],this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(e){if(!this.condition_(e))return!0;const r=e.type;if(r!==a.WHEEL)return!0;const o=e.map,i=e.originalEvent;i.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.pixel);let t=i.deltaY;switch(i.deltaMode){case WheelEvent.DOM_DELTA_LINE:t*=lr;break;case WheelEvent.DOM_DELTA_PAGE:t*=dr;break;default:}if(t===0)return!1;this.lastDelta_=t;const s=Date.now();this.startTime_===0[0]&&(this.startTime_=s),(!this.mode_||s-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(t)<4?"trackpad":"wheel");const n=o.getView();if(this.mode_==="trackpad"&&!n.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(n.getAnimating()&&n.cancelAnimations(),n.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),n.adjustZoom(-t/this.deltaPerZoom_,this.lastAnchor_?o.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=s,!1;this.totalDelta_+=t;const c=Math.max(this.timeout_-(s-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,o),c),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let n=-j(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),ka(t,n,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=0[0],this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=0[0],this.timeoutId_=0[0]}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}},hr=ur,mr=class extends at{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=cs),super(t),this.anchor_=null,this.lastAngle_=0[0],this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==0[0]?e.threshold:.3,this.duration_=e.duration!==0[0]?e.duration:250}handleDragEvent(e){let n=0;const s=this.targetPointers[0],o=this.targetPointers[1],i=Math.atan2(o.clientY-s.clientY,o.clientX-s.clientX);if(this.lastAngle_!==0[0]){const e=i-this.lastAngle_;this.rotationDelta_+=e,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),n=e}this.lastAngle_=i;const t=e.map,a=t.getView();if(a.getConstraints().rotation===Yi)return;this.anchor_=t.getCoordinateFromPixelInternal(t.getEventPixel(Wa(this.targetPointers))),this.rotating_&&(t.render(),a.adjustRotationInternal(n,this.anchor_))}handleUpEvent(e){if(this.targetPointers.length<2){const t=e.map,n=t.getView();return n.endInteraction(this.duration_),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=0[0],this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}},fr=mr,pr=class extends at{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=cs),super(t),this.anchor_=null,this.duration_=e.duration!==0[0]?e.duration:400,this.lastDistance_=0[0],this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const s=this.targetPointers[0],o=this.targetPointers[1],i=s.clientX-o.clientX,a=s.clientY-o.clientY,r=(i*i+a*a)**.5;this.lastDistance_!==0[0]&&(t=this.lastDistance_/r),this.lastDistance_=r;const n=e.map,c=n.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=n.getCoordinateFromPixelInternal(n.getEventPixel(Wa(this.targetPointers))),n.render(),c.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const t=e.map,n=t.getView(),s=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,s),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=0[0],this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}},gr=pr;function Eh(e){e=e||{};const t=new G,n=new Vc(-.005,.05,100),s=e.altShiftDragRotate===0[0]||e.altShiftDragRotate;s&&t.push(new Ir);const o=e.doubleClickZoom===0[0]||e.doubleClickZoom;o&&t.push(new Sc({delta:e.zoomDelta,duration:e.zoomDuration}));const i=e.dragPan===0[0]||e.dragPan;i&&t.push(new Gr({onFocusOnly:e.onFocusOnly,kinetic:n}));const a=e.pinchRotate===0[0]||e.pinchRotate;a&&t.push(new fr);const r=e.pinchZoom===0[0]||e.pinchZoom;r&&t.push(new gr({duration:e.zoomDuration}));const c=e.keyboard===0[0]||e.keyboard;c&&(t.push(new ar),t.push(new cr({delta:e.zoomDelta,duration:e.zoomDuration})));const l=e.mouseWheelZoom===0[0]||e.mouseWheelZoom;l&&t.push(new hr({onFocusOnly:e.onFocusOnly,duration:e.zoomDuration}));const d=e.shiftDragZoom===0[0]||e.shiftDragZoom;return d&&t.push(new sr({duration:e.zoomDuration})),t}u={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"},jr=class extends ce{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[u.OPACITY]=e.opacity!==0[0]?e.opacity:1,m(typeof t[u.OPACITY]=="number","Layer opacity must be a number"),t[u.VISIBLE]=e.visible===0[0]||e.visible,t[u.Z_INDEX]=e.zIndex,t[u.MAX_RESOLUTION]=e.maxResolution!==0[0]?e.maxResolution:1/0,t[u.MIN_RESOLUTION]=e.minResolution!==0[0]?e.minResolution:0,t[u.MIN_ZOOM]=e.minZoom!==0[0]?e.minZoom:-(1/0),t[u.MAX_ZOOM]=e.maxZoom!==0[0]?e.maxZoom:1/0,this.className_=t.className!==0[0]?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===0[0]||e},n=this.getZIndex();return t.opacity=j(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=n===0[0]&&!t.managed?1/0:n,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(){return l()}getLayerStatesArray(){return l()}getExtent(){return this.get(u.EXTENT)}getMaxResolution(){return this.get(u.MAX_RESOLUTION)}getMinResolution(){return this.get(u.MIN_RESOLUTION)}getMinZoom(){return this.get(u.MIN_ZOOM)}getMaxZoom(){return this.get(u.MAX_ZOOM)}getOpacity(){return this.get(u.OPACITY)}getSourceState(){return l()}getVisible(){return this.get(u.VISIBLE)}getZIndex(){return this.get(u.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(u.EXTENT,e)}setMaxResolution(e){this.set(u.MAX_RESOLUTION,e)}setMinResolution(e){this.set(u.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(u.MAX_ZOOM,e)}setMinZoom(e){this.set(u.MIN_ZOOM,e)}setOpacity(e){m(typeof e=="number","Layer opacity must be a number"),this.set(u.OPACITY,e)}setVisible(e){this.set(u.VISIBLE,e)}setZIndex(e){this.set(u.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},qs=jr,de={ADDLAYER:"addlayer",REMOVELAYER:"removelayer"},pe=class extends ve{constructor(e,t){super(e),this.layer=t}},Jn={LAYERS:"layers"},xr=class _LayerGroup extends qs{constructor(e){e=e||{};const n=Object.assign({},e);delete n.layers;let t=e.layers;super(n),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Jn.LAYERS,this.handleLayersChanged_),t?Array.isArray(t)?t=new G(t.slice(),{unique:!0}):m(typeof t.getArray=="function","Expected `layers` to be an array or a `Collection`"):t=new G(0[0],{unique:!0}),this.setLayers(t)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(b),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(h(e,H.ADD,this.handleLayersAdd_,this),h(e,H.REMOVE,this.handleLayersRemove_,this));for(const e in this.listenerKeys_)this.listenerKeys_[e].forEach(b);hs(this.listenerKeys_);const t=e.getArray();for(let e=0,s=t.length;e<s;e++){const n=t[e];this.registerLayerListeners_(n),this.dispatchEvent(new pe(de.ADDLAYER,n))}this.changed()}registerLayerListeners_(e){const t=[h(e,wt.PROPERTYCHANGE,this.handleLayerChange_,this),h(e,a.CHANGE,this.handleLayerChange_,this)];e instanceof _LayerGroup&&t.push(h(e,de.ADDLAYER,this.handleLayerGroupAdd_,this),h(e,de.REMOVELAYER,this.handleLayerGroupRemove_,this)),this.listenerKeys_[A(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new pe(de.ADDLAYER,e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new pe(de.REMOVELAYER,e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new pe(de.ADDLAYER,t)),this.changed()}handleLayersRemove_(e){const t=e.element,n=A(t);this.listenerKeys_[n].forEach(b),delete this.listenerKeys_[n],this.dispatchEvent(new pe(de.REMOVELAYER,t)),this.changed()}getLayers(){return this.get(Jn.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const e=t.getArray();for(let t=0,n=e.length;t<n;++t)this.dispatchEvent(new pe(de.REMOVELAYER,e[t]))}this.set(Jn.LAYERS,e)}getLayersArray(e){return e=e!==0[0]?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const n=e!==0[0]?e:[],o=n.length;this.getLayers().forEach(function(e){e.getLayerStatesArray(n)});const t=this.getLayerState();let s=t.zIndex;!e&&t.zIndex===0[0]&&(s=0);for(let i=o,a=n.length;i<a;i++){const e=n[i];e.opacity*=t.opacity,e.visible=e.visible&&t.visible,e.maxResolution=Math.min(e.maxResolution,t.maxResolution),e.minResolution=Math.max(e.minResolution,t.minResolution),e.minZoom=Math.max(e.minZoom,t.minZoom),e.maxZoom=Math.min(e.maxZoom,t.maxZoom),t.extent!==0[0]&&(e.extent!==0[0]?e.extent=Ie(e.extent,t.extent):e.extent=t.extent),e.zIndex===0[0]&&(e.zIndex=s)}return n}getSourceState(){return"ready"}},xn=xr,ne={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},kr=class extends qs{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(u.SOURCE,this.handleSourcePropertyChange_);const n=e.source?e.source:null;this.setSource(n)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(u.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){if(this.changed(),this.sourceReady_||this.getSource().getState()!=="ready")return;this.sourceReady_=!0,this.dispatchEvent("sourceready")}handleSourcePropertyChange_(){this.sourceChangeKey_&&(b(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=h(e,a.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const n=this.getMapInternal();!e&&n&&(e=n.getView()),e instanceof Q?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&n&&(t.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let s;if(t.layerStatesArray){if(s=t.layerStatesArray.find(e=>e.layer===this),!s)return!1}else s=this.getLayerState();const o=this.getExtent();return Xa(s,t.viewState)&&(!o||nn(o,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];const n=this.getSource()?.getAttributions();if(!n)return[];const s=e instanceof Q?e.getViewStateAndExtent():e;let t=n(s);return Array.isArray(t)||(t=[t]),t}render(e,t){const n=this.getRenderer();return n.prepareFrame(e)?(this.rendered=!0,n.renderFrame(e,t)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(){}renderDeferred(e){const t=this.getRenderer();if(!t)return;t.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(u.MAP,e)}getMapInternal(){return this.get(u.MAP)}setMap(e){this.mapPrecomposeKey_&&(b(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(b(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=h(e,ne.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=h(this,a.CHANGE,e.render,e),this.changed())}handlePrecompose_(e){const t=e.frameState.layerStatesArray,n=this.getLayerState(!1);m(!t.some(e=>e.layer===n.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),t.push(n)}setSource(e){this.set(u.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}};function Xa(e,t){if(!e.visible)return!1;const n=t.resolution;if(n<e.minResolution||n>=e.maxResolution)return!1;const s=t.zoom;return s>e.minZoom&&s<=e.maxZoom}En=kr;function Mr(e,t,n=0,s=e.length-1,o=_h){for(;s>n;){if(s-n>600){const i=s-n+1,r=t-n+1,c=Math.log(i),a=.5*Math.exp(2*c/3),l=.5*(c*a*(i-a)/i)**.5*(r-i/2<0?-1:1),d=Math.max(n,Math.floor(t-r*a/i+l)),u=Math.min(s,Math.floor(t+(i-r)*a/i+l));Mr(e,t,d,u,o)}const r=e[t];let a=n,i=s;for(An(e,n,t),o(e[s],r)>0&&An(e,n,s);a<i;){for(An(e,a,i),a++,i--;o(e[a],r)<0;)a++;for(;o(e[i],r)>0;)i--}o(e[n],r)===0?An(e,n,i):(i++,An(e,i,s)),i<=t&&(n=i+1),t<=i&&(s=i-1)}}function An(e,t,n){const s=e[t];e[t]=e[n],e[n]=s}function _h(e,t){return e<t?-1:e>t?1:0}zr=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const n=[];if(!$n(e,t))return n;const o=this.toBBox,s=[];for(;t;){for(let a=0;a<t.children.length;a++){const i=t.children[a],r=t.leaf?o(i):i;$n(e,r)&&(t.leaf?n.push(i):Ya(e,r)?this._all(i,n):s.push(i))}t=s.pop()}return n}collides(e){let t=this.data;if(!$n(e,t))return!1;const n=[];for(;t;){for(let s=0;s<t.children.length;s++){const o=t.children[s],i=t.leaf?this.toBBox(o):o;if($n(e,i)){if(t.leaf||Ya(e,i))return!0;n.push(o)}}t=n.pop()}return!1}load(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(let t=0;t<e.length;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=pt([]),this}remove(e,t){if(!e)return this;let n=this.data;const c=this.toBBox(e),s=[],r=[];let o,i,a;for(;n||s.length;){if(n||(n=s.pop(),i=s[s.length-1],o=r.pop(),a=!0),n.leaf){const o=yh(e,n.children,t);if(o!==-1)return n.children.splice(o,1),s.push(n),this._condense(s),this}!a&&!n.leaf&&Ya(n,c)?(s.push(n),r.push(o),o=0,i=n,n=n.children[0]):i?(o++,n=i.children[o],a=!1):n=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const n=[];for(;e;)e.leaf?t.push(...e.children):n.push(...e.children),e=n.pop();return t}_build(e,t,n,s){const a=n-t+1;let i=this._maxEntries,o;if(a<=i)return o=pt(e.slice(t,n+1)),mt(o,this.toBBox),o;s||(s=Math.ceil(Math.log(a)/Math.log(i)),i=Math.ceil(a/i**(s-1))),o=pt([]),o.leaf=!1,o.height=s;const r=Math.ceil(a/i),c=r*Math.ceil(i**.5);qr(e,t,n,c,this.compareMinX);for(let i=t;i<=n;i+=c){const a=Math.min(i+c-1,n);qr(e,i,a,r,this.compareMinY);for(let t=i;t<=a;t+=r){const n=Math.min(t+r-1,a);o.children.push(this._build(e,t,n,s-1))}}return mt(o,this.toBBox),o}_chooseSubtree(e,t,n,s){for(;!0;){if(s.push(t),t.leaf||s.length-1===n)break;let o=1/0,i=1/0,a;for(let r=0;r<t.children.length;r++){const s=t.children[r],n=Ga(s),c=oh(e,s)-n;c<i?(i=c,o=n<o?n:o,a=s):c===i&&n<o&&(o=n,a=s)}t=a||t.children[0]}return t}_insert(e,t,n){const o=n?e:this.toBBox(e),s=[],i=this._chooseSubtree(o,this.data,t,s);for(i.children.push(e),Mn(i,o);t>=0;)if(s[t].children.length>this._maxEntries)this._split(s,t),t--;else break;this._adjustParentBBoxes(o,s,t)}_split(e,t){const n=e[t],o=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,o);const a=this._chooseSplitIndex(n,i,o),s=pt(n.children.splice(a,n.children.length-a));s.height=n.height,s.leaf=n.leaf,mt(n,this.toBBox),mt(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(n,s)}_splitRoot(e,t){this.data=pt([e,t]),this.data.height=e.height+1,this.data.leaf=!1,mt(this.data,this.toBBox)}_chooseSplitIndex(e,t,n){let o,i=1/0,s=1/0;for(let a=t;a<=n-t;a++){const l=Sn(e,0,a,this.toBBox),d=Sn(e,a,n,this.toBBox),c=sh(l,d),r=Ga(l)+Ga(d);c<i?(i=c,o=a,s=r<s?r:s):c===i&&r<s&&(s=r,o=a)}return o||n-t}_chooseSplitAxis(e,t,n){const s=e.leaf?this.compareMinX:lh,o=e.leaf?this.compareMinY:ih,i=this._allDistMargin(e,t,n,s),a=this._allDistMargin(e,t,n,o);i<a&&e.children.sort(s)}_allDistMargin(e,t,n,s){e.children.sort(s);const o=this.toBBox,i=Sn(e,0,t,o),a=Sn(e,n-t,n,o);let r=Wn(i)+Wn(a);for(let s=t;s<n-t;s++){const a=e.children[s];Mn(i,e.leaf?o(a):a),r+=Wn(i)}for(let s=n-t-1;s>=t;s--){const i=e.children[s];Mn(a,e.leaf?o(i):i),r+=Wn(a)}return r}_adjustParentBBoxes(e,t,n){for(let s=n;s>=0;s--)Mn(t[s],e)}_condense(e){for(let t=e.length-1,n;t>=0;t--)e[t].children.length===0?t>0?(n=e[t-1].children,n.splice(n.indexOf(e[t]),1)):this.clear():mt(e[t],this.toBBox)}};function yh(e,t,n){if(!n)return t.indexOf(e);for(let s=0;s<t.length;s++)if(n(e,t[s]))return s;return-1}function mt(e,t){Sn(e,0,e.children.length,t,e)}function Sn(e,t,n,s,o){o||(o=pt(null)),o.minX=1/0,o.minY=1/0,o.maxX=-(1/0),o.maxY=-(1/0);for(let i=t;i<n;i++){const a=e.children[i];Mn(o,e.leaf?s(a):a)}return o}function Mn(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function lh(e,t){return e.minX-t.minX}function ih(e,t){return e.minY-t.minY}function Ga(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function Wn(e){return e.maxX-e.minX+(e.maxY-e.minY)}function oh(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function sh(e,t){const n=Math.max(e.minX,t.minX),s=Math.max(e.minY,t.minY),o=Math.min(e.maxX,t.maxX),i=Math.min(e.maxY,t.maxY);return Math.max(0,o-n)*Math.max(0,i-s)}function Ya(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function $n(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function pt(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-(1/0),maxY:-(1/0)}}function qr(e,t,n,s,o){const i=[t,n];for(;i.length;){if(n=i.pop(),t=i.pop(),n-t<=s)continue;const a=t+Math.ceil((n-t)/s/2)*s;Mr(e,a,t,n,o),i.push(t,a,a,n)}}Bn=[NaN,NaN,NaN,0];function nh(){return qa||(qa=L(1,1,0[0],{willReadFrequently:!0,desynchronized:!0})),qa}Qr=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Zr=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Jr=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,ec=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function Nn(e,t){return e.endsWith("%")?Number(e.substring(0,e.length-1))/t:Number(e)}function Tn(e){throw new Error('failed to parse "'+e+'" as color')}function sc(e){if(e.toLowerCase().startsWith("rgb")){const t=e.match(Zr)||e.match(Qr)||e.match(Jr);if(t){const n=t[4],e=100/255;return[j(Nn(t[1],e)+.5|0,0,255),j(Nn(t[2],e)+.5|0,0,255),j(Nn(t[3],e)+.5|0,0,255),n!==0[0]?j(Nn(n,100),0,1):1]}Tn(e)}if(e.startsWith("#")){if(ec.test(e)){const s=e.substring(1),t=s.length<=4?1:2,n=[0,0,0,255];for(let e=0,i=s.length;e<i;e+=t){let o=parseInt(s.substring(e,e+t),16);t===1&&(o+=o<<4),n[e/t]=o}return n[3]=n[3]/255,n}Tn(e)}const t=nh();t.fillStyle="#abcdef";let n=t.fillStyle;t.fillStyle=e,t.fillStyle===n&&(t.fillStyle="#fedcba",n=t.fillStyle,t.fillStyle=e,t.fillStyle===n&&Tn(e));const s=t.fillStyle;if(s.startsWith("#")||s.startsWith("rgba"))return sc(s);t.clearRect(0,0,1,1),t.fillRect(0,0,1,1);const o=Array.from(t.getImageData(0,0,1,1).data);return o[3]=_i(o[3]/255,3),o}function eh(e){return typeof e=="string"?e:za(e)}ic=1024,_t={},Rn=0;function J3(e){if(e.length===4)return e;const t=e.slice();return t[3]=1,t}function Ua(e){return e>.0031308?e**(1/2.4)*269.025-14.025:e*3294.6}function $a(e){return e>.2068965?e**3:(e-4/29)*(108/841)}function Va(e){return e>10.314724?((e+14.025)/269.025)**2.4:e/3294.6}function Ha(e){return e>.0088564?e**(1/3):e/(108/841)+4/29}function mc(e){const t=Va(e[0]),n=Va(e[1]),s=Va(e[2]),o=Ha(t*.222488403+n*.716873169+s*.06060791),i=500*(Ha(t*.452247074+n*.399439023+s*.148375274)-o),a=200*(o-Ha(t*.016863605+n*.117638439+s*.865350722)),r=Math.atan2(a,i)*(180/Math.PI);return[116*o-16,(i*i+a*a)**.5,r<0?r+360:r,e[3]]}function q3(e){const t=(e[0]+16)/116,i=e[1],a=e[2]*Math.PI/180,n=$a(t),s=$a(t+i/500*Math.cos(a)),o=$a(t-i/200*Math.sin(a)),r=Ua(s*3.021973625-n*1.617392459-o*.404875592),c=Ua(s*-.943766287+n*1.916279586+o*.027607165),l=Ua(s*.069407491-n*.22898585+o*1.159737864);return[j(r+.5|0,0,255),j(c+.5|0,0,255),j(l+.5|0,0,255),e[3]]}function Pa(e){if(e==="none")return Bn;if(_t.hasOwnProperty(e))return _t[e];if(Rn>=ic){let e=0;for(const t in _t)(e++&3)===0&&(delete _t[t],--Rn)}const t=sc(e);t.length!==4&&Tn(e);for(const n of t)isNaN(n)&&Tn(e);return _t[e]=t,++Rn,t}function Ye(e){return Array.isArray(e)?e:Pa(e)}function za(e){let t=e[0];t!=(t|0)&&(t=t+.5|0);let n=e[1];n!=(n|0)&&(n=n+.5|0);let s=e[2];s!=(s|0)&&(s=s+.5|0);const o=e[3]===0[0]?1:Math.round(e[3]*1e3)/1e3;return"rgba("+t+","+n+","+s+","+o+")"}Ae=0,T=1<<Ae++,c=1<<Ae++,N=1<<Ae++,Y=1<<Ae++,Fe=1<<Ae++,bt=1<<Ae++,kn=2**Ae-1,Gn={[T]:"boolean",[c]:"number",[N]:"string",[Y]:"color",[Fe]:"number[]",[bt]:"size"},kc=Object.keys(Gn).map(Number).sort(ss);function B3(e){return e in Gn}function Cn(e){const t=[];for(const n of kc)wn(e,n)&&t.push(Gn[n]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function wn(e,t){return(e&t)===t}function Ne(e,t){return e===t}_=class{constructor(e,t){if(!B3(e))throw new Error(`literal expressions must have a specific type, got ${Cn(e)}`);this.type=e,this.value=t}},zc=class{constructor(e,t,...n){this.type=e,this.operator=t,this.args=n}};function Dc(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function S(e,t,n){switch(typeof e){case"boolean":{if(Ne(t,N))return new _(N,e?"true":"false");if(!wn(t,T))throw new Error(`got a boolean, but expected ${Cn(t)}`);return new _(T,e)}case"number":{if(Ne(t,bt))return new _(bt,D(e));if(Ne(t,T))return new _(T,!!e);if(Ne(t,N))return new _(N,e.toString());if(!wn(t,c))throw new Error(`got a number, but expected ${Cn(t)}`);return new _(c,e)}case"string":{if(Ne(t,Y))return new _(Y,Pa(e));if(Ne(t,T))return new _(T,!!e);if(!wn(t,N))throw new Error(`got a string, but expected ${Cn(t)}`);return new _(N,e)}default:}if(!Array.isArray(e))throw new Error("expression must be an array or a primitive value");if(e.length===0)throw new Error("empty expression");if(typeof e[0]=="string")return j3(e,t,n);for(const t of e)if(typeof t!="number")throw new Error("expected an array of numbers");if(Ne(t,bt)){if(e.length!==2)throw new Error(`expected an array of two values for a size, got ${e.length}`);return new _(bt,e)}if(Ne(t,Y)){if(e.length===3)return new _(Y,[...e,1]);if(e.length===4)return new _(Y,e);throw new Error(`expected an array of 3 or 4 values for a color, got ${e.length}`)}if(!wn(t,Fe))throw new Error(`got an array of numbers, but expected ${Cn(t)}`);return new _(Fe,e)}e={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},Rc={[e.Get]:s(i(1,1/0),Pc),[e.Var]:s(i(1,1),F3),[e.Has]:s(i(1,1/0),Pc),[e.Id]:s(M3,it),[e.Concat]:s(i(2,1/0),d(N)),[e.GeometryType]:s(S3,it),[e.LineMetric]:s(it),[e.Resolution]:s(Oa,it),[e.Zoom]:s(Oa,it),[e.Time]:s(Oa,it),[e.Any]:s(i(2,1/0),d(T)),[e.All]:s(i(2,1/0),d(T)),[e.Not]:s(i(1,1),d(T)),[e.Equal]:s(i(2,2),d(kn)),[e.NotEqual]:s(i(2,2),d(kn)),[e.GreaterThan]:s(i(2,2),d(c)),[e.GreaterThanOrEqualTo]:s(i(2,2),d(c)),[e.LessThan]:s(i(2,2),d(c)),[e.LessThanOrEqualTo]:s(i(2,2),d(c)),[e.Multiply]:s(i(2,1/0),Uc),[e.Coalesce]:s(i(2,1/0),Uc),[e.Divide]:s(i(2,2),d(c)),[e.Add]:s(i(2,1/0),d(c)),[e.Subtract]:s(i(2,2),d(c)),[e.Clamp]:s(i(3,3),d(c)),[e.Mod]:s(i(2,2),d(c)),[e.Pow]:s(i(2,2),d(c)),[e.Abs]:s(i(1,1),d(c)),[e.Floor]:s(i(1,1),d(c)),[e.Ceil]:s(i(1,1),d(c)),[e.Round]:s(i(1,1),d(c)),[e.Sin]:s(i(1,1),d(c)),[e.Cos]:s(i(1,1),d(c)),[e.Atan]:s(i(1,2),d(c)),[e.Sqrt]:s(i(1,1),d(c)),[e.Match]:s(i(4,1/0),Yc,x3),[e.Between]:s(i(3,3),d(c)),[e.Interpolate]:s(i(6,1/0),Yc,O3),[e.Case]:s(i(3,1/0),C3,w3),[e.In]:s(i(2,2),_3),[e.Number]:s(i(1,1/0),d(kn)),[e.String]:s(i(1,1/0),d(kn)),[e.Array]:s(i(1,1/0),d(c)),[e.Color]:s(i(1,4),d(c)),[e.Band]:s(i(1,3),d(c)),[e.Palette]:s(i(2,2),y3),[e.ToString]:s(i(1,1),d(T|c|N|Y))};function Pc(e,t,n){const o=e.length-1,s=new Array(o);for(let t=0;t<o;++t){const i=e[t+1];switch(typeof i){case"number":{s[t]=new _(c,i);break}case"string":{s[t]=new _(N,i);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${i}`)}t===0&&n.properties.add(String(i))}return s}function F3(e,t,n){const s=e[1];if(typeof s!="string")throw new Error("expected a string argument for var operation");return n.variables.add(s),[new _(N,s)]}function M3(e,t,n){n.featureId=!0}function S3(e,t,n){n.geometryType=!0}function Oa(e,t,n){n.mapState=!0}function it(e){const s=e[0];if(e.length!==1)throw new Error(`expected no arguments for ${s} operation`);return[]}function i(e,t){return function(n){const a=n[0],i=n.length-1;if(e===t){if(i!==e){const t=e===1?"":"s";throw new Error(`expected ${e} argument${t} for ${a}, got ${i}`)}}else if(i<e||i>t){const n=t===1/0?`${e} or more`:`${e} to ${t}`;throw new Error(`expected ${n} arguments for ${a}, got ${i}`)}}}function Uc(e,t,n){const s=e.length-1,o=new Array(s);for(let i=0;i<s;++i){const a=S(e[i+1],t,n);o[i]=a}return o}function d(e){return function(t,n,s){const o=t.length-1,i=new Array(o);for(let n=0;n<o;++n){const a=S(t[n+1],e,s);i[n]=a}return i}}function C3(e){const o=e[0],s=e.length-1;if(s%2===0)throw new Error(`expected an odd number of arguments for ${o}, got ${s} instead`)}function Yc(e){const o=e[0],s=e.length-1;if(s%2===1)throw new Error(`expected an even number of arguments for operation ${o}, got ${s} instead`)}function x3(e,t,n){const o=e.length-1,r=N|c|T,i=S(e[1],r,n),a=S(e[e.length-1],t,n),s=new Array(o-2);for(let t=0;t<o-2;t+=2){try{const o=S(e[t+2],i.type,n);s[t]=o}catch(e){throw new Error(`failed to parse argument ${t+1} of match expression: ${e.message}`)}try{const o=S(e[t+3],a.type,n);s[t+1]=o}catch(e){throw new Error(`failed to parse argument ${t+2} of match expression: ${e.message}`)}}return[i,...s,a]}function O3(e,t,n){const o=e[1];let i;switch(o[0]){case"linear":i=1;break;case"exponential":const e=o[1];if(typeof e!="number"||e<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(e)} instead`);i=e;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(o)}`)}const r=new _(c,i);let a;try{a=S(e[2],c,n)}catch(e){throw new Error(`failed to parse argument 1 in interpolate expression: ${e.message}`)}const s=new Array(e.length-3);for(let o=0;o<s.length;o+=2){try{const t=S(e[o+3],c,n);s[o]=t}catch(e){throw new Error(`failed to parse argument ${o+2} for interpolate expression: ${e.message}`)}try{const i=S(e[o+4],t,n);s[o+1]=i}catch(e){throw new Error(`failed to parse argument ${o+3} for interpolate expression: ${e.message}`)}}return[r,a,...s]}function w3(e,t,n){const o=S(e[e.length-1],t,n),s=new Array(e.length-1);for(let t=0;t<s.length-1;t+=2){try{const o=S(e[t+1],T,n);s[t]=o}catch(e){throw new Error(`failed to parse argument ${t} of case expression: ${e.message}`)}try{const i=S(e[t+2],o.type,n);s[t+1]=i}catch(e){throw new Error(`failed to parse argument ${t+1} of case expression: ${e.message}`)}}return s[s.length-1]=o,s}function _3(e,t,n){let s=e[2];if(!Array.isArray(s))throw new Error(`the second argument for the "in" operator must be an array`);let o;if(typeof s[0]=="string"){if(s[0]!=="literal")throw new Error(`for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions`);if(!Array.isArray(s[1]))throw new Error(`failed to parse "in" expression: the literal operator must be followed by an array`);s=s[1],o=N}else o=c;const i=new Array(s.length);for(let e=0;e<i.length;e++)try{const t=S(s[e],o,n);i[e]=t}catch(t){throw new Error(`failed to parse haystack item ${e} for "in" expression: ${t.message}`)}const a=S(e[1],o,n);return[a,...i]}function y3(e,t,n){let i;try{i=S(e[1],c,n)}catch(e){throw new Error(`failed to parse first argument in palette expression: ${e.message}`)}const s=e[2];if(!Array.isArray(s))throw new Error("the second argument of palette must be an array");const o=new Array(s.length);for(let e=0;e<o.length;e++){let t;try{t=S(s[e],Y,n)}catch(t){throw new Error(`failed to parse color at index ${e} in palette expression: ${t.message}`)}if(!(t instanceof _))throw new Error(`the palette color at index ${e} must be a literal value`);o[e]=t}return[i,...o]}function s(...e){return function(t,n,s){const i=t[0];let o;for(let i=0;i<e.length;i++){const a=e[i](t,n,s);if(i==e.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");o=a}}return new zc(n,i,...o)}}function j3(e,t,n){const s=e[0],o=Rc[s];if(!o)throw new Error(`unknown operator: ${s}`);return o(e,t,n)}function nl(e){if(!e)return"";const t=e.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return nl(e.getGeometries()[0]);default:return""}}function sl(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function oe(e,t,n){const s=S(e,t,n);return J(s,n)}function J(t,n){if(t instanceof _){if(t.type===Y&&typeof t.value=="string"){const e=Pa(t.value);return function(){return e}}return function(){return t.value}}const s=t.operator;switch(s){case e.Number:case e.String:case e.Coalesce:return g3(t,n);case e.Get:case e.Var:case e.Has:return p3(t,n);case e.Id:return e=>e.featureId;case e.GeometryType:return e=>e.geometryType;case e.Concat:{const e=t.args.map(e=>J(e,n));return t=>"".concat(...e.map(e=>e(t).toString()))}case e.Resolution:return e=>e.resolution;case e.Any:case e.All:case e.Between:case e.In:case e.Not:return m3(t,n);case e.Equal:case e.NotEqual:case e.LessThan:case e.LessThanOrEqualTo:case e.GreaterThan:case e.GreaterThanOrEqualTo:return f3(t,n);case e.Multiply:case e.Divide:case e.Add:case e.Subtract:case e.Clamp:case e.Mod:case e.Pow:case e.Abs:case e.Floor:case e.Ceil:case e.Round:case e.Sin:case e.Cos:case e.Atan:case e.Sqrt:return h3(t,n);case e.Case:return u3(t,n);case e.Match:return d3(t,n);case e.Interpolate:return l3(t,n);case e.ToString:return c3(t,n);default:throw new Error(`Unsupported operator ${s}`)}}function g3(t,n){const s=t.operator,o=t.args.length,i=new Array(o);for(let e=0;e<o;++e)i[e]=J(t.args[e],n);switch(s){case e.Coalesce:return e=>{for(let t=0;t<o;++t){const n=i[t](e);if(typeof n!="undefined"&&n!==null)return n}throw new Error("Expected one of the values to be non-null")};case e.Number:case e.String:return e=>{for(let t=0;t<o;++t){const n=i[t](e);if(typeof n===s)return n}throw new Error(`Expected one of the values to be a ${s}`)};default:throw new Error(`Unsupported assertion operator ${s}`)}}function p3(t){const o=t.args[0],s=o.value;switch(t.operator){case e.Get:return e=>{const o=t.args;let n=e.properties[s];for(let e=1,t=o.length;e<t;++e){const s=o[e],i=s.value;n=n[i]}return n};case e.Var:return e=>e.variables[s];case e.Has:return e=>{const o=t.args;if(!(s in e.properties))return!1;let n=e.properties[s];for(let e=1,s=o.length;e<s;++e){const i=o[e],t=i.value;if(!n||!Object.hasOwn(n,t))return!1;n=n[t]}return!0};default:throw new Error(`Unsupported accessor operator ${t.operator}`)}}function f3(t,n){const i=t.operator,s=J(t.args[0],n),o=J(t.args[1],n);switch(i){case e.Equal:return e=>s(e)===o(e);case e.NotEqual:return e=>s(e)!==o(e);case e.LessThan:return e=>s(e)<o(e);case e.LessThanOrEqualTo:return e=>s(e)<=o(e);case e.GreaterThan:return e=>s(e)>o(e);case e.GreaterThanOrEqualTo:return e=>s(e)>=o(e);default:throw new Error(`Unsupported comparison operator ${i}`)}}function m3(t,n){const i=t.operator,o=t.args.length,s=new Array(o);for(let e=0;e<o;++e)s[e]=J(t.args[e],n);switch(i){case e.Any:return e=>{for(let t=0;t<o;++t)if(s[t](e))return!0;return!1};case e.All:return e=>{for(let t=0;t<o;++t)if(!s[t](e))return!1;return!0};case e.Between:return e=>{const t=s[0](e),n=s[1](e),o=s[2](e);return t>=n&&t<=o};case e.In:return e=>{const t=s[0](e);for(let n=1;n<o;++n)if(t===s[n](e))return!0;return!1};case e.Not:return e=>!s[0](e);default:throw new Error(`Unsupported logical operator ${i}`)}}function h3(t,n){const i=t.operator,o=t.args.length,s=new Array(o);for(let e=0;e<o;++e)s[e]=J(t.args[e],n);switch(i){case e.Multiply:return e=>{let t=1;for(let n=0;n<o;++n)t*=s[n](e);return t};case e.Divide:return e=>s[0](e)/s[1](e);case e.Add:return e=>{let t=0;for(let n=0;n<o;++n)t+=s[n](e);return t};case e.Subtract:return e=>s[0](e)-s[1](e);case e.Clamp:return e=>{const t=s[0](e),n=s[1](e);if(t<n)return n;const o=s[2](e);return t>o?o:t};case e.Mod:return e=>s[0](e)%s[1](e);case e.Pow:return e=>s[0](e)**s[1](e);case e.Abs:return e=>Math.abs(s[0](e));case e.Floor:return e=>Math.floor(s[0](e));case e.Ceil:return e=>Math.ceil(s[0](e));case e.Round:return e=>Math.round(s[0](e));case e.Sin:return e=>Math.sin(s[0](e));case e.Cos:return e=>Math.cos(s[0](e));case e.Atan:return o===2?e=>Math.atan2(s[0](e),s[1](e)):e=>Math.atan(s[0](e));case e.Sqrt:return e=>s[0](e)**.5;default:throw new Error(`Unsupported numeric operator ${i}`)}}function u3(e,t){const n=e.args.length,s=new Array(n);for(let o=0;o<n;++o)s[o]=J(e.args[o],t);return e=>{for(let t=0;t<n-1;t+=2){const o=s[t](e);if(o)return s[t+1](e)}return s[n-1](e)}}function d3(e,t){const s=e.args.length,n=new Array(s);for(let o=0;o<s;++o)n[o]=J(e.args[o],t);return e=>{const t=n[0](e);for(let o=1;o<s-1;o+=2)if(t===n[o](e))return n[o+1](e);return n[s-1](e)}}function l3(e,t){const s=e.args.length,n=new Array(s);for(let o=0;o<s;++o)n[o]=J(e.args[o],t);return e=>{const a=n[0](e),o=n[1](e);let i,t;for(let c=2;c<s;c+=2){const l=n[c](e);let r=n[c+1](e);const d=Array.isArray(r);if(d&&(r=J3(r)),l>=o)return c===2?r:d?a3(a,o,i,t,l,r):en(a,o,i,t,l,r);i=l,t=r}return t}}function c3(t,n){const s=t.operator,o=t.args.length,i=new Array(o);for(let e=0;e<o;++e)i[e]=J(t.args[e],n);switch(s){case e.ToString:return e=>{const n=i[0](e);return t.args[0].type===Y?za(n):n.toString()};default:throw new Error(`Unsupported convert operator ${s}`)}}function en(e,t,n,s,o,i){const a=o-n;if(a===0)return s;const r=t-n,c=e===1?r/a:(e**r-1)/(e**a-1);return s+c*(i-s)}function a3(e,t,n,s,o,i){const l=o-n;if(l===0)return s;const r=mc(s),c=mc(i);let a=c[2]-r[2];a>180?a-=360:a<-180&&(a+=360);const d=[en(e,t,n,r[0],o,c[0]),en(e,t,n,r[1],o,c[1]),r[2]+en(e,t,n,0,o,a),en(e,t,n,s[3],o,i[3])];return q3(d)}vl=class{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const n=this.cache_[t];(e++&3)===0&&!n.hasListener()&&(delete this.cache_[t],delete this.patternCache_[t],--this.cacheSize_)}}}get(e,t){const n=va(e,t),s=n in this.cache_?this.cache_[n]:null;return s}getPattern(e,t){const n=va(e,t);return n in this.patternCache_?this.patternCache_[n]:null}set(e,t,n,s){const o=va(e,t),i=o in this.cache_;this.cache_[o]=n,s&&(n.getImageState()===r.IDLE&&n.load(),n.getImageState()===r.LOADING?n.ready().then(()=>{this.patternCache_[o]=As().createPattern(n.getImage(1),"repeat")}):this.patternCache_[o]=As().createPattern(n.getImage(1),"repeat")),i||++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}};function va(e,t){const n=t?Ye(t):"null";return e+":"+n}V=new vl,Et=null,ga=class extends cn{constructor(e,t,n,s,o){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=n?.crossOrigin,this.referrerPolicy_=n?.referrerPolicy,this.canvas_={},this.color_=o,this.imageState_=s===0[0]?r.IDLE:s,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_),this.referrerPolicy_!==0[0]&&(this.image_.referrerPolicy=this.referrerPolicy_)}isTainted_(){if(this.tainted_===0[0]&&this.imageState_===r.LOADED){Et||(Et=L(1,1,0[0],{willReadFrequently:!0})),Et.drawImage(this.image_,0,0);try{Et.getImageData(0,0,1,1),this.tainted_=!1}catch{Et=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(a.CHANGE)}handleImageError_(){this.imageState_=r.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=r.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}setImage(e){this.image_=e}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],n=L(e,t);n.fillRect(0,0,e,t),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_!==r.IDLE)return;this.image_||this.initializeImage_(),this.imageState_=r.LOADING;try{this.src_!==0[0]&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&z0(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==r.LOADED)return;const n=this.image_,t=L(Math.ceil(n.width*e),Math.ceil(n.height*e)),s=t.canvas;t.scale(e,e),t.drawImage(n,0,0),t.globalCompositeOperation="multiply",t.fillStyle=eh(this.color_),t.fillRect(0,0,s.width/e,s.height/e),t.globalCompositeOperation="destination-in",t.drawImage(n,0,0),this.canvas_[e]=s}ready(){return this.ready_||(this.ready_=new Promise(e=>{if(this.imageState_===r.LOADED||this.imageState_===r.ERROR)e();else{const t=()=>{(this.imageState_===r.LOADED||this.imageState_===r.ERROR)&&(this.removeEventListener(a.CHANGE,t),e())};this.addEventListener(a.CHANGE,t)}})),this.ready_}};function Kt(e,t,n,s,o,i){let a=t===0[0]?0[0]:V.get(t,o);return a||(a=new ga(e,e&&"src"in e?e.src||0[0]:t,n,s,o),V.set(t,o,a,i)),i&&a&&!V.getPattern(t,o)&&V.set(t,o,a,i),a}Ol=ga;function xl(e){return e?Array.isArray(e)?za(e):typeof e=="object"&&"src"in e?i3(e):e:null}function i3(e){if(!e.offset||!e.size)return V.getPattern(e.src,e.color);const t=e.src+":"+e.offset,n=V.getPattern(t,e.color);if(n)return n;const s=V.get(e.src,null);if(s.getImageState()!==r.LOADED)return null;const o=L(e.size[0],e.size[1]);return o.drawImage(s.getImage(1),e.offset[0],e.offset[1],e.size[0],e.size[1],0,0,e.size[0],e.size[1]),Kt(o.canvas,t,0[0],r.LOADED,e.color,!0),V.getPattern(t,e.color)}pa="#000",fa="round",ma="round",Sl=10,Ml="#000",Fl=1,Tl=new ce,zl=class _ImageStyle{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=D(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new _ImageStyle({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return l()}getImage(){return l()}getHitDetectionImage(){return l()}getPixelRatio(){return 1}getImageState(){return l()}getImageSize(){return l()}getOrigin(){return l()}getSize(){return l()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=D(e)}listenImageChange(){l()}load(){l()}unlistenImageChange(){l()}ready(){return Promise.resolve()}},ha=zl,Nl=class _RegularShape extends ha{constructor(e){super({opacity:1,rotateWithView:e.rotateWithView!==0[0]&&e.rotateWithView,rotation:e.rotation!==0[0]?e.rotation:0,scale:e.scale!==0[0]?e.scale:1,displacement:e.displacement!==0[0]?e.displacement:[0,0],declutterMode:e.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=e.fill!==0[0]?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius=e.radius,this.radius2_=e.radius2,this.angle_=e.angle!==0[0]?e.angle:0,this.stroke_=e.stroke!==0[0]?e.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?r.LOADING:r.LOADED,this.imageState_===r.LOADING&&this.ready().then(()=>this.imageState_=r.LOADED),this.render()}clone(){const e=this.getScale(),t=new _RegularShape({fill:this.getFill()?this.getFill().clone():0[0],points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():0[0],rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_,t=this.getDisplacement(),n=this.getScaleArray();return[e[0]/2-t[0]/n[0],e[1]/2+t[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){const s=this.fill_?.getKey(),n=`${e},${this.angle_},${this.radius},${this.radius2_},${this.points_},${s}`+Object.values(this.renderOptions_).join(",");let t=V.get(n,null)?.getImage(1);if(!t){const s=this.renderOptions_,o=Math.ceil(s.size*e),i=L(o,o);this.draw_(s,i,e),t=i.canvas;const a=new Ol(t,0[0],null,r.LOADED,null);V.set(n,null,a),createImageBitmap(t).then(e=>{a.setImage(e)})}return t}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}setRadius(e){if(this.radius===e)return;this.radius=e,this.render()}getRadius2(){return this.radius2_}setRadius2(e){if(this.radius2_===e)return;this.radius2_=e,this.render()}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(){}load(){}unlistenImageChange(){}calculateLineJoinSize_(e,t,n){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let s=this.radius,o=this.radius2_===0[0]?s:this.radius2_;if(s<o){const e=s;s=o,o=e}const b=this.radius2_===0[0]?this.points_:this.points_*2,h=2*Math.PI/b,i=o*Math.sin(h),y=(o*o-i*i)**.5,c=s-y,u=(i*i+c*c)**.5,r=u/i;if(e==="miter"&&r<=n)return r*t;const m=t/2/r,f=t/2*(c/u),g=((s+m)*(s+m)+f*f)**.5,l=g-s;if(this.radius2_===0[0]||e==="bevel")return l*2;const a=s*Math.sin(h),v=(s*s-a*a)**.5,d=o-v,j=(a*a+d*d)**.5,p=j/a;if(p<=n){const e=p*t/2-o-s;return 2*Math.max(l,e)}return l*2}createRenderOptions(){let s=fa,e=ma,t=0,o=null,i=0,a,n=0;this.stroke_&&(a=xl(this.stroke_.getColor()??Ml),n=this.stroke_.getWidth()??Fl,o=this.stroke_.getLineDash(),i=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??ma,s=this.stroke_.getLineCap()??fa,t=this.stroke_.getMiterLimit()??Sl);const r=this.calculateLineJoinSize_(e,n,t),c=Math.max(this.radius,this.radius2_||0),l=Math.ceil(2*c+r);return{strokeStyle:a,strokeWidth:n,size:l,lineCap:s,lineDash:o,lineDashOffset:i,lineJoin:e,miterLimit:t}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,t,n){if(t.scale(n,n),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let e=this.fill_.getColor();e===null&&(e=pa),t.fillStyle=xl(e),t.fill()}e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){let t;if(this.fill_){let n=this.fill_.getColor(),s=0;typeof n=="string"&&(n=Ye(n)),n===null?s=1:Array.isArray(n)&&(s=n.length===4?n[3]:1),s===0&&(t=L(e.size,e.size),this.drawHitDetectionCanvas_(e,t))}return t?t.canvas:this.getImage(1)}createPath_(e){let t=this.points_;const n=this.radius;if(t===1/0)e.arc(0,0,n,0,2*Math.PI);else{const s=this.radius2_===0[0]?n:this.radius2_;this.radius2_!==0[0]&&(t*=2);const o=this.angle_-Math.PI/2,i=2*Math.PI/t;for(let a=0;a<t;a++){const r=o+a*i,c=a%2===0?n:s;e.lineTo(c*Math.cos(r),c*Math.sin(r))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=pa,t.fill(),e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}},da=Nl,Rl=class _CircleStyle extends da{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==0[0]?e.scale:1,rotation:e.rotation!==0[0]?e.rotation:0,rotateWithView:e.rotateWithView!==0[0]&&e.rotateWithView,displacement:e.displacement!==0[0]?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new _CircleStyle({fill:this.getFill()?this.getFill().clone():0[0],stroke:this.getStroke()?this.getStroke().clone():0[0],radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}},ra=Rl,Hl=class _Fill{constructor(e){e=e||{},this.patternImage_=null,this.color_=null,e.color!==0[0]&&this.setColor(e.color)}clone(){const e=this.getColor();return new _Fill({color:Array.isArray(e)?e.slice():e||0[0]})}getColor(){return this.color_}setColor(e){if(e!==null&&typeof e=="object"&&"src"in e){const t=Kt(null,e.src,{crossOrigin:"anonymous"},0[0],e.offset?null:e.color?e.color:null,!e.offset||!e.size);t.ready().then(()=>{this.patternImage_=null}),t.getImageState()===r.IDLE&&t.load(),t.getImageState()===r.LOADING&&(this.patternImage_=t)}this.color_=e}getKey(){const e=this.getColor();return e?e instanceof CanvasPattern||e instanceof CanvasGradient?A(e):typeof e=="object"&&"src"in e?e.src+":"+e.offset:Ye(e).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}},Wt=Hl;function Bl(e,t,n,s){return n!==0[0]&&s!==0[0]?[n/e,s/t]:n!==0[0]?n/e:s!==0[0]?s/t:1}Vl=class _Icon extends ha{constructor(e){e=e||{};const o=e.opacity!==0[0]?e.opacity:1,i=e.rotation!==0[0]?e.rotation:0,a=e.scale!==0[0]?e.scale:1,c=e.rotateWithView!==0[0]&&e.rotateWithView;super({opacity:o,rotation:i,scale:a,displacement:e.displacement!==0[0]?e.displacement:[0,0],rotateWithView:c,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==0[0]?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==0[0]?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==0[0]?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==0[0]?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==0[0]?e.crossOrigin:null,this.referrerPolicy_=e.referrerPolicy;const t=e.img!==0[0]?e.img:null;let n=e.src;m(n===0[0]||!t,"`image` and `src` cannot be provided at the same time"),(n===0[0]||n.length===0)&&t&&(n=t.src||A(t)),m(n!==0[0]&&n.length>0,"A defined and non-empty `src` or `image` must be provided"),m(e.width===0[0]&&e.height===0[0]||e.scale===0[0],"`width` or `height` cannot be provided together with `scale`");let s;if(e.src!==0[0]?s=r.IDLE:t!==0[0]&&("complete"in t?t.complete?s=t.src?r.LOADED:r.IDLE:s=r.LOADING:s=r.LOADED),this.color_=e.color!==0[0]?Ye(e.color):null,this.iconImage_=Kt(t,n,{crossOrigin:this.crossOrigin_,referrerPolicy:this.referrerPolicy_},s,this.color_),this.offset_=e.offset!==0[0]?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==0[0]?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==0[0]?e.size:null,this.initialOptions_,e.width!==0[0]||e.height!==0[0]){let t,n;if(e.size)[t,n]=e.size;else{const s=this.getImage(1);if(s.width&&s.height)t=s.width,n=s.height;else if(s instanceof HTMLImageElement){this.initialOptions_=e;const t=()=>{if(this.unlistenImageChange(t),!this.initialOptions_)return;const n=this.iconImage_.getSize();this.setScale(Bl(n[0],n[1],e.width,e.height))};this.listenImageChange(t);return}}t!==0[0]&&this.setScale(Bl(t,n,e.width,e.height))}}clone(){let e,t,n;return this.initialOptions_?(t=this.initialOptions_.width,n=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new _Icon({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||0[0],crossOrigin:this.crossOrigin_,referrerPolicy:this.referrerPolicy_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:n,size:this.size_!==null?this.size_.slice():0[0],src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const t=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!t)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=t[0]),this.anchorYUnits_=="fraction"&&(e[1]*=t[1])}if(this.anchorOrigin_!="top-left"){if(!t)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+t[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+t[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),n=this.getScaleArray();return[e[0]-t[0]/n[0],e[1]+t[1]/n[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}setColor(e){const t=e?Ye(e):null;if(this.color_===t||this.color_&&t&&this.color_.length===t.length&&this.color_.every((e,n)=>e===t[n]))return;this.color_=t;const n=this.getSrc(),s=n!==0[0]?null:this.getHitDetectionImage(),o=n!==0[0]?r.IDLE:this.iconImage_.getImageState();this.iconImage_=Kt(s,n,{crossOrigin:this.crossOrigin_,referrerPolicy:this.referrerPolicy_},o,this.color_)}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),n=this.iconImage_.getSize();if(!t||!n)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=n[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=n[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}setSrc(e){this.iconImage_=Kt(null,e,{crossOrigin:this.crossOrigin_,referrerPolicy:this.referrerPolicy_},r.IDLE,this.color_)}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();return this.size_?this.size_[0]*e[0]:this.iconImage_.getImageState()==r.LOADED?this.iconImage_.getSize()[0]*e[0]:0[0]}getHeight(){const e=this.getScaleArray();return this.size_?this.size_[1]*e[1]:this.iconImage_.getImageState()==r.LOADED?this.iconImage_.getSize()[1]*e[1]:0[0]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(a.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(a.CHANGE,e)}ready(){return this.iconImage_.ready()}},$l=Vl,Wl=class _Stroke{constructor(e){e=e||{},this.color_=e.color!==0[0]?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==0[0]?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.offset_=e.offset,this.width_=e.width}clone(){const e=this.getColor();return new _Stroke({color:Array.isArray(e)?e.slice():e||0[0],lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():0[0],lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),offset:this.getOffset(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getOffset(){return this.offset_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setOffset(e){this.offset_=e}setWidth(e){this.width_=e}},aa=Wl,oa=class _Style{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=Xl,e.geometry!==0[0]&&this.setGeometry(e.geometry),this.fill_=e.fill!==0[0]?e.fill:null,this.image_=e.image!==0[0]?e.image:null,this.renderer_=e.renderer!==0[0]?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==0[0]?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==0[0]?e.stroke:null,this.text_=e.text!==0[0]?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new _Style({geometry:e??0[0],fill:this.getFill()?this.getFill().clone():0[0],image:this.getImage()?this.getImage().clone():0[0],renderer:this.getRenderer()??0[0],stroke:this.getStroke()?this.getStroke().clone():0[0],text:this.getText()?this.getText().clone():0[0],zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==0[0]&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=Xl,this.geometry_=e}setZIndex(e){this.zIndex_=e}};function Z2(e){let t;if(typeof e=="function")t=e;else{let n;if(Array.isArray(e))n=e;else{m(typeof e.getZIndex=="function","Expected an `Style` or an array of `Style`");const t=e;n=[t]}t=function(){return n}}return t}Is=null;function Gl(){if(!Is){const e=new Wt({color:"rgba(255,255,255,0.4)"}),t=new aa({color:"#3399CC",width:1.25});Is=[new oa({image:new ra({fill:e,stroke:t,radius:5}),fill:e,stroke:t})]}return Is}function Xl(e){return e.getGeometry()}Vt=oa,Zl="#333",Jl=class _Text{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.keepUpright_=e.keepUpright,this.scale_=e.scale,this.scaleArray_=D(e.scale!==0[0]?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==0[0]?e.fill:new Wt({color:Zl}),this.maxAngle_=e.maxAngle!==0[0]?e.maxAngle:Math.PI/4,this.placement_=e.placement!==0[0]?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==0[0]?e.stroke:null,this.offsetX_=e.offsetX!==0[0]?e.offsetX:0,this.offsetY_=e.offsetY!==0[0]?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===0[0]?null:e.padding,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new _Text({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()instanceof Wt?this.getFill().clone():this.getFill(),stroke:this.getStroke()?this.getStroke().clone():0[0],offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():0[0],backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():0[0],padding:this.getPadding()||0[0],declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setKeepUpright(e){this.keepUpright_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=D(e!==0[0]?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}},ed=Jl;function q2(){return!0}function K2(e){const n=Dc(),s=U2(e,n),t=sl();return function(e,o){if(t.properties=e.getPropertiesInternal(),t.resolution=o,n.featureId){const n=e.getId();n!==0[0]?t.featureId=n:t.featureId=null}return n.geometryType&&(t.geometryType=nl(e.getGeometry())),s(t)}}function sd(e){const o=Dc(),n=e.length,i=new Array(n);for(let t=0;t<n;++t)i[t]=sa(e[t],o);const t=sl(),s=new Array(n);return function(e,a){if(t.properties=e.getPropertiesInternal(),t.resolution=a,o.featureId){const n=e.getId();n!==0[0]?t.featureId=n:t.featureId=null}let r=0;for(let e=0;e<n;++e){const o=i[e](t);o&&(s[r]=o,r+=1)}return s.length=r,s}}function U2(e,t){const n=e.length,s=new Array(n);for(let i=0;i<n;++i){const o=e[i],r="filter"in o?oe(o.filter,T,t):q2;let a;if(Array.isArray(o.style)){const e=o.style.length;a=new Array(e);for(let n=0;n<e;++n)a[n]=sa(o.style[n],t)}else a=[sa(o.style,t)];s[i]={filter:r,styles:a}}return function(t){const o=[];let i=!1;for(let a=0;a<n;++a){const r=s[a].filter;if(!r(t))continue;if(e[a].else&&i)continue;i=!0;for(const n of s[a].styles){const e=n(t);if(!e)continue;o.push(e)}}return o}}function sa(e,t){const s=Bt(e,"",t),o=Ht(e,"",t),i=M2(e,t),a=S2(e,t),r=k(e,"z-index",t);if(!s&&!o&&!i&&!a&&!f1(e))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(e));const n=new Vt;return function(e){let t=!0;if(s){const o=s(e);o&&(t=!1),n.setFill(o)}if(o){const s=o(e);s&&(t=!1),n.setStroke(s)}if(i){const s=i(e);s&&(t=!1),n.setText(s)}if(a){const s=a(e);s&&(t=!1),n.setImage(s)}return r&&n.setZIndex(r(e)),t?null:n}}function Bt(e,t,n){let s;if(t+"fill-pattern-src"in e)s=w2(e,t+"fill-",n);else{if(e[t+"fill-color"]==="none")return e=>null;s=Us(e,t+"fill-color",n)}if(!s)return null;const o=new Wt;return function(e){const t=s(e);return t===Bn?null:(o.setColor(t),o)}}function Ht(e,t,n){const o=k(e,t+"stroke-width",n),i=Us(e,t+"stroke-color",n);if(!o&&!i)return null;const a=je(e,t+"stroke-line-cap",n),r=je(e,t+"stroke-line-join",n),c=jd(e,t+"stroke-line-dash",n),l=k(e,t+"stroke-line-dash-offset",n),d=k(e,t+"stroke-miter-limit",n),u=k(e,t+"stroke-offset",n),s=new aa;return function(e){if(i){const t=i(e);if(t===Bn)return null;s.setColor(t)}if(o&&s.setWidth(o(e)),a){const t=a(e);if(t!=="butt"&&t!=="round"&&t!=="square")throw new Error("Expected butt, round, or square line cap");s.setLineCap(t)}if(r){const t=r(e);if(t!=="bevel"&&t!=="round"&&t!=="miter")throw new Error("Expected bevel, round, or miter line join");s.setLineJoin(t)}return c&&s.setLineDash(c(e)),l&&s.setLineDashOffset(l(e)),d&&s.setMiterLimit(d(e)),u&&s.setOffset(u(e)),s}}function M2(e,t){const n="text-",O=je(e,n+"value",t);if(!O)return null;const h=Bt(e,n,t),p=Bt(e,n+"background-",t),a=Ht(e,n,t),r=Ht(e,n+"background-",t),c=je(e,n+"font",t),l=k(e,n+"max-angle",t),d=k(e,n+"offset-x",t),u=k(e,n+"offset-y",t),o=lt(e,n+"overflow",t),m=je(e,n+"placement",t),f=k(e,n+"repeat",t),i=Vs(e,n+"scale",t),g=lt(e,n+"rotate-with-view",t),v=k(e,n+"rotation",t),b=je(e,n+"align",t),j=je(e,n+"justify",t),y=je(e,n+"baseline",t),_=lt(e,n+"keep-upright",t),w=jd(e,n+"padding",t),x=Ps(e,n+"declutter-mode"),s=new ed({declutterMode:x});return function(e){if(s.setText(O(e)),h&&s.setFill(h(e)),p&&s.setBackgroundFill(p(e)),a&&s.setStroke(a(e)),r&&s.setBackgroundStroke(r(e)),c&&s.setFont(c(e)),l&&s.setMaxAngle(l(e)),d&&s.setOffsetX(d(e)),u&&s.setOffsetY(u(e)),o&&s.setOverflow(o(e)),m){const t=m(e);if(t!=="point"&&t!=="line")throw new Error("Expected point or line for text-placement");s.setPlacement(t)}if(f&&s.setRepeat(f(e)),i&&s.setScale(i(e)),g&&s.setRotateWithView(g(e)),v&&s.setRotation(v(e)),b){const t=b(e);if(t!=="left"&&t!=="center"&&t!=="right"&&t!=="end"&&t!=="start")throw new Error("Expected left, right, center, start, or end for text-align");s.setTextAlign(t)}if(j){const t=j(e);if(t!=="left"&&t!=="right"&&t!=="center")throw new Error("Expected left, right, or center for text-justify");s.setJustify(t)}if(y){const t=y(e);if(t!=="bottom"&&t!=="top"&&t!=="middle"&&t!=="alphabetic"&&t!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");s.setTextBaseline(t)}return w&&s.setPadding(w(e)),_&&s.setKeepUpright(_(e)),s}}function S2(e,t){return"icon-src"in e?E2(e,t):"shape-points"in e?C2(e,t):"circle-radius"in e?x2(e,t):null}function E2(e,t){const n="icon-",h=n+"src",g=Fd(e[h],h),f=Ws(e,n+"anchor",t),c=Vs(e,n+"scale",t),u=k(e,n+"opacity",t),a=Ws(e,n+"displacement",t),l=k(e,n+"rotation",t),d=lt(e,n+"rotate-with-view",t),p=Ed(e,n+"anchor-origin"),C=kd(e,n+"anchor-x-units"),x=kd(e,n+"anchor-y-units"),i=ge(e,n+"color");let r,o=null;if(i!==0[0]){const s=Array.isArray(i)&&i.length>0&&typeof i[0]=="string";s?o=Us(e,n+"color",t):r=zd(i,n+"color")}const v=c2(e,n+"cross-origin"),b=r2(e,n+"offset"),j=Ed(e,n+"offset-origin"),y=Ji(e,n+"width"),_=Ji(e,n+"height"),w=g2(e,n+"size"),O=Ps(e,n+"declutter-mode"),m={src:g,anchorOrigin:p,anchorXUnits:C,anchorYUnits:x,crossOrigin:v,offset:b,offsetOrigin:j,height:_,width:y,size:w,declutterMode:O};let s=null;return function(e){if(s)o&&s.setColor(o(e));else{const t=o?o(e):r;s=new $l(t!==0[0]?Object.assign({},m,{color:t}):Object.assign({},m))}return u&&s.setOpacity(u(e)),a&&s.setDisplacement(a(e)),l&&s.setRotation(l(e)),d&&s.setRotateWithView(d(e)),c&&s.setScale(c(e)),f&&s.setAnchor(f(e)),s}}function C2(e,t){const n="shape-",d=n+"points",o=n+"radius",p=Qi(e[d],d);if(!(o in e))throw new Error(`Expected a number for ${o}`);const c=k(e,o,t),g=typeof e[o]=="number"?e[o]:5,i=n+"radius2",l=k(e,i,t),j=typeof e[i]=="number"?e[i]:0[0],u=Bt(e,n,t),h=Ht(e,n,t),m=Vs(e,n+"scale",t),a=Ws(e,n+"displacement",t),f=k(e,n+"rotation",t),r=lt(e,n+"rotate-with-view",t),v=Ji(e,n+"angle"),b=Ps(e,n+"declutter-mode"),s=new da({points:p,radius:g,radius2:j,angle:v,declutterMode:b});return function(e){return c&&s.setRadius(c(e)),l&&s.setRadius2(l(e)),u&&s.setFill(u(e)),h&&s.setStroke(h(e)),a&&s.setDisplacement(a(e)),f&&s.setRotation(f(e)),r&&s.setRotateWithView(r(e)),m&&s.setScale(m(e)),s}}function x2(e,t){const n="circle-",o=Bt(e,n,t),i=Ht(e,n,t),a=k(e,n+"radius",t),r=Vs(e,n+"scale",t),c=Ws(e,n+"displacement",t),l=k(e,n+"rotation",t),d=lt(e,n+"rotate-with-view",t),u=Ps(e,n+"declutter-mode"),s=new ra({radius:5,declutterMode:u});return function(e){return a&&s.setRadius(a(e)),o&&s.setFill(o(e)),i&&s.setStroke(i(e)),c&&s.setDisplacement(c(e)),l&&s.setRotation(l(e)),d&&s.setRotateWithView(d(e)),r&&s.setScale(r(e)),s}}function ge(e,t){if(!(t in e))return 0[0];const n=e[t];return n===0[0]?0[0]:n}function k(e,t,n){const s=ge(e,t);if(s===0[0])return 0[0];const o=oe(s,c,n);return function(e){return Qi(o(e),t)}}function je(e,t,n){const s=ge(e,t);if(s===0[0])return null;const o=oe(s,N,n);return function(e){return Fd(o(e),t)}}function w2(e,t,n){const a=je(e,t+"pattern-src",n),s=_d(e,t+"pattern-offset",n),o=_d(e,t+"pattern-size",n),i=Us(e,t+"color",n);return function(e){return{src:a(e),offset:s&&s(e),size:o&&o(e),color:i&&i(e)}}}function lt(e,t,n){const s=ge(e,t);if(s===0[0])return null;const o=oe(s,T,n);return function(e){const n=o(e);if(typeof n!="boolean")throw new Error(`Expected a boolean for ${t}`);return n}}function Us(e,t,n){const s=ge(e,t);if(s===0[0])return null;const o=oe(s,Y,n);return function(e){return zd(o(e),t)}}function jd(e,t,n){const s=ge(e,t);if(s===0[0])return null;if(Array.isArray(s)&&(s.length===0||typeof s[0]!="string")){const e=s.map((e,s)=>{if(typeof e=="number")return()=>e;const o=oe(e,c,n);return function(e){return Qi(o(e),`${t}[${s}]`)}});return function(t){const n=new Array(e.length);for(let s=0;s<e.length;++s)n[s]=e[s](t);return n}}const o=oe(s,Fe,n);return function(e){return Gt(o(e),t)}}function Ws(e,t,n){const s=ge(e,t);if(s===0[0])return null;const o=oe(s,Fe,n);return function(e){const n=Gt(o(e),t);if(n.length!==2)throw new Error(`Expected two numbers for ${t}`);return n}}function _d(e,t,n){const s=ge(e,t);if(s===0[0])return null;const o=oe(s,Fe,n);return function(e){return Dd(o(e),t)}}function Vs(e,t,n){const s=ge(e,t);if(s===0[0])return null;const o=oe(s,Fe|c,n);return function(e){return e2(o(e),t)}}function Ji(e,t){const n=e[t];if(n===0[0])return 0[0];if(typeof n!="number")throw new Error(`Expected a number for ${t}`);return n}function g2(e,t){const n=e[t];if(n===0[0])return 0[0];if(typeof n=="number")return D(n);if(!Array.isArray(n))throw new Error(`Expected a number or size array for ${t}`);if(n.length!==2||typeof n[0]!="number"||typeof n[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return n}function c2(e,t){const n=e[t];if(n===0[0])return 0[0];if(typeof n!="string")throw new Error(`Expected a string for ${t}`);return n}function Ed(e,t){const n=e[t];if(n===0[0])return 0[0];if(n!=="bottom-left"&&n!=="bottom-right"&&n!=="top-left"&&n!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return n}function kd(e,t){const n=e[t];if(n===0[0])return 0[0];if(n!=="pixels"&&n!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return n}function r2(e,t){const n=e[t];return n===0[0]?0[0]:Gt(n,t)}function Ps(e,t){const n=e[t];if(n===0[0])return 0[0];if(typeof n!="string")throw new Error(`Expected a string for ${t}`);if(n!=="declutter"&&n!=="obstacle"&&n!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return n}function Gt(e,t){if(!Array.isArray(e))throw new Error(`Expected an array for ${t}`);const n=e.length;for(let s=0;s<n;++s)if(typeof e[s]!="number")throw new Error(`Expected an array of numbers for ${t}`);return e}function Fd(e,t){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}function Qi(e,t){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}function zd(e,t){if(typeof e=="string")return e;const n=Gt(e,t),s=n.length;if(s<3||s>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return n}function Dd(e,t){const n=Gt(e,t);if(n.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return n}function e2(e,t){return typeof e=="number"?e:Dd(e,t)}Xi={RENDER_ORDER:"renderOrder"},Rd=class extends En{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter?String(e.declutter):0[0],this.renderBuffer_=e.renderBuffer!==0[0]?e.renderBuffer:100,this.style_=null,this.styleFunction_=0[0],this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==0[0]&&e.updateWhileAnimating,this.updateWhileInteracting_=e.updateWhileInteracting!==0[0]&&e.updateWhileInteracting}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Xi.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e,t){const n=this.getDeclutter();n in e.declutter===!1&&(e.declutter[n]=new zr(9)),this.getRenderer().renderDeclutter(e,t)}setRenderOrder(e){this.set(Xi.RENDER_ORDER,e)}setStyle(e){this.style_=e===0[0]?Gl:e;const t=Z0(e);this.styleFunction_=e===null?0[0]:Z2(t),this.changed()}setDeclutter(e){this.declutter_=e?String(e):0[0],this.changed()}};function Z0(e){if(e===0[0])return Gl;if(!e)return null;if(typeof e=="function")return e;if(e instanceof Vt)return e;if(!Array.isArray(e))return sd([e]);if(e.length===0)return[];const t=e.length,n=e[0];if(n instanceof Vt){const n=new Array(t);for(let s=0;s<t;++s){const o=e[s];if(!(o instanceof Vt))throw new Error("Expected a list of style instances");n[s]=o}return n}if("style"in n){const n=new Array(t);for(let s=0;s<t;++s){const o=e[s];if(!("style"in o))throw new Error("Expected a list of rules with a style property");n[s]=o}return K2(n)}const s=e;return sd(s)}er=Rd,Id=class extends ve{constructor(e,t,n,s){super(e),this.inversePixelTransform=t,this.frameState=n,this.context=s}},Gi=Id,Vd=class extends jn{constructor(e){super(),this.map_=e}dispatchRenderEvent(){l()}calculateMatrices2D(e){const t=e.viewState,n=e.coordinateToPixelTransform,s=e.pixelToCoordinateTransform;qt(n,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),p1(s,n)}forEachFeatureAtCoordinate(e,t,n,s,o,i,a,r){let l;const m=t.viewState;function g(e,t,n,s){return o.call(i,t,e?n:null,s)}const u=m.projection,v=G2(e.slice(),u),d=[[0,0]];if(u.canWrapX()&&s){const t=u.getExtent(),e=f(t);d.push([-e,0],[e,0])}const p=t.layerStatesArray,b=p.length,c=[],h=[];for(let s=0;s<d.length;s++)for(let i=b-1;i>=0;--i){const u=p[i],o=u.layer;if(o.hasRenderer()&&Xa(u,m)&&a.call(r,o)){const i=o.getRenderer(),a=o.getSource();if(i&&a){const o=a.getWrapX()?v:e,r=g.bind(null,u.managed);h[0]=o[0]+d[s][0],h[1]=o[1]+d[s][1],l=i.forEachFeatureAtCoordinate(h,t,n,r,c)}if(l)return l}}if(c.length===0)return 0[0];const j=1/c.length;return c.forEach((e,t)=>e.distanceSq+=t*j),c.sort((e,t)=>e.distanceSq-t.distanceSq),c.some(e=>l=e.callback(e.feature,e.layer,e.geometry)),l}hasFeatureAtCoordinate(e,t,n,s,o,i){const a=this.forEachFeatureAtCoordinate(e,t,n,s,rs,this,o,i);return a!==0[0]}getMap(){return this.map_}renderFrame(){l()}scheduleExpireIconCache(e){V.canExpireCache()&&e.postRenderFunctions.push(Q0)}};function Q0(){V.expire()}Wd=Vd,Ud=class extends Wd{constructor(e){super(e),this.fontChangeListenerKey_=h(Tl,wt.PROPERTYCHANGE,e.redrawText,e),this.element_=se?yd():document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=ct+" ol-layers";const n=e.getViewport();n&&n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const n=this.getMap();if(n.hasListener(e)){const s=new Gi(e,0[0],t);n.dispatchEvent(s)}}disposeInternal(){b(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(ne.PRECOMPOSE,e);const n=e.layerStatesArray.sort((e,t)=>e.zIndex-t.zIndex),i=n.some(e=>e.layer instanceof er&&e.layer.getDeclutter());i&&(e.declutter={});const a=e.viewState;this.children_.length=0;const o=[];let s=null;for(let t=0,d=n.length;t<d;++t){const r=n[t];e.layerIndex=t;const c=r.layer,l=c.getSourceState();if(!Xa(r,a)||l!="ready"&&l!="undefined"){c.unrender();continue}const i=c.render(e,s);if(!i)continue;i!==s&&(this.children_.push(i),s=i),o.push(r)}this.declutter(e,o),b2(this.element_,this.children_);const r=this.getMap(),t=r.getTargetElement();if(Oe(t)){const e=t.getContext("2d");for(const s of this.children_){const n=s.firstElementChild||s,o=s.style.backgroundColor;if(o&&(!Oe(n)||n.width>0)&&(e.fillStyle=o,e.fillRect(0,0,t.width,t.height)),Oe(n)&&n.width>0){e.save();const t=s.style.opacity||n.style.opacity;e.globalAlpha=t===""?1:Number(t);const o=n.style.transform;if(o)e.transform(...Po(o));else{const t=parseFloat(n.style.width)/n.width,s=parseFloat(n.style.height)/n.height;e.transform(t,0,0,s,0,0)}e.drawImage(n,0,0),e.restore()}}}this.dispatchRenderEvent(ne.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,t){if(!e.declutter)return;for(let n=t.length-1;n>=0;--n){const s=t[n],o=s.layer;o.getDeclutter()&&o.renderDeclutter(e,s)}t.forEach(t=>t.layer.renderDeferred(e))}},Kd=Ud;function qd(e){if(e instanceof En){e.setMapInternal(null);return}e instanceof xn&&e.getLayers().forEach(qd)}function Yd(e,t){if(e instanceof En){e.setMapInternal(t);return}if(e instanceof xn){const n=e.getLayers().getArray();for(let e=0,s=n.length;e<s;++e)Yd(n[e],t)}}Gd=class extends ce{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=X0(e);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==0[0]?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==0[0]?e.pixelRatio:Xu,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=vt(),this.pixelToCoordinateTransform_=vt(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,se||(this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_)),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,se||(this.resizeObserver_=new ResizeObserver(()=>this.updateSize())),this.controls=t.controls||(se?new G:k3()),this.interactions=t.interactions||(se?new G:Eh({onFocusOnly:!0})),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new T1(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(x.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(x.VIEW,this.handleViewChanged_),this.addChangeListener(x.SIZE,this.handleSizeChanged_),this.addChangeListener(x.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const n=this;e.view&&!(e.view instanceof Q)&&e.view.then(function(e){n.setView(new Q(e))}),this.controls.addEventListener(H.ADD,e=>{e.element.setMap(this)}),this.controls.addEventListener(H.REMOVE,e=>{e.element.setMap(null)}),this.interactions.addEventListener(H.ADD,e=>{e.element.setMap(this)}),this.interactions.addEventListener(H.REMOVE,e=>{e.element.setMap(null)}),this.overlays_.addEventListener(H.ADD,e=>{this.addOverlayInternal_(e.element)}),this.overlays_.addEventListener(H.REMOVE,e=>{const t=e.element.getId();t!==0[0]&&delete this.overlayIdIndex_[t.toString()],e.element.setMap(null)}),this.controls.forEach(e=>{e.setMap(this)}),this.interactions.forEach(e=>{e.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){const t=this.getLayerGroup().getLayers();t.push(e)}handleLayerAdd_(e){Yd(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==0[0]&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_?.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,n){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(e);n=n!==0[0]?n:{};const o=n.hitTolerance!==0[0]?n.hitTolerance:0,i=n.layerFilter!==0[0]?n.layerFilter:rs,a=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,o,a,t,null,i,null)}getFeaturesAtPixel(e,t){const n=[];return this.forEachFeatureAtPixel(e,function(e){n.push(e)},t),n}getAllLayers(){const e=[];function t(n){n.forEach(function(n){n instanceof xn?t(n.getLayers()):e.push(n)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(e);t=t!==0[0]?t:{};const s=t.layerFilter!==0[0]?t.layerFilter:rs,o=t.hitTolerance!==0[0]?t.hitTolerance:0,i=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,o,i,s,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const o=this.viewport_,t=o.getBoundingClientRect(),n=this.getSize(),i=t.width/n[0],a=t.height/n[1],s="changedTouches"in e?e.changedTouches[0]:e;return[(s.clientX-t.left)/i,(s.clientY-t.top)/a]}getTarget(){return this.get(x.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return ca(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?q(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==0[0]?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(x.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof G){t.setLayers(e);return}const n=t.getLayers();n.clear(),n.extend(e)}getLayers(){const e=this.getLayerGroup().getLayers();return e}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const n=e[t];if(!n.visible)continue;const s=n.layer.getRenderer();if(s&&!s.ready)return!0;const o=n.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=ae(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?q(t.coordinateToPixelTransform,e.slice(0,2)):null}getPixelRatio(){return this.pixelRatio_}setPixelRatio(e){if(this.pixelRatio_===e)return;this.pixelRatio_=e,this.render()}getRenderer(){return this.renderer_}getSize(){return this.get(x.SIZE)}getView(){return this.get(x.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,n,s){return s0(this.frameState_,e,t,n,s)}handleBrowserEvent(e,t){t=t||e.type;const n=new fe(t,this,e);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(e){if(!this.frameState_)return;const n=e.originalEvent,t=n.type;if(t===Ns.POINTERDOWN||t===a.WHEEL||t===a.KEYDOWN){const t=this.getOwnerDocument(),e=this.viewport_.getRootNode?this.viewport_.getRootNode():t,s=n.target,o=e instanceof ShadowRoot?e.host===s?e.host.ownerDocument:e:e===t?t.documentElement:e;if(this.overlayContainerStopEvent_.contains(s)||!o.contains(s))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const t=this.getInteractions().getArray().slice();for(let n=t.length-1;n>=0;n--){const s=t[n];if(s.getMap()!==this||!s.getActive()||!this.getTargetElement())continue;const o=s.handleEvent(e);if(!o||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let n=this.maxTilesLoading_,s=n;if(e){const t=e.viewHints;if(t[I.ANIMATING]||t[I.INTERACTING]){const t=Date.now()-e.time>8;n=t?0:8,s=t?0:2}}t.getTilesLoading()<n&&(t.reprioritize(),t.loadMoreTiles(n,s))}e&&this.renderer_&&!e.animate&&(this.renderComplete_?(this.hasListener(ne.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(ne.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Ve(me.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Ve(me.LOADSTART,this,e))));const n=this.postRenderFunctions_;if(e)for(let t=0,s=n.length;t<s;++t)n[t](this,e);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let e=0,t=this.targetChangeHandlerKeys_.length;e<t;++e)b(this.targetChangeHandlerKeys_[e]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(a.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(a.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_&&!Oe(this.targetElement_)){this.resizeObserver_?.unobserve(this.targetElement_);const e=this.targetElement_.getRootNode();e instanceof ShadowRoot&&this.resizeObserver_.unobserve(e.host),this.setSize(0[0])}const t=this.getTarget(),e=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=e,e){if(Oe(e)||e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Kd(this)),!Oe(e)){this.mapBrowserEventHandler_=new h1(this,this.moveTolerance_);for(const e in v)this.mapBrowserEventHandler_.addEventListener(v[e],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(a.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(a.WHEEL,this.boundHandleBrowserEvent_,!!Ni&&{passive:!1});let t;if(this.keyboardEventTarget_)t=this.keyboardEventTarget_;else{const n=e.getRootNode(),s=n instanceof ShadowRoot?n.host:e;t=s}if(this.targetChangeHandlerKeys_=[h(t,a.KEYDOWN,this.handleBrowserEvent,this),h(t,a.KEYPRESS,this.handleBrowserEvent,this)],e instanceof HTMLElement){const t=e.getRootNode();t instanceof ShadowRoot&&this.resizeObserver_.observe(t.host),this.resizeObserver_?.observe(e)}}this.updateSize()}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=0[0],this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=0[0])}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(b(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(b(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=h(e,wt.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=h(e,a.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(b),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new pe("addlayer",e)),this.layerGroupPropertyListenerKeys_=[h(e,wt.PROPERTYCHANGE,this.render,this),h(e,a.CHANGE,this.render,this),h(e,"addlayer",this.handleLayerAdd_,this),h(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=0[0],this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){if(!this.frameState_)return;const e=this.frameState_.layerStatesArray;for(let t=0,s=e.length;t<s;++t){const n=e[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===0[0]&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){const t=this.getLayerGroup().getLayers();return t.remove(e)}handleLayerRemove_(e){qd(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const n=this.getSize(),s=this.getView(),o=this.frameState_;let t=null;if(n!==0[0]&&x1(n)&&s&&s.isDef()){const i=s.getHints(this.frameState_?this.frameState_.viewHints:0[0]),o=s.getState();if(t={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:So(o.center,o.resolution,o.rotation,n),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:n,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:o,viewHints:i,wantedTiles:{},mapId:A(this),renderTargets:{}},o.nextCenter&&o.nextResolution){const e=isNaN(o.nextRotation)?o.rotation:o.nextRotation;t.nextExtent=So(o.nextCenter,o.nextResolution,e,n)}}if(this.frameState_=t,this.renderer_.renderFrame(t),t){if(t.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,t.postRenderFunctions),o){const e=!this.previousExtent_||!on(this.previousExtent_)&&!ro(t.extent,this.previousExtent_);e&&(this.dispatchEvent(new Ve(me.MOVESTART,this,o)),this.previousExtent_=Rt(this.previousExtent_))}const e=this.previousExtent_&&!t.viewHints[I.ANIMATING]&&!t.viewHints[I.INTERACTING]&&!ro(t.extent,this.previousExtent_);e&&(this.dispatchEvent(new Ve(me.MOVEEND,this,t)),dh(t.extent,this.previousExtent_))}this.dispatchEvent(new Ve(me.POSTRENDER,this,t)),this.renderComplete_=(this.hasListener(me.LOADSTART)||this.hasListener(me.LOADEND)||this.hasListener(ne.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=0[0],this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new pe("removelayer",t)),this.set(x.LAYERGROUP,e)}setSize(e){this.set(x.SIZE,e)}setTarget(e){this.set(x.TARGET,e)}setView(e){if(!e||e instanceof Q){this.set(x.VIEW,e);return}this.set(x.VIEW,new Q);const t=this;e.then(function(e){t.setView(new Q(e))})}updateSize(){const e=this.getTargetElement();let t=0[0];if(e){let n,s;if(Oe(e)){const t=e.getContext("2d").getTransform();n=e.width/t.a,s=e.height/t.d}else{const t=getComputedStyle(e);n=e.offsetWidth-parseFloat(t.borderLeftWidth)-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight)-parseFloat(t.borderRightWidth),s=e.offsetHeight-parseFloat(t.borderTopWidth)-parseFloat(t.paddingTop)-parseFloat(t.paddingBottom)-parseFloat(t.borderBottomWidth)}!isNaN(n)&&!isNaN(s)&&(t=[Math.max(0,n),Math.max(0,s)],!x1(t)&&!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&tr("No map visible because the map container's width or height are 0."))}const n=this.getSize();t&&(!n||!ts(t,n))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}};function X0(e){let i=null;e.keyboardEventTarget!==0[0]&&(i=typeof e.keyboardEventTarget=="string"?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);const t={},a=e.layers&&typeof e.layers.getLayers=="function"?e.layers:new xn({layers:e.layers});t[x.LAYERGROUP]=a,t[x.TARGET]=e.target,t[x.VIEW]=e.view instanceof Q?e.view:new Q;let s;e.controls!==0[0]&&(Array.isArray(e.controls)?s=new G(e.controls.slice()):(m(typeof e.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),s=e.controls));let o;e.interactions!==0[0]&&(Array.isArray(e.interactions)?o=new G(e.interactions.slice()):(m(typeof e.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),o=e.interactions));let n;return e.overlays!==0[0]?Array.isArray(e.overlays)?n=new G(e.overlays.slice()):(m(typeof e.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),n=e.overlays):n=new G,{controls:s,interactions:o,keyboardEventTarget:i,overlays:n,values:t}}qi=Gd;function Ki(e){return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageBitmap?e:null}Jd=new Error("disposed"),eu=[256,256],tu=class extends ks{constructor(e){const t=n.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;const e=Ki(this.data_);return e?[e.width,e.height]:eu}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==n.IDLE&&this.state!==n.ERROR)return;this.state=n.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=n.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=n.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(Jd),this.controller_=null),super.disposeInternal()}},Ui=tu,su=class{constructor(e){this.highWaterMark=e!==0[0]?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const e=this.pop();e instanceof jn&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e){const n=this.entries_[e];return m(n!==0[0],"Tried to get a value for a key that does not exist in the cache"),n===this.newest_?n.value_:(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n,n.value_)}remove(e){const t=this.entries_[e];return m(t!==0[0],"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let n=0,e;for(e=this.newest_;e;e=e.older)t[n++]=e.key_;return t}getValues(){const t=new Array(this.count_);let n=0,e;for(e=this.newest_;e;e=e.older)t[n++]=e.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){m(!(e in this.entries_),"Tried to set a value for a key that is used already");const n={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[e]=n,++this.count_}setSize(e){this.highWaterMark=e}},Vi=su,iu=class{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(As(),{get:(e,t)=>typeof As()[t]!="function"?0[0]:(this.push_(t),this.pushMethodArgs_),set:(e,t,n)=>(this.push_(t,n),!0)})}push_(...n){const e=this.instructions_,t=this.zIndex+this.offset_;e[t]||(e[t]=[]),e[t].push(...n)}pushMethodArgs_=(...e)=>(this.push_(e),this);pushFunction(e){this.push_(e)}getContext(){return this.context_}draw(e){this.instructions_.forEach(t=>{for(let s=0,i=t.length;s<i;++s){const n=t[s];if(typeof n=="function"){n(e);continue}const o=t[++s];if(typeof e[n]=="function")e[n](...o);else{if(typeof o=="function"){e[n]=o(e);continue}e[n]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}},au=iu,ru=5,cu=class extends ho{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.staleKeys_=new Array,this.maxStaleKeys=ru}getStaleKeys(){return this.staleKeys_}prependStaleKey(e){this.staleKeys_.unshift(e),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(){return l()}getData(){return null}prepareFrame(){return l()}renderFrame(){return l()}forEachFeatureAtCoordinate(){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===r.LOADED||t.getState()===r.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=r.LOADED&&t!=r.ERROR&&e.addEventListener(a.CHANGE,this.boundHandleImageChange_),t==r.IDLE&&(e.load(),t=e.getState()),t==r.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}renderDeferred(){}disposeInternal(){delete this.layer_,super.disposeInternal()}},lu=cu,Ge=null;function q0(){Ge=L(1,1,0[0],{willReadFrequently:!0})}hu=class extends lu{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=vt(),this.pixelTransform=vt(),this.inversePixelTransform=vt(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(e,t,n){Ge||q0(),Ge.clearRect(0,0,1,1);let s;try{Ge.drawImage(e,t,n,1,1,0,0,1,1),s=Ge.getImageData(0,0,1,1).data}catch{return Ge=null,null}return s}getBackground(e){const n=this.getLayer();let t=n.getBackground();return typeof t=="function"&&(t=t(e.viewState.resolution)),t||0[0]}useContainer(e,t,n){const i=this.getLayer().getClassName();let o,s;if(e&&e.className===i&&(!n||e&&e.style.backgroundColor&&ts(Ye(e.style.backgroundColor),Ye(n)))){const t=e.firstElementChild;Oe(t)&&(s=t.getContext("2d"))}if(s&&K0(s.canvas.style.transform,t)?(this.container=e,this.context=s,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){o=se?yd():document.createElement("div"),o.className=i;let e=o.style;e.position="absolute",e.width="100%",e.height="100%",s=L();const t=s.canvas;o.appendChild(t),e=t.style,e.position="absolute",e.left="0",e.transformOrigin="top left",this.container=o,this.context=s}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(e,t,n){const s=Te(n),o=Cs(n),i=Ms(n),a=Fs(n);q(t.coordinateToPixelTransform,s),q(t.coordinateToPixelTransform,o),q(t.coordinateToPixelTransform,i),q(t.coordinateToPixelTransform,a);const r=this.inversePixelTransform;q(r,s),q(r,o),q(r,i),q(r,a),e.save(),e.beginPath(),e.moveTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(i[0]),Math.round(i[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}prepareContainer(e,t){const a=e.extent,r=e.viewState.resolution,c=e.viewState.rotation,n=e.pixelRatio,s=Math.round(f(a)/r*n),o=Math.round($(a)/r*n);qt(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/n,1/n,c,-s/2,-o/2),p1(this.inversePixelTransform,this.pixelTransform);const i=M0(this.pixelTransform);if(this.useContainer(t,i,this.getBackground(e)),!this.containerReused){const e=this.context.canvas;e.width!=s||e.height!=o?(e.width=s,e.height=o):this.context.clearRect(0,0,s,o),i!==e.style.transform&&(e.style.transform=i)}}dispatchRenderEvent_(e,t,n){const s=this.getLayer();if(s.hasListener(e)){const o=new Gi(e,this.inversePixelTransform,n,t);s.dispatchEvent(o)}}preRender(e,t){if(this.frameState=t,t.declutter)return;this.dispatchRenderEvent_(ne.PRERENDER,e,t)}postRender(e,t){if(t.declutter)return;this.dispatchRenderEvent_(ne.POSTRENDER,e,t)}renderDeferredInternal(){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new au),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){if(!e.declutter)return;this.dispatchRenderEvent_(ne.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(ne.POSTRENDER,this.context,e)}getRenderTransform(e,t,n,s,o,i,a){const c=o/2,l=i/2,r=s/t,d=-r,u=-e[0]+a,h=-e[1];return qt(this.tempTransform,c,l,r,d,-n,u,h)}disposeInternal(){delete this.frameState,super.disposeInternal()}},mu=hu;function Hi(e,t,n){if(!(n in e))return e[n]=new Set([t]),!0;const s=e[n],o=s.has(t);return o||s.add(t),!o}function U0(e,t,n){const s=e[n];return!!s&&s.delete(t)}function gu(e,t){const n=e.layerStatesArray[e.layerIndex];n.extent&&(t=Ie(t,ye(n.extent,e.viewState.projection)));const s=n.layer.getRenderSource();if(!s.getWrapX()){const n=s.getTileGridForProjection(e.viewState.projection).getExtent();n&&(t=Ie(t,n))}return t}vu=class extends mu{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=We(),this.tempTileRange_=new Qo(0,0,0,0),this.tempTileCoord_=Un(0,0,0);const n=t.cacheSize!==0[0]?t.cacheSize:512;this.tileCache_=new Vi(n),this.sourceTileCache_=null,this.maxStaleKeys=n*.5}getTileCache(){return this.tileCache_}getSourceTileCache(){return this.sourceTileCache_||(this.sourceTileCache_=new Vi(512)),this.sourceTileCache_}getOrCreateTile(e,t,n,s){const a=this.tileCache_,c=this.getLayer(),i=c.getSource(),r=Kn(i,i.getKey(),e,t,n);let o;if(a.containsKey(r))o=a.get(r);else{const c=s.viewState.projection,l=i.getProjection();if(o=i.getTile(e,t,n,s.pixelRatio,c,!l||ls(l,c)?0[0]:this.getSourceTileCache()),!o)return null;a.set(r,o)}return o}getTile(e,t,n,s){const o=this.getOrCreateTile(e,t,n,s);return o||null}getData(e){const s=this.frameState;if(!s)return null;const c=this.getLayer(),o=q(s.pixelToCoordinateTransform,e.slice()),l=c.getExtent();if(l&&!to(l,o))return null;const i=s.viewState,a=c.getRenderSource(),t=a.getTileGridForProjection(i.projection),r=a.getTilePixelRatio(s.pixelRatio);for(let e=t.getZForResolution(i.resolution);e>=t.getMinZoom();--e){const l=t.getTileCoordForCoordAndZ(o,e),c=this.getTile(e,l[1],l[2],s);if(!c||c.getState()!==n.LOADED)continue;const u=t.getOrigin(e),h=D(t.getTileSize(e)),m=t.getResolution(e);let d;if(c instanceof In||c instanceof co)d=c.getImage();else if(c instanceof Ui){if(d=Ki(c.getData()),!d)continue}else continue;const p=Math.floor(r*((o[0]-u[0])/m-l[1]*h[0])),g=Math.floor(r*((u[1]-o[1])/m-l[2]*h[1])),f=Math.round(r*a.getGutterForProjection(i.projection));return this.getImageData(d,p+f,g+f)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const t=this.getLayer().getSource();if(!t)return!1;const n=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==n&&(this.renderedSourceRevision_=n,this.renderedSourceKey_===t.getKey()&&(this.tileCache_.clear(),this.sourceTileCache_?.clear())):this.renderedSourceRevision_=n,!0}enqueueTilesForNextExtent(){return!0}enqueueTiles(e,t,s,o,i){const r=e.viewState,c=this.getLayer(),d=c.getRenderSource(),a=d.getTileGridForProjection(r.projection),l=A(d);l in e.wantedTiles||(e.wantedTiles[l]={});const m=e.wantedTiles[l],h=c.getMapInternal(),f=Math.max(s-i,a.getMinZoom(),a.getZForResolution(Math.min(c.getMaxResolution(),h?h.getView().getResolutionForZoom(Math.max(c.getMinZoom(),0)):a.getResolution(0)),d.zDirection)),u=r.rotation,p=u?vd(r.center,r.resolution,u,e.size):0[0];for(let i=s;i>=f;--i){const r=a.getTileRangeForExtentAndZ(t,i,this.tempTileRange_),c=a.getResolution(i);for(let t=r.minX;t<=r.maxX;++t)for(let s=r.minY;s<=r.maxY;++s){if(u&&!a.tileCoordIntersectsViewport([i,t,s],p))continue;const d=this.getTile(i,t,s,e);if(!d)continue;const f=Hi(o,d,i);if(!f)continue;const h=d.getKey();if(m[h]=!0,d.getState()===n.IDLE&&!e.tileQueue.isKeyQueued(h)){const n=Un(i,t,s,this.tempTileCoord_);e.tileQueue.enqueue([d,l,a.getTileCoordCenter(n),c])}}}}findStaleTile_(e,t){const s=this.tileCache_,o=e[0],a=e[1],r=e[2],i=this.getStaleKeys();for(let e=0;e<i.length;++e){const c=Kn(this.getLayer().getSource(),i[e],o,a,r);if(s.containsKey(c)){const e=s.peek(c);if(e.getState()===n.LOADED)return e.endTransition(A(this)),Hi(t,e,o),!0}}return!1}findAltTiles_(e,t,s,o){const i=e.getTileRangeForTileCoordAndZ(t,s,this.tempTileRange_);if(!i)return!1;let a=!0;const r=this.tileCache_,c=this.getLayer().getRenderSource(),l=c.getKey();for(let e=i.minX;e<=i.maxX;++e)for(let t=i.minY;t<=i.maxY;++t){const d=Kn(c,l,s,e,t);let u=!1;if(r.containsKey(d)){const e=r.peek(d);e.getState()===n.LOADED&&(Hi(o,e,s),u=!0)}u||(a=!1)}return a}renderFrame(e,t){this.renderComplete=!0;const m=e.layerStatesArray[e.layerIndex],b=e.viewState,u=b.projection,F=b.resolution,f=b.center,v=e.pixelRatio,M=this.getLayer(),a=M.getSource(),r=a.getTileGridForProjection(u),c=r.getZForResolution(F,a.zDirection),l=r.getResolution(c),y=a.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==y&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=y):this.renderedSourceKey_=y;let w=e.extent;const d=a.getTilePixelRatio(v);this.prepareContainer(e,t);const j=this.context.canvas.width,O=this.context.canvas.height,k=m.extent&&ye(m.extent,u);k&&(w=Ie(w,ye(m.extent,u)));const S=l*j/2/d,T=l*O/2/d,h=[f[0]-S,f[1]-T,f[0]+S,f[1]+T],o={};this.renderedTiles.length=0;const x=M.getPreload();if(e.nextExtent&&this.enqueueTilesForNextExtent()){const t=r.getZForResolution(b.nextResolution,a.zDirection),n=gu(e,e.nextExtent);this.enqueueTiles(e,n,t,o,x)}const C=gu(e,w);if(this.enqueueTiles(e,C,c,o,0),x>0&&setTimeout(()=>{this.enqueueTiles(e,C,c-1,o,x-1)},0),!(c in o))return this.container;const E=A(this),D=e.time;for(const t of o[c]){const s=t.getState();if(s===n.EMPTY)continue;const i=t.tileCoord;if(s===n.LOADED){const e=t.getAlpha(E,D);if(e===1){t.endTransition(E);continue}}s!==n.ERROR&&(this.renderComplete=!1);const a=this.findStaleTile_(i,o);if(a){U0(o,t,c),e.animate=!0;continue}const l=this.findAltTiles_(r,i,c+1,o);if(l)continue;const d=r.getMinZoom();for(let e=c-1;e>=d;--e){const t=this.findAltTiles_(r,i,e,o);if(t)break}}const p=l/F*v/d,s=this.getRenderContext(e);qt(this.tempTransform,j/2,O/2,p,p,0,-j/2,-O/2),m.extent&&this.clipUnrotated(s,e,k),a.getInterpolate()||(s.imageSmoothingEnabled=!1),this.preRender(s,e);const g=Object.keys(o).map(Number);g.sort(ss);let i;const _=[],z=[];for(let m=g.length-1;m>=0;--m){const t=g[m],b=a.getTilePixelSize(t,v,u),x=r.getResolution(t),j=x/l,y=b[0]*j*p,w=b[1]*j*p,f=r.getTileCoordForCoordAndZ(Te(h),t),O=r.getTileCoordExtent(f),c=q(this.tempTransform,[d*(O[0]-h[0])/l,d*(h[3]-O[3])/l]),C=d*a.getGutterForProjection(u);for(const d of o[t]){if(d.getState()!==n.LOADED)continue;const p=d.tileCoord,v=f[1]-p[1],O=Math.round(c[0]-(v-1)*y),b=f[2]-p[2],x=Math.round(c[1]-(b-1)*w),r=Math.round(c[0]-v*y),l=Math.round(c[1]-b*w),u=O-r,h=x-l,j=g.length===1;let m=!1;i=[r,l,r+u,l,r+u,l+h,r,l+h];for(let e=0,n=_.length;e<n;++e)if(!j&&t<z[e]){const t=_[e];nn([r,l,r+u,l+h],[t[0],t[3],t[4],t[7]])&&(m||(s.save(),m=!0),s.beginPath(),s.moveTo(i[0],i[1]),s.lineTo(i[2],i[3]),s.lineTo(i[4],i[5]),s.lineTo(i[6],i[7]),s.moveTo(t[6],t[7]),s.lineTo(t[4],t[5]),s.lineTo(t[2],t[3]),s.lineTo(t[0],t[1]),s.clip())}_.push(i),z.push(t),this.drawTile(d,e,r,l,u,h,C,j),m&&s.restore(),this.renderedTiles.unshift(d),this.updateUsedTiles(e.usedTiles,a,d)}}if(this.renderedResolution=l,this.extentChanged=!this.renderedExtent_||!ro(this.renderedExtent_,h),this.renderedExtent_=h,this.renderedPixelRatio=v,this.postRender(this.context,e),m.extent&&s.restore(),s.imageSmoothingEnabled=!0,this.renderComplete){const t=(e,t)=>{const s=A(a),n=t.wantedTiles[s],o=n?Object.keys(n).length:0;this.updateCacheSize(o),this.tileCache_.expireCache(),this.sourceTileCache_?.expireCache()};e.postRenderFunctions.push(t)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,t,n,s,o,i,a,r){let c;if(e instanceof Ui){if(c=Ki(e.getData()),!c)throw new Error("Rendering array data is not yet supported")}else c=this.getTileImage(e);if(!c)return;const l=this.getRenderContext(t),u=A(this),h=t.layerStatesArray[t.layerIndex],d=h.opacity*(r?e.getAlpha(u,t.time):1),m=d!==l.globalAlpha;m&&(l.save(),l.globalAlpha=d),l.drawImage(c,a,a,c.width-2*a,c.height-2*a,n,s,o,i),m&&l.restore(),d!==h.opacity?t.animate=!0:r&&e.endTransition(u)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,n){const s=A(t);s in e||(e[s]={}),e[s][n.getKey()]=!0}},bu=vu,Jt={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"},yu=class extends En{constructor(e){e=e||{};const t=Object.assign({},e),n=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=n,this.setPreload(e.preload!==0[0]?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError===0[0]||e.useInterimTilesOnError)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(Jt.PRELOAD)}setPreload(e){this.set(Jt.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(Jt.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(Jt.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}},_u=yu,wu=class extends _u{constructor(e){super(e)}createRenderer(){return new bu(this,{cacheSize:this.getCacheSize()})}},Pi=wu,Ri=["fullscreenchange","webkitfullscreenchange"],Li={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"},Eu=class extends Xe{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==0[0]&&e.keys,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==0[0]?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==0[0]?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==0[0]?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const t=e.label!==0[0]?e.label:"â¤¢";this.labelNode_=typeof t=="string"?document.createTextNode(t):t;const n=e.labelActive!==0[0]?e.labelActive:"\xD7";this.labelActiveNode_=typeof n=="string"?document.createTextNode(n):n;const s=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=s,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(a.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${ct} ${ln}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const t=this.getMap();if(!t)return;const e=t.getOwnerDocument();if(!ku(e))return;if(Au(e))I0(e);else{let n;this.source_?n=typeof this.source_=="string"?e.getElementById(this.source_):this.source_:n=t.getTargetElement(),this.keys_?V0(n):Su(n)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const t=this.isInFullscreen_;this.isInFullscreen_=Au(e.getOwnerDocument()),t!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(Ss(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(Li.ENTERFULLSCREEN)):(Ss(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(Li.LEAVEFULLSCREEN)),e.updateSize())}setClassName_(e,t){t?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const t=this.getMap();t&&t.removeChangeListener(x.TARGET,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(x.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let t=0,n=e.length;t<n;++t)b(e[t]);e.length=0;const t=this.getMap();if(t){const n=t.getOwnerDocument();ku(n)?this.element.classList.remove(la):this.element.classList.add(la);for(let t=0,s=Ri.length;t<s;++t)e.push(h(n,Ri[t],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}};function ku(e){const t=e.body;return!!(t.webkitRequestFullscreen||t.requestFullscreen&&e.fullscreenEnabled)}function Au(e){return!!(e.webkitIsFullScreen||e.fullscreenElement)}function Su(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function V0(e){e.webkitRequestFullscreen?e.webkitRequestFullscreen():Su(e)}function I0(e){e.exitFullscreen?e.exitFullscreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()}Tu=Eu,zu=class{static DEFAULT_COLORSPACE="rec2100-hlg";static SDR_MULTIPLIER=2**16-1;static COLORSPACES={"rec2100-hlg":"rec2100hlg","display-p3":"p3",srgb:"sRGB","rec2100-pq":"rec2100pq"};data;height;width;constructor(e,t){this.height=t,this.width=e}static fromImageData(){throw new Error("Method not implemented!")}static fromImageDataArray(){throw new Error("Method not implemented!")}static async loadSDRImageData(e){return fetch(e).then(e=>e.blob()).then(e=>createImageBitmap(e)).then(e=>{const{width:t,height:n}=e,o=new OffscreenCanvas(t,n),s=o.getContext("2d");return s.drawImage(e,0,0),s.getImageData(0,0,t,n)})}getPixel(e,t){const n=(t*this.width+e)*4;return this.data.slice(n,n+4)}setPixel(e,t,n){const s=(t*this.width+e)*4;this.data[s+0]=n[0],this.data[s+1]=n[1],this.data[s+2]=n[2],this.data[s+3]=n[3]}clone(){const e=Object.create(Object.getPrototypeOf(this));return Object.assign(e,this),e}};function g(e,t){let s=e.length;Array.isArray(e[0])||(e=[e]),Array.isArray(t[0])||(t=t.map(e=>[e]));let o=t[0].length,i=t[0].map((e,n)=>t.map(e=>e[n])),n=e.map(e=>i.map(t=>{let n=0;if(!Array.isArray(e)){for(let s of t)n+=e*s;return n}for(let s=0;s<e.length;s++)n+=e[s]*(t[s]||0);return n}));return s===1&&(n=n[0]),o===1?n.map(e=>e[0]):n}function tn(e){return De(e)==="string"}function De(e){let t=Object.prototype.toString.call(e);return(t.match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase()}function Os(e,{precision:t,unit:n}){return Le(e)?"none":Iu(e,t)+(n??"")}function Le(e){return Number.isNaN(e)||e instanceof Number&&e?.none}function w(e){return Le(e)?0:e}function Iu(e,t){if(e===0)return 0;let n=~~e,s=0;n&&t&&(s=~~Math.log10(Math.abs(n))+1);const o=10**(t-s);return Math.floor(e*o+.5)/o}Bu={deg:1,grad:.9,rad:180/Math.PI,turn:360};function Vu(e){if(!e)return;e=e.trim();const n=/^([a-z]+)\((.+?)\)$/i,s=/^-?[\d.]+$/,o=/%|deg|g?rad|turn$/,i=/\/?\s*(none|[-\w.]+(?:%|deg|g?rad|turn)?)/g;let t=e.match(n);if(t){let e=[];return t[2].replace(i,(t,n)=>{let a=n.match(o),i=n;if(a){let e=a[0],t=i.slice(0,-e.length);e==="%"?(i=new Number(t/100),i.type="<percentage>"):(i=new Number(t*Bu[e]),i.type="<angle>",i.unit=e)}else s.test(i)?(i=new Number(i),i.type="<number>"):i==="none"&&(i=new Number(NaN),i.none=!0);t.startsWith("/")&&(i=i instanceof Number?i:new Number(i),i.alpha=!0),typeof i=="object"&&i instanceof Number&&(i.raw=n),e.push(i)}),{name:t[1].toLowerCase(),rawName:t[1],rawArgs:t[2],args:e}}}function $u(e){return e[e.length-1]}function sn(e,t,n){return isNaN(e)?t:isNaN(t)?e:e+(t-e)*n}function Uu(e,t,n){return(n-e)/(t-e)}function Di(e,t,n){return sn(t[0],t[1],Uu(e[0],e[1],n))}function qu(e){return e.map(e=>e.split("|").map(e=>{e=e.trim();let t=e.match(/^(<[a-z]+>)\[(-?[.\d]+),\s*(-?[.\d]+)\]?$/);if(t){let e=new String(t[1]);return e.range=[+t[2],+t[3]],e}return e}))}function Yu(e,t,n){return Math.max(Math.min(n,t),e)}function _s(e,t){return Math.sign(e)===Math.sign(t)?e:-e}function re(e,t){return _s((e<0?-e:e)**t,e)}function Fi(e,t){return t===0?0:e/t}function Zu(e,t,n=0,s=e.length){for(;n<s;){const o=n+s>>1;e[o]<t?n=o+1:s=o}return n}Ju=Object.freeze({__proto__:null,bisectLeft:Zu,clamp:Yu,copySign:_s,interpolate:sn,interpolateInv:Uu,isNone:Le,isString:tn,last:$u,mapRange:Di,multiplyMatrices:g,parseCoordGrammar:qu,parseFunction:Vu,serializeNumber:Os,skipNone:w,spow:re,toPrecision:Iu,type:De,zdiv:Fi}),e1=class{add(e,t,n){if(typeof arguments[0]!="string"){for(var e in arguments[0])this.add(e,arguments[0][e],arguments[1]);return}(Array.isArray(e)?e:[e]).forEach(function(e){this[e]=this[e]||[],t&&this[e][n?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(e){e.call(t&&t.context?t.context:t,t)})}},be=new e1,R={gamut_mapping:"css",precision:5,deltaE:"76",verbose:globalThis?.process?.env?.NODE_ENV?.toLowerCase()!=="test",warn:function(t){this.verbose&&globalThis?.console?.warn?.(t)}},F={D50:[.3457/.3585,1,(1-.3457-.3585)/.3585],D65:[.3127/.329,1,(1-.3127-.329)/.329]};function Si(e){return Array.isArray(e)?e:F[e]}function js(e,t,n,s={}){if(e=Si(e),t=Si(t),!e||!t)throw new TypeError(`Missing white point to convert ${e?"":"from"}${!e&&!t?"/":""}${t?"":"to"}`);if(e===t)return n;let o={W1:e,W2:t,XYZ:n,options:s};if(be.run("chromatic-adaptation-start",o),o.M||(o.W1===F.D65&&o.W2===F.D50?o.M=[[1.0479297925449969,.022946870601609652,-.05019226628920524],[.02962780877005599,.9904344267538799,-.017073799063418826],[-.009243040646204504,.015055191490298152,.7518742814281371]]:o.W1===F.D50&&o.W2===F.D65&&(o.M=[[.955473421488075,-.02309845494876471,.06325924320057072],[-.0283697093338637,1.0099953980813041,.021041441191917323],[.012314014864481998,-.020507649298898964,1.330365926242124]])),be.run("chromatic-adaptation-end",o),o.M)return g(o.M,o.XYZ);throw new TypeError("Only Bradford CAT with white points D50 and D65 supported for now.")}a1=new Set(["<number>","<percentage>","<angle>"]);function r1(e,t,n,s){let o=Object.entries(e.coords).map(([e,o],i)=>{let d=t.coordGrammar[i],r=s[i],c=r?.type,a;if(r.none?a=d.find(e=>a1.has(e)):a=d.find(e=>e==c),!a){let t=o.name||e;throw new TypeError(`${c??r.raw} not allowed for ${t} in ${n}()`)}let l=a.range;c==="<percentage>"&&(l||=[0,1]);let u=o.range||o.refRange;return l&&u&&(s[i]=Di(l,u,s[i])),a});return o}function c1(e,{meta:n}={}){let s={str:String(e)?.trim()};if(be.run("parse-start",s),s.color)return s.color;if(s.parsed=Vu(s.str),s.parsed){{let e=s.parsed.name;if(e==="color"){let e=s.parsed.args.shift(),o=e.startsWith("--")?e.substring(2):`--${e}`,i=[e,o],c=s.parsed.rawArgs.indexOf("/")>0?s.parsed.args.pop():1;for(let a of t.all){let o=a.getFormat("color");if(o&&(i.includes(o.id)||o.ids?.filter(e=>i.includes(e)).length)){const t=Object.keys(a.coords).map((e,t)=>s.parsed.args[t]||0);let i;return o.coordGrammar&&(i=r1(a,o,"color",t)),n&&Object.assign(n,{formatId:"color",types:i}),o.id.startsWith("--")&&!e.startsWith("--")&&R.warn(`${a.name} is a non-standard space and not currently supported in the CSS spec. Use prefixed color(${o.id}) instead of color(${e}).`),e.startsWith("--")&&!o.id.startsWith("--")&&R.warn(`${a.name} is a standard space and supported in the CSS spec. Use color(${o.id}) instead of prefixed color(${e}).`),{spaceId:a.id,coords:t,alpha:c}}}let a="",r=e in t.registry?e:o;if(r in t.registry){let e=t.registry[r].formats?.color?.id;e&&(a=`Did you mean color(${e})?`)}throw new TypeError(`Cannot parse color(${e}). `+(a||"Missing a plugin?"))}for(let i of t.all){let o=i.getFormat(e);if(o&&o.type==="function"){let t=1;(o.lastAlpha||$u(s.parsed.args).alpha)&&(t=s.parsed.args.pop());let a=s.parsed.args,r;return o.coordGrammar&&(r=r1(i,o,e,a)),n&&Object.assign(n,{formatId:o.name,types:r}),{spaceId:i.id,coords:a,alpha:t}}}}}else for(let e of t.all)for(let i in e.formats){let t=e.formats[i];if(t.type!=="custom")continue;if(t.test&&!t.test(s.str))continue;let o=t.parse(s.str);if(o)return o.alpha??=1,n&&(n.formatId=i),o}throw new TypeError(`Could not parse ${e} as a color. Missing a plugin?`)}function o(e){if(Array.isArray(e))return e.map(o);if(!e)throw new TypeError("Empty color reference");tn(e)&&(e=c1(e));let n=e.space||e.spaceId;return n instanceof t||(e.space=t.get(n)),e.alpha===0[0]&&(e.alpha=1),e}d1=75e-6,t=class _ColorSpace{constructor(e){this.id=e.id,this.name=e.name,this.base=e.base?_ColorSpace.get(e.base):null,this.aliases=e.aliases,this.base&&(this.fromBase=e.fromBase,this.toBase=e.toBase);let t=e.coords??this.base.coords;for(let e in t)"name"in t[e]||(t[e].name=e);this.coords=t;let n=e.white??this.base.white??"D65";this.white=Si(n),this.formats=e.formats??{};for(let e in this.formats){let t=this.formats[e];t.type||="function",t.name||=e}this.formats.color?.id||(this.formats.color={...this.formats.color??{},id:e.cssId||this.id}),e.gamutSpace?this.gamutSpace=e.gamutSpace==="self"?this:_ColorSpace.get(e.gamutSpace):this.isPolar?this.gamutSpace=this.base:this.gamutSpace=this,this.gamutSpace.isUnbounded&&(this.inGamut=()=>!0),this.referred=e.referred,Object.defineProperty(this,"path",{value:w0(this).reverse(),writable:!1,enumerable:!0,configurable:!0}),be.run("colorspace-init-end",this)}inGamut(e,{epsilon:t=d1}={}){if(!this.equals(this.gamutSpace))return e=this.to(this.gamutSpace,e),this.gamutSpace.inGamut(e,{epsilon:t});let n=Object.values(this.coords);return e.every((e,s)=>{let o=n[s];if(o.type!=="angle"&&o.range){if(Number.isNaN(e))return!0;let[n,s]=o.range;return(n===0[0]||e>=n-t)&&(s===0[0]||e<=s+t)}return!0})}get isUnbounded(){return Object.values(this.coords).every(e=>!("range"in e))}get cssId(){return this.formats?.color?.id||this.id}get isPolar(){for(let e in this.coords)if(this.coords[e].type==="angle")return!0;return!1}getFormat(e){if(typeof e=="object")return e=m1(e,this),e;let t;return e==="default"?t=Object.values(this.formats)[0]:t=this.formats[e],t?(t=m1(t,this),t):null}equals(e){return!!e&&(this===e||this.id===e||this.id===e.id)}to(e,t){if(arguments.length===1){const n=o(e);[e,t]=[n.space,n.coords]}if(e=_ColorSpace.get(e),this.equals(e))return t;t=t.map(e=>Number.isNaN(e)?0:e);let n=this.path,s=e.path,a,i;for(let e=0;e<n.length;e++)if(n[e].equals(s[e]))a=n[e],i=e;else break;if(!a)throw new Error(`Cannot convert between color spaces ${this} and ${e}: no connection space was found`);for(let e=n.length-1;e>i;e--)t=n[e].toBase(t);for(let e=i+1;e<s.length;e++)t=s[e].fromBase(t);return t}from(e,t){if(arguments.length===1){const n=o(e);[e,t]=[n.space,n.coords]}return e=_ColorSpace.get(e),e.to(this,t)}toString(){return`${this.name} (${this.id})`}getMinCoords(){let e=[];for(let n in this.coords){let t=this.coords[n],s=t.range||t.refRange;e.push(s?.min??0)}return e}static registry={};static get all(){return[...new Set(Object.values(_ColorSpace.registry))]}static register(e,t){if(arguments.length===1&&(t=arguments[0],e=t.id),t=this.get(t),this.registry[e]&&this.registry[e]!==t)throw new Error(`Duplicate color space registration: '${e}'`);if(this.registry[e]=t,arguments.length===1&&t.aliases)for(let e of t.aliases)this.register(e,t);return t}static get(e,...t){if(!e||e instanceof _ColorSpace)return e;let n=De(e);if(n==="string"){let t=_ColorSpace.registry[e.toLowerCase()];if(!t)throw new TypeError(`No color space found with id = "${e}"`);return t}if(t.length)return _ColorSpace.get(...t);throw new TypeError(`${e} is not a valid color space`)}static resolveCoord(e,t){let o=De(e),n,s;if(o==="string"?e.includes(".")?[n,s]=e.split("."):[n,s]=[,e]:Array.isArray(e)?[n,s]=e:(n=e.space,s=e.coordId),n=_ColorSpace.get(n),n||(n=t),!n)throw new TypeError(`Cannot resolve coordinate reference ${e}: No color space specified and relative references are not allowed here`);if(o=De(s),o==="number"||o==="string"&&s>=0){let e=Object.entries(n.coords)[s];if(e)return{space:n,id:e[0],index:s,...e[1]}}n=_ColorSpace.get(n);let i=s.toLowerCase(),a=0;for(let e in n.coords){let t=n.coords[e];if(e.toLowerCase()===i||t.name?.toLowerCase()===i)return{space:n,id:e,index:a,...t};a++}throw new TypeError(`No "${s}" coordinate found in ${n.name}. Its coordinates are: ${Object.keys(n.coords).join(", ")}`)}static DEFAULT_FORMAT={type:"functions",name:"color"}};function w0(e){let t=[e];for(let n=e;n=n.base;)t.push(n);return t}function m1(e,{coords:t}={}){if(e.coords&&!e.coordGrammar){e.type||="function",e.name||="color",e.coordGrammar=qu(e.coords);let n=Object.entries(t).map(([t,n],s)=>{let o=e.coordGrammar[s][0],r=n.range||n.refRange,a=o.range,i="";return o=="<percentage>"?(a=[0,100],i="%"):o=="<angle>"&&(i="deg"),{fromRange:r,toRange:a,suffix:i}});e.serializeCoords=(e,t)=>e.map((e,s)=>{let{fromRange:o,toRange:i,suffix:a}=n[s];return o&&i&&(e=Di(o,i,e)),e=Os(e,{precision:t,unit:a}),e})}return e}C=new t({id:"xyz-d65",name:"XYZ D65",coords:{x:{name:"X"},y:{name:"Y"},z:{name:"Z"}},white:"D65",formats:{color:{ids:["xyz-d65","xyz"]}},aliases:["xyz"]}),z=class extends t{constructor(e){e.coords||(e.coords={r:{range:[0,1],name:"Red"},g:{range:[0,1],name:"Green"},b:{range:[0,1],name:"Blue"}}),e.base||(e.base=C),e.toXYZ_M&&e.fromXYZ_M&&(e.toBase??=t=>{let n=g(e.toXYZ_M,t);return this.white!==this.base.white&&(n=js(this.white,this.base.white,n)),n},e.fromBase??=t=>(t=js(this.base.white,this.white,t),g(e.fromXYZ_M,t))),e.referred??="display",super(e)}};function un(e,n){return e=o(e),!n||e.space.equals(n)?e.coords.slice():(n=t.get(n),n.from(e))}function K(e,n){e=o(e);let{space:s,index:i}=t.resolveCoord(n,e.space),a=un(e,s);return a[i]}function ki(e,n,s){return e=o(e),n=t.get(n),e.coords=n.to(e.space,s),e}ki.returns="color";function he(e,n,s){if(e=o(e),arguments.length===2&&De(arguments[1])==="object"){let t=arguments[1];for(let n in t)he(e,n,t[n])}else{typeof s=="function"&&(s=s(K(e,n)));let{space:o,index:a}=t.resolveCoord(n,e.space),i=un(e,o);i[a]=s,ki(e,o,i)}return e}he.returns="color",is=new t({id:"xyz-d50",name:"XYZ D50",white:"D50",base:C,fromBase:e=>js(C.white,"D50",e),toBase:e=>js("D50",C.white,e)}),_1=216/24389,Ci=24/116,_n=24389/27,Yn=F.D50,P=new t({id:"lab",name:"Lab",coords:{l:{refRange:[0,100],name:"Lightness"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:Yn,base:is,fromBase(e){let n=e.map((e,t)=>e/Yn[t]),t=n.map(e=>e>_1?Math.cbrt(e):(_n*e+16)/116);return[116*t[1]-16,500*(t[0]-t[1]),200*(t[1]-t[2])]},toBase(e){let t=[];t[1]=(e[0]+16)/116,t[0]=e[1]/500+t[1],t[2]=t[1]-e[2]/200;let n=[t[0]>Ci?t[0]**3:(116*t[0]-16)/_n,e[0]>8?((e[0]+16)/116)**3:e[0]/_n,t[2]>Ci?t[2]**3:(116*t[2]-16)/_n];return n.map((e,t)=>e*Yn[t])},formats:{lab:{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});function le(e){return(e%360+360)%360}function r0(e,t){if(e==="raw")return t;let[s,o]=t.map(le),n=o-s;return e==="increasing"?n<0&&(o+=360):e==="decreasing"?n>0&&(s+=360):e==="longer"?-180<n&&n<180&&(n>0?s+=360:o+=360):e==="shorter"&&(n>180?s+=360:n<-180&&(o+=360)),[s,o]}xt=new t({id:"lch",name:"LCH",coords:{l:{refRange:[0,100],name:"Lightness"},c:{refRange:[0,150],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:P,fromBase(e){let[i,t,n]=e,s;const o=.02;return(t<0?-t:t)<o&&(n<0?-n:n)<o?s=NaN:s=Math.atan2(n,t)*180/Math.PI,[i,(t**2+n**2)**.5,le(s)]},toBase(e){let[s,t,n]=e;return t<0&&(t=0),isNaN(n)&&(n=0),[s,t*Math.cos(n*Math.PI/180),t*Math.sin(n*Math.PI/180)]},formats:{lch:{coords:["<number> | <percentage>","<number> | <percentage>","<number> | <angle>"]}}}),xi=25**7,Fn=Math.PI,Oi=180/Fn,et=Fn/180;function z1(e){const t=e*e,n=t*t*t*e;return n}function D1(e,t,{kL:n=1,kC:s=1,kH:i=1}={}){[e,t]=o([e,t]);let[w,A,g]=P.from(e),x=xt.from(P,[w,A,g])[1],[b,z,v]=P.from(t),O=xt.from(P,[b,z,v])[1];x<0&&(x=0),O<0&&(O=0);let H=(x+O)/2,C=z1(H),F=.5*(1-(C/(C+xi))**.5),y=(1+F)*A,j=(1+F)*z,c=(y**2+g**2)**.5,f=(j**2+v**2)**.5,m=y===0&&g===0?0:Math.atan2(g,y),h=j===0&&v===0?0:Math.atan2(v,j);m<0&&(m+=2*Fn),h<0&&(h+=2*Fn),m*=Oi,h*=Oi;let W=b-w,M=f-c,r=h-m,l=m+h,k=r<0?-r:r,u;c*f===0?u=0:k<=180?u=r:r>180?u=r-360:r<-180?u=r+360:R.warn("the unthinkable has happened");let S=2*(f*c)**.5*Math.sin(u*et/2),I=(w+b)/2,_=(c+f)/2,T=z1(_),a;c*f===0?a=l:k<=180?a=l/2:l<360?a=(l+360)/2:a=(l-360)/2;let D=(I-50)**2,L=1+.015*D/(20+D)**.5,N=1+.045*_,d=1;d-=.17*Math.cos((a-30)*et),d+=.24*Math.cos(2*a*et),d+=.32*Math.cos((3*a+6)*et),d-=.2*Math.cos((4*a-63)*et);let E=1+.015*_*d,B=30*Math.exp(-1*((a-275)/25)**2),V=2*(T/(T+xi))**.5,$=-1*Math.sin(2*B*et)*V,p=(W/(n*L))**2;return p+=(M/(s*N))**2,p+=(S/(i*E))**2,p+=$*(M/(s*N))*(S/(i*E)),p**.5}N1=[[.819022437996703,.3619062600528904,-.1288737815209879],[.0329836539323885,.9292868615863434,.0361446663506424],[.0481771893596242,.2642395317527308,.6335478284694309]],L1=[[1.2268798758459243,-.5578149944602171,.2813910456659647],[-.0405757452148008,1.112286803280317,-.0717110580655164],[-.0763729366746601,-.4214933324022432,1.5869240198367816]],R1=[[.210454268309314,.7936177747023054,-.0040720430116193],[1.9779985324311684,-2.42859224204858,.450593709617411],[.0259040424655478,.7827717124575296,-.8086757549230774]],P1=[[1,.3963377773761749,.2158037573099136],[1,-.1055613458156586,-.0638541728258133],[1,-.0894841775298119,-1.2914855480194092]],tt=new t({id:"oklab",name:"Oklab",coords:{l:{refRange:[0,1],name:"Lightness"},a:{refRange:[-.4,.4]},b:{refRange:[-.4,.4]}},white:"D65",base:C,fromBase(e){let t=g(N1,e),n=t.map(e=>Math.cbrt(e));return g(R1,n)},toBase(e){let t=g(P1,e),n=t.map(e=>e**3);return g(L1,n)},formats:{oklab:{coords:["<percentage> | <number>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});function yi(e,t){[e,t]=o([e,t]);let[n,s,i]=tt.from(e),[a,r,c]=tt.from(t),l=n-a,d=s-r,u=i-c;return(l**2+d**2+u**2)**.5}B1=75e-6;function Ke(e,n,{epsilon:s=B1}={}){e=o(e),n||(n=e.space),n=t.get(n);let i=e.coords;return n!==e.space&&(i=n.from(e)),n.inGamut(i,{epsilon:s})}function kt(e){return{space:e.space,coords:e.coords.slice(),alpha:e.alpha}}function W1(e,n,s="lab"){s=t.get(s);let o=s.from(e),i=s.from(n);return o.reduce((e,t,n)=>{let s=i[n];return isNaN(t)||isNaN(s)?e:e+(s-t)**2},0)**.5}function X4(e,t){return W1(e,t,"lab")}K1=Math.PI,ji=K1/180;function Y4(e,t,{l:n=2,c:s=1}={}){[e,t]=o([e,t]);let[r,f,h]=P.from(e),[,i,a]=xt.from(P,[r,f,h]),[p,m,b]=P.from(t),c=xt.from(P,[p,m,b])[1];i<0&&(i=0),c<0&&(c=0);let C=r-p,u=i-c,O=f-m,w=h-b,_=O**2+w**2-u**2,j=.511;r>=16&&(j=.040975*r/(1+.01765*r));let y=.0638*i/(1+.0131*i)+.638,d;Number.isNaN(a)&&(a=0),a>=164&&a<=345?d=.56+Math.abs(.2*Math.cos((a+168)*ji)):d=.36+Math.abs(.4*Math.cos((a+35)*ji));let v=i**4,g=(v/(v+1900))**.5,x=y*(g*d+1-g),l=(C/(n*j))**2;return l+=(u/(s*y))**2,l+=_/x**2,l**.5}Ks=203,ms=new t({id:"xyz-abs-d65",cssId:"--xyz-abs-d65",name:"Absolute XYZ D65",coords:{x:{refRange:[0,9504.7],name:"Xa"},y:{refRange:[0,1e4],name:"Ya"},z:{refRange:[0,10888.3],name:"Za"}},base:C,fromBase(e){return e.map(e=>Math.max(e*Ks,0))},toBase(e){return e.map(e=>Math.max(e/Ks,0))}}),Nt=1.15,Dt=.66,bi=2610/2**14,e4=2**14/2610,vi=3424/2**12,gi=2413/2**7,pi=2392/2**7,o4=1.7*2523/2**5,fi=2**5/(1.7*2523),zn=-.56,Vn=16295499532821565e-27,c4=[[.41478972,.579999,.014648],[-.20151,1.120649,.0531008],[-.0166008,.2648,.6684799]],l4=[[1.9242264357876067,-1.0047923125953657,.037651404030618],[.35031676209499907,.7264811939316552,-.06538442294808501],[-.09098281098284752,-.3127282905230739,1.5227665613052603]],d4=[[.5,.5,0],[3.524,-4.066708,.542708],[.199076,1.096799,-1.295875]],u4=[[1,.1386050432715393,.05804731615611886],[.9999999999999999,-.1386050432715393,-.05804731615611886],[.9999999999999998,-.09601924202631895,-.8118918960560388]],mi=new t({id:"jzazbz",name:"Jzazbz",coords:{jz:{refRange:[0,1],name:"Jz"},az:{refRange:[-.5,.5]},bz:{refRange:[-.5,.5]}},base:ms,fromBase(e){let[t,o,n]=e,i=Nt*t-(Nt-1)*n,a=Dt*o-(Dt-1)*t,r=g(c4,[i,a,n]),c=r.map(function(e){let t=vi+gi*(e/1e4)**bi,n=1+pi*(e/1e4)**bi;return(t/n)**o4}),[s,l,d]=g(d4,c),u=(1+zn)*s/(1+zn*s)-Vn;return[u,l,d]},toBase(e){let[t,o,i]=e,a=(t+Vn)/(1+zn-zn*(t+Vn)),r=g(u4,[a,o,i]),c=r.map(function(e){let t=vi-e**fi,n=pi*e**fi-gi,s=1e4*(t/n)**e4;return s}),[l,d,n]=g(l4,c),s=(l+(Nt-1)*n)/Nt,u=(d+(Dt-1)*s)/Dt;return[s,u,n]},formats:{color:{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}}),qn=new t({id:"jzczhz",name:"JzCzHz",coords:{jz:{refRange:[0,1],name:"Jz"},cz:{refRange:[0,1],name:"Chroma"},hz:{refRange:[0,360],type:"angle",name:"Hue"}},base:mi,fromBase(e){let[i,t,n]=e,s;const o=2e-4;return(t<0?-t:t)<o&&(n<0?-n:n)<o?s=NaN:s=Math.atan2(n,t)*180/Math.PI,[i,(t**2+n**2)**.5,le(s)]},toBase(e){return[e[0],e[1]*Math.cos(e[2]*Math.PI/180),e[1]*Math.sin(e[2]*Math.PI/180)]}});function N4(e,t){[e,t]=o([e,t]);let[r,i,n]=qn.from(e),[c,a,s]=qn.from(t),l=r-c,d=i-a;Number.isNaN(n)&&Number.isNaN(s)?(n=0,s=0):Number.isNaN(n)?n=s:Number.isNaN(s)&&(s=n);let u=n-s,h=2*(i*a)**.5*Math.sin(u/2*(Math.PI/180));return(l**2+d**2+h**2)**.5}hi=3424/4096,ui=2413/128,di=2392/128,li=2610/16384,j4=2523/32,y4=16384/2610,ci=32/2523,w4=[[.3592832590121217,.6976051147779502,-.035891593232029],[-.1920808463704993,1.100476797037432,.0753748658519118],[.0070797844607479,.0748396662186362,.8433265453898765]],O4=[[2048/4096,2048/4096,0],[6610/4096,-13613/4096,7003/4096],[17933/4096,-17390/4096,-543/4096]],x4=[[.9999999999999998,.0086090370379328,.111029625003026],[.9999999999999998,-.0086090370379328,-.1110296250030259],[.9999999999999998,.5600313357106791,-.3206271749873188]],md=[[2.0701522183894223,-1.3263473389671563,.2066510476294053],[.3647385209748072,.6805660249472273,-.0453045459220347],[-.0497472075358123,-.0492609666966131,1.1880659249923042]],Xn=new t({id:"ictcp",name:"ICTCP",coords:{i:{refRange:[0,1],name:"I"},ct:{refRange:[-.5,.5],name:"CT"},cp:{refRange:[-.5,.5],name:"CP"}},base:ms,fromBase(e){let t=g(w4,e);return k4(t)},toBase(e){let t=A4(e);return g(md,t)}});function k4(e){let t=e.map(function(e){let t=hi+ui*(e/1e4)**li,n=1+di*(e/1e4)**li;return(t/n)**j4});return g(O4,t)}function A4(e){let t=g(x4,e),n=t.map(function(e){let t=Math.max(e**ci-hi,0),n=ui-di*e**ci;return 1e4*(t/n)**y4});return n}function S4(e,t){[e,t]=o([e,t]);let[n,s,i]=Xn.from(e),[a,r,c]=Xn.from(t);return 720*((n-a)**2+.25*(s-r)**2+(i-c)**2)**.5}p4=F.D65,ai=.42,ii=1/ai,es=2*Math.PI,oi=[[.401288,.650173,-.051461],[-.250268,1.204414,.045854],[-.002079,.048952,.953127]],f4=[[1.8620678550872327,-1.0112546305316843,.14918677544445175],[.38752654323613717,.6214474419314753,-.008973985167612518],[-.015841498849333856,-.03412293802851557,1.0499644368778496]],r4=[[460,451,288],[460,-891,-261],[460,-220,-6300]],i4={dark:[.8,.525,.8],dim:[.9,.59,.9],average:[1,.69,1]},ze={h:[20.14,90,164.25,237.53,380.14],e:[.8,.7,1,1.2,.8],H:[0,100,200,300,400]},n4=180/Math.PI,si=Math.PI/180;function Q1(e,t){const n=e.map(e=>{const n=re(t*(e<0?-e:e)*.01,ai);return 400*_s(n,e)/(n+27.13)});return n}function V4(e,t){const n=100/t*27.13**ii;return e.map(e=>{const t=e<0?-e:e;return _s(n*re(t/(400-t),ii),e)})}function $4(e){let t=le(e);t<=ze.h[0]&&(t+=360);const n=Zu(ze.h,t)-1,[o,i]=ze.h.slice(n,n+2),[a,r]=ze.e.slice(n,n+2),c=ze.H[n],s=(t-o)/a;return c+100*s/(s+(i-t)/r)}function W4(e){let t=(e%400+400)%400;const n=Math.floor(.01*t);t=t%100;const[o,a]=ze.h.slice(n,n+2),[i,s]=ze.e.slice(n,n+2);return le((t*(s*o-i*a)-100*o*s)/(t*(s-i)-100*s))}function X1(e,t,n,s,o){const i={};i.discounting=o,i.refWhite=e,i.surround=s;const c=e.map(e=>e*100);i.la=t,i.yb=n;const l=c[1],d=g(oi,c);s=i4[i.surround];const u=s[0];i.c=s[1],i.nc=s[2];const h=1/(5*i.la+1),a=h**4;i.fl=a*i.la+.1*(1-a)*(1-a)*Math.cbrt(5*i.la),i.flRoot=i.fl**.25,i.n=i.yb/l,i.z=1.48+i.n**.5,i.nbb=.725*i.n**-.2,i.ncb=i.nbb;const m=Math.max(Math.min(u*(1-1/3.6*Math.exp((-i.la-42)/92)),1),0);i.dRgb=d.map(e=>sn(1,l/e,m)),i.dRgbInv=i.dRgb.map(e=>1/e);const f=d.map((e,t)=>e*i.dRgb[t]),r=Q1(f,i.fl);return i.aW=i.nbb*(2*r[0]+r[1]+.05*r[2]),i}ni=X1(p4,64/Math.PI*.2,20,"average",!1);function ti(e,t){if(!(e.J!==0[0]^e.Q!==0[0]))throw new Error("Conversion requires one and only one: 'J' or 'Q'");if(!(e.C!==0[0]^e.M!==0[0]^e.s!==0[0]))throw new Error("Conversion requires one and only one: 'C', 'M' or 's'");if(!(e.h!==0[0]^e.H!==0[0]))throw new Error("Conversion requires one and only one: 'h' or 'H'");if(e.J===0||e.Q===0)return[0,0,0];let s=0;e.h!==0[0]?s=le(e.h)*si:s=W4(e.H)*si;const c=Math.cos(s),a=Math.sin(s);let n=0;e.J!==0[0]?n=re(e.J,1/2)*.1:e.Q!==0[0]&&(n=.25*t.c*e.Q/((t.aW+4)*t.flRoot));let o=0;e.C!==0[0]?o=e.C/n:e.M!==0[0]?o=e.M/t.flRoot/n:e.s!==0[0]&&(o=4e-4*e.s**2*(t.aW+4)/t.c);const r=re(o*(1.64-.29**t.n)**-.73,10/9),d=.25*(Math.cos(s+2)+3.8),u=t.aW*re(n,2/t.c/t.z),h=5e4/13*t.nc*t.ncb*d,i=u/t.nbb,l=23*(i+.305)*Fi(r,23*h+r*(11*c+108*a)),m=l*c,f=l*a,p=V4(g(r4,[i,m,f]).map(e=>e*1/1403),t.fl);return g(f4,p.map((e,n)=>e*t.dRgbInv[n])).map(e=>e/100)}function Y1(e,t){const f=e.map(e=>e*100),n=Q1(g(oi,f).map((e,n)=>e*t.dRgb[n]),t.fl),i=n[0]+(-12*n[1]+n[2])/11,c=(n[0]+n[1]-2*n[2])/9,a=(Math.atan2(c,i)%es+es)%es,v=.25*(Math.cos(a+2)+3.8),d=5e4/13*t.nc*t.ncb*Fi(v*(i**2+c**2)**.5,n[0]+n[1]+1.05*n[2]+.305),l=re(d,.9)*(1.64-.29**t.n)**.73,u=t.nbb*(2*n[0]+n[1]+.05*n[2]),s=re(u/t.aW,.5*t.c*t.z),h=100*re(s,2),m=4/t.c*s*(t.aW+4)*t.flRoot,o=l*s,p=o*t.flRoot,r=le(a*n4),b=$4(r),j=50*re(t.c*l/(t.aW+4),1/2);return{J:h,C:o,h:r,s:j,Q:m,M:p,H:b}}q1=new t({id:"cam16-jmh",cssId:"--cam16-jmh",name:"CAM16-JMh",coords:{j:{refRange:[0,100],name:"J"},m:{refRange:[0,105],name:"Colorfulness"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:C,fromBase(e){const t=Y1(e,ni);return[t.J,t.M,t.h]},toBase(e){return ti({J:e[0],M:e[1],h:e[2]},ni)}}),U1=F.D65,V1=216/24389,ei=24389/27;function J4(e){const t=e>V1?Math.cbrt(e):(ei*e+16)/116;return 116*t-16}function Jo(e){return e>8?((e+16)/116)**3:e/ei}function t0(e,t){let[i,a,n]=e,o=[],s=0;if(n===0)return[0,0,0];let r=Jo(n);n>0?s=.00379058511492914*n**2+.608983189401032*n+.9155088574762233:s=9514440756550361e-21*n**2+.08693057439788597*n-21.928975842194614;const d=2e-12,u=15;let c=0,l=1/0;for(;c<=u;){o=ti({J:s,C:a,h:i},t);const e=Math.abs(o[1]-r);if(e<l){if(e<=d)return o;l=e}s=s-(o[1]-r)*s/(2*o[1]),c+=1}return ti({J:s,C:a,h:i},t)}function n0(e){const n=J4(e[1]);if(n===0)return[0,0,0];const s=Y1(e,ns);return[le(s.h),s.C,n]}ns=X1(U1,200/Math.PI*Jo(50),Jo(50)*100,"average",!1),ht=new t({id:"hct",name:"HCT",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},c:{refRange:[0,145],name:"Colorfulness"},t:{refRange:[0,100],name:"Tone"}},base:C,fromBase(e){return n0(e)},toBase(e){return t0(e,ns)},formats:{color:{id:"--hct",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}}),S1=Math.PI/180,Xo=[1,.007,.0228];function k1(e){e[1]<0&&(e=ht.fromBase(ht.toBase(e)));const t=Math.log(Math.max(1+Xo[2]*e[1]*ns.flRoot,1))/Xo[2],n=e[0]*S1,s=t*Math.cos(n),o=t*Math.sin(n);return[e[2],s,o]}function c0(e,t){[e,t]=o([e,t]);let[n,s,i]=k1(ht.from(e)),[a,r,c]=k1(ht.from(t));return((n-a)**2+(s-r)**2+(i-c)**2)**.5}Pe={deltaE76:X4,deltaECMC:Y4,deltaE2000:D1,deltaEJz:N4,deltaEITP:S4,deltaEOK:yi,deltaEHCT:c0};function d0(e){const t=e?Math.floor(Math.log10(e<0?-e:e)):0;return Math.max(parseFloat(`1e${t-2}`),1e-6)}Yo={hct:{method:"hct.c",jnd:2,deltaEMethod:"hct",blackWhiteClamp:{}},"hct-tonal":{method:"hct.c",jnd:0,deltaEMethod:"hct",blackWhiteClamp:{channel:"hct.t",min:0,max:100}}};function Se(e,{method:n=R.gamut_mapping,space:s=0[0],deltaEMethod:i="",jnd:a=2,blackWhiteClamp:r={}}={}){if(e=o(e),tn(arguments[1])?s=arguments[1]:s||(s=e.space),s=t.get(s),Ke(e,s,{epsilon:0}))return e;let c;if(n==="css")c=f0(e,{space:s});else{if(n!=="clip"&&!Ke(e,s)){Object.prototype.hasOwnProperty.call(Yo,n)&&({method:n,jnd:a,deltaEMethod:i,blackWhiteClamp:r}=Yo[n]);let o=D1;if(i!=="")for(let e in Pe)if("deltae"+i.toLowerCase()===e.toLowerCase()){o=Pe[e];break}let l=Se(p(e,s),{method:"clip",space:s});if(o(e,l)>a){if(Object.keys(r).length===3){let s=t.resolveCoord(r.channel),n=K(p(e,s.space),s.id);if(Le(n)&&(n=0),n>=r.max)return p({space:"xyz-d65",coords:F.D65},e.space);if(n<=r.min)return p({space:"xyz-d65",coords:[0,0,0]},e.space)}let l=t.resolveCoord(n),f=l.space,d=l.id,i=p(e,f);i.coords.forEach((e,t)=>{Le(e)&&(i.coords[t]=0)});let g=l.range||l.refRange,v=g[0],m=d0(a),u=v,h=K(i,d);for(;h-u>m;){let e=kt(i);e=Se(e,{space:s,method:"clip"});let t=o(i,e);t-a<m?u=K(i,d):h=K(i,d),he(i,d,(u+h)/2)}c=p(i,s)}else c=l}else c=p(e,s);if(n==="clip"||!Ke(c,s,{epsilon:0})){let e=Object.values(s.coords).map(e=>e.range||[]);c.coords=c.coords.map((t,n)=>{let[s,o]=e[n];return s!==0[0]&&(t=Math.max(s,t)),o!==0[0]&&(t=Math.min(t,o)),t})}}return s!==e.space&&(c=p(c,e.space)),e.coords=c.coords,e}Se.returns="color",qo={WHITE:{space:tt,coords:[1,0,0]},BLACK:{space:tt,coords:[0,0,0]}};function f0(e,{space:n}={}){const l=.02,u=1e-4;e=o(e),n||(n=e.space),n=t.get(n);const g=t.get("oklch");if(n.isUnbounded)return p(e,n);const i=p(e,g);let h=i.coords[0];if(h>=1){const t=p(qo.WHITE,n);return t.alpha=e.alpha,p(t,n)}if(h<=0){const t=p(qo.BLACK,n);return t.alpha=e.alpha,p(t,n)}if(Ke(i,n,{epsilon:0}))return p(i,n);function m(e){const t=p(e,n),s=Object.values(n.coords);return t.coords=t.coords.map((e,t)=>{if("range"in s[t]){const[n,o]=s[t].range;return Yu(n,e,o)}return e}),t}let r=0,d=i.coords[1],f=!0,s=kt(i),a=m(s),c=yi(a,s);if(c<l)return a;for(;d-r>u;){const e=(r+d)/2;if(s.coords[1]=e,f&&Ke(s,n,{epsilon:0}))r=e;else if(a=m(s),c=yi(a,s),c<l){if(l-c<u)break;f=!1,r=e}else d=e}return a}function p(e,n,{inGamut:s}={}){e=o(e),n=t.get(n);let a=n.from(e),i={space:n,coords:a,alpha:e.alpha};return s&&(i=Se(i,s===!0?0[0]:s)),i}p.returns="color";function On(e,{precision:n=R.precision,format:s="default",inGamut:i=!0,...a}={}){let c;e=o(e);let l=s;s=e.space.getFormat(s)??e.space.getFormat("default")??t.DEFAULT_FORMAT;let r=e.coords.slice();if(i||=s.toGamut,i&&!Ke(e)&&(r=Se(kt(e),i===!0?0[0]:i).coords),s.type==="custom")if(a.precision=n,s.serialize)c=s.serialize(r,e.alpha,a);else throw new TypeError(`format ${l} can only be used to parse colors, not for serialization`);else{let o=s.name||"color";s.serializeCoords?r=s.serializeCoords(r,n):n!==null&&(r=r.map(e=>Os(e,{precision:n})));let i=[...r];if(o==="color"){let t=s.id||s.ids?.[0]||e.space.id;i.unshift(t)}let t=e.alpha;n!==null&&(t=Os(t,{precision:n}));let a=e.alpha>=1||s.noAlpha?"":`${s.commas?",":" /"} ${t}`;c=`${o}(${i.join(s.commas?", ":" ")}${a})`}return c}if(j1=[[.6369580483012914,.14461690358620832,.1688809751641721],[.2627002120112671,.6779980715188708,.05930171646986196],[0,.028072693049087428,1.060985057710791]],b1=[[1.716651187971268,-.355670783776392,-.25336628137366],[-.666684351832489,1.616481236634939,.0157685458139111],[.017639857445311,-.042770613257809,.942103121235474]],yn=new z({id:"rec2020-linear",cssId:"--rec2020-linear",name:"Linear REC.2020",white:"D65",toXYZ_M:j1,fromXYZ_M:b1}),fn=1.09929682680944,Uo=.018053968510807,Wo=new z({id:"rec2020",name:"REC.2020",base:yn,toBase(e){return e.map(function(e){return e<Uo*4.5?e/4.5:((e+fn-1)/fn)**(1/.45)})},fromBase(e){return e.map(function(e){return e>=Uo?fn*e**.45-(fn-1):4.5*e})}}),o1=[[.4865709486482162,.26566769316909306,.1982172852343625],[.2289745640697488,.6917385218365064,.079286914093745],[0,.04511338185890264,1.043944368900976]],s1=[[2.493496911941425,-.9313836179191239,-.40271078445071684],[-.8294889695615747,1.7626640603183463,.023624685841943577],[.03584583024378447,-.07617238926804182,.9568845240076872]],$o=new z({id:"p3-linear",cssId:"--display-p3-linear",name:"Linear P3",white:"D65",toXYZ_M:o1,fromXYZ_M:s1}),Wu=[[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],O=[[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]],Vo=new z({id:"srgb-linear",name:"Linear sRGB",white:"D65",toXYZ_M:Wu,fromXYZ_M:O}),Bo={aliceblue:[240/255,248/255,1],antiquewhite:[250/255,235/255,215/255],aqua:[0,1,1],aquamarine:[127/255,1,212/255],azure:[240/255,1,1],beige:[245/255,245/255,220/255],bisque:[1,228/255,196/255],black:[0,0,0],blanchedalmond:[1,235/255,205/255],blue:[0,0,1],blueviolet:[138/255,43/255,226/255],brown:[165/255,42/255,42/255],burlywood:[222/255,184/255,135/255],cadetblue:[95/255,158/255,160/255],chartreuse:[127/255,1,0],chocolate:[210/255,105/255,30/255],coral:[1,127/255,80/255],cornflowerblue:[100/255,149/255,237/255],cornsilk:[1,248/255,220/255],crimson:[220/255,20/255,60/255],cyan:[0,1,1],darkblue:[0,0,139/255],darkcyan:[0,139/255,139/255],darkgoldenrod:[184/255,134/255,11/255],darkgray:[169/255,169/255,169/255],darkgreen:[0,100/255,0],darkgrey:[169/255,169/255,169/255],darkkhaki:[189/255,183/255,107/255],darkmagenta:[139/255,0,139/255],darkolivegreen:[85/255,107/255,47/255],darkorange:[1,140/255,0],darkorchid:[153/255,50/255,204/255],darkred:[139/255,0,0],darksalmon:[233/255,150/255,122/255],darkseagreen:[143/255,188/255,143/255],darkslateblue:[72/255,61/255,139/255],darkslategray:[47/255,79/255,79/255],darkslategrey:[47/255,79/255,79/255],darkturquoise:[0,206/255,209/255],darkviolet:[148/255,0,211/255],deeppink:[1,20/255,147/255],deepskyblue:[0,191/255,1],dimgray:[105/255,105/255,105/255],dimgrey:[105/255,105/255,105/255],dodgerblue:[30/255,144/255,1],firebrick:[178/255,34/255,34/255],floralwhite:[1,250/255,240/255],forestgreen:[34/255,139/255,34/255],fuchsia:[1,0,1],gainsboro:[220/255,220/255,220/255],ghostwhite:[248/255,248/255,1],gold:[1,215/255,0],goldenrod:[218/255,165/255,32/255],gray:[128/255,128/255,128/255],green:[0,128/255,0],greenyellow:[173/255,1,47/255],grey:[128/255,128/255,128/255],honeydew:[240/255,1,240/255],hotpink:[1,105/255,180/255],indianred:[205/255,92/255,92/255],indigo:[75/255,0,130/255],ivory:[1,1,240/255],khaki:[240/255,230/255,140/255],lavender:[230/255,230/255,250/255],lavenderblush:[1,240/255,245/255],lawngreen:[124/255,252/255,0],lemonchiffon:[1,250/255,205/255],lightblue:[173/255,216/255,230/255],lightcoral:[240/255,128/255,128/255],lightcyan:[224/255,1,1],lightgoldenrodyellow:[250/255,250/255,210/255],lightgray:[211/255,211/255,211/255],lightgreen:[144/255,238/255,144/255],lightgrey:[211/255,211/255,211/255],lightpink:[1,182/255,193/255],lightsalmon:[1,160/255,122/255],lightseagreen:[32/255,178/255,170/255],lightskyblue:[135/255,206/255,250/255],lightslategray:[119/255,136/255,153/255],lightslategrey:[119/255,136/255,153/255],lightsteelblue:[176/255,196/255,222/255],lightyellow:[1,1,224/255],lime:[0,1,0],limegreen:[50/255,205/255,50/255],linen:[250/255,240/255,230/255],magenta:[1,0,1],maroon:[128/255,0,0],mediumaquamarine:[102/255,205/255,170/255],mediumblue:[0,0,205/255],mediumorchid:[186/255,85/255,211/255],mediumpurple:[147/255,112/255,219/255],mediumseagreen:[60/255,179/255,113/255],mediumslateblue:[123/255,104/255,238/255],mediumspringgreen:[0,250/255,154/255],mediumturquoise:[72/255,209/255,204/255],mediumvioletred:[199/255,21/255,133/255],midnightblue:[25/255,25/255,112/255],mintcream:[245/255,1,250/255],mistyrose:[1,228/255,225/255],moccasin:[1,228/255,181/255],navajowhite:[1,222/255,173/255],navy:[0,0,128/255],oldlace:[253/255,245/255,230/255],olive:[128/255,128/255,0],olivedrab:[107/255,142/255,35/255],orange:[1,165/255,0],orangered:[1,69/255,0],orchid:[218/255,112/255,214/255],palegoldenrod:[238/255,232/255,170/255],palegreen:[152/255,251/255,152/255],paleturquoise:[175/255,238/255,238/255],palevioletred:[219/255,112/255,147/255],papayawhip:[1,239/255,213/255],peachpuff:[1,218/255,185/255],peru:[205/255,133/255,63/255],pink:[1,192/255,203/255],plum:[221/255,160/255,221/255],powderblue:[176/255,224/255,230/255],purple:[128/255,0,128/255],rebeccapurple:[102/255,51/255,153/255],red:[1,0,0],rosybrown:[188/255,143/255,143/255],royalblue:[65/255,105/255,225/255],saddlebrown:[139/255,69/255,19/255],salmon:[250/255,128/255,114/255],sandybrown:[244/255,164/255,96/255],seagreen:[46/255,139/255,87/255],seashell:[1,245/255,238/255],sienna:[160/255,82/255,45/255],silver:[192/255,192/255,192/255],skyblue:[135/255,206/255,235/255],slateblue:[106/255,90/255,205/255],slategray:[112/255,128/255,144/255],slategrey:[112/255,128/255,144/255],snow:[1,250/255,250/255],springgreen:[0,1,127/255],steelblue:[70/255,130/255,180/255],tan:[210/255,180/255,140/255],teal:[0,128/255,128/255],thistle:[216/255,191/255,216/255],tomato:[1,99/255,71/255],turquoise:[64/255,224/255,208/255],violet:[238/255,130/255,238/255],wheat:[245/255,222/255,179/255],white:[1,1,1],whitesmoke:[245/255,245/255,245/255],yellow:[1,1,0],yellowgreen:[154/255,205/255,50/255]},Io=Array(3).fill("<percentage> | <number>[0, 255]"),Ho=Array(3).fill("<number>[0, 255]"),Je=new z({id:"srgb",name:"sRGB",base:Vo,fromBase:e=>e.map(e=>{let t=e<0?-1:1,n=e*t;return n>.0031308?t*(1.055*n**(1/2.4)-.055):12.92*e}),toBase:e=>e.map(e=>{let t=e<0?-1:1,n=e*t;return n<=.04045?e/12.92:t*((n+.055)/1.055)**2.4}),formats:{rgb:{coords:Io},rgb_number:{name:"rgb",commas:!0,coords:Ho,noAlpha:!0},color:{},rgba:{coords:Io,commas:!0,lastAlpha:!0},rgba_number:{name:"rgba",commas:!0,coords:Ho},hex:{type:"custom",toGamut:!0,test:e=>/^#([a-f0-9]{3,4}){1,2}$/i.test(e),parse(e){e.length<=5&&(e=e.replace(/[a-f0-9]/gi,"$&$&"));let t=[];return e.replace(/[a-f0-9]{2}/gi,e=>{t.push(parseInt(e,16)/255)}),{spaceId:"srgb",coords:t.slice(0,3),alpha:t.slice(3)[0]}},serialize:(e,t,{collapse:n=!0}={})=>{t<1&&e.push(t),e=e.map(e=>Math.round(e*255));let s=n&&e.every(e=>e%17===0),o=e.map(e=>s?(e/17).toString(16):e.toString(16).padStart(2,"0")).join("");return"#"+o}},keyword:{type:"custom",test:e=>/^[a-z]+$/i.test(e),parse(e){e=e.toLowerCase();let t={spaceId:"srgb",coords:null,alpha:1};if(e==="transparent"?(t.coords=Bo.black,t.alpha=0):t.coords=Bo[e],t.coords)return t}}}}),Ro=new z({id:"p3",cssId:"display-p3",name:"P3",base:$o,fromBase:Je.fromBase,toBase:Je.toBase}),R.display_space=Je,typeof CSS!="undefined"&&CSS.supports)for(let e of[P,Wo,Ro]){let t=e.getMinCoords(),n={space:e,coords:t,alpha:1},s=On(n);if(CSS.supports("color",s)){R.display_space=e;break}}function N0(e,{space:t=R.display_space,...n}={}){let s=On(e,n);if(typeof CSS=="undefined"||CSS.supports("color",s)||!R.display_space)s=new String(s),s.color=e;else{let o=e,i=e.coords.some(Le)||Le(e.alpha);if(i&&!(D0??=CSS.supports("color","hsl(none 50% 50%)"))&&(o=kt(e),o.coords=o.coords.map(w),o.alpha=w(o.alpha),s=On(o,n),CSS.supports("color",s)))return s=new String(s),s.color=o,s;o=p(o,t),s=new String(On(o,n)),s.color=o}return s}function L0(e,t){return e=o(e),t=o(t),e.space===t.space&&e.alpha===t.alpha&&e.coords.every((e,n)=>e===t.coords[n])}function Ce(e){return K(e,[C,"y"])}function Du(e,t){he(e,[C,"y"],t)}function H0(e){Object.defineProperty(e.prototype,"luminance",{get(){return Ce(this)},set(e){Du(this,e)}})}Fu=Object.freeze({__proto__:null,getLuminance:Ce,register:H0,setLuminance:Du});function B0(e,t){e=o(e),t=o(t);let n=Math.max(Ce(e),0),s=Math.max(Ce(t),0);return s>n&&([n,s]=[s,n]),(n+.05)/(s+.05)}Mu=.56,Cu=.57,Ou=.62,pu=.65,Lo=.022,uu=1.414,nu=.1,Zd=5e-4,Xd=1.14,No=.027,Pd=1.14;function Ld(e){return e>=Lo?e:e+(Lo-e)**uu}function st(e){let t=e<0?-1:1,n=e<0?-e:e;return t*n**2.4}function t2(e,t){t=o(t),e=o(e);let s,n,i,a,r,c;t=p(t,"srgb"),[a,r,c]=t.coords;let u=st(a)*.2126729+st(r)*.7151522+st(c)*.072175;e=p(e,"srgb"),[a,r,c]=e.coords;let h=st(a)*.2126729+st(r)*.7151522+st(c)*.072175,l=Ld(u),d=Ld(h),m=d>l;return Math.abs(d-l)<Zd?n=0:m?(s=d**Mu-l**Cu,n=s*Xd):(s=d**pu-l**Ou,n=s*Pd),(n<0?-n:n)<nu?i=0:n>0?i=n-No:i=n+No,i*100}function n2(e,t){e=o(e),t=o(t);let n=Math.max(Ce(e),0),s=Math.max(Ce(t),0);s>n&&([n,s]=[s,n]);let i=n+s;return i===0?0:(n-s)/i}Td=5e4;function o2(e,t){e=o(e),t=o(t);let s=Math.max(Ce(e),0),n=Math.max(Ce(t),0);return n>s&&([s,n]=[n,s]),n===0?Td:(s-n)/n}function i2(e,t){e=o(e),t=o(t);let n=K(e,[P,"l"]),s=K(t,[P,"l"]);return Math.abs(n-s)}Sd=216/24389,Mo=24/116,hn=24389/27,fs=F.D65,ps=new t({id:"lab-d65",name:"Lab D65",coords:{l:{refRange:[0,100],name:"Lightness"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:fs,base:C,fromBase(e){let n=e.map((e,t)=>e/fs[t]),t=n.map(e=>e>Sd?Math.cbrt(e):(hn*e+16)/116);return[116*t[1]-16,500*(t[0]-t[1]),200*(t[1]-t[2])]},toBase(e){let t=[];t[1]=(e[0]+16)/116,t[0]=e[1]/500+t[1],t[2]=t[1]-e[2]/200;let n=[t[0]>Mo?t[0]**3:(116*t[0]-16)/hn,e[0]>8?((e[0]+16)/116)**3:e[0]/hn,t[2]>Mo?t[2]**3:(116*t[2]-16)/hn];return n.map((e,t)=>e*fs[t])},formats:{"lab-d65":{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}}),vs=5**.5*.5+.5;function h2(e,t){e=o(e),t=o(t);let s=K(e,[ps,"l"]),i=K(t,[ps,"l"]),a=Math.abs(s**vs-i**vs),n=a**(1/vs)*Math.SQRT2-40;return n<7.5?0:n}rn=Object.freeze({__proto__:null,contrastAPCA:t2,contrastDeltaPhi:h2,contrastLstar:i2,contrastMichelson:n2,contrastWCAG21:B0,contrastWeber:o2});function f2(e,t,n={}){tn(n)&&(n={algorithm:n});let{algorithm:s,...i}=n;if(!s){let e=Object.keys(rn).map(e=>e.replace(/^contrast/,"")).join(", ");throw new TypeError(`contrast() function needs a contrast algorithm. Please specify one of: ${e}`)}e=o(e),t=o(t);for(let n in rn)if("contrast"+s.toLowerCase()===n.toLowerCase())return rn[n](e,t,i);throw new TypeError(`Unknown contrast algorithm: ${s}`)}function ys(e){let[t,n,o]=un(e,C),s=t+15*n+3*o;return[4*t/s,9*n/s]}function xd(e){let[t,n,o]=un(e,C),s=t+n+o;return[t/s,n/s]}function v2(e){Object.defineProperty(e.prototype,"uv",{get(){return ys(this)}}),Object.defineProperty(e.prototype,"xy",{get(){return xd(this)}})}wd=Object.freeze({__proto__:null,register:v2,uv:ys,xy:xd});function Qt(e,t,n={}){tn(n)&&(n={method:n});let{method:s=R.deltaE,...o}=n;for(let n in Pe)if("deltae"+s.toLowerCase()===n.toLowerCase())return Pe[n](e,t,o);throw new TypeError(`Unknown deltaE method: ${s}`)}function y2(e,n=.25){let s=t.get("oklch","lch"),o=[s,"l"];return he(e,o,e=>e*(1+n))}function _2(e,n=.25){let s=t.get("oklch","lch"),o=[s,"l"];return he(e,o,e=>e*(1-n))}gd=Object.freeze({__proto__:null,darken:_2,lighten:y2});function pd(e,t,n=.5,s={}){[e,t]=[o(e),o(t)],De(n)==="object"&&([n,s]=[.5,n]);let i=Xt(e,t,s);return i(n)}function hd(e,t,n={}){let i;Ao(e)&&([i,n]=[e,t],[e,t]=i.rangeArgs.colors);let{maxDeltaE:r,deltaEMethod:d,steps:l=2,maxSteps:c=1e3,...u}=n;i||([e,t]=[o(e),o(t)],i=Xt(e,t,u));let h=Qt(e,t),a=r>0?Math.max(l,Math.ceil(h/r)+1):l,s=[];if(c!==0[0]&&(a=Math.min(a,c)),a===1)s=[{p:.5,color:i(.5)}];else{let e=1/(a-1);s=Array.from({length:a},(t,n)=>{let s=n*e;return{p:s,color:i(s)}})}if(r>0){let e=s.reduce((e,t,n)=>{if(n===0)return 0;let o=Qt(t.color,s[n-1].color,d);return Math.max(e,o)},0);for(;e>r;){e=0;for(let t=1;t<s.length&&s.length<c;t++){let o=s[t-1],a=s[t],n=(a.p+o.p)/2,r=i(n);e=Math.max(e,Qt(r,o.color),Qt(r,a.color)),s.splice(t,0,{p:n,color:i(n)}),t++}}}return s=s.map(e=>e.color),s}function Xt(e,n,s={}){if(Ao(e)){let[t,s]=[e,n];return Xt(...t.rangeArgs.colors,{...t.rangeArgs.options,...s})}let{space:i,outputSpace:a,progression:r,premultiplied:c}=s;e=o(e),n=o(n),e=kt(e),n=kt(n);let l={colors:[e,n],options:s};if(i?i=t.get(i):i=t.registry[R.interpolationSpace]||e.space,a=a?t.get(a):i,e=p(e,i),n=p(n,i),e=Se(e),n=Se(n),i.coords.h&&i.coords.h.type==="angle"){let r=s.hue=s.hue||"shorter",a=[i,"h"],[t,o]=[K(e,a),K(n,a)];isNaN(t)&&!isNaN(o)?t=o:isNaN(o)&&!isNaN(t)&&(o=t),[t,o]=r0(r,[t,o]),he(e,a,t),he(n,a,o)}return c&&(e.coords=e.coords.map(t=>t*e.alpha),n.coords=n.coords.map(e=>e*n.alpha)),Object.assign(t=>{t=r?r(t):t;let l=e.coords.map((e,s)=>{let o=n.coords[s];return sn(e,o,t)}),o=sn(e.alpha,n.alpha,t),s={space:i,coords:l,alpha:o};return c&&(s.coords=s.coords.map(e=>e/o)),a!==i&&(s=p(s,a)),s},{rangeArgs:l})}function Ao(e){return De(e)==="function"&&!!e.rangeArgs}R.interpolationSpace="lab";function k2(e){e.defineFunction("mix",pd,{returns:"color"}),e.defineFunction("range",Xt,{returns:"function<color>"}),e.defineFunction("steps",hd,{returns:"array<color>"})}var E4=Object.freeze({__proto__:null,isRange:Ao,mix:pd,range:Xt,register:k2,steps:hd}),ld=new t({id:"hsl",name:"HSL",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:Je,fromBase:e=>{let o=Math.max(...e),l=Math.min(...e),[c,i,a]=e,[t,s,n]=[NaN,0,(l+o)/2],r=o-l;if(r!==0){switch(s=n===0||n===1?0:(o-n)/Math.min(n,1-n),o){case c:t=(i-a)/r+(i<a?6:0);break;case i:t=(a-c)/r+2;break;case a:t=(c-i)/r+4}t=t*60}return s<0&&(t+=180,s=s<0?-s:s),t>=360&&(t-=360),[t,s*100,n*100]},toBase:e=>{let[t,o,n]=e;t=t%360,t<0&&(t+=360),o/=100,n/=100;function s(e){let s=(e+t/30)%12,i=o*Math.min(n,1-n);return n-i*Math.max(-1,Math.min(s-3,9-s,1))}return[s(0),s(8),s(4)]},formats:{hsl:{coords:["<number> | <angle>","<percentage>","<percentage>"]},hsla:{coords:["<number> | <angle>","<percentage>","<percentage>"],commas:!0,lastAlpha:!0}}}),cd=new t({id:"hsv",name:"HSV",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},v:{range:[0,100],name:"Value"}},base:ld,fromBase(e){let[o,s,t]=e;s/=100,t/=100;let n=t+s*Math.min(t,1-t);return[o,n===0?0:200*(1-t/n),100*n]},toBase(e){let[o,s,n]=e;s/=100,n/=100;let t=n*(1-s/2);return[o,t===0||t===1?0:(n-t)/Math.min(t,1-t)*100,t*100]},formats:{color:{id:"--hsv",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}}),F2=new t({id:"hwb",name:"HWB",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},w:{range:[0,100],name:"Whiteness"},b:{range:[0,100],name:"Blackness"}},base:cd,fromBase(e){let[n,s,t]=e;return[n,t*(100-s)/100,100-t]},toBase(e){let[o,t,n]=e;t/=100,n/=100;let i=t+n;if(i>=1){let e=t/i;return[o,0,e*100]}let s=1-n,a=s===0?0:1-t/s;return[o,a*100,s*100]},formats:{hwb:{coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}}),T2=[[.5766690429101305,.1855582379065463,.1882286462349947],[.29734497525053605,.6273635662554661,.07529145849399788],[.02703136138641234,.07068885253582723,.9913375368376388]],z2=[[2.0415879038107465,-.5650069742788596,-.34473135077832956],[-.9692436362808795,1.8759675015077202,.04155505740717557],[.013444280632031142,-.11836239223101838,1.0151749943912054]],rd=new z({id:"a98rgb-linear",cssId:"--a98-rgb-linear",name:"Linear Adobe\xAE 98 RGB compatible",white:"D65",toXYZ_M:T2,fromXYZ_M:z2}),N2=new z({id:"a98rgb",cssId:"a98-rgb",name:"Adobe\xAE 98 RGB compatible",base:rd,toBase:e=>e.map(e=>(e<0?-e:e)**(563/256)*Math.sign(e)),fromBase:e=>e.map(e=>(e<0?-e:e)**(256/563)*Math.sign(e))}),L2=[[.7977666449006423,.13518129740053308,.0313477341283922],[.2880748288194013,.711835234241873,8993693872564e-17],[0,0,.8251046025104602]],R2=[[1.3457868816471583,-.25557208737979464,-.05110186497554526],[-.5446307051249019,1.5082477428451468,.02052744743642139],[0,0,1.2119675456389452]],ad=new z({id:"prophoto-linear",cssId:"--prophoto-rgb-linear",name:"Linear ProPhoto",white:"D50",base:is,toXYZ_M:L2,fromXYZ_M:R2}),H2=1/512,I2=16/512,B2=new z({id:"prophoto",cssId:"prophoto-rgb",name:"ProPhoto",base:ad,toBase(e){return e.map(e=>e<I2?e/16:e**1.8)},fromBase(e){return e.map(e=>e>=H2?e**(1/1.8):16*e)}}),V2=new t({id:"oklch",name:"Oklch",coords:{l:{refRange:[0,1],name:"Lightness"},c:{refRange:[0,.4],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},white:"D65",base:tt,fromBase(e){let[i,t,n]=e,s;const o=2e-4;return(t<0?-t:t)<o&&(n<0?-n:n)<o?s=NaN:s=Math.atan2(n,t)*180/Math.PI,[i,(t**2+n**2)**.5,le(s)]},toBase(e){let[i,o,t]=e,n,s;return isNaN(t)?(n=0,s=0):(n=o*Math.cos(t*Math.PI/180),s=o*Math.sin(t*Math.PI/180)),[i,n,s]},formats:{oklch:{coords:["<percentage> | <number>","<number> | <percentage>[0,1]","<number> | <angle>"]}}}),id=F.D65,W2=216/24389,od=24389/27,[nd,td]=ys({space:C,coords:id}),Ql=new t({id:"luv",name:"Luv",coords:{l:{refRange:[0,100],name:"Lightness"},u:{refRange:[-215,215]},v:{refRange:[-215,215]}},white:id,base:C,fromBase(e){let s=[w(e[0]),w(e[1]),w(e[2])],t=s[1],[o,i]=ys({space:C,coords:s});if(!Number.isFinite(o)||!Number.isFinite(i))return[0,0,0];let n=t<=W2?od*t:116*Math.cbrt(t)-16;return[n,13*n*(o-nd),13*n*(i-td)]},toBase(e){let[t,n,s]=e;if(t===0||Le(t))return[0,0,0];n=w(n),s=w(s);let a=n/(13*t)+nd,o=s/(13*t)+td,i=t<=8?t/od:((t+16)/116)**3;return[i*(9*a/(4*o)),i,i*((12-3*a-20*o)/(4*o))]},formats:{color:{id:"--luv",coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}}),ko=new t({id:"lchuv",name:"LChuv",coords:{l:{refRange:[0,100],name:"Lightness"},c:{refRange:[0,220],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:Ql,fromBase(e){let[i,t,n]=e,s;const o=.02;return(t<0?-t:t)<o&&(n<0?-n:n)<o?s=NaN:s=Math.atan2(n,t)*180/Math.PI,[i,(t**2+n**2)**.5,le(s)]},toBase(e){let[s,t,n]=e;return t<0&&(t=0),isNaN(n)&&(n=0),[s,t*Math.cos(n*Math.PI/180),t*Math.sin(n*Math.PI/180)]},formats:{color:{id:"--lchuv",coords:["<number> | <percentage>","<number> | <percentage>","<number> | <angle>"]}}}),X2=216/24389,Q2=24389/27,ql=O[0][0],Kl=O[0][1],Eo=O[0][2],Ul=O[1][0],Il=O[1][1],Co=O[1][2],Ll=O[2][0],Cl=O[2][1],xo=O[2][2];function ft(e,t,n){const s=t/(Math.sin(n)-e*Math.cos(n));return s<0?1/0:s}function Ts(e){const i=(e+16)**3/1560896,t=i>X2?i:e/Q2,a=t*(284517*ql-94839*Eo),r=t*(838422*Eo+769860*Kl+731718*ql),n=t*(632260*Eo-126452*Kl),c=t*(284517*Ul-94839*Co),l=t*(838422*Co+769860*Il+731718*Ul),s=t*(632260*Co-126452*Il),d=t*(284517*Ll-94839*xo),u=t*(838422*xo+769860*Cl+731718*Ll),o=t*(632260*xo-126452*Cl);return{r0s:a/n,r0i:r*e/n,r1s:a/(n+126452),r1i:(r-769860)*e/(n+126452),g0s:c/s,g0i:l*e/s,g1s:c/(s+126452),g1i:(l-769860)*e/(s+126452),b0s:d/o,b0i:u*e/o,b1s:d/(o+126452),b1i:(u-769860)*e/(o+126452)}}function ml(e,t){const n=t/360*Math.PI*2,s=ft(e.r0s,e.r0i,n),o=ft(e.r1s,e.r1i,n),i=ft(e.g0s,e.g0i,n),a=ft(e.g1s,e.g1i,n),r=ft(e.b0s,e.b0i,n),c=ft(e.b1s,e.b1i,n);return Math.min(s,o,i,a,r,c)}hl=new t({id:"hsluv",name:"HSLuv",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:ko,gamutSpace:Je,fromBase(e){let[t,o,s]=[w(e[0]),w(e[1]),w(e[2])],n;if(t>99.9999999)n=0,t=100;else if(t<1e-8)n=0,t=0;else{let e=Ts(t),i=ml(e,s);n=o/i*100}return[s,n,t]},toBase(e){let[s,o,t]=[w(e[0]),w(e[1]),w(e[2])],n;if(t>99.9999999)t=100,n=0;else if(t<1e-8)t=0,n=0;else{let e=Ts(t),i=ml(e,s);n=i/100*o}return[t,n,s]},formats:{color:{id:"--hsluv",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}}),O[0][0],O[0][1],O[0][2],O[1][0],O[1][1],O[1][2],O[2][0],O[2][1],O[2][2];function yt(e,t){return(t<0?-t:t)/(e**2+1)**.5}function dl(e){let t=yt(e.r0s,e.r0i),n=yt(e.r1s,e.r1i),s=yt(e.g0s,e.g0i),o=yt(e.g1s,e.g1i),i=yt(e.b0s,e.b0i),a=yt(e.b1s,e.b1i);return Math.min(t,n,s,o,i,a)}ll=new t({id:"hpluv",name:"HPLuv",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:ko,gamutSpace:"self",fromBase(e){let[t,s,o]=[w(e[0]),w(e[1]),w(e[2])],n;if(t>99.9999999)n=0,t=100;else if(t<1e-8)n=0,t=0;else{let e=Ts(t),o=dl(e);n=s/o*100}return[o,n,t]},toBase(e){let[s,o,t]=[w(e[0]),w(e[1]),w(e[2])],n;if(t>99.9999999)t=100,n=0;else if(t<1e-8)t=0,n=0;else{let e=Ts(t),s=dl(e);n=s/100*o}return[t,n,s]},formats:{color:{id:"--hpluv",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}}),wo=203,_o=2610/2**14,al=2**14/2610,il=2523/2**5,yo=2**5/2523,jo=3424/2**12,bo=2413/2**7,vo=2392/2**7,Qc=new z({id:"rec2100pq",cssId:"rec2100-pq",name:"REC.2100-PQ",base:yn,toBase(e){return e.map(function(e){let t=(Math.max(e**yo-jo,0)/(bo-vo*e**yo))**al;return t*1e4/wo})},fromBase(e){return e.map(function(e){let t=Math.max(e*wo/1e4,0),n=jo+bo*t**_o,s=1+vo*t**_o;return(n/s)**il})}}),go=.17883277,po=.28466892,fo=.55991073,Ds=3.7743,Kc=new z({id:"rec2100hlg",cssId:"rec2100-hlg",name:"REC.2100-HLG",referred:"scene",base:yn,toBase(e){return e.map(function(e){return e<=.5?e**2/3*Ds:(Math.exp((e-fo)/go)+po)/12*Ds})},fromBase(e){return e.map(function(e){return e/=Ds,e<=1/12?(3*e)**.5:go*Math.log(12*e-po)+fo})}}),uo={},be.add("chromatic-adaptation-start",e=>{e.options.method&&(e.M=Ic(e.W1,e.W2,e.options.method))}),be.add("chromatic-adaptation-end",e=>{e.M||(e.M=Ic(e.W1,e.W2,e.options.method))});function Ls({id:e,toCone_M:t,fromCone_M:n}){uo[e]=arguments[0]}function Ic(e,t,n="Bradford"){let s=uo[n],[o,i,a]=g(s.toCone_M,e),[r,c,l]=g(s.toCone_M,t),d=[[r/o,0,0],[0,c/i,0],[0,0,l/a]],u=g(d,s.toCone_M),h=g(s.fromCone_M,u);return h}Ls({id:"von Kries",toCone_M:[[.40024,.7076,-.08081],[-.2263,1.16532,.0457],[0,0,.91822]],fromCone_M:[[1.8599363874558397,-1.1293816185800916,.21989740959619328],[.3611914362417676,.6388124632850422,-6370596838649899e-21],[0,0,1.0890636230968613]]}),Ls({id:"Bradford",toCone_M:[[.8951,.2664,-.1614],[-.7502,1.7135,.0367],[.0389,-.0685,1.0296]],fromCone_M:[[.9869929054667121,-.14705425642099013,.15996265166373122],[.4323052697233945,.5183602715367774,.049291228212855594],[-.00852866457517732,.04004282165408486,.96848669578755]]}),Ls({id:"CAT02",toCone_M:[[.7328,.4296,-.1624],[-.7036,1.6975,.0061],[.003,.0136,.9834]],fromCone_M:[[1.0961238208355142,-.27886900021828726,.18274517938277307],[.4543690419753592,.4735331543074117,.07209780371722911],[-.009627608738429355,-.00569803121611342,1.0153256399545427]]}),Ls({id:"CAT16",toCone_M:[[.401288,.650173,-.051461],[-.250268,1.204414,.045854],[-.002079,.048952,.953127]],fromCone_M:[[1.862067855087233,-1.0112546305316845,.14918677544445172],[.3875265432361372,.6214474419314753,-.008973985167612521],[-.01584149884933386,-.03412293802851557,1.0499644368778496]]}),Object.assign(F,{A:[1.0985,1,.35585],C:[.98074,1,1.18232],D55:[.95682,1,.92149],D75:[.94972,1,1.22638],E:[1,1,1],F2:[.99186,1,.67393],F7:[.95041,1,1.08747],F11:[1.00962,1,.6435]}),F.ACES=[.32168/.33767,1,(1-.32168-.33767)/.33767],Hc=[[.6624541811085053,.13400420645643313,.1561876870049078],[.27222871678091454,.6740817658111484,.05368951740793705],[-.005574649490394108,.004060733528982826,1.0103391003129971]],Lc=[[1.6410233796943257,-.32480329418479,-.23642469523761225],[-.6636628587229829,1.6153315916573379,.016756347685530137],[.011721894328375376,-.008284441996237409,.9883948585390215]],lo=new z({id:"acescg",cssId:"--acescg",name:"ACEScg",coords:{r:{range:[0,65504],name:"Red"},g:{range:[0,65504],name:"Green"},b:{range:[0,65504],name:"Blue"}},referred:"scene",white:F.ACES,toXYZ_M:Hc,fromXYZ_M:Lc}),Ut=2**-16,Hs=-.35828683,It=(Math.log2(65504)+9.72)/17.52,Fc=new z({id:"acescc",cssId:"--acescc",name:"ACEScc",coords:{r:{range:[Hs,It],name:"Red"},g:{range:[Hs,It],name:"Green"},b:{range:[Hs,It],name:"Blue"}},referred:"scene",base:lo,toBase(e){const t=(9.72-15)/17.52;return e.map(function(e){return e<=t?(2**(e*17.52-9.72)-Ut)*2:e<It?2**(e*17.52-9.72):65504})},fromBase(e){return e.map(function(e){return e<=0?(Math.log2(Ut)+9.72)/17.52:e<Ut?(Math.log2(Ut+e*.5)+9.72)/17.52:(Math.log2(e)+9.72)/17.52})}}),ao=Object.freeze({__proto__:null,A98RGB:N2,A98RGB_Linear:rd,ACEScc:Fc,ACEScg:lo,CAM16_JMh:q1,HCT:ht,HPLuv:ll,HSL:ld,HSLuv:hl,HSV:cd,HWB:F2,ICTCP:Xn,JzCzHz:qn,Jzazbz:mi,LCH:xt,LCHuv:ko,Lab:P,Lab_D65:ps,Luv:Ql,OKLCH:V2,OKLab:tt,P3:Ro,P3_Linear:$o,ProPhoto:B2,ProPhoto_Linear:ad,REC_2020:Wo,REC_2020_Linear:yn,REC_2100_HLG:Kc,REC_2100_PQ:Qc,XYZ_ABS_D65:ms,XYZ_D50:is,XYZ_D65:C,sRGB:Je,sRGB_Linear:Vo}),U=class _Color{constructor(...i){let e;i.length===1&&(e=o(i[0]));let a,s,n;e?(a=e.space||e.spaceId,s=e.coords,n=e.alpha):[a,s,n]=i,Object.defineProperty(this,"space",{value:t.get(a),writable:!1,enumerable:!0,configurable:!0}),this.coords=s?s.slice():[0,0,0],this.alpha=n>1||n===0[0]?1:n<0?0:n;for(let e=0;e<this.coords.length;e++)this.coords[e]==="NaN"&&(this.coords[e]=NaN);for(let e in this.space.coords)Object.defineProperty(this,e,{get:()=>this.get(e),set:t=>this.set(e,t)})}get spaceId(){return this.space.id}clone(){return new _Color(this.space,this.coords,this.alpha)}toJSON(){return{spaceId:this.spaceId,coords:this.coords,alpha:this.alpha}}display(...t){let e=N0(this,...t);return e.color=new _Color(e.color),e}static get(e,...t){return e instanceof _Color?e:new _Color(e,...t)}static defineFunction(e,t,n=t){let{instance:i=!0,returns:s}=n,o=function(...n){let e=t(...n);if(s==="color")e=_Color.get(e);else if(s==="function<color>"){let t=e;e=function(...e){let n=t(...e);return _Color.get(n)},Object.assign(e,t)}else s==="array<color>"&&(e=e.map(e=>_Color.get(e)));return e};e in _Color||(_Color[e]=o),i&&(_Color.prototype[e]=function(...e){return o(this,...e)})}static defineFunctions(e){for(let t in e)_Color.defineFunction(t,e[t],e[t])}static extend(e){if(e.register)e.register(_Color);else for(let t in e)_Color.defineFunction(t,e[t])}},U.defineFunctions({get:K,getAll:un,set:he,setAll:ki,to:p,equals:L0,inGamut:Ke,toGamut:Se,distance:W1,toString:On}),Object.assign(U,{util:Ju,hooks:be,WHITES:F,Space:t,spaces:t.registry,parse:c1,defaults:R});for(let e of Object.keys(ao))t.register(ao[e]);for(let e in t.registry)io(e,t.registry[e]);be.add("colorspace-init-end",e=>{io(e.id,e),e.aliases?.forEach(t=>{io(t,e)})});function io(e,n){let s=e.replace(/-/g,"_");Object.defineProperty(U.prototype,s,{get(){let s=this.getAll(e);return typeof Proxy=="undefined"?s:new Proxy(s,{has:(e,s)=>{try{return t.resolveCoord([n,s]),!0}catch{}return Reflect.has(e,s)},get:(e,s,o)=>{if(s&&typeof s!="symbol"&&!(s in e)){let{index:o}=t.resolveCoord([n,s]);if(o>=0)return e[o]}return Reflect.get(e,s,o)},set:(s,o,i,a)=>{if(o&&typeof o!="symbol"&&!(o in s)||o>=0){let{index:a}=t.resolveCoord([n,o]);if(a>=0)return s[a]=i,this.setAll(e,s),!0}return Reflect.set(s,o,i,a)}})},set(t){this.setAll(e,t)},configurable:!0,enumerable:!0})}U.extend(Pe),U.extend({deltaE:Qt}),Object.assign(U,{deltaEMethods:Pe}),U.extend(gd),U.extend({contrast:f2}),U.extend(wd),U.extend(Fu),U.extend(E4),U.extend(rn);function B(e){return(t,...n)=>$3(e,t,n)}function Mt(e,t){return B(W3(e,t).get)}var{apply:$3,getOwnPropertyDescriptor:W3,getPrototypeOf:oo}=Reflect,y,Ee,Cd,Do,Nu,gn,g1,Ko,Go,Qo,M1,O1,nt,Re,ue,y1,Ei,a,r,v1,jn,u1,ve,l1,cn,we,i1,x0,n1,Mi,Xu,se,zi,Ni,n,ju,ks,Bi,bd,In,ta,fd,St,wl,zs,At,Ze,yl,jl,Zt,$e,ja,el,_a,Wc,_e,wa,gs,qe,pn,W,vn,bn,Me,Ea,He,Sa,os,Zn,Ma,Ta,Cc,xc,Oc,wc,_c,yc,jc,Dn,Na,Ka,ac,nc,Kr,Nr,Sr,Er,Qn,ie,ea,Ue,g0,Hu,Nd,To,ud,cl,Gc,Nc,co,Xr,tc,cc,lc,wt,Lt,ho,mo,qc,ce,Xc,Jc,tl,ol,rl,$s,fl,gl,Pl,Yl,dd,Ad,Fo,H,zo,$t,$d,G,Ru,Ve,Pu,fe,v,Ns,t1,h1,me,x,Yt,C1,E1,A1,T1,I,X,ri,_4,b4,v4,g4,Es,Qu,Ti,Gu,Ku,Ii,du,xs,Od,Q,an,ct,la,ln,ua,C4,Al,Xe,El,_l,bl,ba,pl,ya,$c,Vc,xa,Tc,ot,Mc,Sc,Ec,vc,Da,gc,La,Ra,pc,hc,Ia,ds,uc,dc,at,rc,Gr,Wr,Ir,Ar,Or,Qe,rt,yr,Dl,nr,sr,ke,ir,ar,rr,cr,lr,dr,ur,hr,mr,fr,pr,gr,u,jr,qs,de,pe,Jn,xr,xn,ne,kr,En,zr,Bn,qa,Qr,Zr,Jr,ec,ic,_t,Rn,Ae,c,T,N,Y,Fe,bt,kn,Gn,kc,_,zc,e,Rc,vl,V,Et,ga,Ol,pa,fa,ma,Sl,Ml,Fl,Tl,zl,ha,Nl,da,Rl,ra,Hl,Wt,Vl,$l,Wl,aa,oa,Is,Vt,Zl,Jl,ed,Xi,Rd,er,Id,Gi,Vd,Wd,Ud,Kd,Gd,qi,Jd,eu,tu,Ui,su,Vi,iu,au,ru,cu,lu,Ge,hu,mu,vu,bu,Jt,yu,_u,wu,Pi,Ri,Li,Eu,Tu,zu,Bu,Ju,e1,be,F,R,a1,d1,t,C,z,is,_1,Ci,_n,Yn,P,xt,xi,Fn,Oi,et,N1,L1,R1,P1,tt,B1,K1,ji,Ks,ms,Nt,Dt,bi,e4,vi,gi,pi,o4,fi,zn,Vn,c4,l4,d4,u4,mi,qn,hi,ui,di,li,j4,y4,ci,w4,O4,x4,md,Xn,p4,ai,ii,es,oi,f4,r4,i4,ze,n4,si,ni,q1,U1,V1,ei,ns,ht,S1,Xo,Pe,Yo,qo,j1,b1,yn,fn,Uo,Wo,o1,s1,$o,Wu,O,Vo,Bo,Io,Ho,Je,Ro,D0,Fu,Mu,Cu,Ou,pu,Lo,uu,nu,Zd,Xd,No,Pd,Td,Sd,Mo,hn,fs,ps,vs,rn,wd,gd,hl,ll,wo,_o,al,il,yo,jo,bo,vo,Qc,go,po,fo,Ds,Kc,uo,Hc,Lc,lo,Ut,Hs,It,Fc,ao,E,U,so,no,M,oc,eo,Js,Zs,Vr,Hr,Qs,rh,ch,te,ee,Xs,Ft,Rr,Lr,Dr,Tr,zt,Ys,wr,_r,vr,{EPSILON:K3,isFinite:kh,isNaN:Ah}=Number,{iterator:fc,toStringTag:Y3}=Symbol,{abs:Sh}=Math,G3=ArrayBuffer,X3=G3.prototype;Mt(X3,"byteLength"),so=typeof SharedArrayBuffer!="undefined"?SharedArrayBuffer:null,so&&Mt(so.prototype,"byteLength"),no=oo(Uint8Array),no.from,M=no.prototype,M[fc],B(M.keys),B(M.values),B(M.entries),B(M.set),B(M.reverse),B(M.fill),B(M.copyWithin),B(M.sort),B(M.slice),B(M.subarray),Mt(M,"buffer"),Mt(M,"byteOffset"),Mt(M,"length"),Mt(M,Y3),oc=Uint8Array,eo=Uint16Array,Js=Uint32Array,Zs=oo([][fc]()),B(Zs.next),B(function*(){}().next),oo(Zs),Vr=1/K3,Hr=6103515625e-14,Qs=.0009765625,rh=Qs*Hr,ch=Qs*Vr,te=new eo(512),ee=new oc(512);for(let e=0;e<256;++e){const t=e-127;t<-24?(te[e]=0,te[e|256]=32768,ee[e]=24,ee[e|256]=24):t<-14?(te[e]=1024>>-t-14,te[e|256]=1024>>-t-14|32768,ee[e]=-t-1,ee[e|256]=-t-1):t<=15?(te[e]=t+15<<10,te[e|256]=t+15<<10|32768,ee[e]=13,ee[e|256]=13):t<128?(te[e]=31744,te[e|256]=64512,ee[e]=24,ee[e|256]=24):(te[e]=31744,te[e|256]=64512,ee[e]=13,ee[e|256]=13)}Xs=new Js(2048);for(let e=1;e<1024;++e){let t=e<<13,n=0;for(;(t&8388608)===0;)t<<=1,n-=8388608;t&=-8388609,n+=947912704,Xs[e]=t|n}for(let e=1024;e<2048;++e)Xs[e]=939524096+(e-1024<<13);Ft=new Js(64);for(let e=1;e<31;++e)Ft[e]=e<<23;Ft[31]=1199570944,Ft[32]=2147483648;for(let e=33;e<63;++e)Ft[e]=2147483648+(e-32<<23);Ft[63]=3347054592,Rr=new eo(64);for(let e=1;e<64;++e)e!==32&&(Rr[e]=1024);function fh(){const e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(e==null)console.warn(`Unsupported / untested browser (${navigator.userAgent}) detected - using more modern defaults`);else if(e.length>=3)return Number(e[2]);return null}function Gs(){const e={colorSpace:zu.DEFAULT_COLORSPACE},t=fh();return t==null?(console.warn(`Unsupported / untested browser (${navigator.userAgent}) detected - using more modern defaults`),e.colorType="float16",e.toneMapping={mode:"extended"}):t<134?console.warn("Older Chrome / chromium based browser detected, using older `pixelFormat`"):e.pixelFormat="float16",e}function gh(){HTMLCanvasElement.prototype._getContext=HTMLCanvasElement.prototype.getContext,HTMLCanvasElement.prototype.getContext=function(e,t){return t!==0[0]?t=Object.assign({},t,Gs()):t=Gs(),this._getContext(e,t)}}function vh(){try{const e=screen.colorDepth/3,t=e>8,n=window.matchMedia("(dynamic-range: high)").matches,s=window.matchMedia("(color-gamut: rec2020)").matches||window.matchMedia("(color-gamut: p3)").matches;return!!(s&&n)&&e===Math.round(e)&&!!t}catch(e){return console.error("Exception during check for HDR",e),!1}}function bh(){try{const e=document.createElement("canvas");if(!e.getContext)return!1;const t=Gs(),n=e.getContext("2d",t);return n!==null}catch{return console.error("Bad canvas ColorSpace test - make sure that the Chromium browser flag 'enable-experimental-web-platform-features' has been enabled"),!1}}Lr=class extends Q{constructor(e){const t=e||{};super(e),this.pauseableAnimations_=[],this.animationsPointer_=-1,this.lastAnimation_={},this.initalCenter=this.getCenter()}getPauseableAnimation_(){return this.pauseableAnimations_.length-1>this.animationsPointer_?(this.animationsPointer_++,this.pauseableAnimations_[this.animationsPointer_]):(this.animationsPointer_=0,this.pauseableAnimations_[this.animationsPointer_])}nextAnimation_(e){if(e===0[0]||e){var t=this,n=this.getPauseableAnimation_();this.animate(n,function(e){t.nextAnimation_(e)})}}pauseAnimation(){if(!this.getAnimating())return;var e=this.animations_[0][0],t=Date.now(),n=t-e.start;let s={center:e.center,zoom:e.zoom,rotation:e.rotation,duration:e.duration-n};this.lastAnimation_=s,this.cancelAnimations()}startAnimation_(){if(this.getAnimating())return;Object.keys(this.lastAnimation_).length!==0&&(this.lastAnimation_={});var e=this;this.animate(this.getPauseableAnimation_,function(t){e.nextAnimation_(t)})}resumeAnimation(){if(this.getAnimating())return;if(Object.keys(this.lastAnimation_).length===0)this.startAnimation_();else{var e=this;this.animate(this.lastAnimation_,function(t){e.nextAnimation_(t)})}}setPauseableAnimation(){var n,t=new Array(arguments.length);for(let e=0;e<t.length;++e)n=arguments[e],t[e]=n;this.animationsPointer_=-1,this.pauseableAnimations_=t}getPauseableAnimation(){return this.pauseableAnimations_}setCenter(e){this.initalCenter=e,this.setCenterInternal(ae(e,this.getProjection()))}isNoopAnimation(){return!1}setResolutions(e){this.resolutions_=e}setExtent(e){var t={};t.extent=ye(e,this.projection_),this.applyOptions_(t)}},Dr=class extends Xe{constructor(e){const n=e||{},o=n.tipLabel?n.tipLabel:"Rotate 90\xB0 left",t=document.createElement("button");t.innerHTML='<i class="icon-left"></i>',t.title=o;const s=document.createElement("div");s.className="rotate-left ol-unselectable ol-control",s.appendChild(t),super({element:s,target:n.target}),t.addEventListener("click",this.handleRotateLeft.bind(this),!1)}handleRotateLeft(){var e=this.getMap().getView().getRotation();this.getMap().getView().setRotation(e+-90*Math.PI/180)}},Tr=class extends Xe{constructor(e){const n=e||{},o=n.tipLabel?n.tipLabel:"Rotate 90\xB0 right",t=document.createElement("button");t.innerHTML='<i class="icon-right"></i>',t.title=o;const s=document.createElement("div");s.className="rotate-right ol-unselectable ol-control",s.appendChild(t),super({element:s,target:n.target}),t.addEventListener("click",this.handleRotateRight.bind(this),!1)}handleRotateRight(){var e=this.getMap().getView().getRotation();this.getMap().getView().setRotation(e+90*Math.PI/180)}},window.addMap=function(e,t,n,s,o){if(r=0,n!==0[0]&&n!=0&&(r=n*Math.PI/180),o===0[0]&&(o=!1),i="en",document.documentElement.lang!==0[0]){const e=new Intl.Locale(document.documentElement.lang);i=e.language}a={de:{zoomIn:"Vergr\xF6\xDFern",zoomOut:"Verkleinern",fullscreen:"Vollbildansicht",rotate:"Rotation zur\xFCcksetzen",rotateLeft:"90\xB0 nach links drehen",rotateRight:"90\xB0 nach rechst drehen"},en:{zoomIn:"Zoom in",zoomOut:"Zoom out",fullscreen:"Toggle full-screen",rotate:"Reset rotation",rotateLeft:"Rotate 90\xB0 left",rotateRight:"Rotate 90\xB0 right"}},console.log("Setting up "+i),o&&vh()&&bh()&&(gh(),console.log("Enabled HDR Canvas"));var i,a,r,l=new Pi,c=new qi({controls:[new ya({zoomInTipLabel:a[i].zoomIn,zoomOutTipLabel:a[i].zoomOut}),new Tu({tipLabel:a[i].fullscreen}),new ba({tipLabel:a[i].rotate}),new Dr({tipLabel:a[i].rotateLeft}),new Tr({tipLabel:a[i].rotateRight})],layers:[l],target:e});return fetch(t).then(function(e){e.json().then(function(e){var n,t=new Ko(e).getTileSourceOptions();if(t===0[0]||t.version===0[0]){console.log("Data seems to be no valid IIIF image information.");return}t.zDirection=-1,s!==0[0]&&s!=""&&(t.url=s),n=new Fo(t),l.setSource(n),c.setView(new Q({resolutions:n.getTileGrid().getResolutions(),extent:n.getTileGrid().getExtent(),constrainOnlyCenter:!0,rotation:r})),c.getView().fit(n.getTileGrid().getExtent())}).catch(function(e){console.log("Could not read image info json. "+e)})}).catch(function(){console.log("Could not read data from URL.")}),c},window.animatedMap=function(e,t,n,s,o,i,a,r){d=0,n!==0[0]&&n!=0&&(d=n*Math.PI/180);var d,u=new Pi,l=new qi({controls:[],layers:[u],target:e}),c=new Lr({constrainOnlyCenter:!0,rotation:d});return fetch(t).then(function(e){e.json().then(function(e){var n,t=new Ko(e).getTileSourceOptions();if(t===0[0]||t.version===0[0]){console.log("Data seems to be no valid IIIF image information.");return}t.zDirection=-1,s!==0[0]&&s!=""&&(t.url=s),n=new Fo(t),u.setSource(n),c.setExtent(n.getTileGrid().getExtent()),c.setResolutions(n.getTileGrid().getResolutions()),l.setView(c),l.getView().fit(n.getTileGrid().getExtent()),o!==0[0]&&o!==""&&l.getView().setZoom(o),r!==0[0]&&r!==""&&l.getView().setCenter(r)}).catch(function(e){console.log(`Could not read image info json from "${t}".`+e)})}).catch(function(){console.log("Could not read data from URL.")}),i!==0[0]&&i!==""&&a!==0[0]&&(Array.isArray(i)?c.setPauseableAnimation(...i):c.setPauseableAnimation(i),l.once("rendercomplete",function(){a.addEventListener("mouseenter",function(){c.resumeAnimation()}),a.addEventListener("mouseleave",function(){c.pauseAnimation()})})),l},zt={hasTouch:!1,isToggled:!1},Ys=()=>{zt.hasTouch=!0,window.removeEventListener("touchstart",Ys),window.innerWidth>799&&document.querySelectorAll(".menu-item-has-children").forEach(e=>{e.classList.add("closed"),e.addEventListener("click",t=>{e.classList.contains("closed")&&(t.preventDefault(),e.classList.remove("closed"))})})},window.addEventListener("touchstart",Ys,{passive:!0}),wr=()=>{const t=document.querySelector("#site-header"),n=document.querySelector("#menu-primary"),e=document.querySelector("#overflow-container");zt.isToggled=!zt.isToggled,t.classList.toggle("toggled",zt.isToggled),zt.isToggled?e.style.minHeight=`${window.innerHeight+240}px`:setTimeout(()=>{n.removeAttribute("style"),e.removeAttribute("style")},400)},_r=()=>{const e=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const n=t.target;n.dataset.src&&(n.src=n.dataset.src),n.dataset.background&&(n.style.backgroundImage=`url(${n.dataset.background})`),n.classList.remove("lazy-image","lazy-bg-image"),e.unobserve(n)}})},{rootMargin:"100px"});document.querySelectorAll(".lazy").forEach(t=>e.observe(t))},vr=()=>{const e=document.querySelector("#return-top");e!==null&&(window.addEventListener("scroll",()=>{e.classList.toggle("visible",window.scrollY>=600)}),e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))},document.addEventListener("DOMContentLoaded",()=>{_r(),vr(),document.querySelector("#toggle-navigation")?.addEventListener("click",wr),document.querySelectorAll(".menu-item a").forEach(e=>{e.addEventListener("focus",()=>e.closest("li").classList.add("focused")),e.addEventListener("blur",()=>e.closest("li").classList.remove("focused"))})})})(),(()=>{var m,ke,V,Ys,ht,wt,x,Ct,po,l,u,Ce,Bs,d,f,y,K,Is,Hs,et,vo,Rs,Ke,Ie,Ge,Eo,R,ko,Z,Xe,Tt,se,it,zs,zt,Do,ft,No,Bo,Yo,ii,fi,Os,s,ws,Pt,S,Ni,p,Vt,hs,us,gt,pt,H,mn,Le,er,st,Ze,fe,en,Fe,n4,t4,Y1,pn,yn,Fn,Qu,cu,nu,Jd,Zt,Je,Ud,Wd,$d,ms,gs,Ls,Vd,P,Pe,Cd,xl,wl,Hr,Rr,Ar,rt,ot,xe,E,B,Ee,ae,je,Dn,qe,Be,O,gn,ca,sa,Yi,Ki,Ui,Qe,Oe,Bn,Q,Fi,qt,Ai,ki,Ei,Jn,Oi,yi,mi,os,rs,Bt,$e,It,ei,Ht,Uo,Ho,Ae,Lo,To,So,Ao,Gs,Xs,Qs,lo,At,_t,ro,so,no,eo,ho,mo,z,qs,c,dt,W,Et,Ne,D,De,As,bt,a,si,oi,C,Ve,$t,cs,He,ss,Me,bi,_,Ci,Zn,Qn,Xn,Si,Mi,G,Un,zi,Di,mt,$n,N,Ii,Bi,Ln,Tn,on,Mn,An,Cn,rn,oa,ia,On,la,_n,yt,Ue,va,ba,de,ya,pe,wa,Oa,Ca,i,Sa,Ma,xn,za,Da,Na,La,Ra,Pa,Ha,Ia,Ba,Va,$a,Wa,Ka,qa,Ya,Qt,Qa,Za,Kt,tr,nr,sr,or,ar,rr,cr,lr,dr,ur,hr,mr,fr,pr,vr,Ut,yr,_r,Or,fs,Cr,Er,be,Sr,Mr,js,zr,Dr,_s,Ir,Br,Vr,$r,Wr,Ur,Kr,Yr,Xr,Qr,Zr,Jr,ec,tc,nc,sc,oc,ic,ac,rc,cc,lc,dc,uc,hc,mc,fc,pc,gc,vc,io,jc,yc,_c,wc,Oc,xc,Cc,Ec,kc,Sc,Mc,Fc,Tc,zc,Dc,Nc,Lc,Rc,Pc,ks,Bc,Vc,Wc,Uc,Kc,Yc,Gc,Xc,Qc,Zc,Jc,el,tl,nl,sl,ol,il,al,rl,cl,ll,dl,ul,hl,ml,fl,pl,gl,vl,bl,jl,_l,Ds,Cl,El,kl,Al,Ml,Fl,Tl,Dl,Nl,Ll,Rl,Pl,Hl,Il,Bl,Vl,Wl,Ul,Kl,ql,Yl,Gl,Xl,Ql,Zl,ed,td,nd,od,id,ad,cd,ld,dd,hd,md,fd,gd,vd,bd,yd,_d,wd,xd,jt,Ad,Ks,he,Fd,Nd,$s,Vs,fn,Gn,eu,su,ou,iu,au,tn,lu,du,hu,mu,fu,gu,vu,bu,yu,_u,wu,xu,Cu,Eu,ku,Au,Su,Mu,Fu,Tu,zu,Du,Nu,Lu,Ru,Pu,Hu,Iu,Bu,Vu,$u,Wu,Uu,qu,Yu,Gu,Nn,Zu,Ju,vn,n1,s1,i1,a1,r1,l1,d1,u1,m1,f1,p1,v1,b1,j1,_1,w1,O1,C1,E1,k1,S1,M1,F1,T1,z1,N1,L1,R1,H1,I1,B1,$1,W1,U1,q1,hn,G1,X1,Z1,un,ln,Sn,o4,i4,a4,r4,c4,l4,d4,u4,h4,m4,f4,p4,g4,v4,b4,j4,y4,w4,O4,x4,E4,k4,A4,M4,F4,T4,D4,N4,L4,P4,H4,I4,V4,$4,W4,K4,q4,Y4,X4,Q4,Z4,e0,t0,n0,o0,i0,a0,c0,l0,d0,h0,m0,ao,g0,v0,p0,u0,r0,s0,J4,G4,U4,B4,R4,z4,S4,C4,_4,s4,Q1,K1,V1,P1,D1,A1,x1,y1,g1,h1,c1,o1,t1,e1,Xu,Ku,Ou,ju,pu,uu,ru,tu,Zd,Qd,Xd,Gd,Yd,qd,Bd,Id,Pd,Rd,Ld,Dd,zd,Td,Md,Sd,Od,jd,pd,ud,rd,sd,Jl,$l,zl,Sl,yl,qc,$c,Ic,Hc,Ac,bc,Gr,qr,Lr,Nr,Tr,Fr,kr,xr,wr,jr,Ja,Xa,Pn,Ua,Ta,In,Fa,ka,Wn,xa,_a,Yn,ua,da,ra,aa,es,ds,Ji,Zi,qi,$i,ps,bs,Pi,Ri,ys,Ti,xi,xs,_i,ji,pi,Es,ui,li,Nt,Qo,qo,$o,Fs,bo,go,fo,zh,H2={};function Js(e){const t=Object.create(null);for(const n of e.split(","))t[n]=1;return e=>e in t}m={},ke=[],V=()=>{},Ys=()=>!1,ht=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),wt=e=>e.startsWith("onUpdate:"),x=Object.assign,Ct=(e,t)=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)},po=Object.prototype.hasOwnProperty,u=(e,t)=>po.call(e,t),l=Array.isArray,Ce=e=>et(e)==="[object Map]",Bs=e=>et(e)==="[object Set]",d=e=>typeof e=="function",y=e=>typeof e=="string",K=e=>typeof e=="symbol",f=e=>e!==null&&typeof e=="object",Is=e=>(f(e)||d(e))&&d(e.then)&&d(e.catch),Hs=Object.prototype.toString,et=e=>Hs.call(e),vo=e=>et(e).slice(8,-1),Rs=e=>et(e)==="[object Object]",Ke=e=>y(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Ie=Js(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Ge=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},Eo=/-\w/g,R=Ge(e=>e.replace(Eo,e=>e.slice(1).toUpperCase())),ko=/\B([A-Z])/g,Z=Ge(e=>e.replace(ko,"-$1").toLowerCase()),Xe=Ge(e=>e.charAt(0).toUpperCase()+e.slice(1)),Tt=Ge(e=>e?`on${Xe(e)}`:""),se=(e,t)=>!Object.is(e,t),it=(e,...t)=>{for(let n=0;n<e.length;n++)e[n](...t)},zs=(e,t,n,s=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:s,value:n})},zt=e=>{const t=parseFloat(e);return isNaN(t)?e:t},ft=()=>Do||(Do=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function ue(e){if(l(e)){const t={};for(let n=0;n<e.length;n++){const s=e[n],o=y(s)?$3(s):ue(s);if(o)for(const e in o)t[e]=o[e]}return t}if(y(e)||f(e))return e}No=/;(?![^(]*\))/g,Bo=/:([^]+)/,Yo=/\/\*[^]*?\*\//g;function $3(e){const t={};return e.replace(Yo,"").split(No).forEach(e=>{if(e){const n=e.split(Bo);n.length>1&&(t[n[0].trim()]=n[1].trim())}}),t}function j(e){let t="";if(y(e))t=e;else if(l(e))for(let n=0;n<e.length;n++){const s=j(e[n]);s&&(t+=s+" ")}else if(f(e))for(const n in e)e[n]&&(t+=n+" ");return t.trim()}ii="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",fi=Js(ii);function wi(e){return!!e||e===""}Os=e=>!!(e&&e.__v_isRef===!0),s=e=>y(e)?e:e==null?"":l(e)||f(e)&&(e.toString===Hs||!d(e.toString))?Os(e)?s(e.value):JSON.stringify(e,ws,2):String(e),ws=(e,t)=>Os(t)?ws(e,t.value):Ce(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((e,[t,n],s)=>(e[Pt(t,s)+" =>"]=n,e),{})}:Bs(t)?{[`Set(${t.size})`]:[...t.values()].map(e=>Pt(e))}:K(t)?Pt(t):f(t)&&!l(t)&&!Rs(t)?String(t):t,Pt=(e,t="")=>{var n;return K(e)?`Symbol(${(n=e.description)!=null?n:t})`:e},Ni=class{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=S,!e&&S&&(this.index=(S.scopes||(S.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=S;try{return S=this,e()}finally{S=t}}}on(){++this._on===1&&(this.prevScope=S,S=this)}off(){this._on>0&&--this._on===0&&(S=this.prevScope,this.prevScope=0[0])}stop(e){if(this._active){this._active=!1;let t,n;for(t=0,n=this.effects.length;t<n;t++)this.effects[t].stop();for(this.effects.length=0,t=0,n=this.cleanups.length;t<n;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const e=this.parent.scopes.pop();e&&e!==this&&(this.parent.scopes[this.index]=e,e.index=this.index)}this.parent=0[0]}}};function Vi(){return S}function E3(e){S&&S.cleanups.push(e)}Vt=new WeakSet,hs=class{constructor(e){this.fn=e,this.deps=0[0],this.depsTail=0[0],this.flags=5,this.next=0[0],this.cleanup=0[0],this.scheduler=0[0],S&&S.active&&S.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Vt.has(this)&&(Vt.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||ea(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Ga(this),na(this);const e=p,t=H;p=this,H=!0;try{return this.fn()}finally{ha(this),p=e,H=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Vn(e);this.deps=this.depsTail=0[0],Ga(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Vt.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){qn(this)&&this.run()}get dirty(){return qn(this)}},us=0;function ea(e,t=!1){if(e.flags|=8,t){e.next=pt,pt=e;return}e.next=gt,gt=e}function is(){us++}function ns(){if(--us>0)return;if(pt){let e=pt;for(pt=0[0];e;){const t=e.next;e.next=0[0],e.flags&=-9,e=t}}let e;for(;gt;){let t=gt;for(gt=0[0];t;){const n=t.next;if(t.next=0[0],t.flags&=-9,t.flags&1)try{t.trigger()}catch(t){e||(e=t)}t=n}}if(e)throw e}function na(e){for(let t=e.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function ha(e){let s,n=e.depsTail,t=n;for(;t;){const e=t.prevDep;t.version===-1?(t===n&&(n=e),Vn(t),l3(t)):s=t,t.dep.activeLink=t.prevActiveLink,t.prevActiveLink=0[0],t=e}e.deps=s,e.depsTail=n}function qn(e){for(let t=e.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(Ea(t.dep.computed)||t.dep.version!==t.version))return!0;return!!e._dirty}function Ea(e){if(e.flags&4&&!(e.flags&16)||(e.flags&=-17,e.globalVersion===Le)||(e.globalVersion=Le,!e.isSSR&&e.flags&128&&(!e.deps&&!e._dirty||!qn(e))))return;e.flags|=2;const t=e.dep,n=p,s=H;p=e,H=!0;try{na(e);const n=e.fn(e._value);(t.version===0||se(n,e._value))&&(e.flags|=128,e._value=n,t.version++)}catch(e){throw t.version++,e}finally{p=n,H=s,ha(e),e.flags&=-3}}function Vn(e,t=!1){const{dep:n,prevSub:s,nextSub:o}=e;if(s&&(s.nextSub=o,e.prevSub=0[0]),o&&(o.prevSub=s,e.nextSub=0[0]),n.subs===e&&(n.subs=s,!s&&n.computed)){n.computed.flags&=-5;for(let e=n.computed.deps;e;e=e.nextDep)Vn(e,!0)}!t&&!--n.sc&&n.map&&n.map.delete(n.key)}function l3(e){const{prevDep:t,nextDep:n}=e;t&&(t.nextDep=n,e.prevDep=0[0]),n&&(n.prevDep=t,e.nextDep=0[0])}H=!0,mn=[];function oe(){mn.push(H),H=!1}function J(){const e=mn.pop();H=e===0[0]||e}function Ga(e){const{cleanup:t}=e;if(e.cleanup=0[0],t){const e=p;p=0[0];try{t()}finally{p=e}}}Le=0,er=class{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=0[0]}},st=class{constructor(e){this.computed=e,this.version=0,this.activeLink=0[0],this.subs=0[0],this.map=0[0],this.key=0[0],this.sc=0,this.__v_skip=!0}track(){if(!p||!H||p===this.computed)return;let t=this.activeLink;if(t===0[0]||t.sub!==p)t=this.activeLink=new er(p,this),p.deps?(t.prevDep=p.depsTail,p.depsTail.nextDep=t,p.depsTail=t):p.deps=p.depsTail=t,gr(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const e=t.nextDep;e.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=e),t.prevDep=p.depsTail,t.nextDep=0[0],p.depsTail.nextDep=t,p.depsTail=t,p.deps===t&&(p.deps=e)}return t}trigger(e){this.version++,Le++,this.notify(e)}notify(){is();try{for(let e=this.subs;e;e=e.prevSub)e.sub.notify()&&e.sub.dep.notify()}finally{ns()}}};function gr(e){if(e.dep.sc++,e.sub.flags&4){const n=e.dep.computed;if(n&&!e.dep.subs){n.flags|=20;for(let e=n.deps;e;e=e.nextDep)gr(e)}const t=e.dep.subs;t!==e&&(e.prevSub=t,t&&(t.nextSub=e)),e.dep.subs=e}}Ze=new WeakMap,fe=Symbol(""),en=Symbol(""),Fe=Symbol("");function A(e,t,n){if(H&&p){let t=Ze.get(e);t||Ze.set(e,t=new Map);let s=t.get(n);s||(t.set(n,s=new st),s.map=t,s.key=n),s.track()}}function ee(e,t,n,s){const a=Ze.get(e);if(!a){Le++;return}const r=e=>{e&&e.trigger()};if(is(),t==="clear")a.forEach(r);else{const o=l(e),i=o&&Ke(n);if(o&&n==="length"){const e=Number(s);a.forEach((t,n)=>{(n==="length"||n===Fe||!K(n)&&n>=e)&&r(t)})}else switch((n!==0[0]||a.has(0[0]))&&r(a.get(n)),i&&r(a.get(Fe)),t){case"add":o?i&&r(a.get("length")):(r(a.get(fe)),Ce(e)&&r(a.get(en)));break;case"delete":o||(r(a.get(fe)),Ce(e)&&r(a.get(en)));break;case"set":Ce(e)&&r(a.get(fe));break}}ns()}function D0(e,t){const n=Ze.get(e);return n&&n.get(t)}function ze(e){const t=h(e);return t===e?t:(A(t,"iterate",Fe),L(e)?t:t.map(P))}function an(e){return A(e=h(e),"iterate",Fe),e}function ge(e,t){return ne(e)?Pe(ve(e)?P(t):t):P(t)}n4={__proto__:null,[Symbol.iterator](){return jn(this,Symbol.iterator,e=>ge(this,e))},concat(...e){return ze(this).concat(...e.map(e=>l(e)?ze(e):e))},entries(){return jn(this,"entries",e=>(e[1]=ge(this,e[1]),e))},every(e,t){return ce(this,"every",e,t,0[0],arguments)},filter(e,t){return ce(this,"filter",e,t,e=>e.map(e=>ge(this,e)),arguments)},find(e,t){return ce(this,"find",e,t,e=>ge(this,e),arguments)},findIndex(e,t){return ce(this,"findIndex",e,t,0[0],arguments)},findLast(e,t){return ce(this,"findLast",e,t,e=>ge(this,e),arguments)},findLastIndex(e,t){return ce(this,"findLastIndex",e,t,0[0],arguments)},forEach(e,t){return ce(this,"forEach",e,t,0[0],arguments)},includes(...e){return ls(this,"includes",e)},indexOf(...e){return ls(this,"indexOf",e)},join(e){return ze(this).join(e)},lastIndexOf(...e){return ls(this,"lastIndexOf",e)},map(e,t){return ce(this,"map",e,t,0[0],arguments)},pop(){return Ye(this,"pop")},push(...e){return Ye(this,"push",e)},reduce(e,...t){return J1(this,"reduce",e,t)},reduceRight(e,...t){return J1(this,"reduceRight",e,t)},shift(){return Ye(this,"shift")},some(e,t){return ce(this,"some",e,t,0[0],arguments)},splice(...e){return Ye(this,"splice",e)},toReversed(){return ze(this).toReversed()},toSorted(e){return ze(this).toSorted(e)},toSpliced(...e){return ze(this).toSpliced(...e)},unshift(...e){return Ye(this,"unshift",e)},values(){return jn(this,"values",e=>ge(this,e))}};function jn(e,t,n){const o=an(e),s=o[t]();return o!==e&&!L(e)&&(s._next=s.next,s.next=()=>{const e=s._next();return e.done||(e.value=n(e.value)),e}),s}t4=Array.prototype;function ce(e,t,n,s,o,i){const a=an(e),r=a!==e&&!L(e),c=a[t];if(c!==t4[t]){const t=c.apply(e,i);return r?P(t):t}let l=n;a!==e&&(r?l=function(t,s){return n.call(this,ge(e,t),s,e)}:n.length>2&&(l=function(t,s){return n.call(this,t,s,e)}));const d=c.call(a,l,s);return r&&o?o(d):d}function J1(e,t,n,s){const i=an(e);let o=n;return i!==e&&(L(e)?n.length>3&&(o=function(t,s,o){return n.call(this,t,s,o,e)}):o=function(t,s,o){return n.call(this,t,ge(e,s),o,e)}),i[t](o,...s)}function ls(e,t,n){const s=h(e);A(s,"iterate",Fe);const o=s[t](...n);return(o===-1||o===!1)&&Jt(n[0])?(n[0]=h(n[0]),s[t](...n)):o}function Ye(e,t,n=[]){oe(),is();const s=h(e)[t].apply(e,n);return ns(),J(),s}Y1=Js("__proto__,__v_isRef,__isVue"),pn=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(K));function X0(e){K(e)||(e=String(e));const t=h(this);return A(t,"has",e),t.hasOwnProperty(e)}yn=class{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,n){if(t==="__v_skip")return e.__v_skip;const o=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!o;if(t==="__v_isReadonly")return o;if(t==="__v_isShallow")return i;if(t==="__v_raw")return n===(o?i?Vd:Ls:i?gs:ms).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(n)?e:0[0];const a=l(e);if(!o){let e;if(a&&(e=n4[t]))return e;if(t==="hasOwnProperty")return X0}const s=Reflect.get(e,t,w(e)?e:n);if((K(t)?pn.has(t):Y1(t))||(o||A(e,"get",t),i))return s;if(w(s)){const e=a&&Ke(t)?s:s.value;return o&&f(e)?Ot(e):e}return f(s)?o?Ot(s):xt(s):s}},Fn=class extends yn{constructor(e=!1){super(!1,e)}set(e,t,n,s){let o=e[t];const i=l(e)&&Ke(t);if(!this._isShallow){const e=ne(o);if(!L(n)&&!ne(n)&&(o=h(o),n=h(n)),!i&&w(o)&&!w(n))return e||(o.value=n),!0}const a=i?Number(t)<e.length:u(e,t),r=Reflect.set(e,t,n,w(e)?e:s);return e===h(s)&&(a?se(n,o)&&ee(e,"set",t,n):ee(e,"add",t,n)),r}deleteProperty(e,t){const s=u(e,t);e[t];const n=Reflect.deleteProperty(e,t);return n&&s&&ee(e,"delete",t,0[0]),n}has(e,t){const n=Reflect.has(e,t);return(!K(t)||!pn.has(t))&&A(e,"has",t),n}ownKeys(e){return A(e,"iterate",l(e)?"length":fe),Reflect.ownKeys(e)}},Qu=class extends yn{constructor(e=!1){super(!0,e)}set(){return!0}deleteProperty(){return!0}},cu=new Fn,nu=new Qu,Jd=new Fn(!0),Zt=e=>e,Je=e=>Reflect.getPrototypeOf(e);function r2(e,t,n){return function(...c){const o=this.__v_raw,i=h(o),a=Ce(i),l=e==="entries"||e===Symbol.iterator&&a,d=e==="keys"&&a,r=o[e](...c),s=n?Zt:t?Pe:P;return!t&&A(i,"iterate",d?en:fe),x(Object.create(r),{next(){const{value:e,done:t}=r.next();return t?{value:e,done:t}:{value:l?[s(e[0]),s(e[1])]:s(e),done:t}}})}}function Yt(e){return function(...t){return e!=="delete"&&(e==="clear"?0[0]:this)}}function l2(e,t){const n={get(n){const o=this.__v_raw,s=h(o),i=h(n);e||(se(n,i)&&A(s,"get",n),A(s,"get",i));const{has:a}=Je(s),r=t?Zt:e?Pe:P;if(a.call(s,n))return r(o.get(n));if(a.call(s,i))return r(o.get(i));o!==s&&o.get(n)},get size(){const t=this.__v_raw;return!e&&A(h(t),"iterate",fe),t.size},has(t){const n=this.__v_raw,o=h(n),s=h(t);return e||(se(t,s)&&A(o,"has",t),A(o,"has",s)),t===s?n.has(t):n.has(t)||n.has(s)},forEach(n,s){const o=this,i=o.__v_raw,r=h(i),a=t?Zt:e?Pe:P;return!e&&A(r,"iterate",fe),i.forEach((e,t)=>n.call(s,a(e),a(t),o))}};return x(n,e?{add:Yt("add"),set:Yt("set"),delete:Yt("delete"),clear:Yt("clear")}:{add(e){!t&&!L(e)&&!ne(e)&&(e=h(e));const n=h(this);return Je(n).has.call(n,e)||(n.add(e),ee(n,"add",e,e)),this},set(e,n){!t&&!L(n)&&!ne(n)&&(n=h(n));const s=h(this),{has:i,get:a}=Je(s);let o=i.call(s,e);o||(e=h(e),o=i.call(s,e));const r=a.call(s,e);return s.set(e,n),o?se(n,r)&&ee(s,"set",e,n):ee(s,"add",e,n),this},delete(e){const t=h(this),{has:s,get:o}=Je(t);let n=s.call(t,e);n||(e=h(e),n=s.call(t,e)),o&&o.call(t,e);const i=t.delete(e);return n&&ee(t,"delete",e,0[0]),i},clear(){const e=h(this),t=e.size!==0,n=e.clear();return t&&ee(e,"clear",0[0],0[0]),n}}),["keys","values","entries",Symbol.iterator].forEach(s=>{n[s]=r2(s,e,t)}),n}function ts(e,t){const n=l2(e,t);return(t,s,o)=>s==="__v_isReactive"?!e:s==="__v_isReadonly"?e:s==="__v_raw"?t:Reflect.get(u(n,s)&&s in t?n:t,s,o)}Ud={get:ts(!1,!1)},Wd={get:ts(!1,!0)},$d={get:ts(!0,!1)},ms=new WeakMap,gs=new WeakMap,Ls=new WeakMap,Vd=new WeakMap;function h2(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Z2(e){return e.__v_skip||!Object.isExtensible(e)?0:h2(vo(e))}function xt(e){return ne(e)?e:oo(e,!1,cu,Ud,ms)}function y2(e){return oo(e,!1,Jd,Wd,gs)}function Ot(e){return oo(e,!0,nu,$d,Ls)}function oo(e,t,n,s,o){if(!f(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const i=Z2(e);if(i===0)return e;const a=o.get(e);if(a)return a;const r=new Proxy(e,i===2?s:n);return o.set(e,r),r}function ve(e){return ne(e)?ve(e.__v_raw):!!(e&&e.__v_isReactive)}function ne(e){return!!(e&&e.__v_isReadonly)}function L(e){return!!(e&&e.__v_isShallow)}function Jt(e){return!!e&&!!e.__v_raw}function h(e){const t=e&&e.__v_raw;return t?h(t):e}function _2(e){return!u(e,"__v_skip")&&Object.isExtensible(e)&&zs(e,"__v_skip",!0),e}P=e=>f(e)?xt(e):e,Pe=e=>f(e)?Ot(e):e;function w(e){return!!e&&e.__v_isRef===!0}function ut(e){return kd(e,!1)}function M(e){return kd(e,!0)}function kd(e,t){return w(e)?e:new Cd(e,t)}Cd=class{constructor(e,t){this.dep=new st,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:h(e),this._value=t?e:P(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const n=this._rawValue,t=this.__v_isShallow||L(e)||ne(e);e=t?e:h(e),se(e,n)&&(this._rawValue=e,this._value=t?e:P(e),this.dep.trigger())}};function Mt(e){return w(e)?e.value:e}function b(e){return d(e)?e():Mt(e)}xl={get:(e,t,n)=>t==="__v_raw"?e:Mt(Reflect.get(e,t,n)),set:(e,t,n,s)=>{const o=e[t];return w(o)&&!w(n)?(o.value=n,!0):Reflect.set(e,t,n,s)}};function Ol(e){return ve(e)?e:new Proxy(e,xl)}wl=class{constructor(e){this.__v_isRef=!0,this._value=0[0];const t=this.dep=new st,{get:n,set:s}=e(t.track.bind(t),t.trigger.bind(t));this._get=n,this._set=s}get value(){return this._value=this._get()}set value(e){this._set(e)}};function L2(e){return new wl(e)}Hr=class{constructor(e,t,n){this._object=e,this._key=t,this._defaultValue=n,this.__v_isRef=!0,this._value=0[0],this._raw=h(e);let o=!0,s=e;if(!l(e)||!Ke(String(t)))do o=!Jt(s)||L(s);while(o&&(s=s.__v_raw))this._shallow=o}get value(){let e=this._object[this._key];return this._shallow&&(e=Mt(e)),this._value=e===0[0]?this._defaultValue:e}set value(e){if(this._shallow&&w(this._raw[this._key])){const t=this._object[this._key];if(w(t)){t.value=e;return}}this._object[this._key]=e}get dep(){return D0(this._raw,this._key)}},Rr=class{constructor(e){this._getter=e,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=0[0]}get value(){return this._value=this._getter()}};function $2(e,t,n){return w(e)?e:d(e)?new Rr(e):f(e)&&arguments.length>1?K2(e,t,n):ut(e)}function K2(e,t,n){return new Hr(e,t,n)}Ar=class{constructor(e,t,n){this.fn=e,this.setter=t,this._value=0[0],this.dep=new st(this),this.__v_isRef=!0,this.deps=0[0],this.depsTail=0[0],this.flags=16,this.globalVersion=Le-1,this.next=0[0],this.effect=this,this.__v_isReadonly=!t,this.isSSR=n}notify(){if(this.flags|=16,!(this.flags&8)&&p!==this)return ea(this,!0),!0}get value(){const e=this.dep.track();return Ea(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}};function G2(e,t,n=!1){let s,o;return d(e)?s=e:(s=e.get,o=e.set),new Ar(s,o,n)}rt={},ot=new WeakMap;function Q2(e,t=!1,n=xe){if(n){let t=ot.get(n);t||ot.set(n,t=[]),t.push(e)}}function s3(e,t,n=m){const{immediate:_,deep:a,once:O,scheduler:v,augmentJob:y,call:o}=n,j=e=>a?e:L(e)||a===!1||a===0?te(e,1):te(e);let s,i,h,p,g=!1,f=!1;if(w(e)?(i=()=>e.value,g=L(e)):ve(e)?(i=()=>j(e),g=!0):l(e)?(f=!0,g=e.some(e=>ve(e)||L(e)),i=()=>e.map(e=>{if(w(e))return e.value;if(ve(e))return j(e);if(d(e))return o?o(e,2):e()})):d(e)?t?i=o?()=>o(e,2):e:i=()=>{if(h){oe();try{h()}finally{J()}}const t=xe;xe=s;try{return o?o(e,3,[p]):e(p)}finally{xe=t}}:i=V,t&&a){const e=i,t=a===!0?1/0:a;i=()=>te(e(),t)}const b=Vi(),c=()=>{s.stop(),b&&b.active&&Ct(b.effects,s)};if(O&&t){const e=t;t=(...t)=>{e(...t),c()}}let r=f?new Array(e.length).fill(rt):rt;const u=e=>{if(!(!(s.flags&1)||!s.dirty&&!e))if(t){{const e=s.run();if(a||g||(f?e.some((e,t)=>se(e,r[t])):se(e,r))){h&&h();const n=xe;xe=s;try{const n=[e,r===rt?0[0]:f&&r[0]===rt?[]:r,p];r=e,o?o(t,3,n):t(...n)}finally{xe=n}}}}else s.run()};return y&&y(u),s=new hs(i),s.scheduler=v?()=>v(u,!1):u,p=e=>Q2(e,!1,s),h=s.onStop=()=>{const e=ot.get(s);if(e){if(o)o(e,4);else for(const t of e)t();ot.delete(s)}},t?_?u(!0):r=s.run():v?v(u.bind(null,!0),!0):s.run(),c.pause=s.pause.bind(s),c.resume=s.resume.bind(s),c.stop=c,c}function te(e,t=1/0,n){if(t<=0||!f(e)||e.__v_skip||(n=n||new Map,(n.get(e)||0)>=t))return e;if(n.set(e,t),t--,w(e))te(e.value,t,n);else if(l(e))for(let s=0;s<e.length;s++)te(e[s],t,n);else if(Bs(e)||Ce(e))e.forEach(e=>{te(e,t,n)});else if(Rs(e)){for(const s in e)te(e[s],t,n);for(const s of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,s)&&te(e[s],t,n)}return e}function tt(e,t,n,s){try{return s?e(...s):e()}catch(e){Xt(e,t,n)}}function X(e,t,n,s){if(d(e)){const o=tt(e,t,n,s);return o&&Is(o)&&o.catch(e=>{Xt(e,t,n)}),o}if(l(e)){const o=[];for(let i=0;i<e.length;i++)o.push(X(e[i],t,n,s));return o}}function Xt(e,t,n,s=!0){const i=t?t.vnode:null,{errorHandler:o,throwUnhandledErrorInProduction:a}=t&&t.appContext.config||m;if(t){let s=t.parent;const i=t.proxy,a=`https://vuejs.org/error-reference/#runtime-${n}`;for(;s;){const t=s.ec;if(t)for(let n=0;n<t.length;n++)if(t[n](e,i,a)===!1)return;s=s.parent}if(o){oe(),tt(o,null,10,[e,i,a]),J();return}}i3(e,n,i,s,a)}function i3(e,t,n,s=!0,o=!1){if(o)throw e;console.error(e)}E=[],B=-1,Ee=[],ae=null,je=0,Dn=Promise.resolve(),qe=null;function En(e){const t=qe||Dn;return e?t.then(this?e.bind(this):e):t}function c3(e){let t=B+1,n=E.length;for(;t<n;){const s=t+n>>>1,o=E[s],i=Be(o);i<e||i===e&&o.flags&2?t=s+1:n=s}return t}function wn(e){if(!(e.flags&1)){const t=Be(e),n=E[E.length-1];!n||!(e.flags&2)&&t>=Be(n)?E.push(e):E.splice(c3(t),0,e),e.flags|=1,Aa()}}function Aa(){qe||(qe=Dn.then(fa))}function f3(e){l(e)?Ee.push(...e):ae&&e.id===-1?ae.splice(je+1,0,e):e.flags&1||(Ee.push(e),e.flags|=1),Aa()}function ja(e,t,n=B+1){for(;n<E.length;n++){const t=E[n];if(t&&t.flags&2){if(e&&t.id!==e.uid)continue;E.splice(n,1),n--,t.flags&4&&(t.flags&=-2),t(),t.flags&4||(t.flags&=-2)}}}function ga(){if(Ee.length){const e=[...new Set(Ee)].sort((e,t)=>Be(e)-Be(t));if(Ee.length=0,ae){ae.push(...e);return}for(ae=e,je=0;je<ae.length;je++){const t=ae[je];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}ae=null,je=0}}Be=e=>e.id==null?e.flags&2?-1:1/0:e.id;function fa(){try{for(B=0;B<E.length;B++){const e=E[B];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),tt(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;B<E.length;B++){const e=E[B];e&&(e.flags&=-2)}B=-1,E.length=0,ga(),qe=null,(E.length||Ee.length)&&fa()}}O=null,gn=null;function dn(e){const t=O;return O=e,gn=e&&e.type.__scopeId||null,t}function I(e,t=O){if(!t||e._n)return e;const s=(...n)=>{s._d&&Ft(-1);const i=dn(t);let o;try{o=e(...n)}finally{dn(i),s._d&&Ft(1)}return o};return s._n=!0,s._c=!0,s._d=!0,s}function k(e,t){if(O===null)return e;const n=Wt(O),s=e.dirs||(e.dirs=[]);for(let o=0;o<t.length;o++){let[e,i,a,r=m]=t[o];e&&(d(e)&&(e={mounted:e,updated:e}),e.deep&&te(i),s.push({dir:e,instance:n,value:i,oldValue:0[0],arg:a,modifiers:r}))}return e}function we(e,t,n,s){const o=e.dirs,i=t&&t.dirs;for(let a=0;a<o.length;a++){const r=o[a];i&&(r.oldValue=i[a].value);let c=r.dir[s];c&&(oe(),X(c,n,8,[e.el,r,e,t]),J())}}function g3(e,t){if(C){let n=C.provides;const s=C.parent&&C.parent.provides;s===n&&(n=C.provides=Object.create(s)),n[e]=t}}function cn(e,t,n=!1){const s=Ve();if(s||Ae){let o=Ae?Ae._context.provides:s?s.parent==null||s.ce?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides:0[0];if(o&&e in o)return o[e];if(arguments.length>1)return n&&d(t)?t.call(s&&s.proxy):t}}ca=Symbol.for("v-scx"),sa=()=>cn(ca);function ta(e,t){return kn(e,null,t)}function $(e,t,n){return kn(e,t,n)}function kn(e,t,n=m){const{immediate:d,deep:u,flush:i,once:h}=n,o=x({},n),c=t&&d||!t&&i!=="post";let a;if(Me)if(i==="sync"){const e=sa();a=e.__watcherHandles||(e.__watcherHandles=[])}else if(!c){const e=()=>{};return e.stop=V,e.resume=V,e.pause=V,e}const s=C;o.call=(e,t,n)=>X(e,s,t,n);let l=!1;i==="post"?o.scheduler=e=>{z(e,s&&s.suspense)}:i!=="sync"&&(l=!0,o.scheduler=(e,t)=>{t?e():wn(e)}),o.augmentJob=e=>{t&&(e.flags|=4),l&&(e.flags|=2,s&&(e.id=s.uid,e.i=s))};const r=s3(e,t,o);return Me&&(a?a.push(r):c&&r()),r}function w3(e,t,n){const s=this.proxy,i=y(e)?e.includes(".")?Qi(s,e):()=>s[e]:e.bind(s,s);let o;d(t)?o=t:(o=t.handler,n=t);const a=He(this),r=kn(i,o.bind(s),n);return a(),r}function Qi(e,t){const n=t.split(".");return()=>{let t=e;for(let e=0;e<n.length&&t;e++)t=t[n[e]];return t}}Yi=Symbol("_vte"),Ki=e=>e.__isTeleport,Ui=Symbol("_leaveCb");function zn(e,t){e.shapeFlag&6&&e.component?(e.transition=t,zn(e.component.subTree,t)):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function sn(){const e=Ve();return e?(e.appContext.config.idPrefix||"v")+"-"+e.ids[0]+e.ids[1]++:""}function Wi(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}function C3(e){const t=Ve(),n=M(null);if(t){const s=t.refs===m?t.refs={}:t.refs;Object.defineProperty(s,e,{enumerable:!0,get:()=>n.value,set:e=>n.value=e})}return n}Qe=new WeakMap;function at(e,t,n,s,o=!1){if(l(e)){e.forEach((e,i)=>at(e,t&&(l(t)?t[i]:t),n,s,o));return}if(Oe(s)&&!o){s.shapeFlag&512&&s.type.__asyncResolved&&s.component.subTree.component&&at(e,t,n,s.component.subTree);return}const c=s.shapeFlag&4?Wt(s.component):s.el,f=o?null:c,{i:g,r:i}=e,r=t&&t.r,a=g.refs===m?g.refs={}:g.refs,p=g.setupState,b=h(p),v=p===m?Ys:e=>u(b,e);if(r!=null&&r!==i)if(Hi(t),y(r))a[r]=null,v(r)&&(p[r]=null);else if(w(r)){r.value=null;const e=t;e.k&&(a[e.k]=null)}if(d(i))tt(i,g,12,[f,a]);else{const t=y(i),s=w(i);if(t||s){const r=()=>{if(e.f){const n=t?v(i)?p[i]:a[i]:i.value;if(o)l(n)&&Ct(n,c);else if(l(n))n.includes(c)||n.push(c);else if(t)a[i]=[c],v(i)&&(p[i]=a[i]);else{const t=[c];i.value=t,e.k&&(a[e.k]=t)}}else t?(a[i]=f,v(i)&&(p[i]=f)):s&&(i.value=f,e.k&&(a[e.k]=f))};if(f){const t=()=>{r(),Qe.delete(e)};t.id=-1,Qe.set(e,t),z(t,n)}else Hi(e),r()}}}function Hi(e){const t=Qe.get(e);t&&(t.flags|=8,Qe.delete(e))}ft().requestIdleCallback,ft().cancelIdleCallback,Oe=e=>!!e.type.__asyncLoader,Bn=e=>e.type.__isKeepAlive;function A3(e,t){Li(e,"a",t)}function S3(e,t){Li(e,"da",t)}function Li(e,t,n=C){const s=e.__wdc||(e.__wdc=()=>{let t=n;for(;t;){if(t.isDeactivated)return;t=t.parent}return e()});if(Gt(t,s,n),n){let e=n.parent;for(;e&&e.parent;)Bn(e.parent.vnode)&&F3(s,t,n,e),e=e.parent}}function F3(e,t,n,s){const o=Gt(t,e,s,!0);Jn(()=>{Ct(s[t],o)},n)}function Gt(e,t,n=C,s=!1){if(n){const i=n[e]||(n[e]=[]),o=t.__weh||(t.__weh=(...s)=>{oe();const o=He(n),i=X(t,n,e,s);return o(),J(),i});return s?i.unshift(o):i.push(o),o}}Q=e=>(t,n=C)=>{(!Me||e==="sp")&&Gt(e,(...e)=>t(...e),n)},Fi=Q("bm"),qt=Q("m"),Ai=Q("bu"),ki=Q("u"),Ei=Q("bum"),Jn=Q("um"),Oi=Q("sp"),yi=Q("rtg"),mi=Q("rtc");function H3(e,t=C){Gt("ec",e,t)}os="components";function di(e,t){return ci(os,e,!0,t)||e}rs=Symbol.for("v-ndc");function I3(e){return y(e)?ci(os,e,!1)||e:e||rs}function ci(e,t,n=!0,s=!1){const o=O||C;if(o){const n=o.type;{const e=D3(n,!1);if(e&&(e===t||e===R(t)||e===Xe(R(t))))return n}const i=ri(o[e]||n[e],t)||ri(o.appContext[e],t);return!i&&s?n:i}}function ri(e,t){return e&&(e[t]||e[R(t)]||e[Xe(R(t))])}function g(e,t,n){let o;const i=n,a=l(e);if(a||y(e)){const r=a&&ve(e);let n=!1,s=!1;r&&(n=!L(e),s=ne(e),e=an(e)),o=new Array(e.length);for(let a=0,r=e.length;a<r;a++)o[a]=t(n?s?Pe(P(e[a])):P(e[a]):e[a],a,0[0],i)}else if(typeof e=="number"){o=new Array(e);for(let n=0;n<e;n++)o[n]=t(n+1,n,0[0],i)}else if(f(e))if(e[Symbol.iterator])o=Array.from(e,(e,n)=>t(e,n,0[0],i));else{const n=Object.keys(e);o=new Array(n.length);for(let s=0,r=n.length;s<r;s++){const a=n[s];o[s]=t(e[a],a,s,i)}}else o=[];return o}function ai(t,n,s={},o){if(O.ce||O.parent&&Oe(O.parent)&&O.parent.ce){const t=Object.keys(s).length>0;return n!=="default"&&(s.name=n),e(),r(c,null,[a("slot",s,o)],t?-2:64)}let l=t[n];l&&l._c&&(l._d=!1),e();const d=l&&ni(l(s)),h=s.key||d&&d.key,u=r(c,{key:(h&&!K(h)?h:`_${n}`)+(!d&&o?"_fb":"")},d||[],d&&t._===1?64:-2);return u.scopeId&&(u.slotScopeIds=[u.scopeId+"-s"]),l&&l._c&&(l._d=!0),u}function ni(e){return e.some(e=>!We(e)||!(e.type===W||e.type===c&&!ni(e.children)))?e:null}Bt=e=>e?hi(e)?Wt(e):Bt(e.parent):null,$e=x(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>Bt(e.parent),$root:e=>Bt(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>Ko(e),$forceUpdate:e=>e.f||(e.f=()=>{wn(e.update)}),$nextTick:e=>e.n||(e.n=En.bind(e.proxy)),$watch:e=>w3.bind(e)}),It=(e,t)=>e!==m&&!e.__isScriptSetup&&u(e,t),ei={get({_:e},t){if(t==="__v_skip")return!0;const{ctx:n,setupState:a,data:o,props:r,accessCache:s,type:d,appContext:h}=e;if(t[0]!=="$"){const e=s[t];if(e!==0[0])switch(e){case 1:return a[t];case 2:return o[t];case 4:return n[t];case 3:return r[t]}else{if(It(a,t))return s[t]=1,a[t];if(o!==m&&u(o,t))return s[t]=2,o[t];if(u(r,t))return s[t]=3,r[t];if(n!==m&&u(n,t))return s[t]=4,n[t];Ht&&(s[t]=0)}}const l=$e[t];let i,c;if(l)return t==="$attrs"&&A(e.attrs,"get",""),l(e);if((i=d.__cssModules)&&(i=i[t]))return i;if(n!==m&&u(n,t))return s[t]=4,n[t];if(c=h.config.globalProperties,u(c,t))return c[t]},set({_:e},t,n){const{data:s,setupState:o,ctx:i}=e;return It(o,t)?(o[t]=n,!0):s!==m&&u(s,t)?(s[t]=n,!0):!(u(e.props,t)||t[0]==="$"&&t.slice(1)in e)&&(i[t]=n,!0)},has({_:{data:e,setupState:t,accessCache:n,ctx:s,appContext:o,props:i,type:a}},r){let c;return!!(n[r]||e!==m&&r[0]!=="$"&&u(e,r)||It(t,r)||u(i,r)||u(s,r)||u($e,r)||u(o.config.globalProperties,r)||(c=a.__cssModules)&&c[r])},defineProperty(e,t,n){return n.get!=null?e._.accessCache[t]=0:u(n,"value")&&this.set(e,t,n.value,null),Reflect.defineProperty(e,t,n)}};function Jo(e){return l(e)?e.reduce((e,t)=>(e[t]=null,e),{}):e}Ht=!0;function q3(e){const u=Ko(e),t=e.proxy,s=e.ctx;Ht=!1,u.beforeCreate&&Xo(u.beforeCreate,e,"bc");const{data:j,computed:a,methods:r,watch:c,provide:o,inject:h,created:m,beforeMount:S,mounted:T,beforeUpdate:O,updated:F,activated:w,deactivated:M,beforeDestroy:N,beforeUnmount:C,destroyed:z,unmounted:x,render:b,renderTracked:E,renderTriggered:k,errorCaptured:A,serverPrefetch:y,expose:i,inheritAttrs:v,components:g,directives:p,filters:D}=u;if(h&&Y3(h,s,null),r)for(const e in r){const n=r[e];d(n)&&(s[e]=n.bind(t))}if(j){const n=j.call(t,t);f(n)&&(e.data=xt(n))}if(Ht=!0,a)for(const n in a){const e=a[n],i=d(e)?e.bind(t,t):d(e.get)?e.get.bind(t,t):V,r=!d(e)&&d(e.set)?e.set.bind(t):V,o=_({get:i,set:r});Object.defineProperty(s,n,{enumerable:!0,configurable:!0,get:()=>o.value,set:e=>o.value=e})}if(c)for(const e in c)Go(c[e],s,t,e);if(o){const e=d(o)?o.call(t):o;Reflect.ownKeys(e).forEach(t=>{g3(t,e[t])})}m&&Xo(m,e,"c");function n(e,n){l(n)?n.forEach(n=>e(n.bind(t))):n&&e(n.bind(t))}if(n(Fi,S),n(qt,T),n(Ai,O),n(ki,F),n(A3,w),n(S3,M),n(H3,A),n(mi,E),n(yi,k),n(Ei,C),n(Jn,x),n(Oi,y),l(i))if(i.length){const n=e.exposed||(e.exposed={});i.forEach(e=>{Object.defineProperty(n,e,{get:()=>t[e],set:n=>t[e]=n,enumerable:!0})})}else e.exposed||(e.exposed={});b&&e.render===V&&(e.render=b),v!=null&&(e.inheritAttrs=v),g&&(e.components=g),p&&(e.directives=p),y&&Wi(e)}function Y3(e,t){l(e)&&(e=Ss(e));for(const o in e){const s=e[o];let n;f(s)?"default"in s?n=cn(s.from||o,s.default,!0):n=cn(s.from||o):n=cn(s),w(n)?Object.defineProperty(t,o,{enumerable:!0,configurable:!0,get:()=>n.value,set:e=>n.value=e}):t[o]=n}}function Xo(e,t,n){X(l(e)?e.map(e=>e.bind(t.proxy)):e.bind(t.proxy),t,n)}function Go(e,t,n,s){let o=s.includes(".")?Qi(n,s):()=>n[s];if(y(e)){const n=t[e];d(n)&&$(o,n)}else if(d(e))$(o,e.bind(n));else if(f(e))if(l(e))e.forEach(e=>Go(e,t,n,s));else{const s=d(e.handler)?e.handler.bind(n):t[e.handler];d(s)&&$(o,s,e)}}function Ko(e){const n=e.type,{mixins:r,extends:c}=n,{mixins:s,optionsCache:o,config:{optionMergeStrategies:i}}=e.appContext,a=o.get(n);let t;return a?t=a:!s.length&&!r&&!c?t=n:(t={},s.length&&s.forEach(e=>Lt(t,e,i,!0)),Lt(t,n,i)),f(n)&&o.set(n,t),t}function Lt(e,t,n,s=!1){const{mixins:o,extends:i}=t;i&&Lt(e,i,n,!0),o&&o.forEach(t=>Lt(e,t,n,!0));for(const o in t)if(!s||o!=="expose"){const s=Uo[o]||n&&n[o];e[o]=s?s(e[o],t[o]):t[o]}return e}Uo={data:Wo,props:Vo,emits:Vo,methods:vt,computed:vt,beforeCreate:F,created:F,beforeMount:F,mounted:F,beforeUpdate:F,updated:F,beforeDestroy:F,beforeUnmount:F,destroyed:F,unmounted:F,activated:F,deactivated:F,errorCaptured:F,serverPrefetch:F,components:vt,directives:vt,watch:nh,provide:Wo,inject:J3};function Wo(e,t){return t?e?function(){return x(d(e)?e.call(this,this):e,d(t)?t.call(this,this):t)}:t:e}function J3(e,t){return vt(Ss(e),Ss(t))}function Ss(e){if(l(e)){const t={};for(let n=0;n<e.length;n++)t[e[n]]=e[n];return t}return e}function F(e,t){return e?[...new Set([].concat(e,t))]:t}function vt(e,t){return e?x(Object.create(null),e,t):t}function Vo(e,t){return e?l(e)&&l(t)?[...new Set([...e,...t])]:x(Object.create(null),Jo(e),Jo(t??{})):t}function nh(e,t){if(!e)return t;if(!t)return e;const n=x(Object.create(null),e);for(const s in t)n[s]=F(e[s],t[s]);return n}function Io(){return{app:null,config:{isNativeTag:Ys,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:0[0],warnHandler:0[0],compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}Ho=0;function sh(e){return function(t,n=null){d(t)||(t=x({},t)),n!=null&&!f(n)&&(n=null);const o=Io(),i=new WeakSet,c=[];let r=!1;const s=o.app={_uid:Ho++,_component:t,_props:n,_container:null,_context:o,_instance:null,version:Ci,get config(){return o.config},set config(e){},use(e,...t){return i.has(e)||(e&&d(e.install)?(i.add(e),e.install(s,...t)):d(e)&&(i.add(e),e(s,...t))),s},mixin(e){return o.mixins.includes(e)||o.mixins.push(e),s},component(e,t){return t?(o.components[e]=t,s):o.components[e]},directive(e,t){return t?(o.directives[e]=t,s):o.directives[e]},mount(i,c,l){if(!r){const c=s._ceVNode||a(t,n);return c.appContext=o,l===!0?l="svg":l===!1&&(l=0[0]),e(c,i,l),r=!0,s._container=i,i.__vue_app__=s,Wt(c.component)}},onUnmount(e){c.push(e)},unmount(){r&&(X(c,s._instance,16),e(null,s._container),delete s._container.__vue_app__)},provide(e,t){return o.provides[e]=t,s},runWithContext(e){const t=Ae;Ae=s;try{return e()}finally{Ae=t}}};return s}}Ae=null,Lo=(e,t)=>t==="modelValue"||t==="model-value"?e.modelModifiers:e[`${t}Modifiers`]||e[`${R(t)}Modifiers`]||e[`${Z(t)}Modifiers`];function ih(e,n,...a){if(e.isUnmounted)return;const s=e.vnode.props||m;let o=a;const c=n.startsWith("update:"),r=c&&Lo(s,n.slice(7));r&&(r.trim&&(o=a.map(e=>y(e)?e.trim():e)),r.number&&(o=a.map(zt)));let t,i=s[t=Tt(n)]||s[t=Tt(R(n))];!i&&c&&(i=s[t=Tt(Z(n))]),i&&X(i,e,6,o);const l=s[t+"Once"];if(l){if(e.emitted){if(e.emitted[t])return}else e.emitted={};e.emitted[t]=!0,X(l,e,6,o)}}To=new WeakMap;function Fo(e,t,n=!1){const i=n?To:t.emitsCache,a=i.get(e);if(a!==0[0])return a;const o=e.emits;let s={},r=!1;if(!d(e)){const o=e=>{const n=Fo(e,t,!0);n&&(r=!0,x(s,n))};!n&&t.mixins.length&&t.mixins.forEach(o),e.extends&&o(e.extends),e.mixins&&e.mixins.forEach(o)}return!o&&!r?(f(e)&&i.set(e,null),null):(l(o)?o.forEach(e=>s[e]=null):x(s,o),f(e)&&i.set(e,s),s)}function kt(e,t){return!!e&&!!ht(t)&&(t=t.slice(2).replace(/Once$/,""),u(e,t[0].toLowerCase()+t.slice(1))||u(e,Z(t))||u(e,t))}function Mo(e){const{type:c,vnode:s,proxy:y,withProxy:j,propsOptions:[l],slots:b,attrs:i,emit:h,render:d,renderCache:u,props:r,data:m,setupState:f,ctx:p,inheritAttrs:g}=e,v=dn(e);let o,n;try{if(s.shapeFlag&4){const e=j||y,t=e;o=Y(d.call(t,e,u,r,f,m,p)),n=i}else{const e=c;o=Y(e.length>1?e(r,{attrs:i,slots:b,emit:h}):e(r,null)),n=c.props?i:So(i)}}catch(t){Ne.length=0,Xt(t,e,1),o=a(W)}let t=o;if(n&&g!==!1){const e=Object.keys(n),{shapeFlag:s}=t;e.length&&s&7&&(l&&e.some(wt)&&(n=Ao(n,l)),t=Re(t,n,!1,!0))}return s.dirs&&(t=Re(t,null,!1,!0),t.dirs=t.dirs?t.dirs.concat(s.dirs):s.dirs),s.transition&&zn(t,s.transition),o=t,dn(v),o}So=e=>{let t;for(const n in e)(n==="class"||n==="style"||ht(n))&&((t||(t={}))[n]=e[n]);return t},Ao=(e,t)=>{const n={};for(const s in e)(!wt(s)||!(s.slice(9)in t))&&(n[s]=e[s]);return n};function ch(e,t,n){const{props:o,children:c,component:l}=e,{props:s,children:a,patchFlag:i}=t,r=l.emitsOptions;if(t.dirs||t.transition)return!0;if(n&&i>=0){{if(i&1024)return!0;if(i&16)return o?Co(o,s,r):!!s;if(i&8){const e=t.dynamicProps;for(let t=0;t<e.length;t++){const n=e[t];if(s[n]!==o[n]&&!kt(r,n))return!0}}}}else return!(!c&&!a||!!a&&!!a.$stable)||o!==s&&(o?!s||Co(o,s,r):!!s);return!1}function Co(e,t,n){const s=Object.keys(t);if(s.length!==Object.keys(e).length)return!0;for(let o=0;o<s.length;o++){const i=s[o];if(t[i]!==e[i]&&!kt(n,i))return!0}return!1}function Eh({vnode:e,parent:t},n){for(;t;){const s=t.subTree;if(s.suspense&&s.suspense.activeBranch===e&&(s.el=e.el),s===e)(e=t.vnode).el=n,t=t.parent;else break}}Gs={},Xs=()=>Object.create(Gs),Qs=e=>Object.getPrototypeOf(e)===Gs;function Ah(e,t,n,s=!1){const o={},i=Xs();e.propsDefaults=Object.create(null),uo(e,t,o,i);for(const t in e.propsOptions[0])t in o||(o[t]=0[0]);n?e.props=s?o:y2(o):e.type.props?e.props=o:e.props=i,e.attrs=i}function Th(e,t,n,s){const{props:i,attrs:o,vnode:{patchFlag:l}}=e,r=h(i),[c]=e.propsOptions;let a=!1;if((s||l>0)&&!(l&16)){if(l&8){const n=e.vnode.dynamicProps;for(let d=0;d<n.length;d++){let s=n[d];if(kt(e.emitsOptions,s))continue;const l=t[s];if(c)if(u(o,s))l!==o[s]&&(o[s]=l,a=!0);else{const t=R(s);i[t]=to(c,r,t,l,e,!1)}else l!==o[s]&&(o[s]=l,a=!0)}}}else{uo(e,t,i,o)&&(a=!0);let s;for(const o in r)(!t||!u(t,o)&&((s=Z(o))===o||!u(t,s)))&&(c?n&&(n[o]!==0[0]||n[s]!==0[0])&&(i[o]=to(c,r,o,0[0],e,!0)):delete i[o]);if(o!==r)for(const e in o)(!t||!u(t,e))&&(delete o[e],a=!0)}a&&ee(e.attrs,"set","")}function uo(e,t,n,s){const[i,o]=e.propsOptions;let r=!1,a;if(t)for(let c in t){if(Ie(c))continue;const l=t[c];let d;i&&u(i,d=R(c))?!o||!o.includes(d)?n[d]=l:(a||(a={}))[d]=l:kt(e.emitsOptions,c)||(!(c in s)||l!==s[c])&&(s[c]=l,r=!0)}if(o){const s=h(n),t=a||m;for(let r=0;r<o.length;r++){const a=o[r];n[a]=to(i,s,a,t[a],e,!u(t,a))}}return r}function to(e,t,n,s,o,i){const a=e[n];if(a!=null){const e=u(a,"default");if(e&&s===0[0]){const e=a.default;if(a.type!==Function&&!a.skipFactory&&d(e)){const{propsDefaults:i}=o;if(n in i)s=i[n];else{const a=He(o);s=i[n]=e.call(null,t),a()}}else s=e;o.ce&&o.ce._setProp(n,s)}a[0]&&(i&&!e?s=!1:a[1]&&(s===""||s===Z(n))&&(s=!0))}return s}lo=new WeakMap;function co(e,t,n=!1){const i=n?lo:t.propsCache,r=i.get(e);if(r)return r;const s=e.props,o={},a=[];let c=!1;if(!d(e)){const s=e=>{c=!0;const[s,n]=co(e,t,!0);x(o,s),n&&a.push(...n)};!n&&t.mixins.length&&t.mixins.forEach(s),e.extends&&s(e.extends),e.mixins&&e.mixins.forEach(s)}if(!s&&!c)return f(e)&&i.set(e,ke),ke;if(l(s))for(let e=0;e<s.length;e++){const t=R(s[e]);f0(t)&&(o[t]=m)}else if(s)for(const t in s){const e=R(t);if(f0(e)){const i=s[t],r=o[e]=l(i)||d(i)?{type:i}:x({},i),n=r.type;let c=!1,h=!0;if(l(n))for(let e=0;e<n.length;++e){const t=n[e],s=d(t)&&t.name;if(s==="Boolean"){c=!0;break}s==="String"&&(h=!1)}else c=d(n)&&n.name==="Boolean";r[0]=c,r[1]=h,(c||u(r,"default"))&&a.push(e)}}const h=[o,a];return f(e)&&i.set(e,h),h}function f0(e){return e[0]!=="$"&&!Ie(e)}At=e=>e==="_"||e==="_ctx"||e==="$stable",_t=e=>l(e)?e.map(Y):[Y(e)],ro=(e,t,n)=>{if(t._n)return t;const s=I((...e)=>_t(t(...e)),n);return s._c=!1,s},so=(e,t)=>{const s=e._ctx;for(const n in e){if(At(n))continue;const o=e[n];if(d(o))t[n]=ro(n,o,s);else if(o!=null){const e=_t(o);t[n]=()=>e}}},no=(e,t)=>{const n=_t(t);e.slots.default=()=>n},eo=(e,t,n)=>{for(const s in t)(n||!At(s))&&(e[s]=t[s])},ho=(e,t,n)=>{const s=e.slots=Xs();if(e.vnode.shapeFlag&32){const e=t._;e?(eo(s,t,n),n&&zs(s,"_",e,!0)):so(t,s)}else t&&no(e,t)},mo=(e,t,n)=>{const{vnode:a,slots:s}=e;let o=!0,i=m;if(a.shapeFlag&32){const e=t._;e?n&&e===1?o=!1:eo(s,t,n):(o=!t.$stable,so(t,s)),i=t}else t&&(no(e,t),i={default:1});if(o)for(const e in s)!At(e)&&i[e]==null&&delete s[e]},z=dh;function Mh(e){return Sh(e)}function Sh(e){const D=ft();D.__VUE__=!0;const{insert:n,remove:r,patchProp:o,createElement:te,createText:b,createComment:Z,setText:Q,setElementText:h,parentNode:C,nextSibling:u,setScopeId:w=V,insertStaticContent:B}=e,s=(e,t,n,s=null,o=null,a=null,r=0[0],l=null,d=!!t.dynamicChildren)=>{if(e===t)return;e&&!lt(e,t)&&(s=p(e),i(e,o,a,!0),e=null),t.patchFlag===-2&&(d=!1,t.dynamicChildren=null);const{type:m,ref:h,shapeFlag:u}=t;switch(m){case dt:P(e,t,n,s);break;case W:S(e,t,n,s);break;case Et:e==null&&T(t,n,s,r);break;case c:L(e,t,n,s,o,a,r,l,d);break;default:u&1?ee(e,t,n,s,o,a,r,l,d):u&6?$(e,t,n,s,o,a,r,l,d):(u&64||u&128)&&m.process(e,t,n,s,o,a,r,l,d,f)}h!=null&&o?at(h,e&&e.ref,a,t||e,!t):h==null&&e&&e.ref!=null&&at(e.ref,null,a,e,!0)},P=(e,t,s,o)=>{if(e==null)n(t.el=b(t.children),s,o);else{const n=t.el=e.el;t.children!==e.children&&Q(n,t.children)}},S=(e,t,s,o)=>{e==null?n(t.el=Z(t.children||""),s,o):t.el=e.el},T=(e,t,n,s)=>{[e.el,e.anchor]=B(e.children,t,n,s,e.el,e.anchor)},K=({el:e,anchor:t},s,o)=>{let i;for(;e&&e!==t;)i=u(e),n(e,s,o),e=i;n(t,s,o)},R=({el:e,anchor:t})=>{let n;for(;e&&e!==t;)n=u(e),r(e),e=n;r(t)},ee=(e,t,n,s,o,i,a,r,c)=>{if(t.type==="svg"?a="svg":t.type==="math"&&(a="mathml"),e==null)X(t,n,s,o,i,a,r,c);else{const n=e.el&&e.el._isVueCE?e.el:null;try{n&&n._beginPatch(),I(e,t,o,i,a,r,c)}finally{n&&n._endPatch()}}},X=(e,t,s,i,a,r,c,l)=>{let m,f;const{props:u,shapeFlag:b,transition:g,dirs:p}=e;if(m=e.el=te(e.type,r,u&&u.is,u),b&8?h(m,e.children):b&16&&d(e.children,m,null,i,a,Zs(e,r),c,l),p&&we(e,null,i,"created"),E(m,e,e.scopeId,c,i),u){for(const e in u)e!=="value"&&!Ie(e)&&o(m,e,null,u[e],r,i);"value"in u&&o(m,"value",null,u.value,r),(f=u.onVnodeBeforeMount)&&U(f,i,e)}p&&we(e,null,i,"beforeMount");const v=_h(a,g);v&&g.beforeEnter(m),n(m,t,s),((f=u&&u.onVnodeMounted)||v||p)&&z(()=>{f&&U(f,i,e),v&&g.enter(m),p&&we(e,null,i,"mounted")},a)},E=(e,t,n,s,o)=>{if(n&&w(e,n),s)for(let t=0;t<s.length;t++)w(e,s[t]);if(o){let n=o.subTree;if(t===n||qs(n.type)&&(n.ssContent===t||n.ssFallback===t)){const t=o.vnode;E(e,t,t.scopeId,t.slotScopeIds,o.parent)}}},d=(e,t,n,o,i,a,r,c,l=0)=>{for(let d=l;d<e.length;d++){const u=e[d]=c?me(e[d]):Y(e[d]);s(null,u,t,n,o,i,a,r,c)}},I=(e,t,n,s,i,a,r)=>{const l=t.el=e.el;let{patchFlag:d,dynamicChildren:p,dirs:g}=t;d|=e.patchFlag&16;const u=e.props||m,c=t.props||m;let f;if(n&&Se(n,!1),(f=c.onVnodeBeforeUpdate)&&U(f,n,t,e),g&&we(t,e,n,"beforeUpdate"),n&&Se(n,!0),(u.innerHTML&&c.innerHTML==null||u.textContent&&c.textContent==null)&&h(l,""),p?_(e.dynamicChildren,p,l,n,s,Zs(t,i),a):r||j(e,t,l,null,n,s,Zs(t,i),a,!1),d>0){if(d&16)M(l,u,c,n,i);else if(d&2&&u.class!==c.class&&o(l,"class",null,c.class,i),d&4&&o(l,"style",u.style,c.style,i),d&8){const e=t.dynamicProps;for(let s=0;s<e.length;s++){const t=e[s],a=u[t],r=c[t];(r!==a||t==="value")&&o(l,t,a,r,i,n)}}d&1&&e.children!==t.children&&h(l,t.children)}else!r&&p==null&&M(l,u,c,n,i);((f=c.onVnodeUpdated)||g)&&z(()=>{f&&U(f,n,t,e),g&&we(t,e,n,"updated")},s)},_=(e,t,n,o,i,a,r)=>{for(let d=0;d<t.length;d++){const l=e[d],u=t[d],h=l.el&&(l.type===c||!lt(l,u)||l.shapeFlag&198)?C(l.el):n;s(l,u,h,null,o,i,a,r,!0)}},M=(e,t,n,s,i)=>{if(t!==n){if(t!==m)for(const a in t)!Ie(a)&&!(a in n)&&o(e,a,t[a],null,i,s);for(const a in n){if(Ie(a))continue;const r=n[a],c=t[a];r!==c&&a!=="value"&&o(e,a,c,r,i,s)}"value"in n&&o(e,"value",t.value,n.value,i)}},L=(e,t,s,o,i,a,r,c,l)=>{const p=t.el=e?e.el:b(""),u=t.anchor=e?e.anchor:b("");let{patchFlag:f,dynamicChildren:h,slotScopeIds:m}=t;m&&(c=c?c.concat(m):m),e==null?(n(p,s,o),n(u,s,o),d(t.children||[],s,u,i,a,r,c,l)):f>0&&f&64&&h&&e.dynamicChildren&&e.dynamicChildren.length===h.length?(_(e.dynamicChildren,h,s,i,a,r,c),(t.key!=null||i&&t===i.subTree)&&yo(e,t,!0)):j(e,t,s,u,i,a,r,c,l)},$=(e,t,n,s,o,i,a,r,c)=>{t.slotScopeIds=r,e==null?t.shapeFlag&512?o.ctx.activate(t,n,s,a,c):O(t,n,s,o,i,a,c):N(e,t,c)},O=(e,t,n,s,o,i,r)=>{const c=e.component=B3(e,s,o);if(Bn(e)&&(c.ctx.renderer=f),R3(c,!1,r),c.asyncDep){if(o&&o.registerDep(c,F,r),!e.el){const s=c.subTree=a(W);S(null,s,t,n),e.placeholder=s.el}}else F(c,e,t,n,o,i,r)},N=(e,t,n)=>{const s=t.component=e.component;if(ch(e,t,n))if(s.asyncDep&&!s.asyncResolved){y(s,t,n);return}else s.next=t,s.update();else t.el=e.el,s.vnode=t},F=(e,t,n,o,i,a,r)=>{const d=()=>{if(e.isMounted){let{next:t,bu:u,u:h,parent:m,vnode:n}=e;{const s=wo(e);if(s){t&&(t.el=n.el,y(e,t,r)),s.asyncDep.then(()=>{e.isUnmounted||d()});return}}let f=t,o;Se(e,!1),t?(t.el=n.el,y(e,t,r)):t=n,u&&it(u),(o=t.props&&t.props.onVnodeBeforeUpdate)&&U(o,m,t,n),Se(e,!0);const c=Mo(e),l=e.subTree;e.subTree=c,s(l,c,C(l.el),p(l),e,i,a),t.el=c.el,f===null&&Eh(e,c.el),h&&z(h,i),(o=t.props&&t.props.onVnodeUpdated)&&z(()=>U(o,m,t,n),i)}else{let c;const{el:p,props:l}=t,{bm:u,m:h,parent:r,root:d,type:f}=e,m=Oe(t);Se(e,!1),u&&it(u),!m&&(c=l&&l.onVnodeBeforeMount)&&U(c,r,t),Se(e,!0);{d.ce&&d.ce._def.shadowRoot!==!1&&d.ce._injectChildStyle(f);const r=e.subTree=Mo(e);s(null,r,n,o,e,i,a),t.el=r.el}if(h&&z(h,i),!m&&(c=l&&l.onVnodeMounted)){const e=t;z(()=>U(c,r,e),i)}(t.shapeFlag&256||r&&Oe(r.vnode)&&r.vnode.shapeFlag&256)&&e.a&&z(e.a,i),e.isMounted=!0,t=n=o=null}};e.scope.on();const c=e.effect=new hs(d);e.scope.off();const u=e.update=c.run.bind(c),l=e.job=c.runIfDirty.bind(c);l.i=e,l.id=e.uid,c.scheduler=()=>wn(l),Se(e,!0),u()},y=(e,t,n)=>{t.component=e;const s=e.vnode.props;e.vnode=t,e.next=null,Th(e,t.props,s,n),mo(e,t.children,n),oe(),ja(e),J()},j=(e,t,n,s,o,i,a,r,c=!1)=>{const u=e&&e.children,f=e?e.shapeFlag:0,m=t.children,{patchFlag:p,shapeFlag:g}=t;if(p>0){if(p&128){A(u,m,n,s,o,i,a,r,c);return}if(p&256){H(u,m,n,s,o,i,a,r,c);return}}g&8?(f&16&&l(u,o,i),m!==u&&h(n,m)):f&16?g&16?A(u,m,n,s,o,i,a,r,c):l(u,o,i,!0):(f&8&&h(n,""),g&16&&d(m,n,s,o,i,a,r,c))},H=(e,t,n,o,i,a,r,c,u)=>{e=e||ke,t=t||ke;const f=e.length,p=t.length,m=Math.min(f,p);let h;for(h=0;h<m;h++){const o=t[h]=u?me(t[h]):Y(t[h]);s(e[h],o,n,null,i,a,r,c,u)}f>p?l(e,i,a,!0,!1,m):d(t,n,o,i,a,r,c,u,m)},A=(e,t,n,o,a,r,c,l,d)=>{let u=0;const f=t.length;let m=e.length-1,h=f-1;for(;u<=m&&u<=h;){const o=e[u],i=t[u]=d?me(t[u]):Y(t[u]);if(lt(o,i))s(o,i,n,null,a,r,c,l,d);else break;u++}for(;u<=m&&u<=h;){const o=e[m],i=t[h]=d?me(t[h]):Y(t[h]);if(lt(o,i))s(o,i,n,null,a,r,c,l,d);else break;m--,h--}if(u>m){if(u<=h){const e=h+1,i=e<f?t[e].el:o;for(;u<=h;)s(null,t[u]=d?me(t[u]):Y(t[u]),n,i,a,r,c,l,d),u++}}else if(u>h)for(;u<=m;)i(e[u],a,r,!0),u++;else{const C=u,v=u,_=new Map;for(u=v;u<=h;u++){const e=t[u]=d?me(t[u]):Y(t[u]);e.key!=null&&_.set(e.key,u)}let p,w=0;const j=h-v+1;let y=!1,O=0;const b=new Array(j);for(u=0;u<j;u++)b[u]=0;for(u=C;u<=m;u++){const f=e[u];if(w>=j){i(f,a,r,!0);continue}let o;if(f.key!=null)o=_.get(f.key);else for(p=v;p<=h;p++)if(b[p-v]===0&&lt(f,t[p])){o=p;break}o===0[0]?i(f,a,r,!0):(b[o-v]=u+1,o>=O?O=o:y=!0,s(f,t[o],n,null,a,r,c,l,d),w++)}const x=y?yh(b):ke;for(p=x.length-1,u=j-1;u>=0;u--){const e=v+u,i=t[e],h=t[e+1],m=e+1<f?h.el||xo(h):o;b[u]===0?s(null,i,n,m,a,r,c,l,d):y&&(p<0||u!==x[p]?g(i,n,m,2):p--)}}},g=(e,t,s,o,i=null)=>{const{el:a,type:u,transition:l,children:h,shapeFlag:d}=e;if(d&6){g(e.component.subTree,t,s,o);return}if(d&128){e.suspense.move(t,s,o);return}if(d&64){u.move(e,t,s,f);return}if(u===c){n(a,t,s);for(let e=0;e<h.length;e++)g(h[e],t,s,o);n(e.anchor,t,s);return}if(u===Et){K(e,t,s);return}if(o!==2&&d&1&&l)if(o===0)l.beforeEnter(a),n(a,t,s),z(()=>l.enter(a),i);else{const{leave:u,delayLeave:o,afterLeave:i}=l,c=()=>{e.ctx.isUnmounted?r(a):n(a,t,s)},d=()=>{a._isLeaving&&a[Ui](!0),u(a,()=>{c(),i&&i()})};o?o(a,c,d):d()}else n(a,t,s)},i=(e,t,n,s=!1,o=!1)=>{const{type:m,props:r,ref:p,children:b,dynamicChildren:u,shapeFlag:i,patchFlag:d,dirs:j,cacheIndex:g}=e;if(d===-2&&(o=!1),p!=null&&(oe(),at(p,null,n,e,!0),J()),g!=null&&(t.renderCache[g]=0[0]),i&256){t.ctx.deactivate(e);return}const h=i&1&&j,v=!Oe(e);let a;if(v&&(a=r&&r.onVnodeBeforeUnmount)&&U(a,t,e),i&6)G(e.component,n,s);else{if(i&128){e.suspense.unmount(n,s);return}h&&we(e,null,t,"beforeUnmount"),i&64?e.type.remove(e,t,n,f,s):u&&!u.hasOnce&&(m!==c||d>0&&d&64)?l(u,t,n,!1,!0):(m===c&&d&384||!o&&i&16)&&l(b,t,n),s&&k(e)}(v&&(a=r&&r.onVnodeUnmounted)||h)&&z(()=>{a&&U(a,t,e),h&&we(e,null,t,"unmounted")},n)},k=e=>{const{type:o,el:n,anchor:i,transition:t}=e;if(o===c){q(n,i);return}if(o===Et){R(e);return}const s=()=>{r(n),t&&!t.persisted&&t.afterLeave&&t.afterLeave()};if(e.shapeFlag&1&&t&&!t.persisted){const{leave:a,delayLeave:o}=t,i=()=>a(n,s);o?o(e.el,s,i):i()}else s()},q=(e,t)=>{let n;for(;e!==t;)n=u(e),r(e),e=n;r(t)},G=(e,t,n)=>{const{bum:s,scope:r,job:o,subTree:c,um:a,m:l,a:d}=e;Oo(l),Oo(d),s&&it(s),r.stop(),o&&(o.flags|=8,i(c,e,t,n)),a&&z(a,t),z(()=>{e.isUnmounted=!0},t)},l=(e,t,n,s=!1,o=!1,a=0)=>{for(let r=a;r<e.length;r++)i(e[r],t,n,s,o)},p=e=>{if(e.shapeFlag&6)return p(e.component.subTree);if(e.shapeFlag&128)return e.suspense.next();const t=u(e.anchor||e.el),n=t&&t[Yi];return n?u(n):t};let v=!1;const x=(e,t,n)=>{let o;e==null?t._vnode&&(i(t._vnode,null,null,!0),o=t._vnode.component):s(t._vnode||null,e,t,null,null,null,n),t._vnode=e,v||(v=!0,ja(o),ga(),v=!1)},f={p:s,um:i,m:g,r:k,mt:O,mc:d,pc:j,pbc:_,n:p,o:e};return{render:x,hydrate:0[0],createApp:sh(x)}}function Zs({type:e,props:t},n){return n==="svg"&&e==="foreignObject"||n==="mathml"&&e==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?0[0]:n}function Se({effect:e,job:t},n){n?(e.flags|=32,t.flags|=4):(e.flags&=-33,t.flags&=-5)}function _h(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function yo(e,t,n=!1){const o=e.children,s=t.children;if(l(o)&&l(s))for(let i=0;i<o.length;i++){const a=o[i];let t=s[i];t.shapeFlag&1&&!t.dynamicChildren&&((t.patchFlag<=0||t.patchFlag===32)&&(t=s[i]=me(s[i]),t.el=a.el),!n&&t.patchFlag!==-2&&yo(a,t)),t.type===dt&&(t.patchFlag!==-1?t.el=a.el:t.__elIndex=i+(e.type===c?1:0)),t.type===W&&!t.el&&(t.el=a.el)}}function yh(e){const a=e.slice(),t=[0];let s,r,n,o,i;const c=e.length;for(s=0;s<c;s++){const l=e[s];if(l!==0){if(r=t[t.length-1],e[r]<l){a[s]=r,t.push(s);continue}for(n=0,o=t.length-1;n<o;)i=n+o>>1,e[t[i]]<l?n=i+1:o=i;l<e[t[n]]&&(n>0&&(a[s]=t[n-1]),t[n]=s)}}for(n=t.length,o=t[n-1];n-- >0;)t[n]=o,o=a[o];return t}function wo(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:wo(t)}function Oo(e){if(e)for(let t=0;t<e.length;t++)e[t].flags|=8}function xo(e){if(e.placeholder)return e.placeholder;const t=e.component;return t?xo(t.subTree):null}qs=e=>e.__isSuspense;function dh(e,t){t&&t.pendingBranch?l(e)?t.effects.push(...e):t.effects.push(e):f3(e)}c=Symbol.for("v-fgt"),dt=Symbol.for("v-txt"),W=Symbol.for("v-cmt"),Et=Symbol.for("v-stc"),Ne=[],D=null;function e(e=!1){Ne.push(D=e?null:[])}function oh(){Ne.pop(),D=Ne[Ne.length-1]||null}De=1;function Ft(e,t=!1){De+=e,e<0&&D&&t&&(D.hasOnce=!0)}function Po(e){return e.dynamicChildren=De>0?D||ke:null,oh(),De>0&&D&&D.push(e),e}function n(e,n,s,o,i,a){return Po(t(e,n,s,o,i,a,!0))}function r(e,t,n,s,o){return Po(a(e,t,n,s,o,!0))}function We(e){return!!e&&e.__v_isVNode===!0}function lt(e,t){return e.type===t.type&&e.key===t.key}As=({key:e})=>e??null,bt=({ref:e,ref_key:t,ref_for:n})=>(typeof e=="number"&&(e=""+e),e!=null?y(e)||w(e)||d(e)?{i:O,r:e,k:t,f:!!n}:e:null);function t(e,t=null,n=null,s=0,o=null,i=e===c?0:1,a=!1,r=!1){const l={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&As(t),ref:t&&bt(t),scopeId:gn,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:s,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:O};return r?(vs(l,n),i&128&&e.normalize(l)):n&&(l.shapeFlag|=y(n)?8:16),De>0&&!a&&D&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&D.push(l),l}a=X3;function X3(e,n=null,s=null,o=0,i=null,a=!1){if((!e||e===rs)&&(e=W),We(e)){const t=Re(e,n,!0);return s&&vs(t,s),De>0&&!a&&D&&(t.shapeFlag&6?D[D.indexOf(e)]=t:D.push(t)),t.patchFlag=-2,t}if(z3(e)&&(e=e.__vccOpts),n){n=G3(n);let{class:t,style:e}=n;t&&!y(t)&&(n.class=j(t)),f(e)&&(Jt(e)&&!l(e)&&(e=x({},e)),n.style=ue(e))}const r=y(e)?1:qs(e)?128:Ki(e)?64:f(e)?4:d(e)?2:0;return t(e,n,s,o,i,r,a,!0)}function G3(e){return e?Jt(e)||Qs(e)?x({},e):e:null}function Re(e,t,n=!1,s=!1){const{props:u,ref:o,patchFlag:i,children:h,transition:a}=e,r=t?W3(u||{},t):u,d={__v_isVNode:!0,__v_skip:!0,type:e.type,props:r,key:r&&As(r),ref:t&&t.ref?n&&o?l(o)?o.concat(bt(t)):[o,bt(t)]:bt(t):o,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:h,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==c?i===-1?16:i|16:i,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:a,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Re(e.ssContent),ssFallback:e.ssFallback&&Re(e.ssFallback),placeholder:e.placeholder,el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return a&&s&&zn(d,a.clone(d)),d}function T(e=" ",t=0){return a(dt,null,e,t)}function o(t="",n=!1){return n?(e(),r(W,null,t)):a(W,null,t)}function Y(e){return e==null||typeof e=="boolean"?a(W):l(e)?a(c,null,e.slice()):We(e)?me(e):a(dt,null,String(e))}function me(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Re(e)}function vs(e,t){let n=0;const{shapeFlag:s}=e;if(t==null)t=null;else if(l(t))n=16;else if(typeof t=="object")if(s&65){const n=t.default;n&&(n._c&&(n._d=!1),vs(e,n()),n._c&&(n._d=!0));return}else{n=32;const s=t._;!s&&!Qs(t)?t._ctx=O:s===3&&O&&(O.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else d(t)?(t={default:t,_ctx:O},n=32):(t=String(t),s&64?(n=16,t=[T(t)]):n=8);e.children=t,e.shapeFlag|=n}function W3(...t){const e={};for(let s=0;s<t.length;s++){const n=t[s];for(const t in n)if(t==="class")e.class!==n.class&&(e.class=j([e.class,n.class]));else if(t==="style")e.style=ue([e.style,n.style]);else if(ht(t)){const s=e[t],o=n[t];o&&s!==o&&!(l(s)&&s.includes(o))&&(e[t]=s?[].concat(s,o):o)}else t!==""&&(e[t]=n[t])}return e}function U(e,t,n,s=null){X(e,t,7,[n,s])}si=Io(),oi=0;function B3(e,t,n){const o=e.type,i=(t?t.appContext:e.appContext)||si,s={uid:oi++,vnode:e,type:o,parent:t,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Ni(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(i.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:co(o,i),emitsOptions:Fo(o,i),emit:null,emitted:null,propsDefaults:m,inheritAttrs:o.inheritAttrs,ctx:m,data:m,props:m,attrs:m,slots:m,refs:m,setupState:m,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return s.ctx={_:s},s.root=t?t.root:s,s.emit=ih.bind(null,s),e.ce&&e.ce(s),s}C=null,Ve=()=>C||O;{const e=ft(),t=(t,n)=>{let s;return(s=e[t])||(s=e[t]=[]),s.push(n),e=>{s.length>1?s.forEach(t=>t(e)):s[0](e)}};$t=t("__VUE_INSTANCE_SETTERS__",e=>C=e),cs=t("__VUE_SSR_SETTERS__",e=>Me=e)}He=e=>{const t=C;return $t(e),e.scope.on(),()=>{e.scope.off(),$t(t)}},ss=()=>{C&&C.scope.off(),$t(null)};function hi(e){return e.vnode.shapeFlag&4}Me=!1;function R3(e,t=!1,n=!1){t&&cs(t);const{props:o,children:i}=e.vnode,s=hi(e);Ah(e,o,s,t),ho(e,i,n||t);const a=s?L3(e,t):0[0];return t&&cs(!1),a}function L3(e,t){const s=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,ei);const{setup:n}=s;if(n){oe();const i=e.setupContext=n.length>1?N3(e):null,a=He(e),s=tt(n,e,0,[e.props,i]),o=Is(s);if(J(),a(),(o||e.sp)&&!Oe(e)&&Wi(e),o){if(s.then(ss,ss),t)return s.then(t=>{gi(e,t)}).catch(t=>{Xt(t,e,0)});e.asyncDep=s}else gi(e,s)}else vi(e)}function gi(e,t){d(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:f(t)&&(e.setupState=Ol(t)),vi(e)}function vi(e){const s=e.type;e.render||(e.render=s.render||V);{const t=He(e);oe();try{q3(e)}finally{J(),t()}}}bi={get(e,t){return A(e,"get",""),e[t]}};function N3(e){const t=t=>{e.exposed=t||{}};return{attrs:new Proxy(e.attrs,bi),slots:e.slots,emit:e.emit,expose:t}}function Wt(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(Ol(_2(e.exposed)),{get(t,n){if(n in t)return t[n];if(n in $e)return $e[n](e)},has(e,t){return t in e||t in $e}})):e.proxy}function D3(e,t=!0){return d(e)?e.displayName||e.name:e.name||t&&e.__name}function z3(e){return d(e)&&"__vccOpts"in e}_=(e,t)=>G2(e,t,Me);function T3(e,t,n){try{Ft(-1);const s=arguments.length;return s===2?f(t)&&!l(t)?We(t)?a(e,null,[t]):a(e,t):a(e,null,t):(s>3?n=Array.prototype.slice.call(arguments,2):s===3&&We(n)&&(n=[n]),a(e,t,n))}finally{Ft(1)}}if(Ci="3.5.27",Qn=typeof window<"u"&&window.trustedTypes,Qn)try{Zn=Qn.createPolicy("vue",{createHTML:e=>e})}catch{}Xn=Zn?e=>Zn.createHTML(e):e=>e,Si="http://www.w3.org/2000/svg",Mi="http://www.w3.org/1998/Math/MathML",G=typeof document<"u"?document:null,Un=G&&G.createElement("template"),zi={insert:(e,t,n)=>{t.insertBefore(e,n||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,n,s)=>{const o=t==="svg"?G.createElementNS(Si,e):t==="mathml"?G.createElementNS(Mi,e):n?G.createElement(e,{is:n}):G.createElement(e);return e==="select"&&s&&s.multiple!=null&&o.setAttribute("multiple",s.multiple),o},createText:e=>G.createTextNode(e),createComment:e=>G.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>G.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,n,s,o,i){const a=n?n.previousSibling:t.lastChild;if(o&&(o===i||o.nextSibling))for(;t.insertBefore(o.cloneNode(!0),n),o!==i&&!!(o=o.nextSibling););else{Un.innerHTML=Xn(s==="svg"?`<svg>${e}</svg>`:s==="mathml"?`<math>${e}</math>`:e);const o=Un.content;if(s==="svg"||s==="mathml"){const e=o.firstChild;for(;e.firstChild;)o.appendChild(e.firstChild);o.removeChild(e)}t.insertBefore(o,n)}return[a?a.nextSibling:t.firstChild,n?n.previousSibling:t.lastChild]}},Di=Symbol("_vtc");function M3(e,t,n){const s=e[Di];s&&(t=(t?[t,...s]:[...s]).join(" ")),t==null?e.removeAttribute("class"):n?e.setAttribute("class",t):e.className=t}mt=Symbol("_vod"),$n=Symbol("_vsh"),N={name:"show",beforeMount(e,{value:t},{transition:n}){e[mt]=e.style.display==="none"?"":e.style.display,n&&t?n.beforeEnter(e):ct(e,t)},mounted(e,{value:t},{transition:n}){n&&t&&n.enter(e)},updated(e,{value:t,oldValue:n},{transition:s}){!t!=!n&&(s?t?(s.beforeEnter(e),ct(e,!0),s.enter(e)):s.leave(e,()=>{ct(e,!1)}):ct(e,t))},beforeUnmount(e,{value:t}){ct(e,t)}};function ct(e,t){e.style.display=t?e[mt]:"none",e[$n]=!t}Ii=Symbol(""),Bi=/(?:^|;)\s*display\s*:/;function k3(e,t,n){const s=e.style,i=y(n);let o=!1;if(n&&!i){if(t)if(y(t))for(const e of t.split(";")){const o=e.slice(0,e.indexOf(":")).trim();n[o]==null&&nn(s,o,"")}else for(const e in t)n[e]==null&&nn(s,e,"");for(const e in n)e==="display"&&(o=!0),nn(s,e,n[e])}else if(i){if(t!==n){const e=s[Ii];e&&(n+=";"+e),s.cssText=n,o=Bi.test(n)}}else t&&e.removeAttribute("style");mt in e&&(e[mt]=o?s.display:"",e[$n]&&(s.display="none"))}Ln=/\s*!important$/;function nn(e,t,n){if(l(n))n.forEach(n=>nn(e,t,n));else if(n==null&&(n=""),t.startsWith("--"))e.setProperty(t,n);else{const s=x3(e,t);Ln.test(n)?e.setProperty(Z(s),n.replace(Ln,""),"important"):e[s]=n}}Tn=["Webkit","Moz","ms"],on={};function x3(e,t){const s=on[t];if(s)return s;let n=R(t);if(n!=="filter"&&n in e)return on[t]=n;n=Xe(n);for(let s=0;s<Tn.length;s++){const o=Tn[s]+n;if(o in e)return on[t]=o}return t}Mn="http://www.w3.org/1999/xlink";function Gi(e,t,n,s,o,i=fi(t)){s&&t.startsWith("xlink:")?n==null?e.removeAttributeNS(Mn,t.slice(6,t.length)):e.setAttributeNS(Mn,t,n):n==null||i&&!wi(n)?e.removeAttribute(t):e.setAttribute(t,i?"":K(n)?String(n):n)}function Xi(e,t,n,s,o){if(t==="innerHTML"||t==="textContent"){n!=null&&(e[t]=t==="innerHTML"?Xn(n):n);return}const i=e.tagName;if(t==="value"&&i!=="PROGRESS"&&!i.includes("-")){const o=i==="OPTION"?e.getAttribute("value")||"":e.value,s=n==null?e.type==="checkbox"?"on":"":String(n);(o!==s||!("_value"in e))&&(e.value=s),n==null&&e.removeAttribute(t),e._value=n;return}let a=!1;if(n===""||n==null){const s=typeof e[t];s==="boolean"?n=wi(n):n==null&&s==="string"?(n="",a=!0):s==="number"&&(n=0,a=!0)}try{e[t]=n}catch{}a&&e.removeAttribute(o||t)}function Te(e,t,n,s){e.addEventListener(t,n,s)}function O3(e,t,n,s){e.removeEventListener(t,n,s)}An=Symbol("_vei");function _3(e,t,n,s,o=null){const a=e[An]||(e[An]={}),i=a[t];if(s&&i)i.value=s;else{const[n,r]=y3(t);if(s){const i=a[t]=j3(s,o);Te(e,n,i,r)}else i&&(O3(e,n,i,r),a[t]=0[0])}}Cn=/(?:Once|Passive|Capture)$/;function y3(e){let t;if(Cn.test(e)){t={};let n;for(;n=e.match(Cn);)e=e.slice(0,e.length-n[0].length),t[n[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):Z(e.slice(2)),t]}rn=0,oa=Promise.resolve(),ia=()=>rn||(oa.then(()=>rn=0),rn=Date.now());function j3(e,t){const n=e=>{if(e._vts){if(e._vts<=n.attached)return}else e._vts=Date.now();X(b3(e,n.value),t,5,[e])};return n.value=e,n.attached=ia(),n}function b3(e,t){if(l(t)){const n=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{n.call(e),e._stopped=!0},t.map(e=>t=>!t._stopped&&e&&e(t))}return t}On=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,la=(e,t,n,s,o,i)=>{const a=o==="svg";t==="class"?M3(e,s,a):t==="style"?k3(e,n,s):ht(t)?wt(t)||_3(e,t,n,s,i):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):v3(e,t,s,a))?(Xi(e,t,s),!e.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&Gi(e,t,s,a,i,t!=="value")):e._isVueCE&&(/[A-Z]/.test(t)||!y(s))?Xi(e,R(t),s,i,t):(t==="true-value"?e._trueValue=s:t==="false-value"&&(e._falseValue=s),Gi(e,t,s,a))};function v3(e,t,n,s){if(s)return!!(t==="innerHTML"||t==="textContent"||t in e&&On(t)&&d(n));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="autocorrect"||t==="sandbox"&&e.tagName==="IFRAME"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const t=e.tagName;if(t==="IMG"||t==="VIDEO"||t==="CANVAS"||t==="SOURCE")return!1}return!(On(t)&&y(n))&&t in e}_n=e=>{const t=e.props["onUpdate:modelValue"];return l(t)?e=>it(t,e):t};function p3(e){e.target.composing=!0}function ma(e){const t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}yt=Symbol("_assign");function pa(e,t,n){return t&&(e=e.trim()),n&&(e=zt(e)),e}Ue={created(e,{modifiers:{lazy:t,trim:n,number:s}},o){e[yt]=_n(o);const i=s||o.props&&o.props.type==="number";Te(e,t?"change":"input",t=>{t.target.composing||e[yt](pa(e.value,n,i))}),(n||i)&&Te(e,"change",()=>{e.value=pa(e.value,n,i)}),t||(Te(e,"compositionstart",p3),Te(e,"compositionend",ma),Te(e,"change",ma))},mounted(e,{value:t}){e.value=t??""},beforeUpdate(e,{value:t,oldValue:n,modifiers:{lazy:s,trim:o,number:i}},a){if(e[yt]=_n(a),e.composing)return;const c=(i||e.type==="number")&&!/^0\d/.test(e.value)?zt(e.value):e.value,r=t??"";c!==r&&(document.activeElement===e&&e.type!=="range"&&(s&&t===n||o&&e.value.trim()===r)||(e.value=r))}},va=["ctrl","shift","alt","meta"],ba={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,t)=>va.some(n=>e[`${n}Key`]&&!t.includes(n))},de=(e,t)=>{const n=e._withMods||(e._withMods={}),s=t.join(".");return n[s]||(n[s]=(n,...s)=>{for(let e=0;e<t.length;e++){const s=ba[t[e]];if(s&&s(n,t))return}return e(n,...s)})},ya={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},pe=(e,t)=>{const n=e._withKeys||(e._withKeys={}),s=t.join(".");return n[s]||(n[s]=n=>{if(!("key"in n))return;const s=Z(n.key);if(t.some(e=>e===s||ya[e]===s))return e(n)})},wa=x({patchProp:la},zi);function m3(){return Oa||(Oa=Mh(wa))}Ca=(...e)=>{const t=m3().createApp(...e),{mount:n}=t;return t.mount=e=>{const s=u3(e);if(!s)return;const o=t._component;!d(o)&&!o.render&&!o.template&&(o.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const i=n(s,!1,h3(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),i},t};function h3(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function u3(e){return y(e)?document.querySelector(e):e}i=(e,t)=>{const n=e.__vccOpts||e;for(const[e,s]of t)n[e]=s;return n},Sa={},Ma={class:"tify-icon -close","aria-hidden":"true",viewBox:"0 0 24 24"};function d3(s,o){return e(),n("svg",Ma,[...o[0]||(o[0]=[t("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},null,-1)])])}xn=i(Sa,[["render",d3]]),za={blobBaseUrl:"https://github.com/tify-iiif-viewer/tify/blob/v0.35.0",bugsUrl:"https://github.com/tify-iiif-viewer/tify/issues",license:"AGPL-3.0",repositoryUrl:"https://github.com/tify-iiif-viewer/tify",version:"0.35.0"},Da={computed:{env:()=>za}},Na={class:"tify-help",tabindex:"0"},La={class:"tify-sr-only"},Ra=["innerHTML"],Pa={class:"tify-list"},Ha=["href"],Ia=["href"],Ba=["href"],Va=["href"],$a={class:"tify-help-footer"},Wa=["innerHTML"];function r3(o,i,a,r,c,l){return e(),n("section",Na,[t("h2",La,s(o.$translate("Help")),1),t("h3",null,s(o.$translate("About TIFY")),1),t("p",{innerHTML:o.$translate("$info")},null,8,Ra),t("ul",Pa,[t("li",null,[t("a",{href:l.env.repositoryUrl},s(o.$translate("Source code")),9,Ha)]),t("li",null,[t("a",{href:`${l.env.blobBaseUrl}/doc`},s(o.$translate("Documentation")),9,Ia)]),t("li",null,[t("a",{href:`${l.env.blobBaseUrl}/CONTRIBUTORS.md`},s(o.$translate("Contributors")),9,Ba)]),t("li",null,[t("a",{href:l.env.bugsUrl},s(o.$translate("Report a bug")),9,Va)])]),t("footer",$a,[t("p",{innerHTML:o.$translate("$copyright")},null,8,Wa),t("p",null,[T(s(o.$translate("Version"))+" ",1),t("b",null,s(l.env.version),1)])])])}Ka=i(Da,[["render",r3]]),qa={},Ya={class:"tify-icon -plus","aria-hidden":"true",viewBox:"0 0 24 24"};function a3(s,o){return e(),n("svg",Ya,[...o[0]||(o[0]=[t("path",{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"},null,-1)])])}Qt=i(qa,[["render",a3]]),Qa={},Za={class:"tify-icon -minus","aria-hidden":"true",viewBox:"0 0 24 24"};function o3(s,o){return e(),n("svg",Za,[...o[0]||(o[0]=[t("path",{d:"M19,13H5V11H19V13Z"},null,-1)])])}Kt=i(Qa,[["render",o3]]),tr={name:"CollectionNode",props:{item:{type:Object,default:()=>{}}},data(){return{children:null,expanded:!1}},computed:{id(){return this.$getId(sn())}},methods:{toggleChildren(){if(this.expanded){this.expanded=!1;return}if(this.children){this.expanded=!0;return}if(this.item.children){this.children=this.item.children,this.expanded=!0;return}this.$store.fetchJson(this.item["@id"]||this.item.id).then(e=>{this.children=e.collections||e.items||e.manifests||[],this.expanded=!0},e=>{const t=e.response&&(e.response.statusText||e.response.data)||e.message;this.$store.addError(`Error loading IIIF manifest: ${t}`),this.children=!1})}}},nr=["aria-controls","aria-expanded","aria-label"],sr=["id"],or=["id"];function t3(t,o,i,a,l,d){const u=Kt,h=Qt,m=di("CollectionNode",!0);return e(),n("li",{class:j(["tify-collection-item",{"-current":t.$store.manifest&&t.$store.manifest.id===(i.item["@id"]||i.item.id)}])},[i.item.type==="Collection"?(e(),n("button",{key:0,type:"button",class:"tify-collection-link -has-children","aria-controls":d.id,"aria-expanded":l.expanded,"aria-label":t.$translate(l.expanded?"Collapse":"Expand"),onClick:o[0]||(o[0]=e=>d.toggleChildren())},[l.expanded?(e(),r(u,{key:0})):(e(),r(h,{key:1})),T(" "+s(t.$store.localize(i.item.label)),1)],8,nr)):(e(),n("a",{key:1,href:"javascript:;",class:"tify-collection-link",onClick:o[1]||(o[1]=e=>t.$store.loadManifest(i.item["@id"]||i.item.id,{expectedType:i.item.type,reset:!0}))},s(t.$store.localize(i.item.label)),1)),l.children!==!1?k((e(),n("ol",{key:2,id:d.id,class:"tify-collection-list"},[(e(!0),n(c,null,g(l.children,t=>(e(),r(m,{key:t.id,item:t},null,8,["item"]))),128))],8,sr)),[[N,l.expanded]]):k((e(),n("p",{key:3,id:d.id,class:"tify-collection-error"},s(t.$translate("Could not load child manifest")),9,or)),[[N,l.expanded]])],2)}ar=i(tr,[["render",t3]]),rr={data(){return{filter:""}},computed:{filteredItems(){const e=this.filter.trim().toLowerCase().split(/\s+/);return this.$store.collection.items.filter(t=>{const n=this.$store.localize(t.label).toLowerCase();return e.every(e=>n.includes(e))})}}},cr={class:"tify-collection",tabindex:"0"},lr={class:"tify-collection-header"},dr={class:"tify-sr-only"},ur={key:0,class:"tify-collection-controls"},hr=["aria-label","placeholder"],mr=["disabled"],fr={key:0,class:"tify-collection-list"},pr={key:1,class:"tify-collection-no-results"};function b0(i,a,l,d,u,h){const m=ar;return e(),n("section",cr,[t("header",lr,[t("h2",dr,s(i.$translate("Collection")),1),i.$store.collection.items.length>5?(e(),n("div",ur,[k(t("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>u.filter=e),"aria-label":i.$translate("Filter collection"),class:"tify-collection-filter",placeholder:i.$translate("Filter collection"),type:"text",onKeydown:[a[1]||(a[1]=pe(de(e=>u.filter?u.filter="":e.target.blur(),["prevent"]),["esc"])),a[2]||(a[2]=de(()=>{},["stop"]))]},null,40,hr),[[Ue,u.filter]]),t("button",{type:"button",class:"tify-collection-reset",disabled:!u.filter,onClick:a[3]||(a[3]=e=>u.filter="")},s(i.$translate("Reset")),9,mr)])):o("",!0)]),h.filteredItems.length?(e(),n("ol",fr,[(e(!0),n(c,null,g(h.filteredItems,t=>(e(),r(m,{key:t.id,item:t},null,8,["item"]))),128))])):(e(),n("p",pr,s(i.$translate("No results")),1))])}vr=i(rr,[["render",b0]]);function br(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}Ut={exports:{}},yr=Ut.exports;function X2(){return _r||(_r=1,function(e){(function(t){if(typeof n!="function"){var n=function(e){return e};n.nonNative=!0}const s=n("plaintext"),i=n("html"),a=n("comment"),l=/<(\w*)>/g,d=/<\/?([^\s/>]+)/;function o(e,t,n){e=e||"",t=t||[],n=n||"";let s=r(t,n);return c(e,s)}function u(e,t){e=e||[],t=t||"";let n=r(e,t);return function(e){return c(e||"",n)}}o.init_streaming_mode=u;function r(e,t){return e=h(e),{allowable_tags:e,tag_replacement:t,state:s,tag_buffer:"",depth:0,in_quote_char:""}}function c(e,t){if(typeof e!="string")throw new TypeError("'html' parameter must be a string");let d=t.allowable_tags,u=t.tag_replacement,o=t.state,n=t.tag_buffer,l=t.depth,r=t.in_quote_char,c="";for(let h=0,f=e.length;h<f;h++){let t=e[h];if(o===s)switch(t){case"<":o=i,n+=t;break;default:c+=t;break}else if(o===i)switch(t){case"<":if(r)break;l++;break;case">":if(r)break;if(l){l--;break}r="",o=s,n+=">",d.has(m(n))?c+=n:c+=u,n="";break;case'"':case"'":t===r?r="":r=r||t,n+=t;break;case"-":n==="<!-"&&(o=a),n+=t;break;case" ":case`
`:if(n==="<"){o=s,c+="< ",n="";break}n+=t;break;default:n+=t;break}else if(o===a)switch(t){case">":n.slice(-2)=="--"&&(o=s),n="";break;default:n+=t;break}}return t.state=o,t.tag_buffer=n,t.depth=l,t.in_quote_char=r,c}function h(e){let t=new Set;if(typeof e=="string"){let n;for(;n=l.exec(e);)t.add(n[1])}else!n.nonNative&&typeof e[n.iterator]=="function"?t=new Set(e):typeof e.forEach=="function"&&e.forEach(t.add,t);return t}function m(e){let t=d.exec(e);return t?t[1].toLowerCase():null}e.exports?e.exports=o:t.striptags=o})(yr)}(Ut)),Ut.exports}Or=X2(),fs=br(Or),Cr={props:{number:{type:Number,required:!0},wrap:{type:Boolean,default:!1}},computed:{classes(){return{L:"tify-page-name-label",P:"tify-page-name-number"}},label(){return fs(this.$store.localize(this.$store.manifest.items[this.number-1].label))||this.$translate("$n/a")},html(){return`<span>${this.$store.options.pageLabelFormat}</span>`.replace("P",`${this.number}`).replace("L",`</span>${this.label}<span>`).replace("<span></span>","")}}},Er=["innerHTML"];function Y2(t,s,o,i,a,r){return e(),n("span",{class:j(["tify-page-name",{"-wrap":o.wrap}]),innerHTML:r.html},null,10,Er)}be=i(Cr,[["render",Y2]]),Sr={},Mr={class:"tify-icon -chevron-up","aria-hidden":"true",viewBox:"0 0 24 24"};function q2(s,o){return e(),n("svg",Mr,[...o[0]||(o[0]=[t("path",{d:"M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"},null,-1)])])}js=i(Sr,[["render",q2]]),zr={},Dr={class:"tify-icon -chevron-down","aria-hidden":"true",viewBox:"0 0 24 24"};function W2(s,o){return e(),n("svg",Dr,[...o[0]||(o[0]=[t("path",{d:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"},null,-1)])])}_s=i(zr,[["render",W2]]);function Rt(e){const n=["a","b","br","i","img","p","span"],s={a:["href"],img:["alt","src"]};let t=fs(e,n);const o=/<(\w+)((\s+.+?(\s*=\s*(?:".*?"|'.*?'|.*?|[\^'">\s]+))?)+\s*|\s*)>/g;return t=t.replace(o,(e,t,n)=>{if(!n)return`<${t}>`;const i=/(?:([^\s"'=]+)(?:=(?:"(.*?)"|'(.*?)'|([^\s>]+)))?)/g,o=[];return n.replace(i,(e,n)=>{var i;(i=s[t])!=null&&i.includes(n)&&o.push(e)}),o.length>0?`<${t} ${o.join(" ")}>`:`<${t}>`}),t}function Pr(e,t){if(!(e instanceof Array)||!t||new Set(e).size!==e.length)return!1;for(let n=0,s=e.length;n<s;n+=1)if(!Number.isInteger(e[n])||n>0&&e[n]>0&&e[n]<=e[n-1]||e[n]<-1||e[n]>t)return!1;return!0}function Cs(e,t=["https:","http:"]){let n;try{n=new URL(e)}catch{return!1}return t.includes(n.protocol)}Ir={props:{metadata:{type:Array,default:()=>[]}},data(){return{infoItems:[]}},watch:{metadata(){this.init()},"$store.options.view":{handler(e){e==="info"&&this.init()},immediate:!0}},methods:{init(){this.$nextTick(()=>{var e;(e=this.$refs.contents)==null||e.forEach((e,t)=>{const n=e.offsetHeight;this.infoItems[t]={collapsed:!0,exceedsHeight:!0},this.$nextTick(()=>{const o=e.offsetHeight,s=n>=o;this.infoItems[t]={collapsed:s,exceedsHeight:s}})})})},filterHtml:Rt,isValidUrl:Cs}},Br={class:"tify-info-metadata"},Vr={key:0},$r={class:"tify-info-value"},Wr=["href"],Ur=["innerHTML"],Kr=["onClick"];function B2(i,r,l,d,u,h){const m=_s,f=js;return e(),n("div",Br,[(e(!0),n(c,null,g(l.metadata,(r,l)=>(e(),n("div",{key:l},[r.label?(e(),n("h4",Vr,s(i.$store.localize(r.label)),1)):o("",!0),t("div",{ref_for:!0,ref:"contents",class:j(["tify-info-content",{"-collapsed":u.infoItems[l]&&u.infoItems[l].collapsed}])},[t("div",$r,[h.isValidUrl(r.value)?(e(),n("p",{key:`url-${l}`},[t("a",{href:r.value},s(r.value),9,Wr)])):(e(),n("div",{key:`html-${l}`,innerHTML:h.filterHtml(i.$store.localize(r.value))||i.$translate("$n/a")},null,8,Ur))]),u.infoItems[l]&&u.infoItems[l].exceedsHeight?(e(),n("button",{key:0,type:"button",class:"tify-info-toggle",onClick:e=>u.infoItems[l].collapsed=!u.infoItems[l].collapsed},[u.infoItems[l].collapsed?(e(),n(c,{key:0},[a(m),T(" "+s(i.$translate("Expand")),1)],64)):(e(),n(c,{key:1},[a(f),T(" "+s(i.$translate("Collapse")),1)],64))],8,Kr)):o("",!0)],2)]))),128))])}Yr=i(Ir,[["render",B2]]);function I2(e,t){try{return new Date(e).toLocaleDateString(t,{month:"long",day:"numeric",year:"numeric"})}catch{return e}}Xr={data(){return{collectionDataShown:!1}},computed:{hasProvider(){var e;return(e=this.manifestOrCollection.provider)==null?0[0]:e.some(e=>{var t;return this.$store.localize(e.label)||((t=e.homepage)==null?0[0]:t.length)})},homepages(){return[].concat(this.manifestOrCollection.homepage||[])},logos(){var t;let e=[].concat(this.manifestOrCollection.logo||[]);return(t=this.manifestOrCollection.provider)==null||t.forEach(t=>{t.logo&&(e=e.concat(t.logo))}),e=[...new Map(e.map(e=>[e.id,e])).values()],e=e.map(e=>{var t,n,s,o;return{id:e.id,link:((n=(t=e.service)==null?0[0]:t[0])==null?0[0]:n.id)||((o=(s=e.service)==null?0[0]:s[0])==null?0[0]:o["@id"])}}),e},manifestOrCollection(){return this.collectionDataShown?this.$store.collection:this.$store.manifest||this.$store.collection||{}},metadataItems(){return this.$store.manifest.items.map((e,t)=>({metadata:e.metadata,number:t+1})).filter(({metadata:e,number:t})=>e?.length&&this.$store.options.pages.includes(t))},pages(){return this.$store.options.pages.filter(e=>e>0).map(e=>{var t,n;const s={page:e,media:[]},o=(n=(t=this.$store.manifest.items[e-1].items)==null?0[0]:t[0])==null?0[0]:n.items;return o==null||o.forEach(e=>{var t;const n=((t=e.body)==null?0[0]:t.items)||[e.body];s.media.push(...n.filter(e=>e.label).map(e=>({label:e.label})))}),s})}},methods:{filterHtml:Rt,formatDate:I2,isValidUrl:Cs}},Qr={class:"tify-info",tabindex:"0"},Zr={class:"tify-sr-only"},Jr={key:0,class:"tify-info-header"},ec=["aria-pressed"],tc=["aria-pressed"],nc={key:1,class:"tify-info-section -title"},sc={key:2,class:"tify-info-section -time"},oc={key:3,class:"tify-info-section -place"},ic={key:4,class:"tify-info-section -metadata"},ac={key:5,class:"tify-info-section -description"},rc={key:6,class:"tify-info-section -metadata -structure"},cc={key:0,class:"tify-info-structure"},lc={key:7,class:"tify-info-section -pages"},dc={class:"tify-list -unstyled"},uc={key:0,class:"tify-info-image-labels"},hc={key:8,class:"tify-info-section -related"},mc={class:"tify-list"},fc=["href"],pc=["href"],gc={key:9,class:"tify-info-section -attribution"},vc=["innerHTML"],io={key:10,class:"tify-info-section -license"},jc=["href"],yc={key:11,class:"tify-info-section -provider"},_c={key:0},wc={key:1,class:"tify-list"},Oc=["href"],xc={key:12,class:"tify-info-section -logo"},Cc=["href"],Ec=["src","alt"],kc=["src","alt"];function P2(i,l,d,u,h,m){var p,v,b,j;const f=Yr,y=be;return e(),n("section",Qr,[t("h2",Zr,s(i.$translate("Info")),1),i.$store.collection&&i.$store.manifest?(e(),n("div",Jr,[t("button",{type:"button",class:"tify-info-button","aria-pressed":!h.collectionDataShown,onClick:l[0]||(l[0]=e=>h.collectionDataShown=!1)},s(i.$translate("Document")),9,ec),t("button",{type:"button",class:"tify-info-button","aria-pressed":h.collectionDataShown,onClick:l[1]||(l[1]=e=>h.collectionDataShown=!0)},s(i.$translate("Collection")),9,tc)])):o("",!0),m.manifestOrCollection.label?(e(),n("div",nc,[t("h3",null,s(i.$translate("Title")),1),t("p",null,s(i.$store.localize(m.manifestOrCollection.label)),1)])):o("",!0),m.manifestOrCollection.navDate?(e(),n("div",sc,[t("h3",null,s(i.$translate("Date")),1),t("p",null,s(m.formatDate(m.manifestOrCollection.navDate,i.$store.options.language)),1)])):o("",!0),m.manifestOrCollection.navPlace?(e(),n("div",oc,[t("h3",null,s(i.$translate("Place")),1),(e(!0),n(c,null,g(m.manifestOrCollection.navPlace.features,t=>(e(),n("p",{key:t.id},s(i.$store.localize(t.properties.label)),1))),128))])):o("",!0),m.manifestOrCollection.metadata&&m.manifestOrCollection.metadata.length?(e(),n("div",ic,[t("h3",null,s(i.$translate("Metadata")),1),i.$store.options.view==="info"?(e(),r(f,{key:0,metadata:m.manifestOrCollection.metadata},null,8,["metadata"])):o("",!0)])):o("",!0),m.manifestOrCollection.summary?(e(),n("div",ac,[t("h3",null,s(i.$translate("Description")),1),i.$store.options.view==="info"?(e(),r(f,{key:0,metadata:[{value:m.manifestOrCollection.summary}]},null,8,["metadata"])):o("",!0)])):o("",!0),m.manifestOrCollection.structures&&((p=i.$store.currentStructure)!=null&&p.label||(v=i.$store.currentStructure)!=null&&v.metadata)?(e(),n("div",rc,[t("h3",null,s(i.$translate("Current Section")),1),(b=i.$store.currentStructure)!=null&&b.label?(e(),n("p",cc,s(i.$store.localize(i.$store.currentStructure.label)),1)):o("",!0),i.$store.options.view==="info"&&(j=i.$store.currentStructure)!=null&&j.metadata?(e(),r(f,{key:1,class:"tify-info-section -metadata",metadata:i.$store.currentStructure.metadata},null,8,["metadata"])):o("",!0)])):o("",!0),m.manifestOrCollection.type==="Manifest"?(e(),n("div",lc,[t("h3",null,s(i.$translate(m.pages.length>1?"Current Pages":"Current Page")),1),t("ol",dc,[(e(!0),n(c,null,g(m.pages,t=>(e(),n("li",{key:t},[a(y,{number:t.page,wrap:""},null,8,["number"]),t.media.length?(e(),n("ul",uc,[(e(!0),n(c,null,g(t.media,(t,o)=>(e(),n("li",{key:o},s(i.$store.localize(t.label)),1))),128))])):o("",!0),i.$store.manifest.items[t.page-1].metadata?(e(),r(f,{key:1,class:"tify-info-section -metadata",metadata:i.$store.manifest.items[t.page-1].metadata},null,8,["metadata"])):o("",!0)]))),128))])])):o("",!0),m.homepages.length?(e(),n("div",hc,[t("h3",null,s(i.$translate("Related Resources")),1),t("ul",mc,[(e(!0),n(c,null,g(m.homepages,(t,o)=>(e(),n("li",{key:o},[typeof t=="string"?(e(),n("a",{key:0,href:t},s(t),9,fc)):(e(),n("a",{key:1,href:t.id},s(t.label?i.$store.localize(t.label):t.id),9,pc))]))),128))])])):o("",!0),m.manifestOrCollection.requiredStatement?(e(),n("div",gc,[t("h3",null,s(i.$store.localize(m.manifestOrCollection.requiredStatement.label)),1),t("div",{innerHTML:m.filterHtml(i.$store.localize(m.manifestOrCollection.requiredStatement.value))},null,8,vc)])):o("",!0),m.manifestOrCollection.rights?(e(),n("div",io,[t("h3",null,s(i.$translate("License")),1),t("p",null,[t("a",{href:m.manifestOrCollection.rights},s(m.manifestOrCollection.rights),9,jc)])])):o("",!0),m.hasProvider?(e(),n("div",yc,[t("h3",null,s(i.$translate("Provided by")),1),(e(!0),n(c,null,g(m.manifestOrCollection.provider,a=>{var r,l;return e(),n("div",{key:a.id},[a.label?(e(),n("p",_c,s(i.$store.localize(a.label)),1)):o("",!0),(r=a.homepage)!=null&&r.length||(l=a.seeAlso)!=null&&l.length?(e(),n("ul",wc,[(e(!0),n(c,null,g([...a.homepage||[],...a.seeAlso||[]],o=>(e(),n("li",{key:o.id},[t("a",{href:o.id},s(o.label?i.$store.localize(o.label):o.id),9,Oc)]))),128))])):o("",!0)])}),128))])):o("",!0),m.logos.length?(e(),n("div",xc,[(e(!0),n(c,null,g(m.logos,(s,o)=>(e(),n("p",{key:o},[s.link?(e(),n("a",{key:0,href:s.link},[t("img",{class:"tify-info-logo",src:s.id,alt:i.$translate("Logo")},null,8,Ec)],8,Cc)):(e(),n("img",{key:1,class:"tify-info-logo",src:s.id,alt:i.$translate("Logo")},null,8,kc))]))),128))])):o("",!0)])}Sc=i(Xr,[["render",P2]]),Mc={name:"TocList",props:{level:{type:Number,default:0},structures:{type:Array,default:()=>[]},purpose:{type:String,default:""}},data(){var e;return{expandedStructures:this.level===0&&this.structures.length===1&&(e=this.structures[0].items)!=null&&e.some(e=>e.items)?[!0]:[]}},computed:{id(){return this.$getId(sn())}},methods:{getFirstPage(e){if(e.items)return this.getFirstPage(e.items[0]);const t=this.$store.manifest.items.findIndex(t=>t.id===e.id);return t<0?1:t+1},getFirstPageLabel(e){var t;const n=this.getFirstPage(e);return this.$store.localize((t=this.$store.manifest.items[n-1])==null?0[0]:t.label)},getLastPage(e){if(e.items)return this.getLastPage(e.items.at(-1));const t=this.$store.manifest.items.findLastIndex(t=>t.id===e.id);return t<0?this.$store.manifest.items.length:t+1},isCurrentPageInStructure(e){if(this.$store.manifest.items.filter((e,t)=>this.$store.options.pages.includes(t+1)).map(e=>e.id).some(t=>{var n;return(n=e.items)==null?0[0]:n.some(e=>e.id===t)}))return!0;const t=e.firstPage||this.getFirstPage(e),n=e.lastPage||this.getLastPage(e);return this.$store.options.pages.some(e=>e>=t&&e<=n)},setPage(e){this.$store.setPage(e),this.$store.isContainerWidthAtLeast("medium")||this.$store.updateOptions({view:null})},toggleAllChildren(e=null){if(this.$refs.children){for(let t=this.structures.length-1;t>=0;t-=1)this.toggleChildren(t,e);this.$refs.children.forEach(t=>{t.toggleAllChildren(e)})}},toggleChildren(e,t=null){var n;(n=this.structures[e].items)!=null&&n.some(e=>e.items)&&(this.expandedStructures[e]=t!==null?t:!this.expandedStructures[e])}}},Fc={class:"tify-toc-list"},Tc=["aria-controls","aria-expanded","aria-label","title","onClick"],zc=["href"],Dc=["onClick"],Nc={class:"tify-toc-label"},Lc={class:"tify-toc-page"},Rc=["onClick"],Pc={class:"tify-toc-label"};function R2(i,a,l,d,u,h){const m=Kt,f=Qt,p=di("TocList",!0);return e(),n("ul",Fc,[(e(!0),n(c,null,g(l.structures,(a,c)=>{var d,g;return e(),n("li",{key:c,class:j(["tify-toc-structure",{"-current":h.isCurrentPageInStructure(a),"-expanded":u.expandedStructures[c]}])},[(d=a.items)!=null&&d.some(e=>e.items)?(e(),n("button",{key:0,type:"button",class:"tify-toc-toggle","aria-controls":`${h.id}-${c}`,"aria-expanded":!!u.expandedStructures[c],"aria-label":i.$translate(u.expandedStructures[c]?"Collapse":"Expand"),title:i.$translate(u.expandedStructures[c]?"Collapse":"Expand"),onClick:e=>h.toggleChildren(c)},[u.expandedStructures[c]?(e(),r(m,{key:0})):(e(),r(f,{key:1}))],8,Tc)):o("",!0),l.purpose==="pdf"?(e(),n("a",{key:1,class:"tify-toc-link",href:a.rendering[0].id,download:""},s(i.$store.localize(a.label))+" ("+s(a.items.length)+"\xA0"+s(i.$translate(a.items.length===1?"page":"pages"))+") ",9,zc)):a.label&&i.$store.localize(a.label)!==h.getFirstPageLabel(a)?(e(),n("a",{key:2,class:"tify-toc-link -dots",href:"javascript:;",onClick:e=>h.setPage(a.firstPage||h.getFirstPage(a))},[t("span",Nc,s(i.$store.localize(a.label)),1),t("span",Lc,s(h.getFirstPageLabel(a)||"â"),1)],8,Dc)):(e(),n("a",{key:3,class:"tify-toc-link",href:"javascript:;",onClick:e=>h.setPage(a.firstPage||h.getFirstPage(a))},[t("span",Pc,s(i.$store.localize(a.label,"string")||h.getFirstPageLabel(a)||i.$translate("$n/a")),1)],8,Rc)),(g=a.items)!=null&&g.some(e=>e.items)?k((e(),r(p,{key:4,id:`${h.id}-${c}`,ref_for:!0,ref:"children",level:l.level+1,purpose:l.purpose,structures:a.items},null,8,["id","level","purpose","structures"])),[[N,u.expandedStructures[c]]]):o("",!0)],2)}),128))])}ks=i(Mc,[["render",R2]]),Bc={},Vc={class:"tify-icon -filmstrip","aria-hidden":"true",viewBox:"0 0 24 24"};function N2(s,o){return e(),n("svg",Vc,[...o[0]||(o[0]=[t("path",{d:"M18,9H16V7H18M18,13H16V11H18M18,17H16V15H18M8,9H6V7H8M8,13H6V11H8M8,17H6V15H8M18,3V5H16V3H8V5H6V3H4V21H6V19H8V21H16V19H18V21H20V3H18Z"},null,-1)])])}Wc=i(Bc,[["render",N2]]),Uc={},Kc={class:"tify-icon -waveform","aria-hidden":"true",viewBox:"0 0 24 24"};function D2(s,o){return e(),n("svg",Kc,[...o[0]||(o[0]=[t("path",{d:"M22 12L20 13L19 14L18 13L17 16L16 13L15 21L14 13L13 15L12 13L11 17L10 13L9 22L8 13L7 19L6 13L5 14L4 13L2 12L4 11L5 10L6 11L7 5L8 11L9 2L10 11L11 7L12 11L13 9L14 11L15 3L16 11L17 8L18 11L19 10L20 11L22 12Z"},null,-1)])])}Yc=i(Uc,[["render",D2]]),Gc={data(){return{otherItems:[],perElementPdfLinksVisible:!1}},computed:{hasElementPdfLinks(){var e,t;return!!((t=(e=this.$store.manifest.structures)==null?0[0]:e[0])!=null&&t.rendering)&&this.$store.manifest.structures[0].rendering.some(e=>e.format&&e.format==="application/pdf")},media(){const e=[];return this.$store.options.pages.filter(e=>e>0).forEach(t=>{var n,s;const o=(s=(n=this.$store.manifest.items[t-1].items)==null?0[0]:n[0])==null?0[0]:s.items;o==null||o.forEach((n,s)=>{var o;(((o=n.body)==null?0[0]:o.items)||[n.body]).forEach((n,o)=>{var a;const i=(a=n.format)==null?0[0]:a.split("/")[1],r={fileName:n.id.split("/").at(-1),format:i?.toUpperCase(),label:n.label,type:n.type,url:n.id,page:t,itemIndex:s,layerIndex:o};if(n.service){const e=[].concat(n.service)[0],s=["ImageService2","ImageService3"].includes(e.type||e["@type"])?"default":"native",o=e.type==="ImageService3"?"max":"full",t=e.id||e["@id"],a=t.at(-1)==="/"?"":"/";r.url=`${t}${a}full/${o}/0/${s}.${i==="jpeg"?"jpg":i}`}e.push(r)})})}),e},pages(){return this.$store.options.pages.filter(e=>e>0)},renderings(){return[].concat(this.$store.manifest.rendering||[])}}},Xc={class:"tify-export",tabindex:"0"},Qc={class:"tify-sr-only"},Zc={key:0,class:"tify-export-section -links"},Jc={class:"tify-export-list"},el=["href"],tl={class:"tify-export-link-media"},nl=["src"],sl={class:"tify-export-link-text"},ol={key:0,class:"tify-export-link-hint"},il={class:"tify-export-link-format"},al={key:1,class:"tify-export-section -renderings"},rl={class:"tify-list"},cl=["href"],ll={key:0,class:"tify-export-container"},dl=["aria-controls","aria-expanded","aria-label"],ul=["id"],hl={class:"tify-export-section -iiif"},ml={class:"tify-list"},fl={key:0},pl=["href"],gl=["href"],vl={key:2,class:"tify-export-section -other"},bl={class:"tify-list"},jl=["href"];function z2(i,l,d,u,h,m){var f,p,v;const b=Yc,y=Wc,_=be,w=xn,O=ks;return e(),n("section",Xc,[t("h2",Qc,s(i.$translate("Export [noun]")),1),i.$store.manifest?(e(),n("div",Zc,[t("h3",null,s(i.$translate("Media Files")),1),t("ul",Jc,[(e(!0),n(c,null,g(m.media,l=>(e(),n("li",{key:l.url},[t("a",{href:l.url,class:"tify-export-link",download:"",rel:"noopener noreferrer",target:"_blank"},[t("span",tl,[i.$store.getThumbnailUrl(l.page,96,l.itemIndex,l.layerIndex)?(e(),n("img",{key:0,src:i.$store.getThumbnailUrl(l.page,96,l.itemIndex,l.layerIndex),alt:""},null,8,nl)):l.type==="Sound"?(e(),r(b,{key:1})):l.type==="Video"?(e(),r(y,{key:2})):o("",!0)]),t("span",sl,[a(_,{number:l.page,wrap:!0},null,8,["number"]),l.label?(e(),n("span",ol,s(i.$store.localize(l.label)),1)):o("",!0),t("span",il,[l.type==="Sound"?(e(),n(c,{key:0},[T(s(i.$translate("Audio"))+" \xB7 ",1)],64)):l.type==="Video"?(e(),n(c,{key:1},[T(s(i.$translate("Video"))+" \xB7 ",1)],64)):l.type==="Image"?(e(),n(c,{key:2},[T(s(i.$translate("Image"))+" \xB7 ",1)],64)):o("",!0),T(" "+s(l.format),1)])])],8,el)]))),128))])])):o("",!0),(f=i.$store.manifest)!=null&&f.rendering?(e(),n("div",al,[t("h3",null,s(i.$translate("Renderings")),1),t("ul",rl,[(e(!0),n(c,null,g(m.renderings,o=>(e(),n("li",{key:o.id},[t("a",{href:o.id},s(i.$store.localize(o.label)),9,cl)]))),128))]),m.hasElementPdfLinks?(e(),n("div",ll,[t("button",{type:"button",class:j(["tify-export-toggle",{"-close":h.perElementPdfLinksVisible}]),"aria-controls":i.$getId("export-pdf-list"),"aria-expanded":h.perElementPdfLinksVisible,"aria-label":h.perElementPdfLinksVisible?i.$translate("Close PDF list"):null,onClick:l[0]||(l[0]=e=>h.perElementPdfLinksVisible=!h.perElementPdfLinksVisible)},[h.perElementPdfLinksVisible?(e(),r(w,{key:1})):(e(),n(c,{key:0},[T(s(i.$translate("PDFs for each element")),1)],64))],10,dl),k(t("div",{id:i.$getId("export-pdf-list"),class:"tify-export-toc"},[t("h4",null,s(i.$translate("PDFs for each element")),1),a(O,{ref:"children",purpose:"pdf",level:0,structures:i.$store.structures},null,8,["structures"])],8,ul),[[N,h.perElementPdfLinksVisible]])])):o("",!0)])):o("",!0),t("div",hl,[l[1]||(l[1]=t("h3",null,"IIIF",-1)),t("ul",ml,[i.$store.options.childManifestUrl?(e(),n("li",fl,[t("a",{href:i.$store.options.childManifestUrl,download:"manifest.json"},s(i.$translate("IIIF manifest (current document)")),9,pl)])):o("",!0),t("li",null,[t("a",{href:i.$store.options.manifestUrl,download:"manifest.json"},s(i.$translate(i.$store.collection?"IIIF manifest (collection)":"IIIF manifest")),9,gl)])])]),(v=(p=i.$store.manifest)==null?0[0]:p.seeAlso)!=null&&v.length?(e(),n("div",vl,[t("h3",null,s(i.$translate("Other Formats")),1),t("ul",bl,[(e(!0),n(c,null,g(i.$store.manifest.seeAlso,o=>(e(),n("li",{key:o.id},[t("a",{href:o.id,download:""},s(o.label?i.$store.localize(o.label):o.id),9,jl)]))),128))])])):o("",!0)])}_l=i(Gc,[["render",z2]]);function Dt(e,t,n=120){const s=e,o=n===!0?120:n;if(!o||o<0){s.scrollTop=t;return}const i=(t-e.scrollTop)/o/.1;setTimeout(()=>{s.scrollTop+=i,s.scrollTop!==t&&Dt(s,t,o-10)},10)}function Ts(e,t,n=!0){const s=t.querySelectorAll(e);if(!s.length)return;let i=s[0];const c=s[s.length-1];Array.prototype.forEach.call(s,e=>{e.dataset.level>=i.dataset.level&&(i=e)});const o=t.getBoundingClientRect(),a=i.getBoundingClientRect(),r=c.getBoundingClientRect();if(a.top<o.top){const e=a.top-o.top+t.scrollTop;Dt(t,e-50,n)}else if(r.bottom>o.bottom){const e=r.bottom-o.bottom+t.scrollTop;Dt(t,e+50,n)}}Ds=".tify-toc-structure.-current",Cl={data(){return{isInited:!1}},computed:{isNested(){return this.$store.structures.filter(e=>{var t;return(t=e.items)==null?0[0]:t.some(e=>e.items)}).length}},watch:{"$store.options.pages":function(){this.$nextTick(()=>Ts(Ds,this.$el))},"$store.options.view":{handler(e){e==="toc"&&this.$nextTick(this.init)},immediate:!0}},methods:{init(){this.isInited=!0,this.$nextTick(()=>Ts(Ds,this.$el,!1))}}},El={class:"tify-toc",tabindex:"0"},kl={class:"tify-sr-only"},Al={key:0,class:"tify-toc-header"};function F2(i,a,c,l,d,u){const h=ks;return e(),n("section",El,[t("h2",kl,s(i.$translate("Table of Contents")),1),u.isNested?(e(),n("div",Al,[t("button",{type:"button",class:"tify-toc-toggle-all",onClick:a[0]||(a[0]=e=>i.$refs.children.toggleAllChildren(!0))},s(i.$translate("Expand all")),1),t("button",{type:"button",class:"tify-toc-toggle-all",onClick:a[1]||(a[1]=e=>i.$refs.children.toggleAllChildren(!1))},s(i.$translate("Collapse all")),1)])):o("",!0),d.isInited?(e(),r(h,{key:1,ref:"children",level:0,structures:i.$store.structures},null,8,["structures"])):o("",!0)])}Ml=i(Cl,[["render",F2]]),Fl={},Tl={class:"tify-icon -image-broken-variant","aria-hidden":"true",viewBox:"0 0 24 24"};function M2(s,o){return e(),n("svg",Tl,[...o[0]||(o[0]=[t("path",{d:"M21,5V11.59L18,8.58L14,12.59L10,8.59L6,12.59L3,9.58V5A2,2 0 0,1 5,3H19A2,2 0 0,1 21,5M18,11.42L21,14.43V19A2,2 0 0,1 19,21H5A2,2 0 0,1 3,19V12.42L6,15.41L10,11.41L14,15.41"},null,-1)])])}Dl=i(Fl,[["render",M2]]),Nl=750,Ll={data(){return{itemHeight:0,itemVMargin:0,items:[{}],itemsPerRow:0,lastScrollTop:0,resizeObserver:null,resizeTimeout:null,style:{},thumbnailWidth:0,touchTimeout:null}},watch:{"$store.options.pages":function(e){this.$nextTick(()=>{const t=".tify-thumbnails-item.-current";e.length>2||e.length>1&&e[1]!==e[0]+1||(this.$refs.container.querySelector(t)?Ts(t,this.$el):this.scrollToCurrentPage())})},"$store.options.view":{handler(e){e==="thumbnails"&&this.$nextTick(this.init)},immediate:!0}},mounted(){this.style.flex=this.$el.style.flex},unmounted(){var e;(e=this.resizeObserver)==null||e.disconnect(),clearTimeout(this.resizeTimeout)},methods:{init(){this.updateDimensions(),this.scrollToCurrentPage(!1),this.resizeObserver=new ResizeObserver(this.onResize),this.resizeObserver.observe(this.$el)},onResize(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this.$store.options.view==="thumbnails"&&this.updateDimensions()},200)},updateDimensions(){if(!this.$refs.container)return;const e=this.$refs.container.querySelector(".tify-thumbnails-item"),t=e.currentStyle||window.getComputedStyle(e),n=parseInt(t.marginTop,10)+parseFloat(t.marginBottom,10);this.itemHeight=e.offsetHeight+n,this.itemVerticalMargin=n;const s=parseInt(t.marginLeft,10)+parseFloat(t.marginRight,10),o=e.offsetWidth+s;this.thumbnailWidth=e.offsetWidth,this.itemsPerRow=Math.floor(this.$refs.container.clientWidth/o);const i=Math.ceil(this.$store.manifest.items.length/this.itemsPerRow)*this.itemHeight;this.$refs.container.style.height=`${i}px`,this.redrawThumbnails(),this.scrollToCurrentPage(!1)},redrawThumbnails(){const n=this.$el.scrollTop,e=Math.floor(n/this.itemHeight)*this.itemsPerRow+1,s=Math.ceil(this.$el.offsetHeight/this.itemHeight)*this.itemsPerRow,o=e+this.itemsPerRow+s,i=Math.min(this.$store.manifest.items.length,o),t=[];for(let n=e;n<=i;n+=1)t.push({thumbnailUrl:this.$store.getThumbnailUrl(n,this.thumbnailWidth),page:n});this.items=t,this.$nextTick(()=>{const t=Math.floor(e/this.itemsPerRow);this.$refs.container.style.paddingTop=`${t*this.itemHeight}px`})},scrollToCurrentPage(e=!0){const t=Math.floor((this.$store.options.pages[0]-1)/this.itemsPerRow)*this.itemHeight+(this.itemVMargin-50);e?Dt(this.$el,t):this.$el.scrollTop=t},setPageAndSwitchView(e,t=!1){if(t){const t=this.$store.options.pages.slice(0),n=t.indexOf(e);n<0?(t.push(e),t.sort((e,t)=>e-t),t[0]===0&&t.shift()):t.length>1&&t.splice(n,1),this.$store.updateOptions({pages:t});return}this.$store.setPage(e),this.$store.isContainerWidthAtLeast("medium")||this.$store.updateOptions({view:null})},touchStartTogglePage(e){this.lastScrollTop=this.$el.scrollTop,this.touchTimeout=setTimeout(()=>{this.$el.scrollTop===this.lastScrollTop&&this.setPageAndSwitchView(e,!0)},Nl)},touchEnd(){clearTimeout(this.touchTimeout)}}},Rl={class:"tify-sr-only"},Pl={ref:"container",class:"tify-thumbnails-list"},Hl=["onClick","onTouchstart"],Il=["src"],Bl={key:1,class:"tify-thumbnails-image"},Vl={class:"tify-sr-only"};function S2(o,i,r,l,d,u){const h=Dl,m=be;return e(),n("section",{class:"tify-thumbnails",tabindex:"0",onScroll:i[1]||(i[1]=(...e)=>u.redrawThumbnails&&u.redrawThumbnails(...e))},[t("h2",Rl,s(o.$translate("Pages")),1),t("ol",Pl,[(e(!0),n(c,null,g(d.items,r=>(e(),n("li",{key:r.page,class:j(["tify-thumbnails-item",{"-current":o.$store.options.pages.includes(r.page)}])},[t("button",{type:"button",class:"tify-thumbnails-button",onClick:de(e=>u.setPageAndSwitchView(r.page,e.ctrlKey),["prevent"]),onTouchstart:e=>u.touchStartTogglePage(r.page),onTouchend:i[0]||(i[0]=(...e)=>u.touchEnd&&u.touchEnd(...e))},[r.thumbnailUrl?(e(),n("img",{key:0,class:"tify-thumbnails-image",alt:"",src:r.thumbnailUrl},null,8,Il)):(e(),n("span",Bl,[a(h),t("span",Vl,s(o.$translate("Image missing")),1)])),a(m,{number:r.page||1},null,8,["number"])],40,Hl)],2))),128))],512)],32)}Wl=i(Ll,[["render",S2]]),Ul={computed:{pages(){return this.$store.options.pages.filter(e=>e>0)}},watch:{"$store.options.annotationId":function(){this.scrollToCurrentAnnotation()},"$store.annotationsAvailable":function(){this.$store.options.annotationId&&this.scrollToCurrentAnnotation()}},mounted(){this.$store.options.annotationId&&this.$store.annotationsAvailable&&this.scrollToCurrentAnnotation()},methods:{filterHtml:Rt,scrollToCurrentAnnotation(){this.$nextTick(()=>{var t;const e=(t=this.$refs.currentItem)==null?0[0]:t[0];e&&e.scrollIntoView({behavior:"smooth",block:e.offsetHeight<this.$refs.panel.offsetHeight/2?"center":"start"})})}}},Kl={ref:"panel",class:"tify-text",tabindex:"0"},ql={class:"tify-sr-only"},Yl={key:0,class:"tify-text-pages"},Gl={key:0},Xl={class:"tify-text-list"},Ql=["onClick","onKeydown","innerHTML"],Zl={key:1,class:"tify-text-none"};function A2(i,r,l,d,u,h){const m=be;return e(),n("section",Kl,[t("h2",ql,s(i.$translate("Text")),1),i.$store.annotationsAvailable!==!1?(e(),n("div",Yl,[(e(!0),n(c,null,g(h.pages,s=>(e(),n("div",{key:s,class:"tify-text-page"},[i.$store.pageCount>1?(e(),n("h3",Gl,[a(m,{number:s},null,8,["number"])])):o("",!0),t("ul",Xl,[(e(!0),n(c,null,g(i.$store.annotations[s],(o,a)=>(e(),n("li",{key:`${s}-${a}`,ref_for:!0,ref:i.$store.options.annotationId===o.id?"currentItem":"",class:j(["tify-text-item",{"-current":i.$store.options.annotationId===o.id}])},[t("div",{role:"button",tabindex:"0",class:"tify-text-toggle",onClick:e=>i.$store.toggleAnnotationId(o.id),onKeydown:pe(e=>i.$store.toggleAnnotationId(o.id),["enter","space"]),innerHTML:h.filterHtml(o.html)},null,40,Ql)],2))),128))])]))),128))])):(e(),n("p",Zl,s(i.$translate("Text not available for this page")),1))],512)}ed=i(Ul,[["render",A2]]),td={},nd={class:"tify-icon -volume-high","aria-hidden":"true",viewBox:"0 0 24 24"};function k2(s,o){return e(),n("svg",nd,[...o[0]||(o[0]=[t("path",{d:"M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z"},null,-1)])])}od=i(td,[["render",k2]]),id={},ad={class:"tify-icon -volume-medium","aria-hidden":"true",viewBox:"0 0 24 24"};function E2(s,o){return e(),n("svg",ad,[...o[0]||(o[0]=[t("path",{d:"M5,9V15H9L14,20V4L9,9M18.5,12C18.5,10.23 17.5,8.71 16,7.97V16C17.5,15.29 18.5,13.76 18.5,12Z"},null,-1)])])}cd=i(id,[["render",E2]]),ld={},dd={class:"tify-icon -volume-low","aria-hidden":"true",viewBox:"0 0 24 24"};function C2(s,o){return e(),n("svg",dd,[...o[0]||(o[0]=[t("path",{d:"M7,9V15H11L16,20V4L11,9H7Z"},null,-1)])])}hd=i(ld,[["render",C2]]),md={},fd={class:"tify-icon -volume-variant-off","aria-hidden":"true",viewBox:"0 0 24 24"};function x2(s,o){return e(),n("svg",fd,[...o[0]||(o[0]=[t("path",{d:"M5.64,3.64L21.36,19.36L19.95,20.78L16,16.83V20L11,15H7V9H8.17L4.22,5.05L5.64,3.64M16,4V11.17L12.41,7.58L16,4Z"},null,-1)])])}gd=i(md,[["render",x2]]),vd={},bd={class:"tify-icon -closed-caption-outline","aria-hidden":"true",viewBox:"0 0 24 24"};function O2(s,o){return e(),n("svg",bd,[...o[0]||(o[0]=[t("path",{d:"M5,4C4.45,4 4,4.18 3.59,4.57C3.2,4.96 3,5.44 3,6V18C3,18.56 3.2,19.04 3.59,19.43C4,19.82 4.45,20 5,20H19C19.5,20 20,19.81 20.39,19.41C20.8,19 21,18.53 21,18V6C21,5.47 20.8,5 20.39,4.59C20,4.19 19.5,4 19,4H5M4.5,5.5H19.5V18.5H4.5V5.5M7,9C6.7,9 6.47,9.09 6.28,9.28C6.09,9.47 6,9.7 6,10V14C6,14.3 6.09,14.53 6.28,14.72C6.47,14.91 6.7,15 7,15H10C10.27,15 10.5,14.91 10.71,14.72C10.91,14.53 11,14.3 11,14V13H9.5V13.5H7.5V10.5H9.5V11H11V10C11,9.7 10.91,9.47 10.71,9.28C10.5,9.09 10.27,9 10,9H7M14,9C13.73,9 13.5,9.09 13.29,9.28C13.09,9.47 13,9.7 13,10V14C13,14.3 13.09,14.53 13.29,14.72C13.5,14.91 13.73,15 14,15H17C17.3,15 17.53,14.91 17.72,14.72C17.91,14.53 18,14.3 18,14V13H16.5V13.5H14.5V10.5H16.5V11H18V10C18,9.7 17.91,9.47 17.72,9.28C17.53,9.09 17.3,9 17,9H14Z"},null,-1)])])}yd=i(vd,[["render",O2]]),_d={},wd={class:"tify-icon -closed-caption","aria-hidden":"true",viewBox:"0 0 24 24"};function w2(s,o){return e(),n("svg",wd,[...o[0]||(o[0]=[t("path",{d:"M18,11H16.5V10.5H14.5V13.5H16.5V13H18V14A1,1 0 0,1 17,15H14A1,1 0 0,1 13,14V10A1,1 0 0,1 14,9H17A1,1 0 0,1 18,10M11,11H9.5V10.5H7.5V13.5H9.5V13H11V14A1,1 0 0,1 10,15H7A1,1 0 0,1 6,14V10A1,1 0 0,1 7,9H10A1,1 0 0,1 11,10M19,4H5C3.89,4 3,4.89 3,6V18A2,2 0 0,0 5,20H19A2,2 0 0,0 21,18V6C21,4.89 20.1,4 19,4Z"},null,-1)])])}xd=i(_d,[["render",w2]]);function St(e){return!!Vi()&&(E3(e),!0)}function Ed(){const e=new Set,t=t=>{e.delete(t)};return{on:n=>{e.add(n);const s=()=>t(n);return St(s),{off:s}},off:t,trigger:(...t)=>Promise.all(Array.from(e).map(e=>e(...t))),clear:()=>{e.clear()}}}jt=typeof window<"u"&&typeof document<"u",typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope,Ad=Object.prototype.toString,Ks=e=>Ad.call(e)==="[object Object]",he=()=>{},Fd=j2();function j2(){var e,t;return jt&&((e=window?.navigator)==null?0[0]:e.userAgent)&&(/iP(?:ad|hone|od)/.test(window.navigator.userAgent)||((t=window?.navigator)==null?0[0]:t.maxTouchPoints)>2&&/iPad|Macintosh/.test(window?.navigator.userAgent))}function b2(...e){if(e.length!==1)return $2(...e);const t=e[0];return typeof t=="function"?Ot(L2(()=>({get:t,set:he}))):ut(t)}function v2(e,t){function n(...n){return new Promise((s,o)=>{Promise.resolve(e(()=>t.apply(this,n),{fn:t,thisArg:this,args:n})).then(s).catch(o)})}return n}Nd=e=>e();function Us(e){return Array.isArray(e)?e:[e]}function p2(){return Ve()}function f2(e,t=!0,n){p2()?qt(e,n):t?e():En(e)}function Hd(e,t,n={}){const{eventFilter:c=Nd,...s}=n,r=v2(c,t);let o,i,a;if(s.flush==="sync"){let t=!1;i=()=>{},o=e=>{t=!0,e(),t=!1},a=$(e,(...e)=>{t||r(...e)},s)}else{const c=[];let n=0,t=0;i=()=>{n=t},c.push($(e,()=>{t++},{...s,flush:"sync"})),o=e=>{const s=t;e(),n+=t-s},c.push($(e,(...e)=>{const s=n>0&&n===t;n=0,t=0,!s&&r(...e)},s)),a=()=>{c.forEach(e=>e())}}return{stop:a,ignoreUpdates:o,ignorePrevAsyncUpdates:i}}function m2(e,t,n){return $(e,t,{...n,immediate:!0})}$s=jt?window:0[0],Vs=jt?window.document:0[0];function _e(e){var n;const t=b(e);return(n=t?.$el)!=null?n:t}function v(...e){const n=[],s=()=>{n.forEach(e=>e()),n.length=0},o=(e,t,n,s)=>(e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)),t=_(()=>{const t=Us(b(e[0])).filter(e=>e!=null);return t.every(e=>typeof e!="string")?t:0[0]}),i=m2(()=>{var n,s;return[(s=(n=t.value)==null?0[0]:n.map(e=>_e(e)))!=null?s:[$s].filter(e=>e!=null),Us(b(t.value?e[1]:e[0])),Us(Mt(t.value?e[2]:e[1])),b(t.value?e[3]:e[2])]},([e,t,i,a])=>{if(s(),e==null||!e.length||t==null||!t.length||i==null||!i.length)return;const r=Ks(a)?{...a}:a;n.push(...e.flatMap(e=>t.flatMap(t=>i.map(n=>o(e,t,n,r)))))},{flush:"post"}),a=()=>{i(),s()};return St(s),a}fn=!1;function Kd(e,t,n={}){const{window:s=$s,ignore:f=[],capture:m=!0,detectIframe:d=!1,controls:r=!1}=n;if(!s)return r?{stop:he,cancel:he,trigger:he}:he;if(Fd&&!fn){fn=!0;const e={passive:!0};Array.from(s.document.body.children).forEach(t=>t.addEventListener("click",he,e)),s.document.documentElement.addEventListener("click",he,e)}let o=!0;const c=e=>b(f).some(t=>{if(typeof t=="string")return Array.from(s.document.querySelectorAll(t)).some(t=>t===e.target||e.composedPath().includes(t));{const n=_e(t);return n&&(e.target===n||e.composedPath().includes(n))}});function u(e){const t=b(e);return t&&t.$.subTree.shapeFlag===16}function h(e,t){const s=b(e),n=s.$.subTree&&s.$.subTree.children;return n!=null&&!!Array.isArray(n)&&n.some(e=>e.el===t.target||t.composedPath().includes(e.el))}const a=n=>{const s=_e(e);if(n.target!=null&&!(!(s instanceof Element)&&u(e)&&h(e,n))&&!(!s||s===n.target||n.composedPath().includes(s))){if("detail"in n&&n.detail===0&&(o=!c(n)),!o){o=!0;return}t(n)}};let i=!1;const p=[v(s,"click",e=>{i||(i=!0,setTimeout(()=>{i=!1},0),a(e))},{passive:!0,capture:m}),v(s,"pointerdown",t=>{const n=_e(e);o=!c(t)&&!!(n&&!t.composedPath().includes(n))},{passive:!0}),d&&v(s,"blur",n=>{setTimeout(()=>{var o;const i=_e(e);((o=s.document.activeElement)==null?0[0]:o.tagName)==="IFRAME"&&!(i!=null&&i.contains(s.document.activeElement))&&t(n)},0)},{passive:!0})].filter(Boolean),l=()=>p.forEach(e=>e());return r?{stop:l,cancel:()=>{o=!1},trigger:e=>{o=!0,a(e),o=!1}}:l}function u2(){const e=M(!1),t=Ve();return t&&qt(()=>{e.value=!0},t),e}function d2(e){const t=u2();return _(()=>(t.value,!!e()))}Gn=["fullscreenchange","webkitfullscreenchange","webkitendfullscreen","mozfullscreenchange","MSFullscreenChange"];function j0(e,t={}){const{document:n=Vs,autoExit:g=!1}=t,s=_(()=>{var t;return(t=_e(e))!=null?t:n?.documentElement}),o=M(!1),c=_(()=>["requestFullscreen","webkitRequestFullscreen","webkitEnterFullscreen","webkitEnterFullScreen","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullscreen"].find(e=>n&&e in n||s.value&&e in s.value)),i=_(()=>["exitFullscreen","webkitExitFullscreen","webkitExitFullScreen","webkitCancelFullScreen","mozCancelFullScreen","msExitFullscreen"].find(e=>n&&e in n||s.value&&e in s.value)),a=_(()=>["fullScreen","webkitIsFullScreen","webkitDisplayingFullscreen","mozFullScreen","msFullscreenElement"].find(e=>n&&e in n||s.value&&e in s.value)),u=["fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement"].find(e=>n&&e in n),l=d2(()=>s.value&&n&&c.value!==0[0]&&i.value!==0[0]&&a.value!==0[0]),p=()=>!!u&&n?.[u]===s.value,h=()=>{if(a.value){if(n&&n[a.value]!=null)return n[a.value];{const e=s.value;if(e?.[a.value]!=null)return!!e[a.value]}}return!1};async function r(){if(!!l.value&&!!o.value){if(i.value)if(n?.[i.value]!=null)await n[i.value]();else{const e=s.value;e?.[i.value]!=null&&await e[i.value]()}o.value=!1}}async function m(){if(!l.value||o.value)return;h()&&await r();const e=s.value;c.value&&e?.[c.value]!=null&&(await e[c.value](),o.value=!0)}async function b(){await(o.value?r():m())}const d=()=>{const e=h();(!e||e&&p())&&(o.value=e)},f={capture:!1,passive:!0};return v(n,Gn,d,f),v(()=>_e(s),Gn,d,f),f2(d,!1),g&&St(r),{isSupported:l,isFullscreen:o,enter:m,exit:r,toggle:b}}function Kn(e,t){b(e)&&t(b(e))}function a2(e){let t=[];for(let n=0;n<e.length;++n)t=[...t,[e.start(n),e.end(n)]];return t}function Hn(e){return Array.from(e).map(({label:e,kind:t,language:n,mode:s,activeCues:o,cues:i,inBandMetadataTrackDispatchType:a},r)=>({id:r,label:e,kind:t,language:n,mode:s,activeCues:o,cues:i,inBandMetadataTrackDispatchType:a}))}eu={src:"",tracks:[]};function i2(e,t={}){e=b2(e),t={...eu,...t};const{document:s=Vs}=t,n={passive:!0},f=M(0),x=M(0),g=M(!1),r=M(1),c=M(!1),p=M(!1),o=M(!1),u=M(1),w=M(!1),C=ut([]),i=ut([]),m=M(-1),a=M(!1),h=M(!1),y=s&&"pictureInPictureEnabled"in s,_=Ed(),j=Ed(),O=t=>{Kn(e,e=>{if(t){const n=typeof t=="number"?t:t.id;e.textTracks[n].mode="disabled"}else for(let t=0;t<e.textTracks.length;++t)e.textTracks[t].mode="disabled";m.value=-1})},E=(t,n=!0)=>{Kn(e,e=>{const s=typeof t=="number"?t:t.id;n&&O(),e.textTracks[s].mode="showing",m.value=s})},k=()=>new Promise((t,n)=>{Kn(e,async e=>{y&&(a.value?s.exitPictureInPicture().then(t).catch(n):e.requestPictureInPicture().then(t).catch(n))})});ta(()=>{if(!s)return;const i=b(e);if(!i)return;const o=b(t.src);let a=[];o&&(typeof o=="string"?a=[{src:o}]:Array.isArray(o)?a=o:Ks(o)&&(a=[o]),i.querySelectorAll("source").forEach(e=>{e.remove()}),a.forEach(({src:e,type:t,media:o})=>{const a=s.createElement("source");a.setAttribute("src",e),a.setAttribute("type",t||""),a.setAttribute("media",o||""),v(a,"error",_.trigger,n),i.appendChild(a)}),i.load())}),$([e,r],()=>{const t=b(e);t&&(t.volume=r.value)}),$([e,h],()=>{const t=b(e);t&&(t.muted=h.value)}),$([e,u],()=>{const t=b(e);t&&(t.playbackRate=u.value)}),ta(()=>{if(!s)return;const n=b(t.tracks),o=b(e);!n||!n.length||!o||(o.querySelectorAll("track").forEach(e=>e.remove()),n.forEach(({default:e,kind:t,label:n,src:i,srcLang:a},r)=>{const c=s.createElement("track");c.default=e,c.kind=t,c.label=n,c.src=i,c.srclang=a,c.default&&(m.value=r),o.appendChild(c)}))});const{ignoreUpdates:A}=Hd(f,t=>{const n=b(e);n&&(n.currentTime=t)}),{ignoreUpdates:d}=Hd(o,t=>{const n=b(e);n&&(t?n.play().catch(e=>{throw j.trigger(e),e}):n.pause())});v(e,"timeupdate",()=>A(()=>f.value=b(e).currentTime),n),v(e,"durationchange",()=>x.value=b(e).duration,n),v(e,"progress",()=>C.value=a2(b(e).buffered),n),v(e,"seeking",()=>g.value=!0,n),v(e,"seeked",()=>g.value=!1,n),v(e,["waiting","loadstart"],()=>{c.value=!0,d(()=>o.value=!1)},n),v(e,"loadeddata",()=>c.value=!1,n),v(e,"playing",()=>{c.value=!1,p.value=!1,d(()=>o.value=!0)},n),v(e,"ratechange",()=>u.value=b(e).playbackRate,n),v(e,"stalled",()=>w.value=!0,n),v(e,"ended",()=>p.value=!0,n),v(e,"pause",()=>d(()=>o.value=!1),n),v(e,"play",()=>d(()=>o.value=!0),n),v(e,"enterpictureinpicture",()=>a.value=!0,n),v(e,"leavepictureinpicture",()=>a.value=!1,n),v(e,"volumechange",()=>{const t=b(e);t&&(r.value=t.volume,h.value=t.muted)},n);const l=[],S=$([e],()=>{const t=b(e);t&&(S(),l[0]=v(t.textTracks,"addtrack",()=>i.value=Hn(t.textTracks),n),l[1]=v(t.textTracks,"removetrack",()=>i.value=Hn(t.textTracks),n),l[2]=v(t.textTracks,"change",()=>i.value=Hn(t.textTracks),n))});return St(()=>l.forEach(e=>e())),{currentTime:f,duration:x,waiting:c,seeking:g,ended:p,stalled:w,buffered:C,playing:o,rate:u,volume:r,muted:h,tracks:i,selectedTrack:m,enableTrack:E,disableTrack:O,supportsPictureInPicture:y,togglePictureInPicture:k,isPictureInPicture:a,onSourceError:_.on,onPlaybackError:j.on}}function Rn(e){return!!(e.altKey||e.ctrlKey||e.metaKey||["INPUT","SELECT","TEXTAREA"].includes(e.target.nodeName)&&e.target.type!=="range")}su={props:{label:{default:null,type:String},position:{default:"bottom",type:String},shortcut:{default:null,type:String}},emits:["open"],data(){return{open:!1}},computed:{id(){return this.$.appContext.config.globalProperties.$getId?this.$getId(sn()):sn()}},mounted(){var e;(((e=this.$store)==null?0[0]:e.rootElement)||document.documentElement).addEventListener("keydown",this.onKeydown),Kd(this.$el,()=>{this.open=!1})},beforeUnmount(){var e;(((e=this.$store)==null?0[0]:e.rootElement)||document.documentElement).removeEventListener("keydown",this.onKeydown)},methods:{onKeydown(e){if(!Rn(e)){if(e.key==="Escape"){this.open=!1;return}e.key===this.shortcut&&(this.open=!this.open,this.open&&this.$emit("open"),e.preventDefault())}}}},ou={class:"tify-dropdown"},iu=["aria-controls","aria-expanded","aria-label","title"],au=["id"];function o2(s,o,i,a,r,c){return e(),n("div",ou,[t("button",{type:"button",class:"tify-dropdown-button","aria-controls":c.id,"aria-expanded":r.open,"aria-label":i.label,title:i.label,onClick:o[0]||(o[0]=e=>{r.open=!r.open,r.open&&s.$emit("open")})},[ai(s.$slots,"button")],8,iu),k(t("div",{id:c.id,class:j(`tify-dropdown-content -${i.position}`),onClick:o[1]||(o[1]=e=>e.target.closest("a, button")&&(r.open=!1))},[ai(s.$slots,"default")],10,au),[[N,r.open]])])}tn=i(su,[["render",o2]]),lu={},du={class:"tify-icon -play-speed","aria-hidden":"true",viewBox:"0 0 24 24"};function s2(s,o){return e(),n("svg",du,[...o[0]||(o[0]=[t("path",{d:"M13,2.05V4.05C17.39,4.59 20.5,8.58 19.96,12.97C19.5,16.61 16.64,19.5 13,19.93V21.93C18.5,21.38 22.5,16.5 21.95,11C21.5,6.25 17.73,2.5 13,2.03V2.05M5.67,19.74C7.18,21 9.04,21.79 11,22V20C9.58,19.82 8.23,19.25 7.1,18.37L5.67,19.74M7.1,5.74C8.22,4.84 9.57,4.26 11,4.06V2.06C9.05,2.25 7.19,3 5.67,4.26L7.1,5.74M5.69,7.1L4.26,5.67C3,7.19 2.25,9.04 2.05,11H4.05C4.24,9.58 4.8,8.23 5.69,7.1M4.06,13H2.06C2.26,14.96 3.03,16.81 4.27,18.33L5.69,16.9C4.81,15.77 4.24,14.42 4.06,13M10,16.5L16,12L10,7.5V16.5Z"},null,-1)])])}hu=i(lu,[["render",s2]]),mu={},fu={class:"tify-icon -pause","aria-hidden":"true",viewBox:"0 0 24 24"};function n2(s,o){return e(),n("svg",fu,[...o[0]||(o[0]=[t("path",{d:"M14,19H18V5H14M6,19H10V5H6V19Z"},null,-1)])])}gu=i(mu,[["render",n2]]),vu={},bu={class:"tify-icon -play","aria-hidden":"true",viewBox:"0 0 24 24"};function t2(s,o){return e(),n("svg",bu,[...o[0]||(o[0]=[t("path",{d:"M8,5.14V19.14L19,12.14L8,5.14Z"},null,-1)])])}yu=i(vu,[["render",t2]]),_u={},wu={class:"tify-icon -loading","aria-hidden":"true",viewBox:"0 0 24 24"};function e2(s,o){return e(),n("svg",wu,[...o[0]||(o[0]=[t("path",{d:"M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"},null,-1)])])}xu=i(_u,[["render",e2]]),Cu={props:{src:{required:!0,type:String},format:{required:!0,type:String},hasImage:{type:Boolean,default:!1}},data(){return{currentSubtitle:null,media:i2(C3("av")),mouseInterval:null,mouseMoving:!0,rates:[.5,.75,1,1.25,1.5,2]}},computed:{type(){var e;return(e=this.format)==null?0[0]:e.split("/")[0]},subtitles(){var t,n;const e=(n=(t=this.$store.manifest.items[this.$store.options.pages[0]-1].annotations)==null?0[0]:t[0].items)==null?0[0]:n[0].body;return e?e.items||[e]:[]}},watch:{currentSubtitle(e){Object.values(this.$refs.av.textTracks).forEach(t=>{t.mode=t.language===e?.language?"showing":"disabled"})}},beforeUnmount(){clearInterval(this.mouseInterval)},mounted(){window.addEventListener("mousemove",this.onMouseMove)},unmounted(){window.removeEventListener("mousemove",this.onMouseMove)},methods:{formatTime(e){const t=Math.floor(e/3600),n=Math.floor(e%3600/60),s=Math.floor(e%60);return[...this.media.duration>3600?[t.toString().padStart(2,"0")]:[],n.toString().padStart(2,"0"),s.toString().padStart(2,"0")].join(":")},onMouseMove(){clearTimeout(this.mouseInterval),this.mouseMoving=!0,this.mouseInterval=setInterval(()=>{this.mouseMoving=this.$store.options.view||this.media.paused},2e3)}}},Eu=["src","type"],ku=["srclang","src"],Au={class:"tify-player-controls"},Su=["aria-label"],Mu=["max","aria-label"],Fu={class:"tify-player-time"},Tu={class:"tify-player-elapsed"},zu={class:"tify-player-duration"},Du={class:"tify-sr-only"},Nu={key:0,class:"tify-player-select-badge"},Lu={class:"tify-player-select-title"},Ru={class:"tify-button-list"},Pu=["aria-pressed","onClick"],Hu={class:"tify-sr-only"},Iu={class:"tify-player-select-title"},Bu={class:"tify-button-list"},Vu=["aria-pressed","onClick"],$u=["aria-pressed"],Wu=["aria-label","disabled"],Uu=["aria-label"];function J0(i,l,d,u,h,m){const v=xu,f=yu,b=gu,y=hu,p=tn,_=xd,w=yd,O=gd,x=hd,C=cd,E=od;return e(),n("div",{class:j(["tify-player",`
			-${m.type}
			${h.mouseMoving||h.media.paused?"-mousing":""}
			${h.media.playing||h.media.waiting?"-playing":""}
			${d.hasImage&&(m.type==="audio"||!h.media.currentTime)?"-bottom":""}
		`]),onKeydown:l[7]||(l[7]=pe(de(e=>h.media.playing=!h.media.playing,["prevent"]),["space"]))},[(e(),r(I3(m.type),{ref:"av",class:"tify-player-av",poster:i.$store.getThumbnailUrl(i.$store.options.pages[0],0),preload:"metadata",crossorigin:"anonymous",onClick:l[0]||(l[0]=e=>{h.media.playing=!h.media.playing,m.onMouseMove()})},{default:I(()=>[t("source",{src:d.src,type:d.format},null,8,Eu),(e(!0),n(c,null,g(m.subtitles,t=>(e(),n("track",{key:t.id,kind:"captions",srclang:t.language,src:t.id},null,8,ku))),128))]),_:1},8,["poster"])),m.type==="video"?(e(),n("div",{key:0,class:j(["tify-player-overlay",{"-hidden":h.media.playing||d.hasImage&&!h.media.currentTime}])},[h.media.waiting?(e(),r(v,{key:0,class:"-spin"})):h.media.currentTime?o("",!0):(e(),r(f,{key:1}))],2)):o("",!0),t("div",Au,[t("div",null,[t("button",{type:"button",class:"tify-player-play-pause","aria-label":i.$translate(h.media.paused?"Play [verb]":"Pause [verb]"),onClick:l[1]||(l[1]=e=>h.media.playing=!h.media.playing)},[h.media.playing||h.media.seeking&&h.media.waiting?(e(),r(b,{key:0})):(e(),r(f,{key:1}))],8,Su),k(t("input",{"onUpdate:modelValue":l[2]||(l[2]=e=>h.media.currentTime=e),type:"range",class:"tify-player-seekbar",min:"0",max:h.media.duration,step:"any","aria-label":i.$translate("Current time"),style:ue(`--value: ${h.media.currentTime/h.media.duration*100}%`)},null,12,Mu),[[Ue,h.media.currentTime,0[0],{number:!0}]]),t("span",Fu,[t("span",Tu,s(m.formatTime(h.media.currentTime)),1),t("span",zu," / "+s(m.formatTime(h.media.duration)),1)]),a(p,{class:"tify-player-select -rate",alignment:"center",position:"top",shortcut:"r"},{button:I(()=>[t("span",Du,s(i.$translate("Playback rate")),1),a(y),h.media.rate!==1?(e(),n("span",Nu,s(h.media.rate.toLocaleString(i.$store.options.language))+"x ",1)):o("",!0)]),default:I(()=>[t("h3",Lu,s(i.$translate("Playback rate")),1),t("ol",Ru,[(e(!0),n(c,null,g(h.rates,o=>(e(),n("li",{key:o},[t("button",{type:"button","aria-pressed":o===h.media.rate,onClick:e=>h.media.rate=o},s(o===1?i.$translate("Normal"):`${o.toLocaleString(i.$store.options.language)}x`),9,Pu)]))),128))])]),_:1}),m.subtitles.length?(e(),r(p,{key:0,class:"tify-player-select -captions",alignment:"center",position:"top",shortcut:"c"},{button:I(()=>[t("span",Hu,s(i.$translate("Closed Captions")),1),h.currentSubtitle?(e(),r(_,{key:0})):(e(),r(w,{key:1}))]),default:I(()=>[t("h3",Iu,s(i.$translate("Closed Captions")),1),t("ol",Bu,[(e(!0),n(c,null,g(m.subtitles,o=>(e(),n("li",{key:o.id},[t("button",{type:"button","aria-pressed":o===h.currentSubtitle,onClick:e=>h.currentSubtitle=o},s(i.$store.localize(o.label)||o.language),9,Vu)]))),128)),t("li",null,[t("button",{type:"button","aria-pressed":!h.currentSubtitle,onClick:l[3]||(l[3]=e=>h.currentSubtitle=null)},s(i.$translate("None")),9,$u)])])]),_:1})):o("",!0)]),t("div",null,[t("button",{type:"button",class:"tify-player-mute","aria-label":i.$translate("Toggle mute"),disabled:h.media.volume===0,onClick:l[4]||(l[4]=e=>h.media.muted=!h.media.muted)},[h.media.muted?(e(),r(O,{key:0})):h.media.volume<.34?(e(),r(x,{key:1})):h.media.volume<.67?(e(),r(C,{key:2})):(e(),r(E,{key:3}))],8,Wu),k(t("input",{"onUpdate:modelValue":l[5]||(l[5]=e=>h.media.volume=e),type:"range",class:"tify-player-volume",min:"0",max:"1",step:"0.01","aria-label":i.$translate("Volume"),style:ue(`--value: ${h.media.volume*100}%`),onInput:l[6]||(l[6]=e=>h.media.muted=h.media.volume===0)},null,44,Uu),[[Ue,h.media.volume,0[0],{number:!0}]])])])],34)}qu=i(Cu,[["render",J0]]),Yu={},Gu={class:"tify-icon -chevron-right","aria-hidden":"true",viewBox:"0 0 24 24"};function Z0(s,o){return e(),n("svg",Gu,[...o[0]||(o[0]=[t("path",{d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"},null,-1)])])}Nn=i(Yu,[["render",Z0]]),Zu={},Ju={class:"tify-icon -chevron-left","aria-hidden":"true",viewBox:"0 0 24 24"};function Q0(s,o){return e(),n("svg",Ju,[...o[0]||(o[0]=[t("path",{d:"M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"},null,-1)])])}vn=i(Zu,[["render",Q0]]),n1={},s1={class:"tify-icon -layers-outline","aria-hidden":"true",viewBox:"0 0 24 24"};function Y0(s,o){return e(),n("svg",s1,[...o[0]||(o[0]=[t("path",{d:"M12,18.54L19.37,12.8L21,14.07L12,21.07L3,14.07L4.62,12.81L12,18.54M12,16L3,9L12,2L21,9L12,16M12,4.53L6.26,9L12,13.47L17.74,9L12,4.53Z"},null,-1)])])}i1=i(n1,[["render",Y0]]),a1={},r1={class:"tify-icon -comment-off-outline","aria-hidden":"true",viewBox:"0 0 24 24"};function q0(s,o){return e(),n("svg",r1,[...o[0]||(o[0]=[t("path",{d:"M7.2 4L5.2 2H20C21.11 2 22 2.9 22 4V16C22 16.76 21.57 17.41 20.95 17.75L19.2 16H20V4H7.2M22.11 21.46L20.84 22.73L16.11 18H13.9L10.2 21.71C10 21.9 9.75 22 9.5 22H9C8.45 22 8 21.55 8 21V18H4C2.9 18 2 17.11 2 16V4C2 3.97 2 3.93 2 3.9L1.11 3L2.39 1.73L22.11 21.46M14.11 16L4 5.89V16H10V19.08L13.08 16H14.11Z"},null,-1)])])}l1=i(a1,[["render",q0]]),d1={},u1={class:"tify-icon -comment-text-outline","aria-hidden":"true",viewBox:"0 0 24 24"};function K0(s,o){return e(),n("svg",u1,[...o[0]||(o[0]=[t("path",{d:"M9,22A1,1 0 0,1 8,21V18H4A2,2 0 0,1 2,16V4C2,2.89 2.9,2 4,2H20A2,2 0 0,1 22,4V16A2,2 0 0,1 20,18H13.9L10.2,21.71C10,21.9 9.75,22 9.5,22V22H9M10,16V19.08L13.08,16H20V4H4V16H10M6,7H18V9H6V7M6,11H15V13H6V11Z"},null,-1)])])}m1=i(d1,[["render",K0]]),f1={},p1={class:"tify-icon -backup-restore","aria-hidden":"true",viewBox:"0 0 24 24"};function U0(s,o){return e(),n("svg",p1,[...o[0]||(o[0]=[t("path",{d:"M12,3A9,9 0 0,0 3,12H0L4,16L8,12H5A7,7 0 0,1 12,5A7,7 0 0,1 19,12A7,7 0 0,1 12,19C10.5,19 9.09,18.5 7.94,17.7L6.5,19.14C8.04,20.3 9.94,21 12,21A9,9 0 0,0 21,12A9,9 0 0,0 12,3M14,12A2,2 0 0,0 12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12Z"},null,-1)])])}v1=i(f1,[["render",U0]]),b1={},j1={class:"tify-icon -palette-outline","aria-hidden":"true",viewBox:"0 0 24 24"};function W0(s,o){return e(),n("svg",j1,[...o[0]||(o[0]=[t("path",{d:"M12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2C17.5,2 22,6 22,11A6,6 0 0,1 16,17H14.2C13.9,17 13.7,17.2 13.7,17.5C13.7,17.6 13.8,17.7 13.8,17.8C14.2,18.3 14.4,18.9 14.4,19.5C14.5,20.9 13.4,22 12,22M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C12.3,20 12.5,19.8 12.5,19.5C12.5,19.3 12.4,19.2 12.4,19.1C12,18.6 11.8,18.1 11.8,17.5C11.8,16.1 12.9,15 14.3,15H16A4,4 0 0,0 20,11C20,7.1 16.4,4 12,4M6.5,10C7.3,10 8,10.7 8,11.5C8,12.3 7.3,13 6.5,13C5.7,13 5,12.3 5,11.5C5,10.7 5.7,10 6.5,10M9.5,6C10.3,6 11,6.7 11,7.5C11,8.3 10.3,9 9.5,9C8.7,9 8,8.3 8,7.5C8,6.7 8.7,6 9.5,6M14.5,6C15.3,6 16,6.7 16,7.5C16,8.3 15.3,9 14.5,9C13.7,9 13,8.3 13,7.5C13,6.7 13.7,6 14.5,6M17.5,10C18.3,10 19,10.7 19,11.5C19,12.3 18.3,13 17.5,13C16.7,13 16,12.3 16,11.5C16,10.7 16.7,10 17.5,10Z"},null,-1)])])}_1=i(b1,[["render",W0]]),w1={},O1={class:"tify-icon -circle-half-full","aria-hidden":"true",viewBox:"0 0 24 24"};function $0(s,o){return e(),n("svg",O1,[...o[0]||(o[0]=[t("path",{d:"M12 2A10 10 0 0 0 2 12A10 10 0 0 0 12 22A10 10 0 0 0 22 12A10 10 0 0 0 12 2M12 4A8 8 0 0 1 20 12A8 8 0 0 1 12 20V4Z"},null,-1)])])}C1=i(w1,[["render",$0]]),E1={},k1={class:"tify-icon -lightbulb-on-outline","aria-hidden":"true",viewBox:"0 0 24 24"};function V0(s,o){return e(),n("svg",k1,[...o[0]||(o[0]=[t("path",{d:"M20,11H23V13H20V11M1,11H4V13H1V11M13,1V4H11V1H13M4.92,3.5L7.05,5.64L5.63,7.05L3.5,4.93L4.92,3.5M16.95,5.63L19.07,3.5L20.5,4.93L18.37,7.05L16.95,5.63M12,6A6,6 0 0,1 18,12C18,14.22 16.79,16.16 15,17.2V19A1,1 0 0,1 14,20H10A1,1 0 0,1 9,19V17.2C7.21,16.16 6,14.22 6,12A6,6 0 0,1 12,6M14,21V22A1,1 0 0,1 13,23H11A1,1 0 0,1 10,22V21H14M11,18H13V15.87C14.73,15.43 16,13.86 16,12A4,4 0 0,0 12,8A4,4 0 0,0 8,12C8,13.86 9.27,15.43 11,15.87V18Z"},null,-1)])])}S1=i(E1,[["render",V0]]),M1={emits:["update"],computed:{saturation(){const e=this.$store.options.filters.saturate;return typeof e=="number"?e:1}}},F1=["value"],T1=["value"],z1=["value"];function B0(o,i,r,l,d,u){const h=S1,m=C1,f=_1;return e(),n(c,null,[t("p",null,[t("label",null,[a(h),T(" "+s(o.$translate("Brightness"))+" ",1),t("b",null,s(Math.round((o.$store.options.filters.brightness||1)*100))+"\xA0%",1),t("input",{ref:"firstSlider",max:"2",min:".5",step:".01",type:"range",value:o.$store.options.filters.brightness||1,style:ue(`--value: ${((o.$store.options.filters.brightness||1)-.5)*.66667*100}%`),onInput:i[0]||(i[0]=e=>o.$emit("update","brightness",e))},null,44,F1)])]),t("p",null,[t("label",null,[a(m),T(" "+s(o.$translate("Contrast"))+" ",1),t("b",null,s(Math.round((o.$store.options.filters.contrast||1)*100))+"\xA0%",1),t("input",{max:"2",min:".5",step:".01",type:"range",value:o.$store.options.filters.contrast||1,style:ue(`--value: ${((o.$store.options.filters.contrast||1)-.5)*.66667*100}%`),onInput:i[1]||(i[1]=e=>o.$emit("update","contrast",e))},null,44,T1)])]),t("p",null,[t("label",null,[a(f),T(" "+s(o.$translate("Saturation"))+" ",1),t("b",null,s(Math.round(u.saturation*100))+"\xA0%",1),t("input",{max:"3",min:"0",step:".01",type:"range",value:u.saturation,style:ue(`--value: ${u.saturation/3*100}%`),onInput:i[2]||(i[2]=e=>o.$emit("update","saturate",e))},null,44,z1)])])],64)}N1=i(M1,[["render",B0]]),L1={},R1={class:"tify-icon -tune","aria-hidden":"true",viewBox:"0 0 24 24"};function H0(s,o){return e(),n("svg",R1,[...o[0]||(o[0]=[t("path",{d:"M3,17V19H9V17H3M3,5V7H13V5H3M13,21V19H21V17H13V15H11V21H13M7,9V11H3V13H7V15H9V9H7M21,13V11H11V13H21M15,9H17V7H21V5H17V3H15V9Z"},null,-1)])])}H1=i(L1,[["render",H0]]),I1={},B1={class:"tify-icon -rotate-right","aria-hidden":"true",viewBox:"0 0 24 24"};function P0(s,o){return e(),n("svg",B1,[...o[0]||(o[0]=[t("path",{d:"M16.89,15.5L18.31,16.89C19.21,15.73 19.76,14.39 19.93,13H17.91C17.77,13.87 17.43,14.72 16.89,15.5M13,17.9V19.92C14.39,19.75 15.74,19.21 16.9,18.31L15.46,16.87C14.71,17.41 13.87,17.76 13,17.9M19.93,11C19.76,9.61 19.21,8.27 18.31,7.11L16.89,8.53C17.43,9.28 17.77,10.13 17.91,11M15.55,5.55L11,1V4.07C7.06,4.56 4,7.92 4,12C4,16.08 7.05,19.44 11,19.93V17.91C8.16,17.43 6,14.97 6,12C6,9.03 8.16,6.57 11,6.09V10L15.55,5.55Z"},null,-1)])])}$1=i(I1,[["render",P0]]),W1={},U1={class:"tify-icon -aspect-ratio","aria-hidden":"true",viewBox:"0 0 24 24"};function R0(s,o){return e(),n("svg",U1,[...o[0]||(o[0]=[t("path",{d:"M19,12H17V15H14V17H19V12M7,9H10V7H5V12H7V9M21,3H3A2,2 0 0,0 1,5V19A2,2 0 0,0 3,21H21A2,2 0 0,0 23,19V5A2,2 0 0,0 21,3M21,19H3V5H21V19Z"},null,-1)])])}q1=i(W1,[["render",R0]]),hn={exports:{}},G1=hn.exports;function N0(){return X1||(X1=1,function(e){function t(e){return new t.Viewer(e)}(function(e){e.version={versionStr:"5.0.1",major:parseInt("5",10),minor:parseInt("0",10),revision:parseInt("1",10)};var s={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object AsyncFunction]":"function","[object Promise]":"promise","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},o=Object.prototype.toString,n=Object.prototype.hasOwnProperty;e.isFunction=function(t){return e.type(t)==="function"},e.isArray=Array.isArray||function(t){return e.type(t)==="array"},e.isWindow=function(e){return e&&typeof e=="object"&&"setInterval"in e},e.type=function(e){return e==null?String(e):s[o.call(e)]||"object"},e.isPlainObject=function(s){if(!s||t.type(s)!=="object"||s.nodeType||e.isWindow(s)||s.constructor&&!n.call(s,"constructor")&&!n.call(s.constructor.prototype,"isPrototypeOf"))return!1;var o,i;for(i in s)o=i;return o===0[0]||n.call(s,o)},e.isEmptyObject=function(e){for(var t in e)return!1;return!0},e.freezeObject=function(t){return Object.freeze?e.freezeObject=Object.freeze:e.freezeObject=function(e){return e},e.freezeObject(t)},e.supportsCanvas=function(){var t=document.createElement("canvas");return!!(e.isFunction(t.getContext)&&t.getContext("2d"))}(),e.isCanvasTainted=function(e){var t=!1;try{e.getContext("2d").getImageData(0,0,1,1)}catch{t=!0}return t},e.supportsAddEventListener=function(){return!!(document.documentElement.addEventListener&&document.addEventListener)}(),e.supportsRemoveEventListener=function(){return!!(document.documentElement.removeEventListener&&document.removeEventListener)}(),e.supportsEventListenerOptions=function(){var n,t=0;if(e.supportsAddEventListener)try{n={get capture(){return t++,!1},get once(){return t++,!1},get passive(){return t++,!1}},window.addEventListener("test",null,n),window.removeEventListener("test",null,n)}catch{t=0}return t>=3}(),e.getCurrentPixelDensityRatio=function(){if(e.supportsCanvas){var t=document.createElement("canvas").getContext("2d"),n=window.devicePixelRatio||1,s=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return Math.max(n,1)/s}return 1},e.pixelDensityRatio=e.getCurrentPixelDensityRatio()})(t),function(e){e.extend=function(){var s,o,i,r,c,l,d,n=arguments[0]||{},h=arguments.length,u=!1,a=1;for(typeof n=="boolean"&&(u=n,n=arguments[1]||{},a=2),typeof n!="object"&&!t.isFunction(n)&&(n={}),h===a&&(n=this,--a);a<h;a++)if(c=arguments[a],c!==null||c!==0[0])for(o in c){if(r=Object.getOwnPropertyDescriptor(c,o),r!==0[0]){if(r.get||r.set){Object.defineProperty(n,o,r);continue}s=r.value}else{e.console.warn('Could not copy inherited property "'+o+'".');continue}n!==s&&(u&&s&&(t.isPlainObject(s)||(l=t.isArray(s)))?(i=n[o],l?(l=!1,d=i&&t.isArray(i)?i:[]):d=i&&t.isPlainObject(i)?i:{},n[o]=t.extend(u,d,s)):s!==0[0]&&(n[o]=s))}return n},s=function(){if(typeof navigator!="object")return!1;var e=navigator.userAgent;return typeof e=="string"&&(e.indexOf("iPhone")!==-1||e.indexOf("iPad")!==-1||e.indexOf("iPod")!==-1)},e.extend(e,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},splitHashDataForPost:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!1,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerDblClickDrag:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:s(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,maxTilesPerFrame:1,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorElement:null,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,overlayPreserveContentDirection:!0,opacity:1,compositeOperation:null,drawer:["webgl","canvas","html"],drawerOptions:{webgl:{},canvas:{},html:{},custom:{}},preload:!1,imageSmoothingEnabled:!0,placeholderFillStyle:null,subPixelRoundingForTransparency:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,tileRetryMax:0,tileRetryDelay:2500,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"],silenceMultiImageWarnings:!1},delegate:function(e,t){return function(){var n=arguments;return n===0[0]&&(n=[]),t.apply(e,n)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},SUBPIXEL_ROUNDING_OCCURRENCES:{NEVER:0,ONLY_AT_REST:1,ALWAYS:2},_viewers:new Map,getViewer:function(t){return e._viewers.get(this.getElement(t))},getElement:function(e){return typeof e=="string"&&(e=document.getElementById(e)),e},getElementPosition:function(t){var s,o,n=new e.Point;for(t=e.getElement(t),s=e.getElementStyle(t).position==="fixed",o=a(t,s);o;)n.x+=t.offsetLeft,n.y+=t.offsetTop,s&&(n=n.plus(e.getPageScroll())),t=o,s=e.getElementStyle(t).position==="fixed",o=a(t,s);return n},getElementOffset:function(t){t=e.getElement(t);var s,o,n=t&&t.ownerDocument,i={top:0,left:0};return n?(s=n.documentElement,typeof t.getBoundingClientRect<"u"&&(i=t.getBoundingClientRect()),o=n===n.window?n:n.nodeType===9&&(n.defaultView||n.parentWindow),new e.Point(i.left+(o.pageXOffset||s.scrollLeft)-(s.clientLeft||0),i.top+(o.pageYOffset||s.scrollTop)-(s.clientTop||0))):new e.Point},getElementSize:function(t){return t=e.getElement(t),new e.Point(t.clientWidth,t.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(t){return t=e.getElement(t),t.currentStyle}:function(t){return t=e.getElement(t),window.getComputedStyle(t,"")},getCssPropertyWithVendorPrefix:function(t){var n={};return e.getCssPropertyWithVendorPrefix=function(t){if(n[t]!==0[0])return n[t];if(o=document.createElement("div").style,s=null,o[t]!==0[0])s=t;else for(var s,o,a,r=["Webkit","Moz","MS","O","webkit","moz","ms","o"],c=e.capitalizeFirstLetter(t),i=0;i<r.length;i++)if(a=r[i]+c,o[a]!==0[0]){s=a;break}return n[t]=s,s},e.getCssPropertyWithVendorPrefix(t)},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},positiveModulo:function(e,t){var n=e%t;return n<0&&(n+=t),n},pointInElement:function(t,n){t=e.getElement(t);var s=e.getElementOffset(t),o=e.getElementSize(t);return n.x>=s.x&&n.x<s.x+o.x&&n.y<s.y+o.y&&n.y>=s.y},getMousePosition:function(t){if(typeof t.pageX=="number")e.getMousePosition=function(t){var n=new e.Point;return n.x=t.pageX,n.y=t.pageY,n};else if(typeof t.clientX=="number")e.getMousePosition=function(t){var n=new e.Point;return n.x=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n.y=t.clientY+document.body.scrollTop+document.documentElement.scrollTop,n};else throw new Error("Unknown event mouse position, no known technique.");return e.getMousePosition(t)},getPageScroll:function(){var t=document.documentElement||{},n=document.body||{};if(typeof window.pageXOffset=="number")e.getPageScroll=function(){return new e.Point(window.pageXOffset,window.pageYOffset)};else if(n.scrollLeft||n.scrollTop)e.getPageScroll=function(){return new e.Point(document.body.scrollLeft,document.body.scrollTop)};else if(t.scrollLeft||t.scrollTop)e.getPageScroll=function(){return new e.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new e.Point(0,0);return e.getPageScroll()},setPageScroll:function(t){if(typeof window.scrollTo<"u")e.setPageScroll=function(e){window.scrollTo(e.x,e.y)};else{var s,n=e.getPageScroll();if(n.x===t.x&&n.y===t.y)return;if(document.body.scrollLeft=t.x,document.body.scrollTop=t.y,s=e.getPageScroll(),s.x!==n.x&&s.y!==n.y){e.setPageScroll=function(e){document.body.scrollLeft=e.x,document.body.scrollTop=e.y};return}if(document.documentElement.scrollLeft=t.x,document.documentElement.scrollTop=t.y,s=e.getPageScroll(),s.x!==n.x&&s.y!==n.y){e.setPageScroll=function(e){document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y};return}e.setPageScroll=function(){}}e.setPageScroll(t)},getWindowSize:function(){var t=document.documentElement||{},n=document.body||{};if(typeof window.innerWidth=="number")e.getWindowSize=function(){return new e.Point(window.innerWidth,window.innerHeight)};else if(t.clientWidth||t.clientHeight)e.getWindowSize=function(){return new e.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(n.clientWidth||n.clientHeight)e.getWindowSize=function(){return new e.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return e.getWindowSize()},makeCenteredNode:function(t){t=e.getElement(t);var n=[e.makeNeutralElement("div"),e.makeNeutralElement("div"),e.makeNeutralElement("div")];return e.extend(n[0].style,{display:"table",height:"100%",width:"100%"}),e.extend(n[1].style,{display:"table-row"}),e.extend(n[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),n[0].appendChild(n[1]),n[1].appendChild(n[2]),n[2].appendChild(t),n[0]},makeNeutralElement:function(e){var n=document.createElement(e),t=n.style;return t.background="transparent none",t.border="none",t.margin="0px",t.padding="0px",t.position="static",n},now:function(){return Date.now?e.now=Date.now:e.now=function(){return(new Date).getTime()},e.now()},makeTransparentImage:function(t){var n=e.makeNeutralElement("img");return n.src=t,n},setElementOpacity:function(t,n,s){var o,i;t=e.getElement(t),s&&!e.Browser.alpha&&(n=Math.round(n)),e.Browser.opacity?t.style.opacity=n<1?n:"":n<1?(o=Math.round(100*n),i="alpha(opacity="+o+")",t.style.filter=i):t.style.filter=""},setElementTouchActionNone:function(t){t=e.getElement(t),typeof t.style.touchAction<"u"?t.style.touchAction="none":typeof t.style.msTouchAction<"u"&&(t.style.msTouchAction="none")},setElementPointerEvents:function(t,n){t=e.getElement(t),typeof t.style<"u"&&typeof t.style.pointerEvents<"u"&&(t.style.pointerEvents=n)},setElementPointerEventsNone:function(t){e.setElementPointerEvents(t,"none")},addClass:function(t,n){t=e.getElement(t),t.className?(" "+t.className+" ").indexOf(" "+n+" ")===-1&&(t.className+=" "+n):t.className=n},indexOf:function(e,t,n){return Array.prototype.indexOf?this.indexOf=function(e,t,n){return e.indexOf(t,n)}:this.indexOf=function(e,t,n){var s,i,o=n||0;if(!e)throw new TypeError;if(i=e.length,i===0||o>=i)return-1;for(o<0&&(o=i-(o<0?-o:o)),s=o;s<i;s++)if(e[s]===t)return s;return-1},this.indexOf(e,t,n)},removeClass:function(t,n){var s,o,i=[];for(t=e.getElement(t),o=t.className.split(/\s+/),s=0;s<o.length;s++)o[s]&&o[s]!==n&&i.push(o[s]);t.className=i.join(" ")},normalizeEventListenerOptions:function(t){var n;return typeof t<"u"?typeof t=="boolean"?n=e.supportsEventListenerOptions?{capture:t}:t:n=e.supportsEventListenerOptions?t:typeof t.capture<"u"&&t.capture:n=!!e.supportsEventListenerOptions&&{capture:!1},n},addEvent:function(){if(e.supportsAddEventListener)return function(t,n,s,o){o=e.normalizeEventListenerOptions(o),t=e.getElement(t),t.addEventListener(n,s,o)};if(document.documentElement.attachEvent&&document.attachEvent)return function(t,n,s){t=e.getElement(t),t.attachEvent("on"+n,s)};throw new Error("No known event model.")}(),removeEvent:function(){if(e.supportsRemoveEventListener)return function(t,n,s,o){o=e.normalizeEventListenerOptions(o),t=e.getElement(t),t.removeEventListener(n,s,o)};if(document.documentElement.detachEvent&&document.detachEvent)return function(t,n,s){t=e.getElement(t),t.detachEvent("on"+n,s)};throw new Error("No known event model.")}(),cancelEvent:function(e){e.preventDefault()},eventIsCanceled:function(e){return e.defaultPrevented},stopEvent:function(e){e.stopPropagation()},createCallback:function(e,t){console.error("The createCallback function is deprecated and will be removed in future versions. Please use alternativeFunction instead.");var n,s=[];for(n=2;n<arguments.length;n++)s.push(arguments[n]);return function(){var n,o=s.concat([]);for(n=0;n<arguments.length;n++)o.push(arguments[n]);return t.apply(e,o)}},getUrlParameter:function(e){var t=i[e];return t||null},getUrlProtocol:function(e){var t=e.match(/^([a-z]+:)\/\//i);return t===null?window.location.protocol:t[1].toLowerCase()},createAjaxRequest:function(){if(window.XMLHttpRequest)return e.createAjaxRequest=function(){return new XMLHttpRequest},new XMLHttpRequest;throw new Error("Browser doesn't support XMLHttpRequest.")},makeAjaxRequest:function(t,n,s){e.isPlainObject(t)&&(n=t.success,s=t.error,l=t.withCredentials,i=t.headers,r=t.responseType||null,c=t.postData||null,t=t.url);var i,a,r,c,l,u,d=e.getUrlProtocol(t),o=e.createAjaxRequest();if(!e.isFunction(n))throw new Error("makeAjaxRequest requires a success callback");o.onreadystatechange=function(){o.readyState===4&&(o.onreadystatechange=function(){},o.status>=200&&o.status<300||o.status===0&&d!=="http:"&&d!=="https:"?n(o):e.isFunction(s)?s(o):e.console.error("AJAX request returned %d: %s",o.status,t))},u=c?"POST":"GET";try{if(o.open(u,t,!0),r&&(o.responseType=r),i)for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&o.setRequestHeader(a,i[a]);l&&(o.withCredentials=!0),o.send(c)}catch(t){e.console.error("%s while making AJAX request: %s",t.name,t.message),o.onreadystatechange=function(){},e.isFunction(s)&&s(o,t)}return o},jsonp:function(t){var n,o=t.url,i=document.head||document.getElementsByTagName("head")[0]||document.documentElement,s=t.callbackName||"openseadragon"+e.now(),r=window[s],c="$1"+s+"$2",l=t.param||"callback",a=t.callback,o=o.replace(/(=)\?(&|$)|\?\?/i,c);o+=(/\?/.test(o)?"&":"?")+l+"="+s,window[s]=function(t){if(r)window[s]=r;else try{delete window[s]}catch{}a&&e.isFunction(a)&&a(t)},n=document.createElement("script"),(t.async!==0[0]||t.async!==!1)&&(n.async="async"),t.scriptCharset&&(n.charset=t.scriptCharset),n.src=o,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,i&&n.parentNode&&i.removeChild(n),n=0[0])},i.insertBefore(n,i.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(t){if(window.DOMParser)e.parseXml=function(e){var n,t=null;return n=new DOMParser,t=n.parseFromString(e,"text/xml"),t};else throw new Error("Browser doesn't support XML DOM.");return e.parseXml(t)},parseJSON:function(t){return e.parseJSON=window.JSON.parse,e.parseJSON(t)},imageFormatSupported:function(e){return e=e||"",!!o[e.toLowerCase()]},setImageFormatsSupported:function(t){e.extend(o,t)}}),n=function(){},e.console=window.console||{log:n,debug:n,info:n,warn:n,error:n,assert:n},e.Browser={vendor:e.BROWSERS.UNKNOWN,version:0,alpha:!0};var n,s,o={avif:!0,bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1,webp:!0},i={};(function(){var n,s,o,a,r,c,l,d,u=navigator.appVersion,t=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(t.substring(t.indexOf("MSIE")+5,t.indexOf(";",t.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(t.indexOf("Edge")>=0?(e.Browser.vendor=e.BROWSERS.EDGE,e.Browser.version=parseFloat(t.substring(t.indexOf("Edge")+5))):t.indexOf("Edg")>=0?(e.Browser.vendor=e.BROWSERS.CHROMEEDGE,e.Browser.version=parseFloat(t.substring(t.indexOf("Edg")+4))):t.indexOf("Firefox")>=0?(e.Browser.vendor=e.BROWSERS.FIREFOX,e.Browser.version=parseFloat(t.substring(t.indexOf("Firefox")+8))):t.indexOf("Safari")>=0?(e.Browser.vendor=t.indexOf("Chrome")>=0?e.BROWSERS.CHROME:e.BROWSERS.SAFARI,e.Browser.version=parseFloat(t.substring(t.substring(0,t.indexOf("Safari")).lastIndexOf("/")+1,t.indexOf("Safari")))):(l=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),l.exec(t)!==null&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":e.Browser.vendor=e.BROWSERS.OPERA,e.Browser.version=parseFloat(u);break}d=window.location.search.substring(1),a=d.split("&");for(o=0;o<a.length;o++)if(n=a[o],s=n.indexOf("="),s>0){r=n.substring(0,s),c=n.substring(s+1);try{i[r]=decodeURIComponent(c)}catch{e.console.error("Ignoring malformed URL parameter: %s=%s",r,c)}}e.Browser.alpha=!(e.Browser.vendor===e.BROWSERS.CHROME&&e.Browser.version<2),e.Browser.opacity=!0,e.Browser.vendor===e.BROWSERS.IE&&e.console.error("Internet Explorer is not supported by OpenSeadragon")})(),function(t){if(i=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame,a=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||t.msCancelAnimationFrame,i&&a)e.requestAnimationFrame=function(){return i.apply(t,arguments)},e.cancelAnimationFrame=function(){return a.apply(t,arguments)};else{var o,i,a,n=[],s=[],r=0;e.requestAnimationFrame=function(t){return n.push([++r,t]),o||(o=setInterval(function(){if(n.length){var t=e.now(),i=s;for(s=n,n=i;s.length;)s.shift()[1](t)}else clearInterval(o),o=0[0]},1e3/50)),r},e.cancelAnimationFrame=function(e){var t,o;for(t=0,o=n.length;t<o;t+=1)if(n[t][0]===e){n.splice(t,1);return}for(t=0,o=s.length;t<o;t+=1)if(s[t][0]===e){s.splice(t,1);return}}}}(window);function a(e,t){return t&&e!==document.body?document.body:e.offsetParent}}(t),function(t,n){e.exports?e.exports=n():t.OpenSeadragon=n()}(G1,function(){return t}),function(e){class t{constructor(e){e||(e=[0,0,0,0,0,0,0,0,0]),this.values=e}static makeIdentity(){return new t([1,0,0,0,1,0,0,0,1])}static makeTranslation(e,n){return new t([1,0,0,0,1,0,e,n,1])}static makeRotation(e){var n=Math.cos(e),s=Math.sin(e);return new t([n,-s,0,s,n,0,0,0,1])}static makeScaling(e,n){return new t([e,0,0,0,n,0,0,0,1])}multiply(e){let n=this.values,s=e.values;var o=n[0],i=n[1],a=n[2],r=n[3],c=n[4],l=n[5],d=n[6],u=n[7],h=n[8],m=s[0],f=s[1],p=s[2],g=s[3],v=s[4],b=s[5],j=s[6],y=s[7],_=s[8];return new t([m*o+f*r+p*d,m*i+f*c+p*u,m*a+f*l+p*h,g*o+v*r+b*d,g*i+v*c+b*u,g*a+v*l+b*h,j*o+y*r+_*d,j*i+y*c+_*u,j*a+y*l+_*h])}}e.Mat3=t}(t),function(e){var t={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.fullscreenElement},t.requestFullScreen=function(t){return t.requestFullscreen().catch(function(t){e.console.error("Fullscreen request failed: ",t)})},t.exitFullScreen=function(){document.exitFullscreen().catch(function(t){e.console.error("Error while exiting fullscreen: ",t)})},t.fullScreenEventName="fullscreenchange",t.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.msFullscreenElement},t.requestFullScreen=function(e){return e.msRequestFullscreen()},t.exitFullScreen=function(){document.msExitFullscreen()},t.fullScreenEventName="MSFullscreenChange",t.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitFullscreenElement},t.requestFullScreen=function(e){return e.webkitRequestFullscreen()},t.exitFullScreen=function(){document.webkitExitFullscreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},t.requestFullScreen=function(e){return e.webkitRequestFullScreen()},t.exitFullScreen=function(){document.webkitCancelFullScreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.mozFullScreenElement},t.requestFullScreen=function(e){return e.mozRequestFullScreen()},t.exitFullScreen=function(){document.mozCancelFullScreen()},t.fullScreenEventName="mozfullscreenchange",t.fullScreenErrorEventName="mozfullscreenerror"),t.isFullScreen=function(){return t.getFullScreenElement()!==null},t.cancelFullScreen=function(){e.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),t.exitFullScreen()},e.extend(e,t)}(t),function(e){e.EventSource=function(){this.events={},this._rejectedEventList={}},e.EventSource.prototype={addOnceHandler:function(e,t,n,s,o){i=this,s=s||1;var i,a=0,r=function(n){return a++,a===s&&i.removeHandler(e,r),t(n)};return this.addHandler(e,r,n,o)},addHandler:function(t,n,s,o){if(Object.prototype.hasOwnProperty.call(this._rejectedEventList,t))return e.console.error(`Error adding handler for ${t}. ${this._rejectedEventList[t]}`),!1;if(i=this.events[t],i||(this.events[t]=i=[]),n&&e.isFunction(n)){var i,a=i.length,r={handler:n,userData:s||null,priority:o||0};for(i[a]=r;a>0&&i[a-1].priority<i[a].priority;)i[a]=i[a-1],i[a-1]=r,a--}return!0},removeHandler:function(t,n){var o,s=this.events[t],i=[];if(s&&e.isArray(s)){for(o=0;o<s.length;o++)s[o].handler!==n&&i.push(s[o]);this.events[t]=i}},numberOfHandlers:function(e){var t=this.events[e];return t?t.length:0},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var t in this.events)this.events[t]=[]},getHandler:function(e){var t=this.events[e];return!t||!t.length?null:(t=t.length===1?[t[0]]:Array.apply(null,t),function(e,n){var s,o=t.length;for(s=0;s<o;s++)t[s]&&(n.eventSource=e,n.userData=t[s].userData,t[s].handler(n))})},raiseEvent:function(t,n){if(Object.prototype.hasOwnProperty.call(this._rejectedEventList,t))return e.console.error(`Error adding handler for ${t}. ${this._rejectedEventList[t]}`),!1;var s=this.getHandler(t);return s&&s(this,n||{}),!0},rejectEventHandler(e,t=""){this._rejectedEventList[e]=t},allowEventHandler(e){delete this._rejectedEventList[e]}}}(t),function(e){var m,o={};e.MouseTracker=function(t){var n,s=arguments;e.isPlainObject(t)||(t={element:s[0],clickTimeThreshold:s[1],clickDistThreshold:s[2]}),this.hash=Math.random(),this.element=e.getElement(t.element),this.clickTimeThreshold=t.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=t.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=t.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=t.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=t.userData||null,this.stopDelay=t.stopDelay||50,this.preProcessEventHandler=t.preProcessEventHandler||null,this.contextMenuHandler=t.contextMenuHandler||null,this.enterHandler=t.enterHandler||null,this.leaveHandler=t.leaveHandler||null,this.exitHandler=t.exitHandler||null,this.overHandler=t.overHandler||null,this.outHandler=t.outHandler||null,this.pressHandler=t.pressHandler||null,this.nonPrimaryPressHandler=t.nonPrimaryPressHandler||null,this.releaseHandler=t.releaseHandler||null,this.nonPrimaryReleaseHandler=t.nonPrimaryReleaseHandler||null,this.moveHandler=t.moveHandler||null,this.scrollHandler=t.scrollHandler||null,this.clickHandler=t.clickHandler||null,this.dblClickHandler=t.dblClickHandler||null,this.dragHandler=t.dragHandler||null,this.dragEndHandler=t.dragEndHandler||null,this.pinchHandler=t.pinchHandler||null,this.stopHandler=t.stopHandler||null,this.keyDownHandler=t.keyDownHandler||null,this.keyUpHandler=t.keyUpHandler||null,this.keyHandler=t.keyHandler||null,this.focusHandler=t.focusHandler||null,this.blurHandler=t.blurHandler||null,n=this,o[this.hash]={click:function(e){re(n,e)},dblclick:function(e){R(n,e)},keydown:function(e){ie(n,e)},keyup:function(e){oe(n,e)},keypress:function(e){te(n,e)},focus:function(e){ee(n,e)},blur:function(e){J(n,e)},contextmenu:function(e){Z(n,e)},wheel:function(e){ae(n,e)},mousewheel:function(e){h(n,e)},DOMMouseScroll:function(e){h(n,e)},MozMousePixelScroll:function(e){h(n,e)},losecapture:function(e){U(n,e)},mouseenter:function(e){N(n,e)},mouseleave:function(e){D(n,e)},mouseover:function(e){p(n,e)},mouseout:function(e){T(n,e)},mousedown:function(e){F(n,e)},mouseup:function(e){M(n,e)},mousemove:function(e){A(n,e)},touchstart:function(e){W(n,e)},touchend:function(e){V(n,e)},touchmove:function(e){B(n,e)},touchcancel:function(e){I(n,e)},gesturestart:function(e){H(n,e)},gesturechange:function(e){P(n,e)},gotpointercapture:function(e){Y(n,e)},lostpointercapture:function(e){G(n,e)},pointerenter:function(e){N(n,e)},pointerleave:function(e){D(n,e)},pointerover:function(e){p(n,e)},pointerout:function(e){T(n,e)},pointerdown:function(e){F(n,e)},pointerup:function(e){M(n,e)},pointermove:function(e){A(n,e)},pointercancel:function(e){L(n,e)},pointerupcaptured:function(e){$(n,e)},pointermovecaptured:function(e){K(n,e)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,e.MouseTracker.havePointerEvents&&e.setElementPointerEvents(this.element,"auto"),this.exitHandler&&e.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),t.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){C(this),this.element=null,o[this.hash]=null,delete o[this.hash]},isTracking:function(){return o[this.hash].tracking},setTracking:function(e){return e?q(this):C(this),this},getActivePointersListByType:function(t){var s,i,n=o[this.hash],a=n?n.activePointersLists.length:0;for(s=0;s<a;s++)if(n.activePointersLists[s].type===t)return n.activePointersLists[s];return i=new e.MouseTracker.GesturePointList(t),n&&n.activePointersLists.push(i),i},getActivePointerCount:function(){var e,t=o[this.hash],s=t.activePointersLists.length,n=0;for(e=0;e<s;e++)n+=t.activePointersLists[e].getLength();return n},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},m=function(){try{return window.self!==window.top}catch{return!0}}();function O(e){try{return e.addEventListener&&e.removeEventListener}catch{return!1}}e.MouseTracker.gesturePointVelocityTracker=function(){var t=[],s=0,n=0,o=function(e,t){return e.hash.toString()+t.type+t.id.toString()},i=function(){var s,o,i,r,c,l,d=t.length,a=e.now();for(r=a-n,n=a,i=0;i<d;i++)o=t[i],s=o.gPoint,s.direction=Math.atan2(s.currentPos.y-o.lastPos.y,s.currentPos.x-o.lastPos.x),c=o.lastPos.distanceTo(s.currentPos),o.lastPos=s.currentPos,l=1e3*c/(r+1),s.speed=.75*l+.25*s.speed},a=function(a,r){var c=o(a,r);t.push({guid:c,gPoint:r,lastPos:r.currentPos}),t.length===1&&(n=e.now(),s=window.setInterval(i,50))},r=function(e,n){var i,r=o(e,n),a=t.length;for(i=0;i<a;i++)if(t[i].guid===r){t.splice(i,1),a--,a===0&&window.clearInterval(s);break}};return{addPoint:a,removePoint:r}}(),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==0[0]?"mousewheel":"DOMMouseScroll",e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",e.MouseTracker.wheelEventName],e.MouseTracker.wheelEventName==="DOMMouseScroll"&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.havePointerCapture=function(){var t=document.createElement("div");return e.isFunction(t.setPointerCapture)&&e.isFunction(t.releasePointerCapture)}(),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(e.MouseTracker.havePointerEvents=!1,e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.havePointerCapture=function(){var t=document.createElement("div");return e.isFunction(t.setCapture)&&e.isFunction(t.releaseCapture)}(),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),e.MouseTracker.GesturePointList=function(e){this._gPoints=[],this.type=e,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(e){return this._gPoints.push(e)},removeById:function(e){var t,n=this._gPoints.length;for(t=0;t<n;t++)if(this._gPoints[t].id===e){this._gPoints.splice(t,1);break}return this._gPoints.length},getByIndex:function(e){return e<this._gPoints.length?this._gPoints[e]:null},getById:function(e){var t,n=this._gPoints.length;for(t=0;t<n;t++)if(this._gPoints[t].id===e)return this._gPoints[t];return null},getPrimary:function(){var t,n=this._gPoints.length;for(t=0;t<n;t++)if(this._gPoints[t].isPrimary)return this._gPoints[t];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(e.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function x(e){var t,n,i,a,r,s=o[e.hash],c=s.activePointersLists.length;for(n=0;n<c;n++)if(i=s.activePointersLists[n],i.getLength()>0){for(a=[],r=i.asArray(),t=0;t<r.length;t++)a.push(r[t]);for(t=0;t<a.length;t++)l(e,i,a[t])}for(n=0;n<c;n++)s.activePointersLists.pop();s.sentDragEvent=!1}function q(t){var n,s,i=o[t.hash];if(!i.tracking){for(s=0;s<e.MouseTracker.subscribeEvents.length;s++)n=e.MouseTracker.subscribeEvents[s],e.addEvent(t.element,n,i[n],n===e.MouseTracker.wheelEventName&&{passive:!1,capture:!1});x(t),i.tracking=!0}}function C(t){var n,i,s=o[t.hash];if(s.tracking){for(n=0;n<e.MouseTracker.subscribeEvents.length;n++)i=e.MouseTracker.subscribeEvents[n],e.removeEvent(t.element,i,s[i],!1);x(t),s.tracking=!1}}function E(e,t){var n=o[e.hash];if(t==="pointerevent")return{upName:"pointerup",upHandler:n.pointerupcaptured,moveName:"pointermove",moveHandler:n.pointermovecaptured};if(t==="mouse")return{upName:"pointerup",upHandler:n.pointerupcaptured,moveName:"pointermove",moveHandler:n.pointermovecaptured};if(t==="touch")return{upName:"touchend",upHandler:n.touchendcaptured,moveName:"touchmove",moveHandler:n.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function X(t,n){var s;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents)try{t.element.setPointerCapture(n.id)}catch{e.console.warn("setPointerCapture() called on invalid pointer ID");return}else t.element.setCapture(!0);else s=E(t,e.MouseTracker.havePointerEvents?"pointerevent":n.type),m&&O(window.top)&&e.addEvent(window.top,s.upName,s.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,s.upName,s.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,s.moveName,s.moveHandler,!0);a(t,n,!0)}function g(t,n){var s,o,i;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents){if(i=t.getActivePointersListByType(n.type),o=i.getById(n.id),!o||!o.captured)return;try{t.element.releasePointerCapture(n.id)}catch{}}else t.element.releaseCapture();else s=E(t,e.MouseTracker.havePointerEvents?"pointerevent":n.type),m&&O(window.top)&&e.removeEvent(window.top,s.upName,s.upHandler,!0),e.removeEvent(e.MouseTracker.captureElement,s.moveName,s.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,s.upName,s.upHandler,!0);a(t,n,!1)}function r(t){return e.MouseTracker.havePointerEvents?t.pointerId:e.MouseTracker.mousePointerId}function s(t){return e.MouseTracker.havePointerEvents&&t.pointerType?t.pointerType:"mouse"}function c(t){return!e.MouseTracker.havePointerEvents||t.isPrimary}function i(t){return e.getMousePosition(t)}function z(e,t){return n(i(e),t)}function n(t,n){var s=e.getElementOffset(n);return t.minus(s)}function d(t,n){return new e.Point((t.x+n.x)/2,(t.y+n.y)/2)}function re(n,s){var o={originalEvent:s,eventType:"click",pointerType:"mouse",isEmulated:!1};t(n,o),o.preventDefault&&!o.defaultPrevented&&e.cancelEvent(s),o.stopPropagation&&e.stopEvent(s)}function R(n,s){var o={originalEvent:s,eventType:"dblclick",pointerType:"mouse",isEmulated:!1};t(n,o),o.preventDefault&&!o.defaultPrevented&&e.cancelEvent(s),o.stopPropagation&&e.stopEvent(s)}function ie(n,s){var i=null,o={originalEvent:s,eventType:"keydown",pointerType:"",isEmulated:!1};t(n,o),n.keyDownHandler&&!o.preventGesture&&!o.defaultPrevented&&(i={eventSource:n,keyCode:s.keyCode?s.keyCode:s.charCode,ctrl:s.ctrlKey,shift:s.shiftKey,alt:s.altKey,meta:s.metaKey,originalEvent:s,preventDefault:o.preventDefault||o.defaultPrevented,userData:n.userData},n.keyDownHandler(i)),(i&&i.preventDefault||o.preventDefault&&!o.defaultPrevented)&&e.cancelEvent(s),o.stopPropagation&&e.stopEvent(s)}function oe(n,s){var i=null,o={originalEvent:s,eventType:"keyup",pointerType:"",isEmulated:!1};t(n,o),n.keyUpHandler&&!o.preventGesture&&!o.defaultPrevented&&(i={eventSource:n,keyCode:s.keyCode?s.keyCode:s.charCode,ctrl:s.ctrlKey,shift:s.shiftKey,alt:s.altKey,meta:s.metaKey,originalEvent:s,preventDefault:o.preventDefault||o.defaultPrevented,userData:n.userData},n.keyUpHandler(i)),(i&&i.preventDefault||o.preventDefault&&!o.defaultPrevented)&&e.cancelEvent(s),o.stopPropagation&&e.stopEvent(s)}function te(n,s){var i=null,o={originalEvent:s,eventType:"keypress",pointerType:"",isEmulated:!1};t(n,o),n.keyHandler&&!o.preventGesture&&!o.defaultPrevented&&(i={eventSource:n,keyCode:s.keyCode?s.keyCode:s.charCode,ctrl:s.ctrlKey,shift:s.shiftKey,alt:s.altKey,meta:s.metaKey,originalEvent:s,preventDefault:o.preventDefault||o.defaultPrevented,userData:n.userData},n.keyHandler(i)),(i&&i.preventDefault||o.preventDefault&&!o.defaultPrevented)&&e.cancelEvent(s),o.stopPropagation&&e.stopEvent(s)}function ee(e,n){var s={originalEvent:n,eventType:"focus",pointerType:"",isEmulated:!1};t(e,s),e.focusHandler&&!s.preventGesture&&e.focusHandler({eventSource:e,originalEvent:n,userData:e.userData})}function J(e,n){var s={originalEvent:n,eventType:"blur",pointerType:"",isEmulated:!1};t(e,s),e.blurHandler&&!s.preventGesture&&e.blurHandler({eventSource:e,originalEvent:n,userData:e.userData})}function Z(s,o){var r=null,a={originalEvent:o,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1};t(s,a),s.contextMenuHandler&&!a.preventGesture&&!a.defaultPrevented&&(r={eventSource:s,position:n(i(o),s.element),originalEvent:a.originalEvent,preventDefault:a.preventDefault||a.defaultPrevented,userData:s.userData},s.contextMenuHandler(r)),(r&&r.preventDefault||a.preventDefault&&!a.defaultPrevented)&&e.cancelEvent(o),a.stopPropagation&&e.stopEvent(o)}function ae(e,t){k(e,t,t)}function h(t,n){var s={target:n.target||n.srcElement,type:"wheel",shiftKey:n.shiftKey,clientX:n.clientX,clientY:n.clientY,pageX:n.pageX?n.pageX:n.clientX,pageY:n.pageY?n.pageY:n.clientY,deltaMode:n.type==="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};e.MouseTracker.wheelEventName==="mousewheel"?s.deltaY=-n.wheelDelta/e.DEFAULT_SETTINGS.pixelsPerWheelLine:s.deltaY=n.detail,k(t,s,n)}function k(n,s,o){var r=0,a=null,r=s.deltaY?s.deltaY<0?1:-1:0,i={originalEvent:s,eventType:"wheel",pointerType:"mouse",isEmulated:s!==o};t(n,i),n.scrollHandler&&!i.preventGesture&&!i.defaultPrevented&&(a={eventSource:n,pointerType:"mouse",position:z(s,n.element),scroll:r,shift:s.shiftKey,isTouchEvent:!1,originalEvent:o,preventDefault:i.preventDefault||i.defaultPrevented,userData:n.userData},n.scrollHandler(a)),i.stopPropagation&&e.stopEvent(o),(a&&a.preventDefault||i.preventDefault&&!i.defaultPrevented)&&e.cancelEvent(o)}function U(n,s){var i={id:e.MouseTracker.mousePointerId,type:"mouse"},o={originalEvent:s,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1};t(n,o),s.target===n.element&&a(n,i,!1),o.stopPropagation&&e.stopEvent(s)}function W(n,s){var o,r,c,l=s.changedTouches.length,d=n.getActivePointersListByType("touch"),u=e.now();d.getLength()>s.touches.length-l&&e.console.warn("Tracked touch contact count doesn't match event.touches.length"),o={originalEvent:s,eventType:"pointerdown",pointerType:"touch",isEmulated:!1};for(t(n,o),r=0;r<l;r++)c={id:s.changedTouches[r].identifier,type:"touch",isPrimary:d.getLength()===0,currentPos:i(s.changedTouches[r]),currentTime:u},w(n,o,c),y(n,o,c,0),a(n,c,!0);o.preventDefault&&!o.defaultPrevented&&e.cancelEvent(s),o.stopPropagation&&e.stopEvent(s)}function V(n,s){var r,c,d=s.changedTouches.length,l=e.now(),o={originalEvent:s,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for(t(n,o),r=0;r<d;r++)c={id:s.changedTouches[r].identifier,type:"touch",currentPos:i(s.changedTouches[r]),currentTime:l},j(n,o,c,0),a(n,c,!1),_(n,o,c);o.preventDefault&&!o.defaultPrevented&&e.cancelEvent(s),o.stopPropagation&&e.stopEvent(s)}function B(n,s){var o,r,l=s.changedTouches.length,c=e.now(),a={originalEvent:s,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for(t(n,a),o=0;o<l;o++)r={id:s.changedTouches[o].identifier,type:"touch",currentPos:i(s.changedTouches[o]),currentTime:c},b(n,a,r);a.preventDefault&&!a.defaultPrevented&&e.cancelEvent(s),a.stopPropagation&&e.stopEvent(s)}function I(n,s){var o,a,r=s.changedTouches.length,i={originalEvent:s,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(t(n,i),o=0;o<r;o++)a={id:s.changedTouches[o].identifier,type:"touch"},v(n,i,a);i.stopPropagation&&e.stopEvent(s)}function H(t,n){return e.eventIsCanceled(n)||n.preventDefault(),!1}function P(t,n){return e.eventIsCanceled(n)||n.preventDefault(),!1}function Y(n,o){var i={originalEvent:o,eventType:"gotpointercapture",pointerType:s(o),isEmulated:!1};t(n,i),o.target===n.element&&a(n,{id:o.pointerId,type:s(o)},!0),i.stopPropagation&&e.stopEvent(o)}function G(n,o){var i={originalEvent:o,eventType:"lostpointercapture",pointerType:s(o),isEmulated:!1};t(n,i),o.target===n.element&&a(n,{id:o.pointerId,type:s(o)},!1),i.stopPropagation&&e.stopEvent(o)}function N(n,o){var a={id:r(o),type:s(o),isPrimary:c(o),currentPos:i(o),currentTime:e.now()},l={originalEvent:o,eventType:"pointerenter",pointerType:a.type,isEmulated:!1};t(n,l),w(n,l,a)}function D(n,o){var a={id:r(o),type:s(o),isPrimary:c(o),currentPos:i(o),currentTime:e.now()},l={originalEvent:o,eventType:"pointerleave",pointerType:a.type,isEmulated:!1};t(n,l),_(n,l,a)}function p(n,o){var l={id:r(o),type:s(o),isPrimary:c(o),currentPos:i(o),currentTime:e.now()},a={originalEvent:o,eventType:"pointerover",pointerType:l.type,isEmulated:!1};t(n,a),ne(n,a,l),a.preventDefault&&!a.defaultPrevented&&e.cancelEvent(o),a.stopPropagation&&e.stopEvent(o)}function T(n,o){var l={id:r(o),type:s(o),isPrimary:c(o),currentPos:i(o),currentTime:e.now()},a={originalEvent:o,eventType:"pointerout",pointerType:l.type,isEmulated:!1};t(n,a),se(n,a,l),a.preventDefault&&!a.defaultPrevented&&e.cancelEvent(o),a.stopPropagation&&e.stopEvent(o)}function F(n,o){var d={id:r(o),type:s(o),isPrimary:c(o),currentPos:i(o),currentTime:e.now()},u=e.MouseTracker.havePointerEvents&&d.type==="touch",l={originalEvent:o,eventType:"pointerdown",pointerType:d.type,isEmulated:!1};t(n,l),y(n,l,d,o.button),l.preventDefault&&!l.defaultPrevented&&e.cancelEvent(o),l.stopPropagation&&e.stopEvent(o),l.shouldCapture&&(u?a(n,d,!0):X(n,d))}function M(e,t){S(e,t)}function $(t,n){var o=t.getActivePointersListByType(s(n));o.getById(n.pointerId)&&S(t,n),e.stopEvent(n)}function S(n,o){var d={id:r(o),type:s(o),isPrimary:c(o),currentPos:i(o),currentTime:e.now()},l={originalEvent:o,eventType:"pointerup",pointerType:d.type,isEmulated:!1};t(n,l),j(n,l,d,o.button),l.preventDefault&&!l.defaultPrevented&&e.cancelEvent(o),l.stopPropagation&&e.stopEvent(o),l.shouldReleaseCapture&&(o.target===n.element?g(n,d):a(n,d,!1))}function A(e,t){f(e,t)}function K(t,n){var o=t.getActivePointersListByType(s(n));o.getById(n.pointerId)&&f(t,n),e.stopEvent(n)}function f(n,o){var l={id:r(o),type:s(o),isPrimary:c(o),currentPos:i(o),currentTime:e.now()},a={originalEvent:o,eventType:"pointermove",pointerType:l.type,isEmulated:!1};t(n,a),b(n,a,l),a.preventDefault&&!a.defaultPrevented&&e.cancelEvent(o),a.stopPropagation&&e.stopEvent(o)}function L(n,o){var a={id:o.pointerId,type:s(o)},i={originalEvent:o,eventType:"pointercancel",pointerType:a.type,isEmulated:!1};t(n,i),v(n,i,a),i.stopPropagation&&e.stopEvent(o)}function u(e,t){return t.speed=0,t.direction=0,t.contactPos=t.currentPos,t.contactTime=t.currentTime,t.lastPos=t.currentPos,t.lastTime=t.currentTime,e.add(t)}function l(t,n,s){var o,i=n.getById(s.id);return i?(i.captured&&(e.console.warn("stopTrackingPointer() called on captured pointer"),g(t,i)),n.removeContact(),o=n.removeById(s.id)):o=n.getLength(),o}function Q(e,t){switch(t.eventType){case"pointermove":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!1,t.preventGesture=!e.hasGestureHandlers,t.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!1,t.preventGesture=!1,t.stopPropagation=!1;break;case"pointerdown":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!1,t.preventGesture=!e.hasGestureHandlers,t.stopPropagation=!1;break;case"pointerup":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!1,t.preventGesture=!e.hasGestureHandlers,t.stopPropagation=!1;break;case"wheel":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!1,t.preventGesture=!e.hasScrollHandler,t.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":t.isStoppable=!0,t.isCancelable=!1,t.preventDefault=!1,t.preventGesture=!1,t.stopPropagation=!1;break;case"click":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!!e.clickHandler,t.preventGesture=!1,t.stopPropagation=!1;break;case"dblclick":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!!e.dblClickHandler,t.preventGesture=!1,t.stopPropagation=!1;break;case"focus":case"blur":case"pointerenter":case"pointerleave":default:t.isStoppable=!1,t.isCancelable=!1,t.preventDefault=!1,t.preventGesture=!1,t.stopPropagation=!1;break}}function t(t,n){n.eventSource=t,n.eventPhase=n.originalEvent&&typeof n.originalEvent.eventPhase<"u"?n.originalEvent.eventPhase:0,n.defaultPrevented=e.eventIsCanceled(n.originalEvent),n.shouldCapture=!1,n.shouldReleaseCapture=!1,n.userData=t.userData,Q(t,n),t.preProcessEventHandler&&t.preProcessEventHandler(n)}function a(t,n,s){var o=t.getActivePointersListByType(n.type),i=o.getById(n.id);i?s&&!i.captured?(i.captured=!0,o.captureCount++):!s&&i.captured&&(i.captured=!1,o.captureCount--,o.captureCount<0&&(o.captureCount=0,e.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):e.console.warn("updatePointerCaptured() called on untracked pointer")}function w(e,t,s){var i=e.getActivePointersListByType(s.type),o=i.getById(s.id);o?(o.insideElement=!0,o.lastPos=o.currentPos,o.lastTime=o.currentTime,o.currentPos=s.currentPos,o.currentTime=s.currentTime,s=o):(s.captured=!1,s.insideElementPressed=!1,s.insideElement=!0,u(i,s)),e.enterHandler&&e.enterHandler({eventSource:e,pointerType:s.type,position:n(s.currentPos,e.element),buttons:i.buttons,pointers:e.getActivePointerCount(),insideElementPressed:s.insideElementPressed,buttonDownAny:i.buttons!==0,isTouchEvent:s.type==="touch",originalEvent:t.originalEvent,userData:e.userData})}function _(e,t,s){var a,i=e.getActivePointersListByType(s.type),o=i.getById(s.id);o?(o.captured?(o.insideElement=!1,o.lastPos=o.currentPos,o.lastTime=o.currentTime,o.currentPos=s.currentPos,o.currentTime=s.currentTime):l(e,i,o),s=o):(s.captured=!1,s.insideElementPressed=!1),(e.leaveHandler||e.exitHandler)&&(a={eventSource:e,pointerType:s.type,position:s.currentPos&&n(s.currentPos,e.element),buttons:i.buttons,pointers:e.getActivePointerCount(),insideElementPressed:s.insideElementPressed,buttonDownAny:i.buttons!==0,isTouchEvent:s.type==="touch",originalEvent:t.originalEvent,userData:e.userData},e.leaveHandler&&e.leaveHandler(a),e.exitHandler&&e.exitHandler(a))}function ne(e,t,s){var o=e.getActivePointersListByType(s.type),i=o.getById(s.id);i?s=i:(s.captured=!1,s.insideElementPressed=!1),e.overHandler&&e.overHandler({eventSource:e,pointerType:s.type,position:n(s.currentPos,e.element),buttons:o.buttons,pointers:e.getActivePointerCount(),insideElementPressed:s.insideElementPressed,buttonDownAny:o.buttons!==0,isTouchEvent:s.type==="touch",originalEvent:t.originalEvent,userData:e.userData})}function se(e,t,s){var o=e.getActivePointersListByType(s.type),i=o.getById(s.id);i?s=i:(s.captured=!1,s.insideElementPressed=!1),e.outHandler&&e.outHandler({eventSource:e,pointerType:s.type,position:s.currentPos&&n(s.currentPos,e.element),buttons:o.buttons,pointers:e.getActivePointerCount(),insideElementPressed:s.insideElementPressed,buttonDownAny:o.buttons!==0,isTouchEvent:s.type==="touch",originalEvent:t.originalEvent,userData:e.userData})}function y(t,s,i,a){var c,l=o[t.hash],r=t.getActivePointersListByType(i.type);if(typeof s.originalEvent.buttons<"u"?r.buttons=s.originalEvent.buttons:a===0?r.buttons|=1:a===1?r.buttons|=4:a===2?r.buttons|=2:a===3?r.buttons|=8:a===4?r.buttons|=16:a===5&&(r.buttons|=32),a!==0){s.shouldCapture=!1,s.shouldReleaseCapture=!1,t.nonPrimaryPressHandler&&!s.preventGesture&&!s.defaultPrevented&&(s.preventDefault=!0,t.nonPrimaryPressHandler({eventSource:t,pointerType:i.type,position:n(i.currentPos,t.element),button:a,buttons:r.buttons,isTouchEvent:i.type==="touch",originalEvent:s.originalEvent,userData:t.userData}));return}c=r.getById(i.id),c?(c.insideElementPressed=!0,c.insideElement=!0,c.originalTarget=s.originalEvent.target,c.contactPos=i.currentPos,c.contactTime=i.currentTime,c.lastPos=c.currentPos,c.lastTime=c.currentTime,c.currentPos=i.currentPos,c.currentTime=i.currentTime,i=c):(i.captured=!1,i.insideElementPressed=!0,i.insideElement=!0,i.originalTarget=s.originalEvent.target,u(r,i)),r.addContact(),!s.preventGesture&&!s.defaultPrevented?(s.shouldCapture=!0,s.shouldReleaseCapture=!1,s.preventDefault=!0,(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(t,i),r.contacts===1?t.pressHandler&&!s.preventGesture&&t.pressHandler({eventSource:t,pointerType:i.type,position:n(i.contactPos,t.element),buttons:r.buttons,isTouchEvent:i.type==="touch",originalEvent:s.originalEvent,userData:t.userData}):r.contacts===2&&t.pinchHandler&&i.type==="touch"&&(l.pinchGPoints=r.asArray(),l.lastPinchDist=l.currentPinchDist=l.pinchGPoints[0].currentPos.distanceTo(l.pinchGPoints[1].currentPos),l.lastPinchCenter=l.currentPinchCenter=d(l.pinchGPoints[0].currentPos,l.pinchGPoints[1].currentPos))):(s.shouldCapture=!1,s.shouldReleaseCapture=!1)}function j(t,s,i,a){var r,m,f,p,h=o[t.hash],c=t.getActivePointersListByType(i.type),g=!1;if(typeof s.originalEvent.buttons<"u"?c.buttons=s.originalEvent.buttons:a===0?c.buttons^=-2:a===1?c.buttons^=-5:a===2?c.buttons^=-3:a===3?c.buttons^=-9:a===4?c.buttons^=-17:a===5&&(c.buttons^=-33),s.shouldCapture=!1,a!==0){s.shouldReleaseCapture=!1,t.nonPrimaryReleaseHandler&&!s.preventGesture&&!s.defaultPrevented&&(s.preventDefault=!0,t.nonPrimaryReleaseHandler({eventSource:t,pointerType:i.type,position:n(i.currentPos,t.element),button:a,buttons:c.buttons,isTouchEvent:i.type==="touch",originalEvent:s.originalEvent,userData:t.userData}));return}r=c.getById(i.id),r?(c.removeContact(),r.captured&&(g=!0),r.lastPos=r.currentPos,r.lastTime=r.currentTime,r.currentPos=i.currentPos,r.currentTime=i.currentTime,r.insideElement||l(t,c,r),m=r.currentPos,p=r.currentTime):(i.captured=!1,i.insideElementPressed=!1,i.insideElement=!0,u(c,i),r=i),!s.preventGesture&&!s.defaultPrevented&&(g?(s.shouldReleaseCapture=!0,s.preventDefault=!0,(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(t,r),c.contacts===0?(t.releaseHandler&&m&&t.releaseHandler({eventSource:t,pointerType:r.type,position:n(m,t.element),buttons:c.buttons,insideElementPressed:r.insideElementPressed,insideElementReleased:r.insideElement,isTouchEvent:r.type==="touch",originalEvent:s.originalEvent,userData:t.userData}),t.dragEndHandler&&h.sentDragEvent&&t.dragEndHandler({eventSource:t,pointerType:r.type,position:n(r.currentPos,t.element),speed:r.speed,direction:r.direction,shift:s.originalEvent.shiftKey,isTouchEvent:r.type==="touch",originalEvent:s.originalEvent,userData:t.userData}),h.sentDragEvent=!1,(t.clickHandler||t.dblClickHandler)&&r.insideElement&&(f=p-r.contactTime<=t.clickTimeThreshold&&r.contactPos.distanceTo(m)<=t.clickDistThreshold,t.clickHandler&&t.clickHandler({eventSource:t,pointerType:r.type,position:n(r.currentPos,t.element),quick:f,shift:s.originalEvent.shiftKey,isTouchEvent:r.type==="touch",originalEvent:s.originalEvent,originalTarget:r.originalTarget,userData:t.userData}),t.dblClickHandler&&f&&(c.clicks++,c.clicks===1?(h.lastClickPos=m,h.dblClickTimeOut=setTimeout(function(){c.clicks=0},t.dblClickTimeThreshold)):c.clicks===2&&(clearTimeout(h.dblClickTimeOut),c.clicks=0,h.lastClickPos.distanceTo(m)<=t.dblClickDistThreshold&&t.dblClickHandler({eventSource:t,pointerType:r.type,position:n(r.currentPos,t.element),shift:s.originalEvent.shiftKey,isTouchEvent:r.type==="touch",originalEvent:s.originalEvent,userData:t.userData}),h.lastClickPos=null)))):c.contacts===2&&t.pinchHandler&&r.type==="touch"&&(h.pinchGPoints=c.asArray(),h.lastPinchDist=h.currentPinchDist=h.pinchGPoints[0].currentPos.distanceTo(h.pinchGPoints[1].currentPos),h.lastPinchCenter=h.currentPinchCenter=d(h.pinchGPoints[0].currentPos,h.pinchGPoints[1].currentPos))):(s.shouldReleaseCapture=!1,t.releaseHandler&&m&&(t.releaseHandler({eventSource:t,pointerType:r.type,position:n(m,t.element),buttons:c.buttons,insideElementPressed:r.insideElementPressed,insideElementReleased:r.insideElement,isTouchEvent:r.type==="touch",originalEvent:s.originalEvent,userData:t.userData}),s.preventDefault=!0)))}function b(e,t,s){var i,c,l,a=o[e.hash],r=e.getActivePointersListByType(s.type);if(typeof t.originalEvent.buttons<"u"&&(r.buttons=t.originalEvent.buttons),i=r.getById(s.id),i)i.lastPos=i.currentPos,i.lastTime=i.currentTime,i.currentPos=s.currentPos,i.currentTime=s.currentTime;else return;t.shouldCapture=!1,t.shouldReleaseCapture=!1,e.stopHandler&&s.type==="mouse"&&(clearTimeout(e.stopTimeOut),e.stopTimeOut=setTimeout(function(){ce(e,t.originalEvent,s.type)},e.stopDelay)),r.contacts===0?e.moveHandler&&e.moveHandler({eventSource:e,pointerType:s.type,position:n(s.currentPos,e.element),buttons:r.buttons,isTouchEvent:s.type==="touch",originalEvent:t.originalEvent,userData:e.userData}):r.contacts===1?(e.moveHandler&&(i=r.asArray()[0],e.moveHandler({eventSource:e,pointerType:i.type,position:n(i.currentPos,e.element),buttons:r.buttons,isTouchEvent:i.type==="touch",originalEvent:t.originalEvent,userData:e.userData})),e.dragHandler&&!t.preventGesture&&!t.defaultPrevented&&(i=r.asArray()[0],l=i.currentPos.minus(i.lastPos),e.dragHandler({eventSource:e,pointerType:i.type,position:n(i.currentPos,e.element),buttons:r.buttons,delta:l,speed:i.speed,direction:i.direction,shift:t.originalEvent.shiftKey,isTouchEvent:i.type==="touch",originalEvent:t.originalEvent,userData:e.userData}),t.preventDefault=!0,a.sentDragEvent=!0)):r.contacts===2&&(e.moveHandler&&(c=r.asArray(),e.moveHandler({eventSource:e,pointerType:c[0].type,position:n(d(c[0].currentPos,c[1].currentPos),e.element),buttons:r.buttons,isTouchEvent:c[0].type==="touch",originalEvent:t.originalEvent,userData:e.userData})),e.pinchHandler&&s.type==="touch"&&!t.preventGesture&&!t.defaultPrevented&&(l=a.pinchGPoints[0].currentPos.distanceTo(a.pinchGPoints[1].currentPos),l!==a.currentPinchDist&&(a.lastPinchDist=a.currentPinchDist,a.currentPinchDist=l,a.lastPinchCenter=a.currentPinchCenter,a.currentPinchCenter=d(a.pinchGPoints[0].currentPos,a.pinchGPoints[1].currentPos),e.pinchHandler({eventSource:e,pointerType:"touch",gesturePoints:a.pinchGPoints,lastCenter:n(a.lastPinchCenter,e.element),center:n(a.currentPinchCenter,e.element),lastDistance:a.lastPinchDist,distance:a.currentPinchDist,shift:t.originalEvent.shiftKey,originalEvent:t.originalEvent,userData:e.userData}),t.preventDefault=!0)))}function v(e,t,n){var s=e.getActivePointersListByType(n.type),o=s.getById(n.id);o&&l(e,s,o)}function ce(e,t,n){e.stopHandler&&e.stopHandler({eventSource:e,pointerType:n,position:z(t,e.element),buttons:e.getActivePointersListByType(n).buttons,isTouchEvent:n==="touch",originalEvent:t,userData:e.userData})}}(t),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(t,n,s){var o=t.parentNode;typeof n=="number"&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),n={anchor:n}),n.attachToViewer=typeof n.attachToViewer>"u"||n.attachToViewer,this.autoFade=typeof n.autoFade>"u"||n.autoFade,this.element=t,this.anchor=n.anchor,this.container=s,this.anchor===e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof n.top=="number"?n.top+"px":n.top,this.wrapper.style.left=typeof n.left=="number"?n.left+"px":n.left,this.wrapper.style.height=typeof n.height=="number"?n.height+"px":n.height,this.wrapper.style.width=typeof n.width=="number"?n.width+"px":n.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),n.attachToViewer?this.anchor===e.ControlAnchor.TOP_RIGHT||this.anchor===e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):o.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==e.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!=="none"},setVisible:function(t){this.wrapper.style.display=t?this.anchor===e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(t){e.setElementOpacity(this.wrapper,t,!0)}}}(t),function(e){e.ControlDock=function(t){var n,s,o=["topleft","topright","bottomright","bottomleft"];for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(Math.random()*1e6),container:e.makeNeutralElement("div"),controls:[]},t),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),e.getElementStyle(this.element).position==="static"&&(this.element.style.position="relative"),this.container.style.width="100%",this.container.style.height="100%"),s=0;s<o.length;s++)n=o[s],this.controls[n]=e.makeNeutralElement("div"),this.controls[n].style.position="absolute",n.match("left")&&(this.controls[n].style.left="0px"),n.match("right")&&(this.controls[n].style.right="0px"),n.match("top")&&(this.controls[n].style.top="0px"),n.match("bottom")&&(this.controls[n].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(n,s){n=e.getElement(n);var o=null;if(!(t(this,n)>=0)){switch(s.anchor){case e.ControlAnchor.TOP_RIGHT:o=this.controls.topright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:o=this.controls.bottomright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:o=this.controls.bottomleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:o=this.controls.topleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingTop="0px";break;case e.ControlAnchor.ABSOLUTE:o=this.container,n.style.margin="0px",n.style.padding="0px";break;default:case e.ControlAnchor.NONE:o=this.container,n.style.margin="0px",n.style.padding="0px";break}this.controls.push(new e.Control(n,s,o)),n.style.display="inline-block"}},removeControl:function(n){n=e.getElement(n);var s=t(this,n);return s>=0&&(this.controls[s].destroy(),this.controls.splice(s,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var e;for(e=this.controls.length-1;e>=0;e--)if(this.controls[e].isVisible())return!0;return!1},setControlsEnabled:function(e){var t;for(t=this.controls.length-1;t>=0;t--)this.controls[t].setVisible(e);return this}};function t(e,t){var n,s=e.controls;for(n=s.length-1;n>=0;n--)if(s[n].element===t)return n;return-1}}(t),function(e){e.Placement=e.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(t),function(e){var n={},V=1;e.Viewer=function(t){var a,i=arguments,s=this;e.isPlainObject(t)||(t={id:i[0],xmlPath:i.length>1?i[1]:0[0],prefixUrl:i.length>2?i[2]:0[0],controls:i.length>3?i[3]:0[0],overlays:i.length>4?i[4]:0[0]}),t.config&&(e.extend(!0,t,t.config),delete t.config);let d=["useCanvas"];if(t.drawerOptions=Object.assign({},d.reduce((e,n)=>(e[n]=t[n],delete t[n],e),{}),t.drawerOptions),e.extend(!0,this,{id:t.id,hash:t.hash||V++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttonGroup:null,profiler:null},e.DEFAULT_SETTINGS,t),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");typeof n[this.hash]<"u"&&e.console.warn("Hash "+this.hash+" has already been used."),n[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,needsResize:!1,forceResize:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null,lastClickTime:null,draggingToZoom:!1},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=e.now(),e.EventSource.call(this),this.addHandler("open-failed",function(t){var n=e.getString("Errors.OpenFailed",t.eventSource,t.message);s._showMessage(n)}),e.ControlDock.call(this,t),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(e){e.width="100%",e.height="100%",e.overflow="hidden",e.position="absolute",e.top="0px",e.left="0px"}(this.canvas.style),e.setElementTouchActionNone(this.canvas),t.tabIndex!==""&&(this.canvas.tabIndex=t.tabIndex===0[0]?0:t.tabIndex),this.container.className="openseadragon-container",function(e){e.width="100%",e.height="100%",e.position="relative",e.overflow="hidden",e.left="0px",e.top="0px",e.textAlign="left"}(this.container.style),e.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new e.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:e.delegate(this,z),keyDownHandler:e.delegate(this,T),keyHandler:e.delegate(this,E),clickHandler:e.delegate(this,D),dblClickHandler:e.delegate(this,j),dragHandler:e.delegate(this,y),dragEndHandler:e.delegate(this,_),enterHandler:e.delegate(this,w),leaveHandler:e.delegate(this,O),pressHandler:e.delegate(this,x),releaseHandler:e.delegate(this,C),nonPrimaryPressHandler:e.delegate(this,v),nonPrimaryReleaseHandler:e.delegate(this,k),scrollHandler:e.delegate(this,F),pinchHandler:e.delegate(this,A),focusHandler:e.delegate(this,S),blurHandler:e.delegate(this,M)}),this.outerTracker=new e.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:e.delegate(this,g),leaveHandler:e.delegate(this,p)}),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),n[this.hash].prevContainerSize=c(this.container),window.ResizeObserver?(this._autoResizePolling=!1,this._resizeObserver=new ResizeObserver(function(){n[s.hash].needsResize=!0}),this._resizeObserver.observe(this.container,{})):this._autoResizePolling=!0,this.world=new e.World({viewer:this}),this.world.addHandler("add-item",function(){s.source=s.world.getItemAt(0).source,n[s.hash].forceRedraw=!0,s._updateRequestId||(s._updateRequestId=l(s,u))}),this.world.addHandler("remove-item",function(){s.world.getItemCount()?s.source=s.world.getItemAt(0).source:s.source=null,n[s.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(){s.viewport&&s.viewport._setContentBounds(s.world.getHomeBounds(),s.world.getContentFactor())}),this.world.addHandler("item-index-change",function(){s.source=s.world.getItemAt(0).source}),this.viewport=new e.Viewport({containerSize:n[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,overlayPreserveContentDirection:this.overlayPreserveContentDirection,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins,silenceMultiImageWarnings:this.silenceMultiImageWarnings}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new e.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:t.timeout,tileRetryMax:this.tileRetryMax,tileRetryDelay:this.tileRetryDelay}),this.tileCache=new e.TileCache({maxImageCacheCount:this.maxImageCacheCount}),Object.prototype.hasOwnProperty.call(this.drawerOptions,"useCanvas")&&(e.console.error('useCanvas is deprecated, use the "drawer" option to indicate preferred drawer(s)'),this.drawerOptions.useCanvas||(this.drawer=e.HTMLDrawer),delete this.drawerOptions.useCanvas);let r=Array.isArray(this.drawer)?this.drawer:[this.drawer];r.length===0&&(r=[e.DEFAULT_SETTINGS.drawer].flat(),e.console.warn("No valid drawers were selected. Using the default value.")),this.drawer=null;for(const e of r)if(this.requestDrawer(e,{mainDrawer:!0,redrawImmediately:!1}))break;if(!this.drawer)throw e.console.error("No drawer could be created!"),"Error with creating the selected drawer(s)";for(this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),this.overlaysContainer=e.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(a=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(a,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(a=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(a,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new e.Navigator({element:this.navigatorElement,id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy,animationTime:this.animationTime,drawer:this.drawer.getType(),loadTilesWithAjax:this.loadTilesWithAjax,ajaxHeaders:this.ajaxHeaders,ajaxWithCredentials:this.ajaxWithCredentials})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),a=0;a<this.customControls.length;a++)this.addControl(this.customControls[a].id,{anchor:this.customControls[a].anchor});e.requestAnimationFrame(function(){o(s)}),e._viewers.set(this.element,this)},e.extend(e.Viewer.prototype,e.EventSource.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(t){return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(t)},openTileSource:function(t){return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(t)},get buttons(){return e.console.warn("Viewer.buttons is deprecated; Please use Viewer.buttonGroup"),this.buttonGroup},open:function(t,n){if(s=this,this.close(),!t)return this;if(this.sequenceMode&&e.isArray(t))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof n<"u"&&!isNaN(n)&&(this.initialPage=n),this.tileSources=t,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(e.isArray(t)||(t=[t]),!t.length)return this;this._opening=!0;for(var s,i,l=t.length,o=0,r=0,c=function(){if(o+r===l)if(o){(s._firstOpen||!s.preserveViewport)&&(s.viewport.goHome(!0),s.viewport.update()),s._firstOpen=!1;var e,n=t[0];if(n.tileSource&&(n=n.tileSource),s.overlays&&!s.preserveOverlays)for(e=0;e<s.overlays.length;e++)s.currentOverlays[e]=h(s,s.overlays[e]);s._drawOverlays(),s._opening=!1,s.raiseEvent("open",{source:n})}else s._opening=!1,s.raiseEvent("open-failed",i)},d=function(t){(!e.isPlainObject(t)||!t.tileSource)&&(t={tileSource:t}),t.index!==0[0]&&(e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete t.index),t.collectionImmediately===0[0]&&(t.collectionImmediately=!0);var n,a=t.success;t.success=function(e){if(o++,t.tileSource.overlays)for(var n=0;n<t.tileSource.overlays.length;n++)s.addOverlay(t.tileSource.overlays[n]);a&&a(e),c()},n=t.error,t.error=function(e){r++,i||(i=e),n&&n(e),c()},s.addTiledImage(t)},a=0;a<t.length;a++)d(t[a]);return this},close:function(){return n[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),n[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(n[this.hash]){if(this.raiseEvent("before-destroy"),this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this._resizeObserver&&this._resizeObserver.disconnect(),this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(e.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),n[this.navigator.hash]=null,delete n[this.navigator.hash],this.navigator=null),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),n[this.hash]=null,delete n[this.hash],this.canvas=null,this.container=null,e._viewers.delete(this.element),this.element=null,this.raiseEvent("destroy"),this.removeAllHandlers()}},requestDrawer(t,n){const a={mainDrawer:!0,redrawImmediately:!0,drawerOptions:null};n=e.extend(!0,a,n);const o=n.mainDrawer,r=n.redrawImmediately,c=n.drawerOptions,i=this.drawer;let s=null;if(t&&t.prototype instanceof e.DrawerBase?(s=t,t="custom"):typeof t=="string"&&(s=e.determineDrawer(t)),s||e.console.warn("Unsupported drawer! Drawer must be an existing string type, or a class that extends OpenSeadragon.DrawerBase."),s&&s.isSupported()){i&&o&&i.destroy();const e=new s({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor,options:c||this.drawerOptions[t]});return o&&(this.drawer=e,r&&this.forceRedraw()),e}return!1},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this.outerTracker.setTracking(e),this.raiseEvent("mouse-enabled",{enabled:e}),this},areControlsEnabled:function(){var e,t=this.controls.length;for(e=0;e<this.controls.length;e++)t=t&&this.controls[e].isVisible();return t},setControlsEnabled:function(e){return e?i(this):o(this),this.raiseEvent("controls-enabled",{enabled:e}),this},setDebugMode:function(e){for(var t=0;t<this.world.getItemCount();t++)this.world.getItemAt(t).debugMode=e;this.debugMode=e,this.forceRedraw()},setAjaxHeaders:function(t,n){if(t===null&&(t={}),!e.isPlainObject(t)){console.error("[Viewer.setAjaxHeaders] Ignoring invalid headers, must be a plain object");return}if(n===0[0]&&(n=!0),this.ajaxHeaders=t,n){for(var o,s=0;s<this.world.getItemCount();s++)this.world.getItemAt(s)._updateAjaxHeaders(!0);if(this.navigator&&this.navigator.setAjaxHeaders(this.ajaxHeaders,!0),this.referenceStrip&&this.referenceStrip.miniViewers)for(o in this.referenceStrip.miniViewers)this.referenceStrip.miniViewers[o].setAjaxHeaders(this.ajaxHeaders,!0)}},addButton:function(e){this.buttonGroup.addButton(e)},isFullPage:function(){return n[this.hash]&&n[this.hash].fullPage},setFullPage:function(t){var a,r,l,d,u,i=document.body,s=i.style,o=document.documentElement.style,c=this;if(t===this.isFullPage())return this;if(l={fullPage:t,preventDefaultAction:!1},this.raiseEvent("pre-full-page",l),l.preventDefaultAction)return this;if(t&&this.element){for(this.elementSize=e.getElementSize(this.element),this.pageScroll=e.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=s.margin,this.docMargin=o.margin,s.margin="0",o.margin="0",this.bodyPadding=s.padding,this.docPadding=o.padding,s.padding="0",o.padding="0",this.bodyWidth=s.width,this.docWidth=o.width,s.width="100%",o.width="100%",this.bodyHeight=s.height,this.docHeight=o.height,s.height="100%",o.height="100%",this.bodyDisplay=s.display,s.display="block",this.previousBody=[],n[this.hash].prevElementParent=this.element.parentNode,n[this.hash].prevNextSibling=this.element.nextSibling,n[this.hash].prevElementWidth=this.element.style.width,n[this.hash].prevElementHeight=this.element.style.height,r=i.childNodes.length,a=0;a<r;a++)this.previousBody.push(i.childNodes[0]),i.removeChild(i.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,i.appendChild(this.toolbar.element),e.addClass(this.toolbar.element,"fullpage")),e.addClass(this.element,"fullpage"),i.appendChild(this.element),this.element.style.height="100vh",this.element.style.width="100vw",this.toolbar&&this.toolbar.element&&(this.element.style.height=e.getElementSize(this.element).y-e.getElementSize(this.toolbar.element).y+"px"),n[this.hash].fullPage=!0,e.delegate(this,g)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,s.margin=this.bodyMargin,o.margin=this.docMargin,s.padding=this.bodyPadding,o.padding=this.docPadding,s.width=this.bodyWidth,o.width=this.docWidth,s.height=this.bodyHeight,o.height=this.docHeight,s.display=this.bodyDisplay,i.removeChild(this.element),r=this.previousBody.length,a=0;a<r;a++)i.appendChild(this.previousBody.shift());e.removeClass(this.element,"fullpage"),n[this.hash].prevElementParent.insertBefore(this.element,n[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(i.removeChild(this.toolbar.element),e.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=n[this.hash].prevElementWidth,this.element.style.height=n[this.hash].prevElementHeight,d=0,u=function(){e.setPageScroll(c.pageScroll);var t=e.getPageScroll();d++,d<10&&(t.x!==c.pageScroll.x||t.y!==c.pageScroll.y)&&e.requestAnimationFrame(u)},e.requestAnimationFrame(u),n[this.hash].fullPage=!1,e.delegate(this,p)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:t}),this},setFullScreen:function(t){var s,o,n=this;if(!e.supportsFullScreen)return this.setFullPage(t);if(e.isFullScreen()===t)return this;if(o={fullScreen:t,preventDefaultAction:!1},this.raiseEvent("pre-full-screen",o),o.preventDefaultAction)return this;if(t){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%",s=function(){var t=e.isFullScreen();t||(e.removeEvent(document,e.fullScreenEventName,s),e.removeEvent(document,e.fullScreenErrorEventName,s),n.setFullPage(!1),n.isFullPage()&&(n.element.style.width=n.fullPageStyleWidth,n.element.style.height=n.fullPageStyleHeight)),n.navigator&&n.viewport&&setTimeout(function(){n.navigator.update(n.viewport)}),n.raiseEvent("full-screen",{fullScreen:t})},e.addEvent(document,e.fullScreenEventName,s),e.addEvent(document,e.fullScreenErrorEventName,s),e.requestFullScreen(document.body)}else e.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!=="hidden"},isFullScreen:function(){return e.isFullScreen()&&this.isFullPage()},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this.raiseEvent("visible",{visible:e}),this},addTiledImage:function(t){e.console.assert(t,"[Viewer.addTiledImage] options is required"),e.console.assert(t.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),e.console.assert(!t.replace||t.index>-1&&t.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var s,n=this;t.replace&&(t.replaceItem=n.world.getItemAt(t.index)),this._hideMessage(),t.placeholderFillStyle===0[0]&&(t.placeholderFillStyle=this.placeholderFillStyle),t.opacity===0[0]&&(t.opacity=this.opacity),t.preload===0[0]&&(t.preload=this.preload),t.compositeOperation===0[0]&&(t.compositeOperation=this.compositeOperation),t.crossOriginPolicy===0[0]&&(t.crossOriginPolicy=t.tileSource.crossOriginPolicy!==0[0]?t.tileSource.crossOriginPolicy:this.crossOriginPolicy),t.ajaxWithCredentials===0[0]&&(t.ajaxWithCredentials=this.ajaxWithCredentials),t.loadTilesWithAjax===0[0]&&(t.loadTilesWithAjax=this.loadTilesWithAjax),e.isPlainObject(t.ajaxHeaders)||(t.ajaxHeaders={}),s={options:t};function o(e){for(var o=0;o<n._loadQueue.length;o++)if(n._loadQueue[o]===s){n._loadQueue.splice(o,1);break}n._loadQueue.length===0&&i(s),n.raiseEvent("add-item-failed",e),t.error&&t.error(e)}function i(e){n.collectionMode&&(n.world.arrange({immediately:e.options.collectionImmediately,rows:n.collectionRows,columns:n.collectionColumns,layout:n.collectionLayout,tileSize:n.collectionTileSize,tileMargin:n.collectionTileMargin}),n.world.setAutoRefigureSizes(!0))}if(e.isArray(t.tileSource)){setTimeout(function(){o({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:t.tileSource,options:t})});return}this._loadQueue.push(s);function a(){for(;n._loadQueue.length&&(t=n._loadQueue[0],!!t.tileSource);){if(n._loadQueue.splice(0,1),t.options.replace){var t,s,o,a=n.world.getIndexOfItem(t.options.replaceItem);a!==-1&&(t.options.index=a),n.world.removeItem(t.options.replaceItem)}s=new e.TiledImage({viewer:n,source:t.tileSource,viewport:n.viewport,drawer:n.drawer,tileCache:n.tileCache,imageLoader:n.imageLoader,x:t.options.x,y:t.options.y,width:t.options.width,height:t.options.height,fitBounds:t.options.fitBounds,fitBoundsPlacement:t.options.fitBoundsPlacement,clip:t.options.clip,placeholderFillStyle:t.options.placeholderFillStyle,opacity:t.options.opacity,preload:t.options.preload,degrees:t.options.degrees,flipped:t.options.flipped,compositeOperation:t.options.compositeOperation,springStiffness:n.springStiffness,animationTime:n.animationTime,minZoomImageRatio:n.minZoomImageRatio,wrapHorizontal:n.wrapHorizontal,wrapVertical:n.wrapVertical,maxTilesPerFrame:n.maxTilesPerFrame,immediateRender:n.immediateRender,blendTime:n.blendTime,alwaysBlend:n.alwaysBlend,minPixelRatio:n.minPixelRatio,smoothTileEdgesMinZoom:n.smoothTileEdgesMinZoom,iOSDevice:n.iOSDevice,crossOriginPolicy:t.options.crossOriginPolicy,ajaxWithCredentials:t.options.ajaxWithCredentials,loadTilesWithAjax:t.options.loadTilesWithAjax,ajaxHeaders:t.options.ajaxHeaders,debugMode:n.debugMode,subPixelRoundingForTransparency:n.subPixelRoundingForTransparency}),n.collectionMode&&n.world.setAutoRefigureSizes(!1),n.navigator&&(o=e.extend({},t.options,{replace:!1,originalTiledImage:s,tileSource:t.tileSource}),n.navigator.addTiledImage(o)),n.world.addItem(s,{index:t.options.index}),n._loadQueue.length===0&&i(t),n.world.getItemCount()===1&&!n.preserveViewport&&n.viewport.goHome(!0),t.options.success&&t.options.success({item:s})}}P(this,t.tileSource,t,function(e){s.tileSource=e,a()},function(e){e.options=t,o(e),a()})},addSimpleImage:function(t){e.console.assert(t,"[Viewer.addSimpleImage] options is required"),e.console.assert(t.url,"[Viewer.addSimpleImage] options.url is required");var n=e.extend({},t,{tileSource:{type:"image",url:t.url}});delete n.url,this.addTiledImage(n)},addLayer:function(t){var s,n=this;return e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead."),s=e.extend({},t,{success:function(e){n.raiseEvent("add-layer",{options:t,drawer:e.item})},error:function(e){n.raiseEvent("add-layer-failed",e)}}),this.addTiledImage(s),this},getLayerAtLevel:function(t){return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(t)},getLevelOfLayer:function(t){return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(t)},getLayersCount:function(){return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(t,n){return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(t,n)},removeLayer:function(t){return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(t)},forceRedraw:function(){return n[this.hash].forceRedraw=!0,this},forceResize:function(){n[this.hash].needsResize=!0,n[this.hash].forceResize=!0},bindSequenceControls:function(){var n=e.delegate(this,m),o=e.delegate(this,f),a=e.delegate(this,this.goToNextPage),r=e.delegate(this,this.goToPreviousPage),t=this.navImages,i=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(i=!1),this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:s(this.prefixUrl,t.previous.REST),srcGroup:s(this.prefixUrl,t.previous.GROUP),srcHover:s(this.prefixUrl,t.previous.HOVER),srcDown:s(this.prefixUrl,t.previous.DOWN),onRelease:r,onFocus:n,onBlur:o}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:s(this.prefixUrl,t.next.REST),srcGroup:s(this.prefixUrl,t.next.GROUP),srcHover:s(this.prefixUrl,t.next.HOVER),srcDown:s(this.prefixUrl,t.next.DOWN),onRelease:a,onFocus:n,onBlur:o}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),i&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var l=e.delegate(this,H),a=e.delegate(this,B),b=e.delegate(this,W),c=e.delegate(this,I),v=e.delegate(this,U),g=e.delegate(this,q),d=e.delegate(this,Y),p=e.delegate(this,G),h=e.delegate(this,X),u=e.delegate(this,Q),o=e.delegate(this,m),i=e.delegate(this,f),t=this.navImages,n=[],r=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(r=!1),this.showZoomControl&&(n.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:s(this.prefixUrl,t.zoomIn.REST),srcGroup:s(this.prefixUrl,t.zoomIn.GROUP),srcHover:s(this.prefixUrl,t.zoomIn.HOVER),srcDown:s(this.prefixUrl,t.zoomIn.DOWN),onPress:l,onRelease:a,onClick:b,onEnter:l,onExit:a,onFocus:o,onBlur:i})),n.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:s(this.prefixUrl,t.zoomOut.REST),srcGroup:s(this.prefixUrl,t.zoomOut.GROUP),srcHover:s(this.prefixUrl,t.zoomOut.HOVER),srcDown:s(this.prefixUrl,t.zoomOut.DOWN),onPress:c,onRelease:a,onClick:v,onEnter:c,onExit:a,onFocus:o,onBlur:i}))),this.showHomeControl&&n.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:s(this.prefixUrl,t.home.REST),srcGroup:s(this.prefixUrl,t.home.GROUP),srcHover:s(this.prefixUrl,t.home.HOVER),srcDown:s(this.prefixUrl,t.home.DOWN),onRelease:g,onFocus:o,onBlur:i})),this.showFullPageControl&&n.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:s(this.prefixUrl,t.fullpage.REST),srcGroup:s(this.prefixUrl,t.fullpage.GROUP),srcHover:s(this.prefixUrl,t.fullpage.HOVER),srcDown:s(this.prefixUrl,t.fullpage.DOWN),onRelease:d,onFocus:o,onBlur:i})),this.showRotationControl&&(n.push(this.rotateLeftButton=new e.Button({element:this.rotateLeftButton?e.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateLeft"),srcRest:s(this.prefixUrl,t.rotateleft.REST),srcGroup:s(this.prefixUrl,t.rotateleft.GROUP),srcHover:s(this.prefixUrl,t.rotateleft.HOVER),srcDown:s(this.prefixUrl,t.rotateleft.DOWN),onRelease:p,onFocus:o,onBlur:i})),n.push(this.rotateRightButton=new e.Button({element:this.rotateRightButton?e.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateRight"),srcRest:s(this.prefixUrl,t.rotateright.REST),srcGroup:s(this.prefixUrl,t.rotateright.GROUP),srcHover:s(this.prefixUrl,t.rotateright.HOVER),srcDown:s(this.prefixUrl,t.rotateright.DOWN),onRelease:h,onFocus:o,onBlur:i}))),this.showFlipControl&&n.push(this.flipButton=new e.Button({element:this.flipButton?e.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Flip"),srcRest:s(this.prefixUrl,t.flip.REST),srcGroup:s(this.prefixUrl,t.flip.GROUP),srcHover:s(this.prefixUrl,t.flip.HOVER),srcDown:s(this.prefixUrl,t.flip.DOWN),onRelease:u,onFocus:o,onBlur:i})),r?(this.buttonGroup=new e.ButtonGroup({buttons:n,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",e.delegate(this,K)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT})):this.customButtons=n),this},currentPage:function(){return this._sequenceIndex},goToPage:function(e){return this.tileSources&&e>=0&&e<this.tileSources.length&&(this._sequenceIndex=e,this._updateSequenceButtons(e),this.open(this.tileSources[e]),this.referenceStrip&&this.referenceStrip.setFocus(e),this.raiseEvent("page",{page:e})),this},addOverlay:function(t,n,s,o){if(e.isPlainObject(t)?i=t:i={element:t,location:n,placement:s,onDraw:o},t=e.getElement(i.element),a(this.currentOverlays,t)>=0)return this;var i,r=h(this,i);return this.currentOverlays.push(r),r.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:t,location:i.location,placement:i.placement}),this},updateOverlay:function(t,s,o){var i;return t=e.getElement(t),i=a(this.currentOverlays,t),i>=0&&(this.currentOverlays[i].update(s,o),n[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:t,location:s,placement:o})),this},removeOverlay:function(t){var s;return t=e.getElement(t),s=a(this.currentOverlays,t),s>=0&&(this.currentOverlays[s].destroy(),this.currentOverlays.splice(s,1),n[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:t})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return n[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(t){var n;return t=e.getElement(t),n=a(this.currentOverlays,t),n>=0?this.currentOverlays[n]:null},_updateSequenceButtons:function(e){this.nextButton&&(!this.tileSources||this.tileSources.length-1===e?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(e>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(t){this._hideMessage();var n=e.makeNeutralElement("div");n.appendChild(document.createTextNode(t)),this.messageDiv=e.makeCenteredNode(n),e.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var e=this.messageDiv;e&&(e.parentNode.removeChild(e),delete this.messageDiv)},gestureSettingsByDeviceType:function(e){switch(e){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var e,t=this.currentOverlays.length;for(e=0;e<t;e++)this.currentOverlays[e].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new e.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),e.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){e.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var n=e.pixelDensityRatio,t=e.getCurrentPixelDensityRatio();n!==t&&(e.pixelDensityRatio=t,this.forceResize())},goToPreviousPage:function(){var e=this._sequenceIndex-1;this.navPrevNextWrap&&e<0&&(e+=this.tileSources.length),this.goToPage(e)},goToNextPage:function(){var e=this._sequenceIndex+1;this.navPrevNextWrap&&e>=this.tileSources.length&&(e=0),this.goToPage(e)},isAnimating:function(){return n[this.hash].animating}});function c(t){return t=e.getElement(t),new e.Point(t.clientWidth===0?1:t.clientWidth,t.clientHeight===0?1:t.clientHeight)}function P(t,n,s,o,i){var r,a=t;if(e.type(n)==="string")if(n.match(/^\s*<.*>\s*$/))n=e.parseXml(n);else if(n.match(/^\s*[{[].*[}\]]\s*$/))try{r=e.parseJSON(n),n=r}catch{}function c(e,t){e.ready?o(e):(e.addHandler("ready",function(){o(e)}),e.addHandler("open-failed",function(e){i({message:e.message,source:t})}))}setTimeout(function(){if(e.type(n)==="string")n=new e.TileSource({url:n,crossOriginPolicy:s.crossOriginPolicy!==0[0]?s.crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,ajaxHeaders:s.ajaxHeaders?s.ajaxHeaders:t.ajaxHeaders,splitHashDataForPost:t.splitHashDataForPost,success:function(e){o(e.tileSource)}}),n.addHandler("open-failed",function(e){i(e)});else if(e.isPlainObject(n)||n.nodeType)if(n.crossOriginPolicy===0[0]&&(s.crossOriginPolicy!==0[0]||t.crossOriginPolicy!==0[0])&&(n.crossOriginPolicy=s.crossOriginPolicy!==0[0]?s.crossOriginPolicy:t.crossOriginPolicy),n.ajaxWithCredentials===0[0]&&(n.ajaxWithCredentials=t.ajaxWithCredentials),e.isFunction(n.getTileUrl)){var r,d,l=new e.TileSource(n);l.getTileUrl=n.getTileUrl,o(l)}else{if(r=e.TileSource.determineType(a,n),!r){i({message:"Unable to load TileSource",source:n});return}d=r.prototype.configure.apply(a,[n]),c(new r(d),n)}else c(n,n)})}function h(t,n){if(n instanceof e.Overlay)return n;s=null,n.element?s=e.getElement(n.element):(c=n.id?n.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7),s=e.getElement(n.id),s||(s=document.createElement("a"),s.href="#/overlay/"+c),s.id=c,e.addClass(s,n.className?n.className:"openseadragon-overlay"));var s,o,i,c,d,u,l=n.location,a=n.width,r=n.height;return l||(d=n.x,u=n.y,n.px!==0[0]&&(o=t.viewport.imageToViewportRectangle(new e.Rect(n.px,n.py,a||0,r||0)),d=o.x,u=o.y,a=a!==0[0]?o.width:0[0],r=r!==0[0]?o.height:0[0]),l=new e.Point(d,u)),i=n.placement,i&&e.type(i)==="string"&&(i=e.Placement[n.placement.toUpperCase()]),new e.Overlay({element:s,location:l,placement:i,onDraw:n.onDraw,checkResize:n.checkResize,width:a,height:r,rotationMode:n.rotationMode})}function a(e,t){var n;for(n=e.length-1;n>=0;n--)if(e[n].element===t)return n;return-1}function l(t,n){return e.requestAnimationFrame(function(){n(t)})}function d(t){e.requestAnimationFrame(function(){b(t)})}function o(t){t.autoHideControls&&(t.controlsShouldFade=!0,t.controlsFadeBeginTime=e.now()+t.controlsFadeDelay,window.setTimeout(function(){d(t)},t.controlsFadeDelay))}function b(t){var n,s,o,i;if(t.controlsShouldFade){for(o=e.now(),i=o-t.controlsFadeBeginTime,n=1-i/t.controlsFadeLength,n=Math.min(1,n),n=Math.max(0,n),s=t.controls.length-1;s>=0;s--)t.controls[s].autoFade&&t.controls[s].setOpacity(n);n>0&&d(t)}}function i(e){var t;for(e.controlsShouldFade=!1,t=e.controls.length-1;t>=0;t--)e.controls[t].setOpacity(1)}function m(){i(this)}function f(){o(this)}function z(e){var t={tracker:e.eventSource,position:e.position,originalEvent:e.originalEvent,preventDefault:e.preventDefault};this.raiseEvent("canvas-contextmenu",t),e.preventDefault=t.preventDefault}function T(t){var n={originalEvent:t.originalEvent,preventDefaultAction:!1,preventVerticalPan:t.preventVerticalPan||!this.panVertical,preventHorizontalPan:t.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",n),!n.preventDefaultAction&&!t.ctrl&&!t.alt&&!t.meta)switch(t.keyCode){case 38:n.preventVerticalPan||(t.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 40:n.preventVerticalPan||(t.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 37:n.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 39:n.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 187:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),t.preventDefault=!0;break;case 189:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),t.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),t.preventDefault=!0;break;case 87:n.preventVerticalPan||(t.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-40))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 83:n.preventVerticalPan||(t.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,40))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 65:n.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40,0))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 68:n.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40,0))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 82:t.shift?this.viewport.flipped?this.viewport.setRotation(this.viewport.getRotation()+this.rotationIncrement):this.viewport.setRotation(this.viewport.getRotation()-this.rotationIncrement):this.viewport.flipped?this.viewport.setRotation(this.viewport.getRotation()-this.rotationIncrement):this.viewport.setRotation(this.viewport.getRotation()+this.rotationIncrement),this.viewport.applyConstraints(),t.preventDefault=!0;break;case 70:this.viewport.toggleFlip(),t.preventDefault=!0;break;case 74:this.goToPreviousPage();break;case 75:this.goToNextPage();break;default:t.preventDefault=!1;break}else t.preventDefault=!1}function E(e){var t={originalEvent:e.originalEvent};this.raiseEvent("canvas-key-press",t)}function D(t){var s,o,i=document.activeElement===this.canvas;i||this.canvas.focus(),this.viewport.flipped&&(t.position.x=this.viewport.getContainerSize().x-t.position.x),o={tracker:t.eventSource,position:t.position,quick:t.quick,shift:t.shift,originalEvent:t.originalEvent,originalTarget:t.originalTarget,preventDefaultAction:!1},this.raiseEvent("canvas-click",o),!o.preventDefaultAction&&this.viewport&&t.quick&&(s=this.gestureSettingsByDeviceType(t.pointerType),s.clickToZoom===!0&&(this.viewport.zoomBy(t.shift?1/this.zoomPerClick:this.zoomPerClick,s.zoomToRefPoint?this.viewport.pointFromPixel(t.position,!0):null),this.viewport.applyConstraints()),s.dblClickDragToZoom&&(n[this.hash].draggingToZoom===!0?(n[this.hash].lastClickTime=null,n[this.hash].draggingToZoom=!1):n[this.hash].lastClickTime=e.now()))}function j(e){var t,n={tracker:e.eventSource,position:e.position,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",n),!n.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType),t.dblClickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints()))}function y(e){var t,s,o,a,i={tracker:e.eventSource,pointerType:e.pointerType,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-drag",i),s=this.gestureSettingsByDeviceType(e.pointerType),!i.preventDefaultAction&&this.viewport&&(s.dblClickDragToZoom&&n[this.hash].draggingToZoom?(a=this.zoomPerDblClickDrag**(e.delta.y/50),this.viewport.zoomBy(a)):s.dragToPan&&!n[this.hash].draggingToZoom&&((this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewport.flipped&&(e.delta.x=-e.delta.x),this.constrainDuringPan)&&(t=this.viewport.deltaPointsFromPixels(e.delta.negate()),this.viewport.centerSpringX.target.value+=t.x,this.viewport.centerSpringY.target.value+=t.y,o=this.viewport.getConstrainedBounds(),this.viewport.centerSpringX.target.value-=t.x,this.viewport.centerSpringY.target.value-=t.y,o.xConstrained&&(e.delta.x=0),o.yConstrained&&(e.delta.y=0)),this.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta.negate()),s.flickEnabled&&!this.constrainDuringPan)))}function _(t){if(o={tracker:t.eventSource,pointerType:t.pointerType,position:t.position,speed:t.speed,direction:t.direction,shift:t.shift,originalEvent:t.originalEvent,preventDefaultAction:!1},this.raiseEvent("canvas-drag-end",o),s=this.gestureSettingsByDeviceType(t.pointerType),!o.preventDefaultAction&&this.viewport){if(!n[this.hash].draggingToZoom&&s.dragToPan&&s.flickEnabled&&t.speed>=s.flickMinSpeed){i=0,this.panHorizontal&&(i=s.flickMomentum*t.speed*Math.cos(t.direction)),a=0,this.panVertical&&(a=s.flickMomentum*t.speed*Math.sin(t.direction));var s,o,i,a,r=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),c=this.viewport.pointFromPixel(new e.Point(r.x-i,r.y-a));this.viewport.panTo(c,!1)}this.viewport.applyConstraints()}s.dblClickDragToZoom&&n[this.hash].draggingToZoom===!0&&(n[this.hash].draggingToZoom=!1)}function w(e){this.raiseEvent("canvas-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function O(e){this.raiseEvent("canvas-exit",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function x(t){if(this.raiseEvent("canvas-press",{tracker:t.eventSource,pointerType:t.pointerType,position:t.position,insideElementPressed:t.insideElementPressed,insideElementReleased:t.insideElementReleased,originalEvent:t.originalEvent}),s=this.gestureSettingsByDeviceType(t.pointerType),s.dblClickDragToZoom){var s,o=n[this.hash].lastClickTime,i=e.now();if(o===null)return;i-o<this.dblClickTimeThreshold&&(n[this.hash].draggingToZoom=!0),n[this.hash].lastClickTime=null}}function C(e){this.raiseEvent("canvas-release",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function v(e){this.raiseEvent("canvas-nonprimary-press",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function k(e){this.raiseEvent("canvas-nonprimary-release",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function A(e){if(t={tracker:e.eventSource,pointerType:e.pointerType,gesturePoints:e.gesturePoints,lastCenter:e.lastCenter,center:e.center,lastDistance:e.lastDistance,distance:e.distance,shift:e.shift,originalEvent:e.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1},this.raiseEvent("canvas-pinch",t),this.viewport&&(s=this.gestureSettingsByDeviceType(e.pointerType),s.pinchToZoom&&(!t.preventDefaultPanAction||!t.preventDefaultZoomAction)&&(n=this.viewport.pointFromPixel(e.center,!0),s.zoomToRefPoint&&!t.preventDefaultPanAction&&(i=this.viewport.pointFromPixel(e.lastCenter,!0),o=i.minus(n),this.panHorizontal||(o.x=0),this.panVertical||(o.y=0),this.viewport.panBy(o,!0)),t.preventDefaultZoomAction||this.viewport.zoomBy(e.distance/e.lastDistance,n,!0),this.viewport.applyConstraints()),s.pinchRotate&&!t.preventDefaultRotateAction)){var t,n,s,o,i,a=Math.atan2(e.gesturePoints[0].currentPos.y-e.gesturePoints[1].currentPos.y,e.gesturePoints[0].currentPos.x-e.gesturePoints[1].currentPos.x),r=Math.atan2(e.gesturePoints[0].lastPos.y-e.gesturePoints[1].lastPos.y,e.gesturePoints[0].lastPos.x-e.gesturePoints[1].lastPos.x);n=this.viewport.pointFromPixel(e.center,!0),this.viewport.rotateTo(this.viewport.getRotation(!0)+(a-r)*(180/Math.PI),n,!0)}}function S(e){this.raiseEvent("canvas-focus",{tracker:e.eventSource,originalEvent:e.originalEvent})}function M(e){this.raiseEvent("canvas-blur",{tracker:e.eventSource,originalEvent:e.originalEvent})}function F(t){var n,s,o,i=e.now(),a=i-this._lastScrollTime;a>this.minScrollDeltaTime?(this._lastScrollTime=i,n={tracker:t.eventSource,position:t.position,scroll:t.scroll,shift:t.shift,originalEvent:t.originalEvent,preventDefaultAction:!1,preventDefault:!0},this.raiseEvent("canvas-scroll",n),!n.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(t.position.x=this.viewport.getContainerSize().x-t.position.x),s=this.gestureSettingsByDeviceType(t.pointerType),s.scrollToZoom&&(o=this.zoomPerScroll**t.scroll,this.viewport.zoomBy(o,s.zoomToRefPoint?this.viewport.pointFromPixel(t.position,!0):null),this.viewport.applyConstraints())),t.preventDefault=n.preventDefault):t.preventDefault=!0}function g(e){n[this.hash].mouseInside=!0,i(this),this.raiseEvent("container-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function p(e){e.pointers<1&&(n[this.hash].mouseInside=!1,n[this.hash].animating||o(this)),this.raiseEvent("container-exit",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function u(e){L(e),e.isOpen()?e._updateRequestId=l(e,u):e._updateRequestId=!1}function N(t,s){var i,o=t.viewport,r=o.getZoom(),c=o.getCenter();if(o.resize(s,t.preserveImageSizeOnResize),o.panTo(c,!0),t.preserveImageSizeOnResize)i=n[t.hash].prevContainerSize.x/s.x;else{var a=new e.Point(0,0),l=new e.Point(n[t.hash].prevContainerSize.x,n[t.hash].prevContainerSize.y).distanceTo(a),d=new e.Point(s.x,s.y).distanceTo(a);i=d/l*n[t.hash].prevContainerSize.x/s.x}o.zoomTo(r*i,null,!0),n[t.hash].prevContainerSize=s,n[t.hash].forceRedraw=!0,n[t.hash].needsResize=!1,n[t.hash].forceResize=!1}function L(e){if(!e._opening&&!!n[e.hash]){(e.autoResize||n[e.hash].forceResize)&&(e._autoResizePolling&&(a=c(e.container),d=n[e.hash].prevContainerSize,a.equals(d)||(n[e.hash].needsResize=!0)),n[e.hash].needsResize&&N(e,a||c(e.container)));var s,a,l,d,r=e.viewport.update(),t=e.world.update(r)||r;r&&e.raiseEvent("viewport-change"),e.referenceStrip&&(t=e.referenceStrip.update(e.viewport)||t),l=n[e.hash].animating,!l&&t&&(e.raiseEvent("animation-start"),i(e)),s=l&&!t,s&&(n[e.hash].animating=!1),(t||s||n[e.hash].forceRedraw||e.world.needsDraw())&&(R(e),e._drawOverlays(),e.navigator&&e.navigator.update(e.viewport),n[e.hash].forceRedraw=!1,t&&e.raiseEvent("animation")),s&&(e.raiseEvent("animation-finish"),n[e.hash].mouseInside||o(e)),n[e.hash].animating=t}}function R(e){e.imageLoader.clear(),e.world.draw(),e.raiseEvent("update-viewport",{})}function s(e,t){return e?e+t:t}function H(){n[this.hash].lastZoomTime=e.now(),n[this.hash].zoomFactor=this.zoomPerSecond,n[this.hash].zooming=!0,r(this)}function I(){n[this.hash].lastZoomTime=e.now(),n[this.hash].zoomFactor=1/this.zoomPerSecond,n[this.hash].zooming=!0,r(this)}function B(){n[this.hash].zooming=!1}function r(t){e.requestAnimationFrame(e.delegate(t,$))}function $(){var t,s,o;n[this.hash].zooming&&this.viewport&&(t=e.now(),s=t-n[this.hash].lastZoomTime,o=n[this.hash].zoomFactor**(s/1e3),this.viewport.zoomBy(o),this.viewport.applyConstraints(),n[this.hash].lastZoomTime=t,r(this))}function W(){this.viewport&&(n[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function U(){this.viewport&&(n[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function K(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function q(){this.viewport&&this.viewport.goHome()}function Y(){this.isFullPage()&&!e.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function G(){if(this.viewport){var e=this.viewport.getRotation();this.viewport.flipped?e+=this.rotationIncrement:e-=this.rotationIncrement,this.viewport.setRotation(e)}}function X(){if(this.viewport){var e=this.viewport.getRotation();this.viewport.flipped?e-=this.rotationIncrement:e+=this.rotationIncrement,this.viewport.setRotation(e)}}function Q(){this.viewport.toggleFlip()}e.determineDrawer=function(n){for(let i in t){const o=t[i],s=o.prototype;if(s&&s instanceof t.DrawerBase&&e.isFunction(s.getType)&&s.getType.call(o)===n)return o}return null}}(t),function(e){e.Navigator=function(n){var l,d,h,c=n.viewer,r=this;n.element||n.id?(n.element?(n.id&&e.console.warn("Given option.id for Navigator was ignored since option.element was provided and is being used instead."),n.element.id?n.id=n.element.id:n.id="navigator-"+e.now(),this.element=n.element):this.element=document.getElementById(n.id),n.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(n.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),n.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:n.autoFade},n.position&&(n.position==="BOTTOM_RIGHT"?n.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:n.position==="BOTTOM_LEFT"?n.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:n.position==="TOP_RIGHT"?n.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:n.position==="TOP_LEFT"?n.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:n.position==="ABSOLUTE"&&(n.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,n.controlOptions.top=n.top,n.controlOptions.left=n.left,n.controlOptions.height=n.height,n.controlOptions.width=n.width))),this.element.id=n.id,this.element.className+=" navigator",n=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},n,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:n.animationTime,autoResize:!1,minZoomImageRatio:1,background:n.background,opacity:n.opacity,borderColor:n.borderColor,displayRegionColor:n.displayRegionColor}),n.minPixelRatio=this.minPixelRatio=c.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),n.controlOptions.anchor!==e.ControlAnchor.NONE&&function(e,t){e.margin="0px",e.border=t+"px solid "+n.borderColor,e.padding="0px",e.background=n.background,e.opacity=n.opacity,e.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(e,t){e.position="relative",e.top="0px",e.left="0px",e.fontSize="0px",e.overflow="hidden",e.border=t+"px solid "+n.displayRegionColor,e.margin="0px",e.padding="0px",e.background="transparent",e.float="left",e.cssFloat="left",e.zIndex=999999999,e.cursor="default",e.boxSizing="content-box"}(this.displayRegion.style,this.borderWidth),e.setElementPointerEventsNone(this.displayRegion),e.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",e.setElementPointerEventsNone(this.displayRegionContainer),e.setElementTouchActionNone(this.displayRegionContainer),c.addControl(this.element,n.controlOptions),this._resizeWithViewer=n.controlOptions.anchor!==e.ControlAnchor.ABSOLUTE&&n.controlOptions.anchor!==e.ControlAnchor.NONE,n.width&&n.height?(this.setWidth(n.width),this.setHeight(n.height)):this._resizeWithViewer&&(l=e.getElementSize(c.element),this.element.style.height=Math.round(l.y*n.sizeRatio)+"px",this.element.style.width=Math.round(l.x*n.sizeRatio)+"px",this.oldViewerSize=l,d=e.getElementSize(this.element),this.elementArea=d.x*d.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[n]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function u(e,n){t(r.displayRegionContainer,e),t(r.displayRegion,-e),r.viewport.setRotation(e,n)}n.navigatorRotate&&(h=n.viewer.viewport?n.viewer.viewport.getRotation():n.viewer.degrees||0,u(h,!0),n.viewer.addHandler("rotate",function(e){u(e.degrees,e.immediately)})),this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:e.delegate(this,o),clickHandler:e.delegate(this,s),releaseHandler:e.delegate(this,i),scrollHandler:e.delegate(this,a),preProcessEventHandler:function(e){e.eventType==="wheel"&&(e.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",e.setElementPointerEventsNone(this.canvas),e.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){r.viewport&&r.viewport.goHome(!0)}),c.world.addHandler("item-index-change",function(e){window.setTimeout(function(){var t=r.world.getItemAt(e.previousIndex);r.world.setItemIndex(t,e.newIndex)},1)}),c.world.addHandler("remove-item",function(e){var n=e.item,t=r._getMatchingItem(n);t&&r.world.removeItem(t)}),this.update(c.viewport)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var t=new e.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);t.equals(this.oldContainerSize)||(this.viewport.resize(t,!0),this.viewport.goHome(!0),this.oldContainerSize=t,this.world.update(),this.world.draw(),this.update(this.viewer.viewport))}},setWidth:function(e){this.width=e,this.element.style.width=typeof e=="number"?e+"px":e,this._resizeWithViewer=!1,this.updateSize()},setHeight:function(e){this.height=e,this.element.style.height=typeof e=="number"?e+"px":e,this._resizeWithViewer=!1,this.updateSize()},setFlip:function(e){return this.viewport.setFlip(e),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(e){n(this.canvas,e),n(this.element,e)},update:function(n){if(n||(n=this.viewer.viewport),s=e.getElementSize(this.viewer.element),this._resizeWithViewer&&s.x&&s.y&&!s.equals(this.oldViewerSize)&&(this.oldViewerSize=s,this.maintainSizeRatio||!this.elementArea?(i=s.x*this.sizeRatio,r=s.y*this.sizeRatio):(i=(this.elementArea*(s.x/s.y))**.5,r=this.elementArea/i),this.element.style.width=Math.round(i)+"px",this.element.style.height=Math.round(r)+"px",this.elementArea||(this.elementArea=i*r),this.updateSize()),n&&this.viewport){(c=n.getBoundsNoRotate(!0),a=this.viewport.pixelFromPointNoRotate(c.getTopLeft(),!1),l=this.viewport.pixelFromPointNoRotate(c.getBottomRight(),!1).minus(this.totalBorderWidths),!this.navigatorRotate)&&(d=n.getRotation(!0),t(this.displayRegion,-d)),o=this.displayRegion.style,o.display=this.world.getItemCount()?"block":"none",o.top=a.y.toFixed(2)+"px",o.left=a.x.toFixed(2)+"px";var s,o,i,a,r,c,l,d,u=l.x-a.x,h=l.y-a.y;o.width=Math.round(Math.max(u,0))+"px",o.height=Math.round(Math.max(h,0))+"px"}},addTiledImage:function(t){var o,s=this,n=t.originalTiledImage;return delete t.original,o=e.extend({},t,{success:function(e){var t=e.item;t._originalForNavigator=n,s._matchBounds(t,n,!0),s._matchOpacity(t,n),s._matchCompositeOperation(t,n);function o(){s._matchBounds(t,n)}function i(){s._matchOpacity(t,n)}function a(){s._matchCompositeOperation(t,n)}n.addHandler("bounds-change",o),n.addHandler("clip-change",o),n.addHandler("opacity-change",i),n.addHandler("composite-operation-change",a)}}),e.Viewer.prototype.addTiledImage.apply(this,[o])},destroy:function(){return e.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(e){for(var t,s=this.world.getItemCount(),n=0;n<s;n++)if(t=this.world.getItemAt(n),t._originalForNavigator===e)return t;return null},_matchBounds:function(e,t,n){var s=t.getBoundsNoRotate();e.setPosition(s.getTopLeft(),n),e.setWidth(s.width,n),e.setRotation(t.getRotation(),n),e.setClip(t.getClip()),e.setFlip(t.getFlip())},_matchOpacity:function(e,t){e.setOpacity(t.opacity)},_matchCompositeOperation:function(e,t){e.setCompositeOperation(t.compositeOperation)}});function s(e){var t,n={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-click",n),!n.preventDefaultAction&&e.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)&&(this.viewer.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x),t=this.viewport.pointFromPixel(e.position),this.panVertical?this.panHorizontal||(t.x=this.viewer.viewport.getCenter(!0).x):t.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(t),this.viewer.viewport.applyConstraints())}function o(e){var t={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",t),!t.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewer.viewport.flipped&&(e.delta.x=-e.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function i(e){e.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function a(e){var t={tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent,preventDefault:e.preventDefault};this.viewer.raiseEvent("navigator-scroll",t),e.preventDefault=t.preventDefault}function t(e,t){n(e,"rotate("+t+"deg)")}function n(e,t){e.style.webkitTransform=t,e.style.mozTransform=t,e.style.msTransform=t,e.style.oTransform=t,e.style.transform=t}}(t),function(e){var t={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};e.extend(e,{getString:function(n){var s,i=n.split("."),o=null,r=arguments,a=t;for(s=0;s<i.length-1;s++)a=a[i[s]]||{};return o=a[i[s]],typeof o!="string"&&(e.console.error("Untranslated source string:",n),o=""),o.replace(/\{\d+\}/g,function(e){var t=parseInt(e.match(/\d+/),10)+1;return t<r.length?r[t]:""})},setString:function(e,n){var s,o=e.split("."),i=t;for(s=0;s<o.length-1;s++)i[o[s]]||(i[o[s]]={}),i=i[o[s]];i[o[s]]=n}})}(t),function(e){e.Point=function(e,t){this.x=typeof e=="number"?e:0,this.y=typeof t=="number"?t:0},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},plus:function(t){return new e.Point(this.x+t.x,this.y+t.y)},minus:function(t){return new e.Point(this.x-t.x,this.y-t.y)},times:function(t){return new e.Point(this.x*t,this.y*t)},divide:function(t){return new e.Point(this.x/t,this.y/t)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(e){return((this.x-e.x)**2+(this.y-e.y)**2)**.5},squaredDistanceTo:function(e){return(this.x-e.x)**2+(this.y-e.y)**2},apply:function(t){return new e.Point(t(this.x),t(this.y))},equals:function(t){return t instanceof e.Point&&this.x===t.x&&this.y===t.y},rotate:function(t,n){if(n=n||new e.Point(0,0),t%90===0)switch(a=e.positiveModulo(t,360),a){case 0:s=1,o=0;break;case 90:s=0,o=1;break;case 180:s=-1,o=0;break;case 270:s=0,o=-1;break}else i=t*Math.PI/180,s=Math.cos(i),o=Math.sin(i);var s,o,i,a,r=s*(this.x-n.x)-o*(this.y-n.y)+n.x,c=o*(this.x-n.x)+s*(this.y-n.y)+n.y;return new e.Point(r,c)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(t),function(e){e.TileSource=function(t){var r,l,d=this,c=arguments;if(e.isPlainObject(t)?r=t:r={width:c[0],height:c[1],tileSize:c[2],tileOverlap:c[3],minLevel:c[4],maxLevel:c[5]},e.EventSource.call(this),e.extend(!0,this,r),!this.success)for(l=0;l<arguments.length;l++)if(e.isFunction(arguments[l])){this.success=arguments[l];break}this.success&&this.addHandler("ready",function(e){d.success(e)}),e.type(arguments[0])==="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new e.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=r.width&&r.height?r.width/r.height:1,this.dimensions=new e.Point(r.width,r.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=r.tileOverlap?r.tileOverlap:0,this.minLevel=r.minLevel?r.minLevel:0,this.maxLevel=r.maxLevel!==0[0]&&r.maxLevel!==null?r.maxLevel:r.width&&r.height?Math.ceil(Math.log(Math.max(r.width,r.height))/Math.log(2)):0,this.success&&e.isFunction(this.success)&&this.success(this))},e.TileSource.prototype={getTileSize:function(){return e.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(e){return this._tileWidth?this._tileWidth:this.getTileSize(e)},getTileHeight:function(e){return this._tileHeight?this._tileHeight:this.getTileSize(e)},setMaxLevel:function(e){this.maxLevel=e,this._memoizeLevelScale()},getLevelScale:function(e){return this._memoizeLevelScale(),this.getLevelScale(e)},_memoizeLevelScale:function(){var e,t={};for(e=0;e<=this.maxLevel;e++)t[e]=1/2**(this.maxLevel-e);this.getLevelScale=function(e){return t[e]}},getNumTiles:function(t){var n=this.getLevelScale(t),s=Math.ceil(n*this.dimensions.x/this.getTileWidth(t)),o=Math.ceil(n*this.dimensions.y/this.getTileHeight(t));return new e.Point(s,o)},getPixelRatio:function(t){var n=this.dimensions.times(this.getLevelScale(t)),s=1/n.x*e.pixelDensityRatio,o=1/n.y*e.pixelDensityRatio;return new e.Point(s,o)},getClosestLevel:function(){var e,t;for(e=this.minLevel+1;e<=this.maxLevel&&(t=this.getNumTiles(e),!(t.x>1||t.y>1));e++);return e-1},getTileAtPoint:function(t,n){s=n.x>=0&&n.x<=1&&n.y>=0&&n.y<=1/this.aspectRatio,e.console.assert(s,"[TileSource.getTileAtPoint] must be called with a valid point.");var s,r,o=this.dimensions.x*this.getLevelScale(t),c=n.x*o,l=n.y*o,i=Math.floor(c/this.getTileWidth(t)),a=Math.floor(l/this.getTileHeight(t));return n.x>=1&&(i=this.getNumTiles(t).x-1),r=1e-15,n.y>=1/this.aspectRatio-r&&(a=this.getNumTiles(t).y-1),new e.Point(i,a)},getTileBounds:function(t,n,s,o){var c=this.dimensions.times(this.getLevelScale(t)),l=this.getTileWidth(t),d=this.getTileHeight(t),u=n===0?0:l*n-this.tileOverlap,h=s===0?0:d*s-this.tileOverlap,i=l+(n===0?1:2)*this.tileOverlap,a=d+(s===0?1:2)*this.tileOverlap,r=1/c.x;return i=Math.min(i,c.x-u),a=Math.min(a,c.y-h),o?new e.Rect(0,0,i,a):new e.Rect(u*r,h*r,i*r,a*r)},getImageInfo:function(t){var o,i,a,r,c,l,d,u,h,s=this;t&&(o=t.split("/"),l=o[o.length-1],d=l.lastIndexOf("."),d>-1&&(o[o.length-1]=l.slice(0,d))),i=null,this.splitHashDataForPost&&(r=t.indexOf("#"),r!==-1&&(i=t.substring(r+1),t=t.substr(0,r))),c=function(n){typeof n=="string"&&(n=e.parseXml(n));var o=e.TileSource.determineType(s,n,t);if(!o){s.raiseEvent("open-failed",{message:"Unable to load TileSource",source:t});return}a=o.prototype.configure.apply(s,[n,t,i]),a.ajaxWithCredentials===0[0]&&(a.ajaxWithCredentials=s.ajaxWithCredentials),h=new o(a),s.ready=!0,s.raiseEvent("ready",{tileSource:h})},t.match(/\.js$/)?(u=t.split("/").pop().replace(".js",""),e.jsonp({url:t,async:!1,callbackName:u,callback:c})):e.makeAjaxRequest({url:t,postData:i,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(e){var t=n(e);c(t)},error:function(n,o){var a,r;try{a="HTTP "+n.status+" attempting to load TileSource: "+t}catch{typeof o>"u"||!o.toString?r="Unknown error":r=o.toString(),a=r+" attempting to load TileSource: "+t}e.console.error(a),s.raiseEvent("open-failed",{message:a,source:t,postData:i})}})},supports:function(){return!1},configure:function(){throw new Error("Method not implemented.")},getTileUrl:function(){throw new Error("Method not implemented.")},getTilePostData:function(){return null},getTileAjaxHeaders:function(){return{}},getTileHashKey:function(e,t,n,s,o){function a(e){return o?e+"+"+JSON.stringify(o):e}return a(typeof s!="string"?e+"/"+t+"_"+n:s)},tileExists:function(e,t,n){var s=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&t>=0&&n>=0&&t<s.x&&n<s.y},hasTransparency:function(e,t){return!!e||t.match(".png")},downloadTileStart:function(t){var o,s=t.userData,n=new Image;s.image=n,s.request=null,o=function(e){if(!n){t.finish(null,s.request,"Image load failed: undefined Image instance.");return}n.onload=n.onerror=n.onabort=null,t.finish(e?null:n,s.request,e)},n.onload=function(){o()},n.onabort=n.onerror=function(){o("Image load aborted.")},t.loadWithAjax?s.request=e.makeAjaxRequest({url:t.src,withCredentials:t.ajaxWithCredentials,headers:t.ajaxHeaders,responseType:"arraybuffer",postData:t.postData,success:function(e){try{t=new window.Blob([e.response])}catch(n){var t,s,i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;n.name==="TypeError"&&i&&(s=new i,s.append(e.response),t=s.getBlob())}t.size===0?o("Empty image response."):n.src=(window.URL||window.webkitURL).createObjectURL(t)},error:function(){o("Image load aborted - XHR error")}}):(t.crossOriginPolicy!==!1&&(n.crossOrigin=t.crossOriginPolicy),n.src=t.src)},downloadTileAbort:function(e){e.userData.request&&e.userData.request.abort();var t=e.userData.image;e.userData.image&&(t.onload=t.onerror=t.onabort=null)},createTileCache:function(e,t){e._data=t},destroyTileCache:function(e){e._data=null,e._renderedContext=null},getTileCacheData:function(e){return e._data},getTileCacheDataAsImage:function(e){return e._data},getTileCacheDataAsContext2D:function(e){if(!e._renderedContext){var t=document.createElement("canvas");t.width=e._data.width,t.height=e._data.height,e._renderedContext=t.getContext("2d"),e._renderedContext.drawImage(e._data,0,0),e._data=null}return e._renderedContext}},e.extend(!0,e.TileSource.prototype,e.EventSource.prototype);function n(t){var s,i,n=t.responseText,o=t.status;if(t){if(t.status!==200&&t.status!==0)throw o=t.status,i=o===404?"Not Found":t.statusText,new Error(e.getString("Errors.Status",o,i))}else throw new Error(e.getString("Errors.Security"));if(n.match(/^\s*<.*/))try{s=t.responseXML&&t.responseXML.documentElement?t.responseXML:e.parseXml(n)}catch{s=t.responseText}else if(n.match(/\s*[{[].*/))try{s=e.parseJSON(n)}catch{s=n}else s=n;return s}e.TileSource.determineType=function(n,s,o){var i;for(i in t)if(i.match(/.+TileSource$/)&&e.isFunction(t[i])&&e.isFunction(t[i].prototype.supports)&&t[i].prototype.supports.call(n,s,o))return t[i];return e.console.error("No TileSource was able to open %s %s",o,s),null}}(t),function(e){e.DziTileSource=function(t){var d,u,h,m;if(e.isPlainObject(t)?u=t:u={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=u.tilesUrl,this.fileFormat=u.fileFormat,this.displayRects=u.displayRects,this.displayRects)for(h=this.displayRects.length-1;h>=0;h--)for(m=this.displayRects[h],d=m.minLevel;d<=m.maxLevel;d++)this._levelRects[d]||(this._levelRects[d]=[]),this._levelRects[d].push(m);e.TileSource.apply(this,[u])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(e){var n;return e.Image?n=e.Image.xmlns:e.documentElement&&(e.documentElement.localName==="Image"||e.documentElement.tagName==="Image")&&(n=e.documentElement.namespaceURI),n=(n||"").toLowerCase(),n.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||n.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(s,o){var a;return e.isPlainObject(s)?a=t(this,s):a=n(this,s),o&&!a.tilesUrl&&(a.tilesUrl=o.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),o.search(/\.(dzi|xml|js)\?/)!==-1?a.queryParams=o.match(/\?.*/):a.queryParams=""),a},getTileUrl:function(e,t,n){return[this.tilesUrl,e,"/",t,"_",n,".",this.fileFormat,this.queryParams].join("")},tileExists:function(e,t,n){var s,o,i,a,c,l,d,r=this._levelRects[e];if(this.minLevel&&e<this.minLevel||this.maxLevel&&e>this.maxLevel)return!1;if(!r||!r.length)return!0;for(d=r.length-1;d>=0;d--)if(s=r[d],!(e<s.minLevel||e>s.maxLevel)&&(o=this.getLevelScale(e),i=s.x*o,a=s.y*o,c=i+s.width*o,l=a+s.height*o,i=Math.floor(i/this._tileWidth),a=Math.floor(a/this._tileWidth),c=Math.ceil(c/this._tileWidth),l=Math.ceil(l/this._tileWidth),i<=t&&t<c&&a<=n&&n<l))return!0;return!1}});function n(n,s){if(!s||!s.documentElement)throw new Error(e.getString("Errors.Xml"));var i,r,c,l,d,f,p,o=s.documentElement,u=o.localName||o.tagName,h=s.documentElement.namespaceURI,a=null,m=[];if(u==="Image")try{if(l=o.getElementsByTagName("Size")[0],l===0[0]&&(l=o.getElementsByTagNameNS(h,"Size")[0]),a={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:o.getAttribute("Url"),Format:o.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(o.getAttribute("Overlap"),10),TileSize:parseInt(o.getAttribute("TileSize"),10),Size:{Height:parseInt(l.getAttribute("Height"),10),Width:parseInt(l.getAttribute("Width"),10)}}},!e.imageFormatSupported(a.Image.Format))throw new Error(e.getString("Errors.ImageFormat",a.Image.Format.toUpperCase()));for(r=o.getElementsByTagName("DisplayRect"),r===0[0]&&(r=o.getElementsByTagNameNS(h,"DisplayRect")[0]),d=0;d<r.length;d++)c=r[d],i=c.getElementsByTagName("Rect")[0],i===0[0]&&(i=c.getElementsByTagNameNS(h,"Rect")[0]),m.push({Rect:{X:parseInt(i.getAttribute("X"),10),Y:parseInt(i.getAttribute("Y"),10),Width:parseInt(i.getAttribute("Width"),10),Height:parseInt(i.getAttribute("Height"),10),MinLevel:parseInt(c.getAttribute("MinLevel"),10),MaxLevel:parseInt(c.getAttribute("MaxLevel"),10)}});return m.length&&(a.Image.DisplayRect=m),t(n,a)}catch(t){throw t instanceof Error?t:new Error(e.getString("Errors.Dzi"))}else{if(u==="Collection")throw new Error(e.getString("Errors.Dzc"));if(u==="Error")throw f=o.getElementsByTagName("Message")[0],p=f.firstChild.nodeValue,new Error(p)}throw new Error(e.getString("Errors.Dzi"))}function t(t,n){var s,i,o=n.Image,l=o.Url,d=o.Format,a=o.Size,r=o.DisplayRect||[],u=parseInt(a.Width,10),h=parseInt(a.Height,10),m=parseInt(o.TileSize,10),f=parseInt(o.Overlap,10),c=[];for(i=0;i<r.length;i++)s=r[i].Rect,c.push(new e.DisplayRect(parseInt(s.X,10),parseInt(s.Y,10),parseInt(s.Width,10),parseInt(s.Height,10),parseInt(s.MinLevel,10),parseInt(s.MaxLevel,10)));return e.extend(!0,{width:u,height:h,tileSize:m,tileOverlap:f,minLevel:null,maxLevel:null,tilesUrl:l,fileFormat:d,displayRects:c},n)}}(t),function(e){e.IIIFTileSource=function(t){if(e.extend(!0,this,t),this._id=this["@id"]||this.id||this.identifier||null,!(this.height&&this.width&&this._id))throw new Error("IIIF required parameters (width, height, or id) not provided.");if(t.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=t.version,this.tile_width&&this.tile_height)t.tileWidth=this.tile_width,t.tileHeight=this.tile_height;else if(this.tile_width)t.tileSize=this.tile_width;else if(this.tile_height)t.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length===1)t.tileWidth=this.tiles[0].width,t.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(o=0;o<this.tiles.length;o++)for(i=0;i<this.tiles[o].scaleFactors.length;i++)c=this.tiles[o].scaleFactors[i],this.scale_factors.push(c),t.tileSizePerScaleFactor[c]={width:this.tiles[o].width,height:this.tiles[o].height||this.tiles[o].width}}else if(n(t)){for(var o,i,r,c,h,u=Math.min(this.height,this.width),l=[256,512,1024],d=[],a=0;a<l.length;a++)l[a]<=u&&d.push(l[a]);d.length>0?t.tileSize=Math.max.apply(null,d):t.tileSize=u}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,t.levels=s(this),e.extend(!0,t,{width:t.levels[t.levels.length-1].width,height:t.levels[t.levels.length-1].height,tileSize:Math.max(t.height,t.width),tileOverlap:0,minLevel:0,maxLevel:t.levels.length-1}),this.levels=t.levels):e.console.error("Nothing in the info.json to construct image pyramids from");!t.maxLevel&&!this.emulateLegacyImagePyramid&&(this.scale_factors?(h=Math.max.apply(null,this.scale_factors),t.maxLevel=Math.round(Math.log(h)*Math.LOG2E)):t.maxLevel=Number(Math.round(Math.log(Math.max(this.width,this.height),2)))),this.sizes&&(r=this.sizes.length,(r===t.maxLevel||r===t.maxLevel+1)&&(this.levelSizes=this.sizes.slice().sort((e,t)=>e.width-t.width),r===t.maxLevel&&this.levelSizes.push({width:this.width,height:this.height}))),e.TileSource.apply(this,[t])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(e){return!!(e.protocol&&e.protocol==="http://iiif.io/api/image"||e["@context"]&&(e["@context"]==="http://library.stanford.edu/iiif/image-api/1.1/context.json"||e["@context"]==="http://iiif.io/api/image/1/context.json")||e.profile&&e.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||e.identifier&&e.width&&e.height)||!!(e.documentElement&&e.documentElement.tagName==="info"&&e.documentElement.namespaceURI==="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(n,s){if(e.isPlainObject(n)){if(n["@context"]){var r,c,l,a=n["@context"];if(Array.isArray(a))for(r=0;r<a.length;r++)if(typeof a[r]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(a[r])||a[r]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){a=a[r];break}switch(a){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":n.version=1;break;case"http://iiif.io/api/image/2/context.json":n.version=2;break;case"http://iiif.io/api/image/3/context.json":n.version=3;break;default:e.console.error("Data has a @context property which contains no known IIIF context URI.")}}else n["@context"]="http://iiif.io/api/image/1.0/context.json",n["@id"]=s.replace("/info.json",""),n.version=1;if(n.preferredFormats)for(c=0;c<n.preferredFormats.length;c++)if(t.imageFormatSupported(n.preferredFormats[c])){n.tileFormat=n.preferredFormats[c];break}return n}return l=i(n),l["@context"]="http://iiif.io/api/image/1.0/context.json",l["@id"]=s.replace("/info.xml",""),l.version=1,l},getTileWidth:function(t){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileWidth.call(this,t);var n=2**(this.maxLevel-t);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[n]?this.tileSizePerScaleFactor[n].width:this._tileWidth},getTileHeight:function(t){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileHeight.call(this,t);var n=2**(this.maxLevel-t);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[n]?this.tileSizePerScaleFactor[n].height:this._tileHeight},getLevelScale:function(t){if(this.emulateLegacyImagePyramid){var n=NaN;return this.levels.length>0&&t>=this.minLevel&&t<=this.maxLevel&&(n=this.levels[t].width/this.levels[this.maxLevel].width),n}return e.TileSource.prototype.getLevelScale.call(this,t)},getNumTiles:function(t){if(this.emulateLegacyImagePyramid)return n=this.getLevelScale(t),n?new e.Point(1,1):new e.Point(0,0);if(this.levelSizes){var n,s=this.levelSizes[t],o=Math.ceil(s.width/this.getTileWidth(t)),i=Math.ceil(s.height/this.getTileHeight(t));return new e.Point(o,i)}return e.TileSource.prototype.getNumTiles.call(this,t)},getTileAtPoint:function(t,n){if(this.emulateLegacyImagePyramid)return new e.Point(0,0);if(this.levelSizes){s=n.x>=0&&n.x<=1&&n.y>=0&&n.y<=1/this.aspectRatio,e.console.assert(s,"[TileSource.getTileAtPoint] must be called with a valid point.");var s,r,o=this.levelSizes[t].width,c=n.x*o,l=n.y*o,i=Math.floor(c/this.getTileWidth(t)),a=Math.floor(l/this.getTileHeight(t));return n.x>=1&&(i=this.getNumTiles(t).x-1),r=1e-15,n.y>=1/this.aspectRatio-r&&(a=this.getNumTiles(t).y-1),new e.Point(i,a)}return e.TileSource.prototype.getTileAtPoint.call(this,t,n)},getTileUrl:function(e,t,n){if(this.emulateLegacyImagePyramid)return h=null,this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(h=this.levels[e].url),h;var s,o,i,a,r,c,l,u,h,m,f,p,g,v,b,j,y,_="0",d=.5**(this.maxLevel-e);return this.levelSizes?(o=this.levelSizes[e].width,i=this.levelSizes[e].height):(o=Math.ceil(this.width*d),i=Math.ceil(this.height*d)),r=this.getTileWidth(e),c=this.getTileHeight(e),v=Math.round(r/d),u=Math.round(c/d),this.version===1?j="native."+this.tileFormat:j="default."+this.tileFormat,o<r&&i<c?(this.version===2&&o===this.width?s="full":this.version===3&&o===this.width&&i===this.height?s="max":this.version===3?s=o+","+i:s=o+",",l="full"):(m=t*v,f=n*u,p=Math.min(v,this.width-m),g=Math.min(u,this.height-f),t===0&&n===0&&p===this.width&&g===this.height?l="full":l=[m,f,p,g].join(","),a=Math.min(r,o-t*r),b=Math.min(c,i-n*c),this.version===2&&a===this.width?s="full":this.version===3&&a===this.width&&b===this.height?s="max":this.version===3?s=a+","+b:s=a+","),y=[this._id,l,s,_,j].join("/"),y},__testonly__:{canBeTiled:n,constructLevels:s}});function n(e){var n=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],s=Array.isArray(e.profile)?e.profile[0]:e.profile,o=n.indexOf(s)!==-1,t=!1;return e.version===2&&e.profile.length>1&&e.profile[1].supports&&(t=e.profile[1].supports.indexOf("sizeByW")!==-1),e.version===3&&e.extraFeatures&&(t=e.extraFeatures.indexOf("sizeByWh")!==-1),!o||t}function s(e){for(var n=[],t=0;t<e.sizes.length;t++)n.push({url:e._id+"/full/"+e.sizes[t].width+","+(e.version===3?e.sizes[t].height:"")+"/0/default."+e.tileFormat,width:e.sizes[t].width,height:e.sizes[t].height});return n.sort(function(e,t){return e.width-t.width})}function i(t){if(!t||!t.documentElement)throw new Error(e.getString("Errors.Xml"));var s=t.documentElement,i=s.tagName,n=null;if(i==="info")try{return n={},o(s,n),n}catch(t){throw t instanceof Error?t:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}function o(t,n,s){var i,a;if(t.nodeType===3&&s)i=t.nodeValue.trim(),i.match(/^\d*$/)&&(i=Number(i)),n[s]?(e.isArray(n[s])||(n[s]=[n[s]]),n[s].push(i)):n[s]=i;else if(t.nodeType===1)for(a=0;a<t.childNodes.length;a++)o(t.childNodes[a],n,t.nodeName)}}(t),function(e){e.OsmTileSource=function(t){var a;e.isPlainObject(t)?a=t:a={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!a.width||!a.height)&&(a.width=65572864,a.height=65572864),a.tileSize||(a.tileSize=256,a.tileOverlap=0),a.tilesUrl||(a.tilesUrl="http://tile.openstreetmap.org/"),a.minLevel=8,e.TileSource.apply(this,[a])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&e.type==="openstreetmaps"},configure:function(e){return e},getTileUrl:function(e,t,n){return this.tilesUrl+(e-8)+"/"+t+"/"+n+".png"}})}(t),function(e){e.TmsTileSource=function(t){e.isPlainObject(t)?a=t:a={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var a,l,r=Math.ceil(a.width/256)*256,c=Math.ceil(a.height/256)*256;r>c?l=r/256:l=c/256,a.maxLevel=Math.ceil(Math.log(l)/Math.log(2))-1,a.tileSize=256,a.width=r,a.height=c,e.TileSource.apply(this,[a])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&e.type==="tiledmapservice"},configure:function(e){return e},getTileUrl:function(e,t,n){var s=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+t+"/"+(s-n)+".png"}})}(t),function(e){e.ZoomifyTileSource=function(e){typeof e.tileSize>"u"&&(e.tileSize=256),typeof e.fileFormat>"u"&&(e.fileFormat="jpg",this.fileFormat=e.fileFormat);var n={x:e.width,y:e.height};for(e.imageSizes=[{x:e.width,y:e.height}],e.gridSize=[this._getGridSize(e.width,e.height,e.tileSize)];parseInt(n.x,10)>e.tileSize||parseInt(n.y,10)>e.tileSize;)n.x=Math.floor(n.x/2),n.y=Math.floor(n.y/2),e.imageSizes.push({x:n.x,y:n.y}),e.gridSize.push(this._getGridSize(n.x,n.y,e.tileSize));e.imageSizes.reverse(),e.gridSize.reverse(),e.minLevel=0,e.maxLevel=e.gridSize.length-1,t.TileSource.apply(this,[e])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(e,t,n){return{x:Math.ceil(e/n),y:Math.ceil(t/n)}},_calculateAbsoluteTileNumber:function(e,t,n){for(var o=0,s={},i=0;i<e;i++)s=this.gridSize[i],o+=s.x*s.y;return s=this.gridSize[e],o+=s.x*n+t,o},supports:function(e){return e.type&&e.type==="zoomifytileservice"},configure:function(e){return e},getTileUrl:function(e,t,n){var s=0,o=this._calculateAbsoluteTileNumber(e,t,n);return s=Math.floor(o/256),this.tilesUrl+"TileGroup"+s+"/"+e+"-"+t+"-"+n+"."+this.fileFormat}})}(t),function(e){e.LegacyTileSource=function(t){var s,o,i;e.isArray(t)&&(s={type:"legacy-image-pyramid",levels:t}),s.levels=n(s.levels),s.levels.length>0?(o=s.levels[s.levels.length-1].width,i=s.levels[s.levels.length-1].height):(o=0,i=0,e.console.error("No supported image formats found")),e.extend(!0,s,{width:o,height:i,tileSize:Math.max(i,o),tileOverlap:0,minLevel:0,maxLevel:s.levels.length>0?s.levels.length-1:0}),e.TileSource.apply(this,[s]),this.levels=s.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&e.type==="legacy-image-pyramid"||e.documentElement&&e.documentElement.getAttribute("type")==="legacy-image-pyramid"},configure:function(n){var a;return e.isPlainObject(n)?a=t(this,n):a=s(this,n),a},getLevelScale:function(e){var t=NaN;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){var n=this.getLevelScale(t);return n?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(e){var s=null;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(s=this.levels[e].url),s}});function n(t){var n,s,o=[];for(s=0;s<t.length;s++)n=t[s],n.height&&n.width&&n.url?o.push({url:n.url,width:Number(n.width),height:Number(n.height)}):e.console.error("Unsupported image format: %s",n.url?n.url:"<no URL>");return o.sort(function(e,t){return e.height-t.height})}function s(n,s){if(!s||!s.documentElement)throw new Error(e.getString("Errors.Xml"));var i,a,r=s.documentElement,o=r.tagName,c=null,l=[];if(o==="image")try{for(c={type:r.getAttribute("type"),levels:[]},l=r.getElementsByTagName("level"),a=0;a<l.length;a++)i=l[a],c.levels.push({url:i.getAttribute("url"),width:parseInt(i.getAttribute("width"),10),height:parseInt(i.getAttribute("height"),10)});return t(n,c)}catch(e){throw e instanceof Error?e:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(o==="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(o==="error")throw new Error("Error: "+s)}throw new Error("Unknown element "+o)}function t(e,t){return t.levels}}(t),function(e){e.ImageTileSource=function(t){t=e.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1},t),e.TileSource.apply(this,[t])},e.extend(e.ImageTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&e.type==="image"},configure:function(e){return e},getImageInfo:function(t){var s=this._image=new Image,n=this;this.crossOriginPolicy&&(s.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(s.useCredentials=this.ajaxWithCredentials),e.addEvent(s,"load",function(){n.width=s.naturalWidth,n.height=s.naturalHeight,n.aspectRatio=n.width/n.height,n.dimensions=new e.Point(n.width,n.height),n._tileWidth=n.width,n._tileHeight=n.height,n.tileOverlap=0,n.minLevel=0,n.levels=n._buildLevels(),n.maxLevel=n.levels.length-1,n.ready=!0,n.raiseEvent("ready",{tileSource:n})}),e.addEvent(s,"error",function(){n.raiseEvent("open-failed",{message:"Error loading image at "+t,source:t})}),s.src=t},getLevelScale:function(e){var t=NaN;return e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){var n=this.getLevelScale(t);return n?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(e){var s=null;return e>=this.minLevel&&e<=this.maxLevel&&(s=this.levels[e].url),s},getContext2D:function(e){var s=null;return e>=this.minLevel&&e<=this.maxLevel&&(s=this.levels[e].context2D),s},destroy:function(e){this._freeupCanvasMemory(e)},_buildLevels:function(){if(s=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}],!this.buildPyramid||!e.supportsCanvas)return delete this._image,s;var s,i,a,t=this._image.naturalWidth,n=this._image.naturalHeight,o=document.createElement("canvas"),r=o.getContext("2d");if(o.width=t,o.height=n,r.drawImage(this._image,0,0,t,n),s[0].context2D=r,delete this._image,e.isCanvasTainted(o))return s;for(;t>=2&&n>=2;)t=Math.floor(t/2),n=Math.floor(n/2),i=document.createElement("canvas"),a=i.getContext("2d"),i.width=t,i.height=n,a.drawImage(o,0,0,t,n),s.splice(0,0,{context2D:a,width:t,height:n}),o=i,r=a;return s},_freeupCanvasMemory:function(e){for(var t=0;t<this.levels.length;t++)this.levels[t].context2D&&(this.levels[t].context2D.canvas.height=0,this.levels[t].context2D.canvas.width=0,e&&e.raiseEvent("image-unloaded",{context2D:this.levels[t].context2D}))}})}(t),function(e){e.TileSourceCollection=function(){e.console.error("TileSourceCollection is deprecated; use World instead")}}(t),function(e){e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(s){var o=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},s),this.element=s.element||e.makeNeutralElement("div"),s.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,e.setElementPointerEventsNone(this.imgRest),e.setElementPointerEventsNone(this.imgGroup),e.setElementPointerEventsNone(this.imgHover),e.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(n){n.insideElementPressed?(t(o,e.ButtonState.DOWN),o.raiseEvent("enter",{originalEvent:n.originalEvent})):n.buttonDownAny||t(o,e.ButtonState.HOVER)},focusHandler:function(e){o.tracker.enterHandler(e),o.raiseEvent("focus",{originalEvent:e.originalEvent})},leaveHandler:function(t){n(o,e.ButtonState.GROUP),t.insideElementPressed&&o.raiseEvent("exit",{originalEvent:t.originalEvent})},blurHandler:function(e){o.tracker.leaveHandler(e),o.raiseEvent("blur",{originalEvent:e.originalEvent})},pressHandler:function(n){t(o,e.ButtonState.DOWN),o.raiseEvent("press",{originalEvent:n.originalEvent})},releaseHandler:function(s){s.insideElementPressed&&s.insideElementReleased?(n(o,e.ButtonState.HOVER),o.raiseEvent("release",{originalEvent:s.originalEvent})):s.insideElementPressed?n(o,e.ButtonState.GROUP):t(o,e.ButtonState.HOVER)},clickHandler:function(e){e.quick&&o.raiseEvent("click",{originalEvent:e.originalEvent})},keyHandler:function(e){e.keyCode===13?(o.raiseEvent("click",{originalEvent:e.originalEvent}),o.raiseEvent("release",{originalEvent:e.originalEvent}),e.preventDefault=!0):e.preventDefault=!1}}),n(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){t(this,e.ButtonState.GROUP)},notifyGroupExit:function(){n(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,this.tracker.setTracking(!1),e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,this.tracker.setTracking(!0),e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}});function s(t){e.requestAnimationFrame(function(){o(t)})}function o(t){var n,o,i;t.shouldFade&&(o=e.now(),i=o-t.fadeBeginTime,n=1-i/t.fadeLength,n=Math.min(1,n),n=Math.max(0,n),t.imgGroup&&e.setElementOpacity(t.imgGroup,n,!0),n>0&&s(t))}function i(t){t.shouldFade=!0,t.fadeBeginTime=e.now()+t.fadeDelay,window.setTimeout(function(){s(t)},t.fadeDelay)}function a(t){t.shouldFade=!1,t.imgGroup&&e.setElementOpacity(t.imgGroup,1,!0)}function t(t,n){t.element.disabled||(n>=e.ButtonState.GROUP&&t.currentState===e.ButtonState.REST&&(a(t),t.currentState=e.ButtonState.GROUP),n>=e.ButtonState.HOVER&&t.currentState===e.ButtonState.GROUP&&(t.imgHover&&(t.imgHover.style.visibility=""),t.currentState=e.ButtonState.HOVER),n>=e.ButtonState.DOWN&&t.currentState===e.ButtonState.HOVER&&(t.imgDown&&(t.imgDown.style.visibility=""),t.currentState=e.ButtonState.DOWN))}function n(t,n){t.element.disabled||(n<=e.ButtonState.HOVER&&t.currentState===e.ButtonState.DOWN&&(t.imgDown&&(t.imgDown.style.visibility="hidden"),t.currentState=e.ButtonState.HOVER),n<=e.ButtonState.GROUP&&t.currentState===e.ButtonState.HOVER&&(t.imgHover&&(t.imgHover.style.visibility="hidden"),t.currentState=e.ButtonState.GROUP),n<=e.ButtonState.REST&&t.currentState===e.ButtonState.GROUP&&(i(t),t.currentState=e.ButtonState.REST))}}(t),function(e){e.ButtonGroup=function(t){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},t);var s,o=this.buttons.concat([]),n=this;if(this.element=t.element||e.makeNeutralElement("div"),!t.group)for(this.element.style.display="inline-block",s=0;s<o.length;s++)this.element.appendChild(o[s].element);e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(){var t;for(t=0;t<n.buttons.length;t++)n.buttons[t].notifyGroupEnter()},leaveHandler:function(e){var t;if(!e.insideElementPressed)for(t=0;t<n.buttons.length;t++)n.buttons[t].notifyGroupExit()}})},e.ButtonGroup.prototype={addButton:function(e){this.buttons.push(e),this.element.appendChild(e.element)},emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var e=this.buttons.pop();this.element.removeChild(e.element),e.destroy()}this.tracker.destroy(),this.element=null}}}(t),function(e){e.Rect=function(t,n,s,o,i){this.x=typeof t=="number"?t:0,this.y=typeof n=="number"?n:0,this.width=typeof s=="number"?s:0,this.height=typeof o=="number"?o:0,this.degrees=typeof i=="number"?i:0,this.degrees=e.positiveModulo(this.degrees,360);var a,r;this.degrees>=270?(a=this.getTopRight(),this.x=a.x,this.y=a.y,r=this.height,this.height=this.width,this.width=r,this.degrees-=270):this.degrees>=180?(a=this.getBottomRight(),this.x=a.x,this.y=a.y,this.degrees-=180):this.degrees>=90&&(a=this.getBottomLeft(),this.x=a.x,this.y=a.y,r=this.height,this.height=this.width,this.width=r,this.degrees-=90)},e.Rect.fromSummits=function(t,n,s){var a=t.distanceTo(n),r=t.distanceTo(s),o=n.minus(t),i=Math.atan(o.y/o.x);return o.x<0?i+=Math.PI:o.y<0&&(i+=2*Math.PI),new e.Rect(t.x,t.y,a,r,i/Math.PI*180)},e.Rect.prototype={clone:function(){return new e.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new e.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new e.Point(this.width,this.height)},equals:function(t){return t instanceof e.Rect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height&&this.degrees===t.degrees},times:function(t){return new e.Rect(this.x*t,this.y*t,this.width*t,this.height*t,this.degrees)},translate:function(t){return new e.Rect(this.x+t.x,this.y+t.y,this.width,this.height,this.degrees)},union:function(t){var n=this.getBoundingBox(),s=t.getBoundingBox(),o=Math.min(n.x,s.x),i=Math.min(n.y,s.y),a=Math.max(n.x+n.width,s.x+s.width),r=Math.max(n.y+n.height,s.y+s.height);return new e.Rect(o,i,a-o,r-i)},intersection:function(t){var s=1e-10,n=[],x=this.getTopLeft();t.containsPoint(x,s)&&n.push(x),j=this.getTopRight(),t.containsPoint(j,s)&&n.push(j),y=this.getBottomLeft(),t.containsPoint(y,s)&&n.push(y),g=this.getBottomRight(),t.containsPoint(g,s)&&n.push(g),c=t.getTopLeft(),this.containsPoint(c,s)&&n.push(c),_=t.getTopRight(),this.containsPoint(_,s)&&n.push(_),d=t.getBottomLeft(),this.containsPoint(d,s)&&n.push(d),u=t.getBottomRight(),this.containsPoint(u,s)&&n.push(u);for(var O=this._getSegments(),w=t._getSegments(),f=0;f<O.length;f++)for(p=O[f],r=0;r<w.length;r++)v=w[r],b=C(p[0],p[1],v[0],v[1]),b&&n.push(b);function C(t,n,o,i){var r,d,a=n.minus(t),c=i.minus(o),l=-c.x*a.y+a.x*c.y;return l===0?null:(d=(a.x*(t.y-o.y)-a.y*(t.x-o.x))/l,r=(c.x*(t.y-o.y)-c.y*(t.x-o.x))/l,-s<=d&&d<=1-s&&-s<=r&&r<=1-s?new e.Point(t.x+r*a.x,t.y+r*a.y):null)}if(n.length===0)return null;for(var o,r,c,d,u,p,g,v,b,j,y,_,a=n[0].x,l=n[0].x,i=n[0].y,m=n[0].y,h=1;h<n.length;h++)o=n[h],o.x<a&&(a=o.x),o.x>l&&(l=o.x),o.y<i&&(i=o.y),o.y>m&&(m=o.y);return new e.Rect(a,i,l-a,m-i)},_getSegments:function(){var e=this.getTopLeft(),t=this.getTopRight(),n=this.getBottomLeft(),s=this.getBottomRight();return[[e,t],[t,s],[s,n],[n,e]]},rotate:function(t,n){if(t=e.positiveModulo(t,360),t===0)return this.clone();n=n||this.getCenter();var o=this.getTopLeft().rotate(t,n),a=this.getTopRight().rotate(t,n),s=a.minus(o),s=s.apply(function(e){var t=1e-15;return(e<0?-e:e)<t?0:e}),i=Math.atan(s.y/s.x);return s.x<0?i+=Math.PI:s.y<0&&(i+=2*Math.PI),new e.Rect(o.x,o.y,this.width,this.height,i/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var t=this.getTopLeft(),n=this.getTopRight(),s=this.getBottomLeft(),o=this.getBottomRight(),i=Math.min(t.x,n.x,s.x,o.x),r=Math.max(t.x,n.x,s.x,o.x),a=Math.min(t.y,n.y,s.y,o.y),c=Math.max(t.y,n.y,s.y,o.y);return new e.Rect(i,a,r-i,c-a)},getIntegerBoundingBox:function(){var t=this.getBoundingBox(),n=Math.floor(t.x),s=Math.floor(t.y),o=Math.ceil(t.width+t.x-n),i=Math.ceil(t.height+t.y-s);return new e.Rect(n,s,o,i)},containsPoint:function(e,t){t=t||0;var n=this.getTopLeft(),i=this.getTopRight(),a=this.getBottomLeft(),s=i.minus(n),o=a.minus(n);return(e.x-n.x)*s.x+(e.y-n.y)*s.y>=-t&&(e.x-i.x)*s.x+(e.y-i.y)*s.y<=t&&(e.x-n.x)*o.x+(e.y-n.y)*o.y>=-t&&(e.x-a.x)*o.x+(e.y-a.y)*o.y<=t},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(t),function(e){var s={};e.ReferenceStrip=function(d){var u,m,p,g=this,h=d.viewer,f=e.getElementSize(h.element);for(d.id||(d.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=d.id,this.element.className="referencestrip"),d=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},d,{element:this.element}),e.extend(this,d),s[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,m=this.element.style,m.marginTop="0px",m.marginRight="0px",m.marginBottom="0px",m.marginLeft="0px",m.left="0px",m.bottom="0px",m.border="0px",m.background="#000",m.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=h,this.tracker=new e.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:e.delegate(this,i),dragHandler:e.delegate(this,a),scrollHandler:e.delegate(this,n),enterHandler:e.delegate(this,o),leaveHandler:e.delegate(this,r),keyDownHandler:e.delegate(this,c),keyHandler:e.delegate(this,l),preProcessEventHandler:function(e){e.eventType==="wheel"&&(e.preventDefault=!0)}}),d.width&&d.height?(this.element.style.width=d.width+"px",this.element.style.height=d.height+"px",h.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):d.scroll==="horizontal"?(this.element.style.width=f.x*d.sizeRatio*h.tileSources.length+12*h.tileSources.length+"px",this.element.style.height=f.y*d.sizeRatio+"px",h.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=f.y*d.sizeRatio*h.tileSources.length+12*h.tileSources.length+"px",this.element.style.width=f.x*d.sizeRatio+"px",h.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=f.x*this.sizeRatio+8,this.panelHeight=f.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},p=0;p<h.tileSources.length;p++)u=e.makeNeutralElement("div"),u.id=this.element.id+"-"+p,u.style.width=g.panelWidth+"px",u.style.height=g.panelHeight+"px",u.style.display="inline",u.style.float="left",u.style.cssFloat="left",u.style.padding="2px",e.setElementTouchActionNone(u),e.setElementPointerEventsNone(u),this.element.appendChild(u),u.activePanel=!1,this.panels.push(u);t(this,this.scroll==="vertical"?f.y:f.x,0),this.setFocus(0)},e.ReferenceStrip.prototype={setFocus:function(n){var s,a=this.element.querySelector("#"+this.element.id+"-"+n),i=e.getElementSize(this.viewer.canvas),l=Number(this.element.style.width.replace("px","")),d=Number(this.element.style.height.replace("px","")),r=-Number(this.element.style.marginLeft.replace("px","")),c=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==a&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=a,this.currentSelected.style.background="#999",this.scroll==="horizontal"?(s=Number(n)*(this.panelWidth+3),s>r+i.x-this.panelWidth?(s=Math.min(s,l-i.x),this.element.style.marginLeft=-s+"px",t(this,i.x,-s)):s<r&&(s=Math.max(0,s-i.x/2),this.element.style.marginLeft=-s+"px",t(this,i.x,-s))):(s=Number(n)*(this.panelHeight+3),s>c+i.y-this.panelHeight?(s=Math.min(s,d-i.y),this.element.style.marginTop=-s+"px",t(this,i.y,-s)):s<c&&(s=Math.max(0,s-i.y/2),this.element.style.marginTop=-s+"px",t(this,i.y,-s))),this.currentPage=n,o.call(this,{eventSource:this.tracker}))},update:function(){return!!s[this.id].animating},destroy:function(){if(this.miniViewers)for(var e in this.miniViewers)this.miniViewers[e].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}};function i(e){if(e.quick){var t;this.scroll==="horizontal"?t=Math.floor(e.position.x/(this.panelWidth+4)):t=Math.floor(e.position.y/this.panelHeight),this.viewer.goToPage(t)}this.element.focus()}function a(n){if(this.dragging=!0,this.element){var s=Number(this.element.style.marginLeft.replace("px","")),o=Number(this.element.style.marginTop.replace("px","")),a=Number(this.element.style.width.replace("px","")),r=Number(this.element.style.height.replace("px","")),i=e.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?-n.delta.x>0?s>-(a-i.x)&&(this.element.style.marginLeft=s+n.delta.x*2+"px",t(this,i.x,s+n.delta.x*2)):-n.delta.x<0&&s<0&&(this.element.style.marginLeft=s+n.delta.x*2+"px",t(this,i.x,s+n.delta.x*2)):-n.delta.y>0?o>-(r-i.y)&&(this.element.style.marginTop=o+n.delta.y*2+"px",t(this,i.y,o+n.delta.y*2)):-n.delta.y<0&&o<0&&(this.element.style.marginTop=o+n.delta.y*2+"px",t(this,i.y,o+n.delta.y*2))}}function n(n){if(this.element){var s=Number(this.element.style.marginLeft.replace("px","")),o=Number(this.element.style.marginTop.replace("px","")),a=Number(this.element.style.width.replace("px","")),r=Number(this.element.style.height.replace("px","")),i=e.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?n.scroll>0?s>-(a-i.x)&&(this.element.style.marginLeft=s-n.scroll*60+"px",t(this,i.x,s-n.scroll*60)):n.scroll<0&&s<0&&(this.element.style.marginLeft=s-n.scroll*60+"px",t(this,i.x,s-n.scroll*60)):n.scroll<0?o>i.y-r&&(this.element.style.marginTop=o+n.scroll*60+"px",t(this,i.y,o+n.scroll*60)):n.scroll>0&&o<0&&(this.element.style.marginTop=o+n.scroll*60+"px",t(this,i.y,o+n.scroll*60)),n.preventDefault=!0}}function t(t,n,s){for(t.scroll==="horizontal"?c=t.panelWidth:c=t.panelHeight,o=Math.ceil(n/c)+5,l=Math.ceil(((s<0?-s:s)+n)/c)+1,o=l-o,o=o<0?0:o,a=o;a<l&&a<t.panels.length;a++)if(r=t.panels[a],!r.activePanel){var o,i,a,r,c,l,d,u=t.viewer.tileSources[a];u.referenceStripThumbnailUrl?d={type:"image",url:u.referenceStripThumbnailUrl}:d=u,i=new e.Viewer({id:r.id,tileSources:[d],element:r,navigatorSizeRatio:t.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:t.viewer.loadTilesWithAjax,ajaxHeaders:t.viewer.ajaxHeaders,drawer:"canvas"}),e.setElementPointerEventsNone(i.canvas),e.setElementPointerEventsNone(i.container),i.innerTracker.setTracking(!1),i.outerTracker.setTracking(!1),t.miniViewers[r.id]=i,r.activePanel=!0}}function o(e){var t=e.eventSource.element;this.scroll==="horizontal"?t.style.marginBottom="0px":t.style.marginLeft="0px"}function r(t){var n=t.eventSource.element;this.scroll==="horizontal"?n.style.marginBottom="-"+e.getElementSize(n).y/2+"px":n.style.marginLeft="-"+e.getElementSize(n).x/2+"px"}function c(e){if(!e.ctrl&&!e.alt&&!e.meta)switch(e.keyCode){case 38:n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;case 40:n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 37:n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 39:n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;default:e.preventDefault=!1;break}else e.preventDefault=!1}function l(e){if(!e.ctrl&&!e.alt&&!e.meta)switch(e.keyCode){case 61:n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;case 45:n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 48:case 119:case 87:n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;case 115:case 83:n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 97:n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 100:n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;default:e.preventDefault=!1;break}else e.preventDefault=!1}}(t),function(e){e.DisplayRect=function(t,n,s,o,i,a){e.Rect.apply(this,[t,n,s,o]),this.minLevel=i,this.maxLevel=a},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(t),function(e){e.Spring=function(t){var n=arguments;typeof t!="object"&&(t={initial:n.length&&typeof n[0]=="number"?n[0]:0[0],springStiffness:n.length>1?n[1].springStiffness:5,animationTime:n.length>1?n[1].animationTime:1.5}),e.console.assert(typeof t.springStiffness=="number"&&t.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),e.console.assert(typeof t.animationTime=="number"&&t.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),t.exponential&&(this._exponential=!0,delete t.exponential),e.extend(!0,this,t),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:e.now()},e.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},e.Spring.prototype={resetTo:function(t){e.console.assert(!this._exponential||t!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=t,this.start.time=this.target.time=this.current.time=e.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(t){e.console.assert(!this._exponential||t!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=t,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(t){this.start.value+=t,this.target.value+=t,this._exponential&&(e.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(t){this._exponential=t,this._exponential&&(e.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=e.now();let n,s;if(this._exponential?(n=this.start._logValue,s=this.target._logValue):(n=this.start.value,s=this.target.value),this.current.time>=this.target.time)this.current.value=this.target.value;else{let e=n+(s-n)*t(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time));this._exponential?this.current.value=Math.exp(e):this.current.value=e}return this.current.value!==this.target.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function t(e,t){return(1-Math.exp(e*-t))/(1-Math.exp(-e))}}(t),function(e){e.ImageJob=function(t){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null,tries:0},t),this.data=null,this.userData={},this.errorMsg=null},e.ImageJob.prototype={start:function(){this.tries++;var e=this,t=this.abort;this.jobId=window.setTimeout(function(){e.finish(null,null,"Image load exceeded timeout ("+e.timeout+" ms)")},this.timeout),this.abort=function(){e.source.downloadTileAbort(e),typeof t=="function"&&t()},this.source.downloadTileStart(this)},finish:function(e,t,n){this.data=e,this.request=t,this.errorMsg=n,this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(t){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,timeout:e.DEFAULT_SETTINGS.timeout,jobQueue:[],failedTiles:[],jobsInProgress:0},t)},e.ImageLoader.prototype={addJob:function(n){n.source||(e.console.error("ImageLoader.prototype.addJob() requires [options.source]. TileSource since new API defines how images are fetched. Creating a dummy TileSource."),s=e.TileSource.prototype,n.source={downloadTileStart:s.downloadTileStart,downloadTileAbort:s.downloadTileAbort});var s,i=this,a=function(e){t(i,e,n.callback)},r={src:n.src,tile:n.tile||{},source:n.source,loadWithAjax:n.loadWithAjax,ajaxHeaders:n.loadWithAjax?n.ajaxHeaders:null,crossOriginPolicy:n.crossOriginPolicy,ajaxWithCredentials:n.ajaxWithCredentials,postData:n.postData,callback:a,abort:n.abort,timeout:this.timeout},o=new e.ImageJob(r);!this.jobLimit||this.jobsInProgress<this.jobLimit?(o.start(),this.jobsInProgress++):this.jobQueue.push(o)},clear:function(){for(var t,e=0;e<this.jobQueue.length;e++)t=this.jobQueue[e],typeof t.abort=="function"&&t.abort();this.jobQueue=[]}};function t(e,t,n){t.errorMsg!==""&&(t.data===null||t.data===0[0])&&t.tries<1+e.tileRetryMax&&e.failedTiles.push(t);var s;e.jobsInProgress--,(!e.jobLimit||e.jobsInProgress<e.jobLimit)&&e.jobQueue.length>0&&(s=e.jobQueue.shift(),s.start(),e.jobsInProgress++),e.tileRetryMax>0&&e.jobQueue.length===0&&(!e.jobLimit||e.jobsInProgress<e.jobLimit)&&e.failedTiles.length>0&&(s=e.failedTiles.shift(),setTimeout(function(){s.start()},e.tileRetryDelay),e.jobsInProgress++),n(t.data,t.errorMsg,t.request)}}(t),function(e){e.Tile=function(n,s,o,i,a,r,c,l,d,u,h,m){this.level=n,this.x=s,this.y=o,this.bounds=i,this.positionedBounds=new t.Rect(i.x,i.y,i.width,i.height),this.sourceBounds=u,this.exists=a,this._url=r,this.postData=h,this.context2D=c,this.loadWithAjax=l,this.ajaxHeaders=d,m===0[0]&&(e.console.warn("Tile constructor needs 'cacheKey' variable: creation tile cache in Tile class is deprecated. TileSource.prototype.getTileHashKey will be used."),m=e.TileSource.prototype.getTileHashKey(n,s,o,r,d,h)),this.cacheKey=m,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.hasTransparency=!1,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return console.warn("Tile.prototype._hasTransparencyChannel() has been deprecated and will be removed in the future. Use TileSource.prototype.hasTransparency() instead."),!!this.context2D||this.getUrl().match(".png")},get image(){return e.console.error("[Tile.image] property has been deprecated. Use [Tile.prototype.getImage] instead."),this.getImage()},get url(){return e.console.error("[Tile.url] property has been deprecated. Use [Tile.prototype.getUrl] instead."),this.getUrl()},getImage:function(){return this.cacheImageRecord.getImage()},getUrl:function(){return typeof this._url=="function"?this._url():this._url},getCanvasContext:function(){return this.context2D||this.cacheImageRecord&&this.cacheImageRecord.getRenderedContext()},getScaleForEdgeSmoothing:function(){var t;if(this.cacheImageRecord)t=this.cacheImageRecord.getRenderedContext();else if(this.context2D)t=this.context2D;else return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return t.canvas.width/(this.size.x*e.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(t,n,s){var o=Math.max(1,Math.ceil((s.x-n.x)/2)),i=Math.max(1,Math.ceil((s.y-n.y)/2));return new e.Point(o,i).minus(this.position.times(e.pixelDensityRatio).times(t||1).apply(function(e){return e%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(t),function(e){e.OverlayPlacement=e.Placement,e.OverlayRotationMode=e.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),e.Overlay=function(t,n,s){var o;e.isPlainObject(t)?o=t:o={element:t,location:n,placement:s},this.elementWrapper=document.createElement("div"),this.element=o.element,this.elementWrapper.appendChild(this.element),this.element.id?this.elementWrapper.id="overlay-wrapper-"+this.element.id:this.elementWrapper.id="overlay-wrapper",this.style=this.elementWrapper.style,this._init(o)},e.Overlay.prototype={_init:function(t){this.location=t.location,this.placement=t.placement===0[0]?e.Placement.TOP_LEFT:t.placement,this.onDraw=t.onDraw,this.checkResize=t.checkResize===0[0]||t.checkResize,this.width=t.width===0[0]?null:t.width,this.height=t.height===0[0]?null:t.height,this.rotationMode=t.rotationMode||e.OverlayRotationMode.EXACT,this.location instanceof e.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=e.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new e.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(t,n){var s=e.Placement.properties[this.placement];s&&(s.isHorizontallyCentered?t.x-=n.x/2:s.isRight&&(t.x-=n.x),s.isVerticallyCentered?t.y-=n.y/2:s.isBottom&&(t.y-=n.y))},destroy:function(){var s,o,n=this.elementWrapper,t=this.style;n.parentNode&&(n.parentNode.removeChild(n),n.prevElementParent&&(t.display="none",document.body.appendChild(n))),this.onDraw=null,t.top="",t.left="",t.position="",this.width!==null&&(t.width=""),this.height!==null&&(t.height=""),s=e.getCssPropertyWithVendorPrefix("transformOrigin"),o=e.getCssPropertyWithVendorPrefix("transform"),s&&o&&(t[s]="",t[o]="")},drawHTML:function(t,n){a=this.elementWrapper,a.parentNode!==t&&(a.prevElementParent=a.parentNode,a.prevNextSibling=a.nextSibling,t.appendChild(a),this.style.position="absolute",this.size=e.getElementSize(this.elementWrapper));var s,o,i,a,r,c,m,l=this._getOverlayPositionAndSize(n),d=l.position,u=this.size=l.size,h="";n.overlayPreserveContentDirection&&(h=n.flipped?" scaleX(-1)":" scaleX(1)"),r=n.flipped?-l.rotate:l.rotate,m=n.flipped?" scaleX(-1)":"",this.onDraw?this.onDraw(d,u,this.element):(s=this.style,i=this.element.style,i.display="block",s.left=d.x+"px",s.top=d.y+"px",this.width!==null&&(i.width=u.x+"px"),this.height!==null&&(i.height=u.y+"px"),c=e.getCssPropertyWithVendorPrefix("transformOrigin"),o=e.getCssPropertyWithVendorPrefix("transform"),c&&o&&(r&&!n.flipped?(i[o]="",s[c]=this._getTransformOrigin(),s[o]="rotate("+r+"deg)"):!r&&n.flipped?(i[o]=h,s[c]=this._getTransformOrigin(),s[o]=m):r&&n.flipped?(i[o]=h,s[c]=this._getTransformOrigin(),s[o]="rotate("+r+"deg)"+m):(i[o]="",s[c]="",s[o]="")),s.display="flex")},_getOverlayPositionAndSize:function(t){var o,i,a,n=t.pixelFromPoint(this.location,!0),s=this._getSizeInPixels(t);return this.adjust(n,s),o=0,t.getRotation(!0)&&this.rotationMode!==e.OverlayRotationMode.NO_ROTATION&&(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null?(a=new e.Rect(n.x,n.y,s.x,s.y),i=this._getBoundingBox(a,t.getRotation(!0)),n=i.getTopLeft(),s=i.getSize()):o=t.getRotation(!0)),t.flipped&&(n.x=t.getContainerSize().x-n.x),{position:n,size:s,rotate:o}},_getSizeInPixels:function(t){var o,i,n=this.size.x,s=this.size.y;return(this.width!==null||this.height!==null)&&(o=t.deltaPixelsFromPointsNoRotate(new e.Point(this.width||0,this.height||0),!0),this.width!==null&&(n=o.x),this.height!==null&&(s=o.y)),this.checkResize&&(this.width===null||this.height===null)&&(i=this.size=e.getElementSize(this.elementWrapper),this.width===null&&(n=i.x),this.height===null&&(s=i.y)),new e.Point(n,s)},_getBoundingBox:function(e,t){var n=this._getPlacementPoint(e);return e.rotate(t,n).getBoundingBox()},_getPlacementPoint:function(t){var n=new e.Point(t.x,t.y),s=e.Placement.properties[this.placement];return s&&(s.isHorizontallyCentered?n.x+=t.width/2:s.isRight&&(n.x+=t.width),s.isVerticallyCentered?n.y+=t.height/2:s.isBottom&&(n.y+=t.height)),n},_getTransformOrigin:function(){var t="",n=e.Placement.properties[this.placement];return n&&(n.isLeft?t="left":n.isRight&&(t="right"),n.isTop?t+=" top":n.isBottom&&(t+=" bottom")),t},update:function(t,n){var s=e.isPlainObject(t)?t:{location:t,placement:n};this._init({location:s.location||this.location,placement:s.placement!==0[0]?s.placement:this.placement,onDraw:s.onDraw||this.onDraw,checkResize:s.checkResize||this.checkResize,width:s.width!==0[0]?s.width:this.width,height:s.height!==0[0]?s.height:this.height,rotationMode:s.rotationMode||this.rotationMode})},getBounds:function(t){e.console.assert(t,"A viewport must now be passed to Overlay.getBounds.");var o,i,n=this.width,s=this.height;return(n===null||s===null)&&(i=t.deltaPointsFromPixelsNoRotate(this.size,!0),n===null&&(n=i.x),s===null&&(s=i.y)),o=this.location.clone(),this.adjust(o,new e.Point(n,s)),this._adjustBoundsForRotation(t,new e.Rect(o.x,o.y,n,s))},_adjustBoundsForRotation:function(t,n){if(!t||t.getRotation(!0)===0||this.rotationMode===e.OverlayRotationMode.EXACT)return n;if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return n;var s=this._getOverlayPositionAndSize(t);return t.viewerElementToViewportRectangle(new e.Rect(s.position.x,s.position.y,s.size.x,s.size.y))}return n.rotate(-t.getRotation(!0),this._getPlacementPoint(n))}}}(t),function(e){const t=e;t.DrawerBase=class{constructor(t){e.console.assert(t.viewer,"[Drawer] options.viewer is required"),e.console.assert(t.viewport,"[Drawer] options.viewport is required"),e.console.assert(t.element,"[Drawer] options.element is required"),this.viewer=t.viewer,this.viewport=t.viewport,this.debugGridColor=typeof t.debugGridColor=="string"?[t.debugGridColor]:t.debugGridColor||e.DEFAULT_SETTINGS.debugGridColor,this.options=t.options||{},this.container=e.getElement(t.element),this._renderingTarget=this._createDrawingElement(),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",this.canvas.style.left="0",e.setElementOpacity(this.canvas,this.viewer.opacity,!0),e.setElementPointerEventsNone(this.canvas),e.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._checkForAPIOverrides()}get canvas(){return this._renderingTarget}get element(){return e.console.error("Drawer.element is deprecated. Use Drawer.container instead."),this.container}getType(){e.console.error("Drawer.getType must be implemented by child class")}static isSupported(){e.console.error("Drawer.isSupported must be implemented by child class")}_createDrawingElement(){return e.console.error("Drawer._createDrawingElement must be implemented by child class"),null}draw(){e.console.error("Drawer.draw must be implemented by child class")}canRotate(){e.console.error("Drawer.canRotate must be implemented by child class")}destroy(){e.console.error("Drawer.destroy must be implemented by child class")}minimumOverlapRequired(){return!1}setImageSmoothingEnabled(){e.console.error("Drawer.setImageSmoothingEnabled must be implemented by child class")}drawDebuggingRect(){e.console.warn("[drawer].drawDebuggingRect is not implemented by this drawer")}clear(){e.console.warn("[drawer].clear() is deprecated. The drawer is responsible for clearing itself as needed before drawing tiles.")}_checkForAPIOverrides(){if(this._createDrawingElement===e.DrawerBase.prototype._createDrawingElement)throw new Error("[drawer]._createDrawingElement must be implemented by child class");if(this.draw===e.DrawerBase.prototype.draw)throw new Error("[drawer].draw must be implemented by child class");if(this.canRotate===e.DrawerBase.prototype.canRotate)throw new Error("[drawer].canRotate must be implemented by child class");if(this.destroy===e.DrawerBase.prototype.destroy)throw new Error("[drawer].destroy must be implemented by child class");if(this.setImageSmoothingEnabled===e.DrawerBase.prototype.setImageSmoothingEnabled)throw new Error("[drawer].setImageSmoothingEnabled must be implemented by child class")}viewportToDrawerRectangle(t){var n=this.viewport.pixelFromPointNoRotate(t.getTopLeft(),!0),s=this.viewport.deltaPixelsFromPointsNoRotate(t.getSize(),!0);return new e.Rect(n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio,s.x*e.pixelDensityRatio,s.y*e.pixelDensityRatio)}viewportCoordToDrawerCoord(t){var n=this.viewport.pixelFromPointNoRotate(t,!0);return new e.Point(n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio)}_calculateCanvasSize(){var n=e.pixelDensityRatio,s=this.viewport.getContainerSize();return new t.Point(Math.round(s.x*n),Math.round(s.y*n))}_raiseTiledImageDrawnEvent(e,t){this.viewer&&this.viewer.raiseEvent("tiled-image-drawn",{tiledImage:e,tiles:t})}_raiseDrawerErrorEvent(e,t){this.viewer&&this.viewer.raiseEvent("drawer-error",{tiledImage:e,drawer:this,error:t})}}}(t),function(e){const t=e;class n extends t.DrawerBase{constructor(e){super(e),this.viewer.rejectEventHandler("tile-drawing","The HTMLDrawer does not raise the tile-drawing event"),this.viewer.allowEventHandler("tile-drawn")}static isSupported(){return!0}getType(){return"html"}minimumOverlapRequired(){return!0}_createDrawingElement(){return e.makeNeutralElement("div")}draw(e){var t=this;this._prepareNewFrame(),e.forEach(function(e){e.opacity!==0&&t._drawTiles(e)})}canRotate(){return!1}destroy(){this.container.removeChild(this.canvas)}setImageSmoothingEnabled(){}_prepareNewFrame(){this.canvas.innerHTML=""}_drawTiles(e){var t,s,n=e.getTilesToDraw().map(e=>e.tile);if(!(e.opacity===0||n.length===0&&!e.placeholderFillStyle))for(t=n.length-1;t>=0;t--)s=n[t],this._drawTile(s),this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:e,tile:s})}_drawTile(t){e.console.assert(t,"[Drawer._drawTile] tile is required");let n=this.canvas;if(!t.cacheImageRecord){e.console.warn("[Drawer._drawTileToHTML] attempting to draw tile %s when it's not cached",t.toString());return}if(!t.loaded){e.console.warn("Attempting to draw tile %s when it's not yet loaded.",t.toString());return}if(!t.element){var s=t.getImage();if(!s)return;t.element=e.makeNeutralElement("div"),t.imgElement=s.cloneNode(),t.imgElement.style.msInterpolationMode="nearest-neighbor",t.imgElement.style.width="100%",t.imgElement.style.height="100%",t.style=t.element.style,t.style.position="absolute"}t.element.parentNode!==n&&n.appendChild(t.element),t.imgElement.parentNode!==t.element&&t.element.appendChild(t.imgElement),t.style.top=t.position.y+"px",t.style.left=t.position.x+"px",t.style.height=t.size.y+"px",t.style.width=t.size.x+"px",t.flipped&&(t.style.transform="scaleX(-1)"),e.setElementOpacity(t.element,t.opacity)}}e.HTMLDrawer=n}(t),function(e){const o=e;class i extends o.DrawerBase{constructor(e){super(e),this.context=this.canvas.getContext("2d"),this.sketchCanvas=null,this.sketchContext=null,this._imageSmoothingEnabled=!0,this.viewer.allowEventHandler("tile-drawn"),this.viewer.allowEventHandler("tile-drawing")}static isSupported(){return e.supportsCanvas}getType(){return"canvas"}_createDrawingElement(){let t=e.makeNeutralElement("canvas"),n=this._calculateCanvasSize();return t.width=n.x,t.height=n.y,t}draw(e){this._prepareNewFrame(),this.viewer.viewport.getFlip()!==this._viewportFlipped&&this._flip();for(const t of e)t.opacity!==0&&this._drawTiles(t)}canRotate(){return!0}destroy(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null,this.container.removeChild(this.canvas)}minimumOverlapRequired(){return!0}setImageSmoothingEnabled(e){this._imageSmoothingEnabled=!!e,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw()}drawDebuggingRect(t){var n=this.context;n.save(),n.lineWidth=2*e.pixelDensityRatio,n.strokeStyle=this.debugGridColor[0],n.fillStyle=this.debugGridColor[0],n.strokeRect(t.x*e.pixelDensityRatio,t.y*e.pixelDensityRatio,t.width*e.pixelDensityRatio,t.height*e.pixelDensityRatio),n.restore()}get _viewportFlipped(){return this.context.getTransform().a<0}_raiseTileDrawingEvent(e,t,n,s){this.viewer.raiseEvent("tile-drawing",{tiledImage:e,context:t,tile:n,rendered:s})}_prepareNewFrame(){var t,e=this._calculateCanvasSize();(this.canvas.width!==e.x||this.canvas.height!==e.y)&&(this.canvas.width=e.x,this.canvas.height=e.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)&&(t=this._calculateSketchCanvasSize(),this.sketchCanvas.width=t.x,this.sketchCanvas.height=t.y,this._updateImageSmoothingEnabled(this.sketchContext)),this._clear()}_clear(e,t){var s,n=this._getContext(e);t?n.clearRect(t.x,t.y,t.width,t.height):(s=n.canvas,n.clearRect(0,0,s.width,s.height))}_drawTiles(t){if(r=t.getTilesToDraw().map(e=>e.tile),!(t.opacity===0||r.length===0&&!t.placeholderFillStyle)){o=r[0],o&&(s=t.opacity<1||t.compositeOperation&&t.compositeOperation!=="source-over"||!t._isBottomItem()&&t.source.hasTransparency(o.context2D,o.getUrl(),o.ajaxHeaders,o.postData));var n,s,o,i,r,c,l,d,u,h,m,f,p,g,v,j=this.viewport.getZoom(!0),b=t.viewportToImageZoom(j);if(r.length>1&&b>t.smoothTileEdgesMinZoom&&!t.iOSDevice&&t.getRotation(!0)%360===0&&(s=!0,n=o.getScaleForEdgeSmoothing(),i=o.getTranslationForEdgeSmoothing(n,this._getCanvasSize(!1),this._getCanvasSize(!0))),s&&(n||(d=this.viewport.viewportToViewerElementRectangle(t.getClippedBounds(!0)).getIntegerBoundingBox(),d=d.times(e.pixelDensityRatio)),this._clear(!0,d)),n||this._setRotations(t,s),l=!1,t._clip&&(this._saveContext(s),u=t.imageToViewportRectangle(t._clip,!0),u=u.rotate(-t.getRotation(!0),t._getRotationPoint(!0)),c=this.viewportToDrawerRectangle(u),n&&(c=c.times(n)),i&&(c=c.translate(i)),this._setClip(c,s),l=!0),t._croppingPolygons){p=this,l||this._saveContext(s);try{g=t._croppingPolygons.map(function(e){return e.map(function(e){var o=t.imageToViewportCoordinates(e.x,e.y,!0).rotate(-t.getRotation(!0),t._getRotationPoint(!0)),s=p.viewportCoordToDrawerCoord(o);return n&&(s=s.times(n)),i&&(s=s.plus(i)),s})}),this._clipWithPolygons(g,s)}catch(t){e.console.error(t)}l=!0}if(t._hasOpaqueTile=!1,t.placeholderFillStyle&&t._hasOpaqueTile===!1){let e=this.viewportToDrawerRectangle(t.getBoundsNoRotate(!0));n&&(e=e.times(n)),i&&(e=e.translate(i));let o=null;typeof t.placeholderFillStyle=="function"?o=t.placeholderFillStyle(t,this.context):o=t.placeholderFillStyle,this._drawRectangle(e,o,s)}f=a(t.subPixelRoundingForTransparency),h=!1,f===e.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS?h=!0:f===e.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&(v=this.viewer&&this.viewer.isAnimating(),h=!v);for(m=0;m<r.length;m++)o=r[m],this._drawTile(o,t,s,n,i,h,t.source),this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:t,tile:o});l&&this._restoreContext(s),n||(t.getRotation(!0)%360!==0&&this._restoreRotationChanges(s),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(s)),s&&(n&&this._setRotations(t),this.blendSketch({opacity:t.opacity,scale:n,translate:i,compositeOperation:t.compositeOperation,bounds:d}),n&&(t.getRotation(!0)%360!==0&&this._restoreRotationChanges(!1),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(!1))),this._drawDebugInfo(t,r),this._raiseTiledImageDrawnEvent(t,r)}}_drawDebugInfo(t,n){if(t.debugMode)for(var o,s=n.length-1;s>=0;s--){o=n[s];try{this._drawDebugInfoOnTile(o,n.length,s,t)}catch(t){e.console.error(t)}}}_clipWithPolygons(e,t){var n=this._getContext(t);n.beginPath();for(const t of e)for(const[s,e]of t.entries())n[s===0?"moveTo":"lineTo"](e.x,e.y);n.clip()}_drawTile(t,n,s,o,i,a,r){e.console.assert(t,"[Drawer._drawTile] tile is required"),e.console.assert(n,"[Drawer._drawTile] drawingHandler is required");var c=this._getContext(s);o=o||1,this._drawTileToCanvas(t,c,n,o,i,a,r)}_drawTileToCanvas(t,n,s,o,i,a){var d,u,h,c=t.position.times(e.pixelDensityRatio),l=t.size.times(e.pixelDensityRatio);if(!t.context2D&&!t.cacheImageRecord){e.console.warn("[Drawer._drawTileToCanvas] attempting to draw tile %s when it's not cached",t.toString());return}if(d=t.getCanvasContext(),!t.loaded||!d){e.console.warn("Attempting to draw tile %s when it's not yet loaded.",t.toString());return}n.save(),typeof o=="number"&&o!==1&&(c=c.times(o),l=l.times(o)),i instanceof e.Point&&(c=c.plus(i)),n.globalAlpha===1&&t.hasTransparency&&(a&&(c.x=Math.round(c.x),c.y=Math.round(c.y),l.x=Math.round(l.x),l.y=Math.round(l.y)),n.clearRect(c.x,c.y,l.x,l.y)),this._raiseTileDrawingEvent(s,n,t,d),t.sourceBounds?(u=Math.min(t.sourceBounds.width,d.canvas.width),h=Math.min(t.sourceBounds.height,d.canvas.height)):(u=d.canvas.width,h=d.canvas.height),n.translate(c.x+l.x/2,0),t.flipped&&n.scale(-1,1),n.drawImage(d.canvas,0,0,u,h,-l.x/2,c.y,l.x,l.y),n.restore()}_getContext(e){var t,n,s=this.context;return e&&(this.sketchCanvas===null&&(this.sketchCanvas=document.createElement("canvas"),n=this._calculateSketchCanvasSize(),(this.sketchCanvas.width=n.x,this.sketchCanvas.height=n.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0)&&(t=this,this.viewer.addHandler("rotate",function e(){if(t.viewport.getRotation()!==0){t.viewer.removeHandler("rotate",e);var n=t._calculateSketchCanvasSize();t.sketchCanvas.width=n.x,t.sketchCanvas.height=n.y}})),this._updateImageSmoothingEnabled(this.sketchContext)),s=this.sketchContext),s}_saveContext(e){this._getContext(e).save()}_restoreContext(e){this._getContext(e).restore()}_setClip(e,t){var n=this._getContext(t);n.beginPath(),n.rect(e.x,e.y,e.width,e.height),n.clip()}_drawRectangle(e,t,n){var s=this._getContext(n);s.save(),s.fillStyle=t,s.fillRect(e.x,e.y,e.width,e.height),s.restore()}blendSketch(t,n,s,o){if(a=t,e.isPlainObject(a)||(a={opacity:t,scale:n,translate:s,compositeOperation:o}),t=a.opacity,o=a.compositeOperation,i=a.bounds,this.context.save(),this.context.globalAlpha=t,o&&(this.context.globalCompositeOperation=o),i)i.x<0&&(i.width+=i.x,i.x=0),i.x+i.width>this.canvas.width&&(i.width=this.canvas.width-i.x),i.y<0&&(i.height+=i.y,i.y=0),i.y+i.height>this.canvas.height&&(i.height=this.canvas.height-i.y),this.context.drawImage(this.sketchCanvas,i.x,i.y,i.width,i.height,i.x,i.y,i.width,i.height);else{n=a.scale||1,s=a.translate;var i,a,d,u,l=s instanceof e.Point?s:new e.Point(0,0),r=0,c=0;s&&(d=this.sketchCanvas.width-this.canvas.width,u=this.sketchCanvas.height-this.canvas.height,r=Math.round(d/2),c=Math.round(u/2)),this.context.drawImage(this.sketchCanvas,l.x-r*n,l.y-c*n,(this.canvas.width+2*r)*n,(this.canvas.height+2*c)*n,-r,-c,this.canvas.width+2*r,this.canvas.height+2*c)}this.context.restore()}_drawDebugInfoOnTile(t,n,s,o){var a,r,c=this.viewer.world.getIndexOfItem(o)%this.debugGridColor.length,i=this.context;i.save(),i.lineWidth=2*e.pixelDensityRatio,i.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",i.strokeStyle=this.debugGridColor[c],i.fillStyle=this.debugGridColor[c],this._setRotations(o),this._viewportFlipped&&this._flip({point:t.position.plus(t.size.divide(2))}),i.strokeRect(t.position.x*e.pixelDensityRatio,t.position.y*e.pixelDensityRatio,t.size.x*e.pixelDensityRatio,t.size.y*e.pixelDensityRatio),a=(t.position.x+t.size.x/2)*e.pixelDensityRatio,r=(t.position.y+t.size.y/2)*e.pixelDensityRatio,i.translate(a,r);const l=this.viewport.getRotation(!0);i.rotate(Math.PI/180*-l),i.translate(-a,-r),t.x===0&&t.y===0&&(i.fillText("Zoom: "+this.viewport.getZoom(),t.position.x*e.pixelDensityRatio,(t.position.y-30)*e.pixelDensityRatio),i.fillText("Pan: "+this.viewport.getBounds().toString(),t.position.x*e.pixelDensityRatio,(t.position.y-20)*e.pixelDensityRatio)),i.fillText("Level: "+t.level,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+20)*e.pixelDensityRatio),i.fillText("Column: "+t.x,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+30)*e.pixelDensityRatio),i.fillText("Row: "+t.y,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+40)*e.pixelDensityRatio),i.fillText("Order: "+s+" of "+n,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+50)*e.pixelDensityRatio),i.fillText("Size: "+t.size.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+60)*e.pixelDensityRatio),i.fillText("Position: "+t.position.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+70)*e.pixelDensityRatio),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(),o.getRotation(!0)%360!==0&&this._restoreRotationChanges(),i.restore()}_updateImageSmoothingEnabled(e){e.msImageSmoothingEnabled=this._imageSmoothingEnabled,e.imageSmoothingEnabled=this._imageSmoothingEnabled}_getCanvasSize(t){var n=this._getContext(t).canvas;return new e.Point(n.width,n.height)}_getCanvasCenter(){return new e.Point(this.canvas.width/2,this.canvas.height/2)}_setRotations(e,t=!1){var n=!1;this.viewport.getRotation(!0)%360!==0&&(this._offsetForRotation({degrees:this.viewport.getRotation(!0),useSketch:t,saveContext:n}),n=!1),e.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:e.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(e._getRotationPoint(!0),!0),useSketch:t,saveContext:n})}_offsetForRotation(t){var n=t.point?t.point.times(e.pixelDensityRatio):this._getCanvasCenter(),s=this._getContext(t.useSketch);s.save(),s.translate(n.x,n.y),s.rotate(Math.PI/180*t.degrees),s.translate(-n.x,-n.y)}_flip(t){t=t||{};var s=t.point?t.point.times(e.pixelDensityRatio):this._getCanvasCenter(),n=this._getContext(t.useSketch);n.translate(s.x,0),n.scale(-1,1),n.translate(-s.x,0)}_restoreRotationChanges(e){var t=this._getContext(e);t.restore()}_calculateCanvasSize(){var t=e.pixelDensityRatio,n=this.viewport.getContainerSize();return{x:Math.round(n.x*t),y:Math.round(n.y*t)}}_calculateSketchCanvasSize(){var t,e=this._calculateCanvasSize();return this.viewport.getRotation()===0?e:(t=Math.ceil((e.x*e.x+e.y*e.y)**.5),{x:t,y:t})}}e.CanvasDrawer=i;var t=e.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER;function n(t){return t!==e.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS&&t!==e.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&t!==e.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER}function s(e){return n(e)?t:e}function a(o){if(typeof o=="number")return s(o);if(!o||!e.Browser)return t;var i=o[e.Browser.vendor];return n(i)&&(i=o["*"]),s(i)}}(t),function(e){const t=e;t.WebGLDrawer=class extends t.DrawerBase{constructor(e){super(e),this._destroyed=!1,this._TextureMap=new Map,this._TileMap=new Map,this._gl=null,this._firstPass=null,this._secondPass=null,this._glFrameBuffer=null,this._renderToTexture=null,this._glFramebufferToCanvasTransform=null,this._outputCanvas=null,this._outputContext=null,this._clippingCanvas=null,this._clippingContext=null,this._renderingCanvas=null,this._backupCanvasDrawer=null,this._imageSmoothingEnabled=!0,this._boundToTileReady=e=>this._tileReadyHandler(e),this._boundToImageUnloaded=e=>this._imageUnloadedHandler(e),this.viewer.addHandler("tile-ready",this._boundToTileReady),this.viewer.addHandler("image-unloaded",this._boundToImageUnloaded),this.viewer.rejectEventHandler("tile-drawn","The WebGLDrawer does not raise the tile-drawn event"),this.viewer.rejectEventHandler("tile-drawing","The WebGLDrawer does not raise the tile-drawing event"),this._setupCanvases(),this._setupRenderer(),this.context=this._outputContext}destroy(){if(this._destroyed)return;let e=this._gl;var n=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(let t=0;t<n;++t)e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),this._unloadTextures(),e.deleteBuffer(this._secondPass.bufferOutputPosition),e.deleteFramebuffer(this._glFrameBuffer),this._renderingCanvas.width=this._renderingCanvas.height=1,this._clippingCanvas.width=this._clippingCanvas.height=1,this._outputCanvas.width=this._outputCanvas.height=1,this._renderingCanvas=null,this._clippingCanvas=this._clippingContext=null,this._outputCanvas=this._outputContext=null;let t=e.getExtension("WEBGL_lose_context");t&&t.loseContext(),this.viewer.removeHandler("tile-ready",this._boundToTileReady),this.viewer.removeHandler("image-unloaded",this._boundToImageUnloaded),this.viewer.removeHandler("resize",this._resizeHandler),this._gl=null,this._backupCanvasDrawer&&(this._backupCanvasDrawer.destroy(),this._backupCanvasDrawer=null),this.container.removeChild(this.canvas),this.viewer.drawer===this&&(this.viewer.drawer=null),this._destroyed=!0}canRotate(){return!0}static isSupported(){let n=document.createElement("canvas"),t=e.isFunction(n.getContext)&&n.getContext("webgl"),s=t&&t.getExtension("WEBGL_lose_context");return s&&s.loseContext(),!!t}getType(){return"webgl"}minimumOverlapRequired(e){return e.isTainted()}_createDrawingElement(){let t=e.makeNeutralElement("canvas"),n=this._calculateCanvasSize();return t.width=n.x,t.height=n.y,t}_getBackupCanvasDrawer(){return this._backupCanvasDrawer||(this._backupCanvasDrawer=this.viewer.requestDrawer("canvas",{mainDrawer:!1}),this._backupCanvasDrawer.canvas.style.setProperty("visibility","hidden")),this._backupCanvasDrawer}draw(n){let s=this._gl;const i=this.viewport.getBoundsNoRotateWithMargins(!0);let a={bounds:i,center:new t.Point(i.x+i.width/2,i.y+i.height/2),rotation:this.viewport.getRotation(!0)*Math.PI/180},c=this.viewport.flipped?-1:1,l=e.Mat3.makeTranslation(-a.center.x,-a.center.y),d=e.Mat3.makeScaling(2/a.bounds.width*c,-2/a.bounds.height),u=e.Mat3.makeRotation(-a.rotation),r=d.multiply(u).multiply(l);s.bindFramebuffer(s.FRAMEBUFFER,null),s.clear(s.COLOR_BUFFER_BIT),this._outputContext.clearRect(0,0,this._outputCanvas.width,this._outputCanvas.height);let o=!1;n.forEach((t,n)=>{if(t.isTainted()){o&&(this._outputContext.drawImage(this._renderingCanvas,0,0),s.bindFramebuffer(s.FRAMEBUFFER,null),s.clear(s.COLOR_BUFFER_BIT),o=!1);const e=this._getBackupCanvasDrawer();e.draw([t]),this._outputContext.drawImage(e.canvas,0,0)}else{let a=t.getTilesToDraw();if(t.placeholderFillStyle&&t._hasOpaqueTile===!1&&this._drawPlaceholder(t),a.length===0||t.getOpacity()===0)return;let g=a[0],c=t.compositeOperation||this.viewer.compositeOperation||t._clip||t._croppingPolygons||t.debugMode,l=c||t.opacity<1||g.hasTransparency;c&&(o&&this._outputContext.drawImage(this._renderingCanvas,0,0),s.bindFramebuffer(s.FRAMEBUFFER,null),s.clear(s.COLOR_BUFFER_BIT)),s.useProgram(this._firstPass.shaderProgram),l?(s.bindFramebuffer(s.FRAMEBUFFER,this._glFrameBuffer),s.clear(s.COLOR_BUFFER_BIT)):s.bindFramebuffer(s.FRAMEBUFFER,null);let d=r,u=t.getRotation(!0);if(u%360!==0){let s=e.Mat3.makeRotation(-u*Math.PI/180),n=t.getBoundsNoRotate(!0).getCenter(),o=e.Mat3.makeTranslation(n.x,n.y),i=e.Mat3.makeTranslation(-n.x,-n.y),a=o.multiply(s).multiply(i);d=r.multiply(a)}let i=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS);if(i<=0)throw new Error(`WegGL error: bad value for gl parameter MAX_TEXTURE_IMAGE_UNITS (${i}). This could happen
                        if too many contexts have been created and not released, or there is another problem with the graphics card.`);let h=new Float32Array(i*12),m=new Array(i),f=new Array(i),p=new Array(i);for(let e=0;e<a.length;e++){let r=a[e].tile,l=e%i,c=l+1,n=r.getCanvasContext(),o=n?this._TextureMap.get(n.canvas):null;if(o||(this._tileReadyHandler({tile:r,tiledImage:t}),o=n?this._TextureMap.get(n.canvas):null),o&&this._getTileData(r,t,o,d,l,h,m,f,p),c===i||e===a.length-1){for(let e=0;e<=c;e++)s.activeTexture(s.TEXTURE0+e),s.bindTexture(s.TEXTURE_2D,m[e]);s.bindBuffer(s.ARRAY_BUFFER,this._firstPass.bufferTexturePosition),s.bufferData(s.ARRAY_BUFFER,h,s.DYNAMIC_DRAW),f.forEach((e,t)=>{s.uniformMatrix3fv(this._firstPass.uTransformMatrices[t],!1,e)}),s.uniform1fv(this._firstPass.uOpacities,new Float32Array(p)),s.bindBuffer(s.ARRAY_BUFFER,this._firstPass.bufferOutputPosition),s.vertexAttribPointer(this._firstPass.aOutputPosition,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this._firstPass.bufferTexturePosition),s.vertexAttribPointer(this._firstPass.aTexturePosition,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this._firstPass.bufferIndex),s.vertexAttribPointer(this._firstPass.aIndex,1,s.FLOAT,!1,0,0),s.drawArrays(s.TRIANGLES,0,6*c)}}l&&(s.useProgram(this._secondPass.shaderProgram),s.bindFramebuffer(s.FRAMEBUFFER,null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this._renderToTexture),this._gl.uniform1f(this._secondPass.uOpacityMultiplier,t.opacity),s.bindBuffer(s.ARRAY_BUFFER,this._secondPass.bufferTexturePosition),s.vertexAttribPointer(this._secondPass.aTexturePosition,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this._secondPass.bufferOutputPosition),s.vertexAttribPointer(this._secondPass.aOutputPosition,2,s.FLOAT,!1,0,0),s.drawArrays(s.TRIANGLES,0,6)),o=!0,c&&(this._applyContext2dPipeline(t,a,n),o=!1,s.bindFramebuffer(s.FRAMEBUFFER,null),s.clear(s.COLOR_BUFFER_BIT)),n===0&&this._raiseTiledImageDrawnEvent(t,a.map(e=>e.tile))}}),o&&this._outputContext.drawImage(this._renderingCanvas,0,0)}setImageSmoothingEnabled(e){this._imageSmoothingEnabled!==e&&(this._imageSmoothingEnabled=e,this._unloadTextures(),this.viewer.world.draw())}drawDebuggingRect(t){let n=this._outputContext;n.save(),n.lineWidth=2*e.pixelDensityRatio,n.strokeStyle=this.debugGridColor[0],n.fillStyle=this.debugGridColor[0],n.strokeRect(t.x*e.pixelDensityRatio,t.y*e.pixelDensityRatio,t.width*e.pixelDensityRatio,t.height*e.pixelDensityRatio),n.restore()}_getTextureDataFromTile(e){return e.getCanvasContext().canvas}_applyContext2dPipeline(e,t,n){if(this._outputContext.save(),this._outputContext.globalCompositeOperation=n===0?null:e.compositeOperation||this.viewer.compositeOperation,e._croppingPolygons||e._clip?(this._renderToClippingCanvas(e),this._outputContext.drawImage(this._clippingCanvas,0,0)):this._outputContext.drawImage(this._renderingCanvas,0,0),this._outputContext.restore(),e.debugMode){const n=this.viewer.viewport.getFlip();n&&this._flip(),this._drawDebugInfo(t,e,n),n&&this._flip()}}_getTileData(t,n,s,o,i,a,r,c,l){let g=s.texture,_=s.position;a.set(_,i*12);let h=this._calculateOverlapFraction(t,n),m=t.positionedBounds.width*h.x,f=t.positionedBounds.height*h.y,p=t.positionedBounds.x+(t.x===0?0:m),u=t.positionedBounds.y+(t.y===0?0:f),v=t.positionedBounds.x+t.positionedBounds.width-(t.isRightMost?0:m),b=t.positionedBounds.y+t.positionedBounds.height-(t.isBottomMost?0:f),j=v-p,y=b-u,d=new e.Mat3([j,0,0,0,y,0,p,u,1]);if(t.flipped){let t=e.Mat3.makeTranslation(.5,0),n=e.Mat3.makeTranslation(-.5,0),s=t.multiply(e.Mat3.makeScaling(-1,1)).multiply(n);d=d.multiply(s)}let w=o.multiply(d);l[i]=t.opacity,r[i]=g,c[i]=w.values}_textureFilter(){return this._imageSmoothingEnabled?this._gl.LINEAR:this._gl.NEAREST}_setupRenderer(){let t=this._gl;t||e.console.error("_setupCanvases must be called before _setupRenderer"),this._unitQuad=this._makeQuadVertexBuffer(0,1,0,1),this._makeFirstPassShaderProgram(),this._makeSecondPassShaderProgram(),this._renderToTexture=t.createTexture(),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._renderToTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this._renderingCanvas.width,this._renderingCanvas.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this._textureFilter()),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this._glFrameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._glFrameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this._renderToTexture,0),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)}_makeFirstPassShaderProgram(){let t=this._glNumTextures=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),o=()=>[...Array(t).keys()].map(e=>`uniform mat3 u_matrix_${e};`).join(`
`),i=()=>[...Array(t).keys()].map(e=>`${e>0?"else ":""}if(int(a_index) == ${e}) { transform_matrix = u_matrix_${e}; }`).join(`
`);const a=`
            attribute vec2 a_output_position;
            attribute vec2 a_texture_position;
            attribute float a_index;

            ${o()} // create a uniform mat3 for each potential tile to draw

            varying vec2 v_texture_position;
            varying float v_image_index;

            void main() {

                mat3 transform_matrix; // value will be set by the if/elses in makeConditional()

                ${i()}

                gl_Position = vec4(transform_matrix * vec3(a_output_position, 1), 1);

                v_texture_position = a_texture_position;
                v_image_index = a_index;
            }
            `,r=`
            precision mediump float;

            // our textures
            uniform sampler2D u_images[${t}];
            // our opacities
            uniform float u_opacities[${t}];

            // the varyings passed in from the vertex shader.
            varying vec2 v_texture_position;
            varying float v_image_index;

            void main() {
                // can't index directly with a variable, need to use a loop iterator hack
                for(int i = 0; i < ${t}; ++i){
                    if(i == int(v_image_index)){
                        gl_FragColor = texture2D(u_images[i], v_texture_position) * u_opacities[i];
                    }
                }
            }
            `;let e=this._gl,n=this.constructor.initShaderProgram(e,a,r);e.useProgram(n),this._firstPass={shaderProgram:n,aOutputPosition:e.getAttribLocation(n,"a_output_position"),aTexturePosition:e.getAttribLocation(n,"a_texture_position"),aIndex:e.getAttribLocation(n,"a_index"),uTransformMatrices:[...Array(this._glNumTextures).keys()].map(t=>e.getUniformLocation(n,`u_matrix_${t}`)),uImages:e.getUniformLocation(n,"u_images"),uOpacities:e.getUniformLocation(n,"u_opacities"),bufferOutputPosition:e.createBuffer(),bufferTexturePosition:e.createBuffer(),bufferIndex:e.createBuffer()},e.uniform1iv(this._firstPass.uImages,[...Array(t).keys()]);let s=new Float32Array(t*12);for(let e=0;e<t;++e)s.set(Float32Array.from(this._unitQuad),e*12);e.bindBuffer(e.ARRAY_BUFFER,this._firstPass.bufferOutputPosition),e.bufferData(e.ARRAY_BUFFER,s,e.STATIC_DRAW),e.enableVertexAttribArray(this._firstPass.aOutputPosition),e.bindBuffer(e.ARRAY_BUFFER,this._firstPass.bufferTexturePosition),e.enableVertexAttribArray(this._firstPass.aTexturePosition),e.bindBuffer(e.ARRAY_BUFFER,this._firstPass.bufferIndex);let c=[...Array(this._glNumTextures).keys()].map(e=>Array(6).fill(e)).flat();e.bufferData(e.ARRAY_BUFFER,new Float32Array(c),e.STATIC_DRAW),e.enableVertexAttribArray(this._firstPass.aIndex)}_makeSecondPassShaderProgram(){const s=`
            attribute vec2 a_output_position;
            attribute vec2 a_texture_position;

            uniform mat3 u_matrix;

            varying vec2 v_texture_position;

            void main() {
                gl_Position = vec4(u_matrix * vec3(a_output_position, 1), 1);

                v_texture_position = a_texture_position;
            }
            `,o=`
            precision mediump float;

            // our texture
            uniform sampler2D u_image;

            // the texCoords passed in from the vertex shader.
            varying vec2 v_texture_position;

            // the opacity multiplier for the image
            uniform float u_opacity_multiplier;

            void main() {
                gl_FragColor = texture2D(u_image, v_texture_position);
                gl_FragColor *= u_opacity_multiplier;
            }
            `;let t=this._gl,n=this.constructor.initShaderProgram(t,s,o);t.useProgram(n),this._secondPass={shaderProgram:n,aOutputPosition:t.getAttribLocation(n,"a_output_position"),aTexturePosition:t.getAttribLocation(n,"a_texture_position"),uMatrix:t.getUniformLocation(n,"u_matrix"),uImage:t.getUniformLocation(n,"u_image"),uOpacityMultiplier:t.getUniformLocation(n,"u_opacity_multiplier"),bufferOutputPosition:t.createBuffer(),bufferTexturePosition:t.createBuffer()},t.bindBuffer(t.ARRAY_BUFFER,this._secondPass.bufferOutputPosition),t.bufferData(t.ARRAY_BUFFER,this._unitQuad,t.STATIC_DRAW),t.enableVertexAttribArray(this._secondPass.aOutputPosition),t.bindBuffer(t.ARRAY_BUFFER,this._secondPass.bufferTexturePosition),t.bufferData(t.ARRAY_BUFFER,this._unitQuad,t.DYNAMIC_DRAW),t.enableVertexAttribArray(this._secondPass.aTexturePosition);let i=e.Mat3.makeScaling(2,2).multiply(e.Mat3.makeTranslation(-.5,-.5));t.uniformMatrix3fv(this._secondPass.uMatrix,!1,i.values)}_resizeRenderer(){let e=this._gl,t=this._renderingCanvas.width,n=this._renderingCanvas.height;e.viewport(0,0,t,n),e.deleteTexture(this._renderToTexture),this._renderToTexture=e.createTexture(),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._renderToTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,n,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this._textureFilter()),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindFramebuffer(e.FRAMEBUFFER,this._glFrameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._renderToTexture,0)}_setupCanvases(){let e=this;this._outputCanvas=this.canvas,this._outputContext=this._outputCanvas.getContext("2d"),this._renderingCanvas=document.createElement("canvas"),this._clippingCanvas=document.createElement("canvas"),this._clippingContext=this._clippingCanvas.getContext("2d"),this._renderingCanvas.width=this._clippingCanvas.width=this._outputCanvas.width,this._renderingCanvas.height=this._clippingCanvas.height=this._outputCanvas.height,this._gl=this._renderingCanvas.getContext("webgl"),this._resizeHandler=function(){e._outputCanvas!==e.viewer.drawer.canvas&&(e._outputCanvas.style.width=e.viewer.drawer.canvas.clientWidth+"px",e._outputCanvas.style.height=e.viewer.drawer.canvas.clientHeight+"px");let t=e._calculateCanvasSize();(e._outputCanvas.width!==t.x||e._outputCanvas.height!==t.y)&&(e._outputCanvas.width=t.x,e._outputCanvas.height=t.y),e._renderingCanvas.style.width=e._outputCanvas.clientWidth+"px",e._renderingCanvas.style.height=e._outputCanvas.clientHeight+"px",e._renderingCanvas.width=e._clippingCanvas.width=e._outputCanvas.width,e._renderingCanvas.height=e._clippingCanvas.height=e._outputCanvas.height,e._resizeRenderer()},this.viewer.addHandler("resize",this._resizeHandler)}_makeQuadVertexBuffer(e,t,n,s){return new Float32Array([e,s,t,s,e,n,e,n,t,s,t,n])}_tileReadyHandler(t){let n=t.tile,o=t.tiledImage;if(o.isTainted())return;let i=n.getCanvasContext(),s=i&&i.canvas;if(!s||e.isCanvasTainted(s)){o.isTainted()||(o.setTainted(!0),e.console.warn("WebGL cannot be used to draw this TiledImage because it has tainted data. Does crossOriginPolicy need to be set?"),this._raiseDrawerErrorEvent(o,"Tainted data cannot be used by the WebGLDrawer. Falling back to CanvasDrawer for this TiledImage."));return}if(!this._TextureMap.get(s)){let e=this._gl,c=e.createTexture(),r,l=o.source.tileOverlap,t,a;if(n.sourceBounds?(t=Math.min(n.sourceBounds.width,s.width)/s.width,a=Math.min(n.sourceBounds.height,s.height)/s.height):(t=1,a=1),l>0){let e=this._calculateOverlapFraction(n,o),s=(n.x===0?0:e.x)*t,i=(n.y===0?0:e.y)*a,c=(n.isRightMost?1:1-e.x)*t,l=(n.isBottomMost?1:1-e.y)*a;r=this._makeQuadVertexBuffer(s,c,i,l)}else t===1&&a===1?r=this._unitQuad:r=this._makeQuadVertexBuffer(0,t,0,a);let d={texture:c,position:r};this._TextureMap.set(s,d),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,c),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this._textureFilter()),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this._textureFilter()),this._uploadImageData(i)}}_calculateOverlapFraction(e,t){let n=t.source.tileOverlap,s=e.sourceBounds.width,o=e.sourceBounds.height,i=(e.x===0?0:n)+(e.isRightMost?0:n),a=(e.y===0?0:n)+(e.isBottomMost?0:n),r=n/(s+i),c=n/(o+a);return{x:r,y:c}}_unloadTextures(){Array.from(this._TextureMap.keys()).forEach(e=>{this._cleanupImageData(e)})}_uploadImageData(t){let n=this._gl,s=t.canvas;try{if(!s)throw t;n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,s)}catch(t){e.console.error("Error uploading image data to WebGL",t)}}_imageUnloadedHandler(e){let t=e.context2D.canvas;this._cleanupImageData(t)}_cleanupImageData(e){let t=this._TextureMap.get(e);this._TextureMap.delete(e),t&&this._gl.deleteTexture(t.texture)}_setClip(){}_renderToClippingCanvas(t){if(this._clippingContext.clearRect(0,0,this._clippingCanvas.width,this._clippingCanvas.height),this._clippingContext.save(),this.viewer.viewport.getFlip()){const t=new e.Point(this.canvas.width/2,this.canvas.height/2);this._clippingContext.translate(t.x,0),this._clippingContext.scale(-1,1),this._clippingContext.translate(-t.x,0)}if(t._clip){let e=[{x:t._clip.x,y:t._clip.y},{x:t._clip.x+t._clip.width,y:t._clip.y},{x:t._clip.x+t._clip.width,y:t._clip.y+t._clip.height},{x:t._clip.x,y:t._clip.y+t._clip.height}].map(e=>{let n=t.imageToViewportCoordinates(e.x,e.y,!0).rotate(this.viewer.viewport.getRotation(!0),this.viewer.viewport.getCenter(!0));return this.viewportCoordToDrawerCoord(n)});this._clippingContext.beginPath(),e.forEach((e,t)=>{this._clippingContext[t===0?"moveTo":"lineTo"](e.x,e.y)}),this._clippingContext.clip(),this._setClip()}if(t._croppingPolygons){let e=t._croppingPolygons.map(e=>e.map(e=>{let n=t.imageToViewportCoordinates(e.x,e.y,!0).rotate(this.viewer.viewport.getRotation(!0),this.viewer.viewport.getCenter(!0));return this.viewportCoordToDrawerCoord(n)}));this._clippingContext.beginPath(),e.forEach(e=>{e.forEach((e,t)=>{this._clippingContext[t===0?"moveTo":"lineTo"](e.x,e.y)})}),this._clippingContext.clip()}if(this.viewer.viewport.getFlip()){const t=new e.Point(this.canvas.width/2,this.canvas.height/2);this._clippingContext.translate(t.x,0),this._clippingContext.scale(-1,1),this._clippingContext.translate(-t.x,0)}this._clippingContext.drawImage(this._renderingCanvas,0,0),this._clippingContext.restore()}_setRotations(e){var t=!1;this.viewport.getRotation(!0)%360!==0&&(this._offsetForRotation({degrees:this.viewport.getRotation(!0),saveContext:t}),t=!1),e.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:e.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(e._getRotationPoint(!0),!0),saveContext:t})}_offsetForRotation(t){var n=t.point?t.point.times(e.pixelDensityRatio):this._getCanvasCenter(),s=this._outputContext;s.save(),s.translate(n.x,n.y),s.rotate(Math.PI/180*t.degrees),s.translate(-n.x,-n.y)}_flip(t){t=t||{};var s=t.point?t.point.times(e.pixelDensityRatio):this._getCanvasCenter(),n=this._outputContext;n.translate(s.x,0),n.scale(-1,1),n.translate(-s.x,0)}_drawDebugInfo(t,n,s){for(var i,o=t.length-1;o>=0;o--){i=t[o].tile;try{this._drawDebugInfoOnTile(i,t.length,o,n,s)}catch(t){e.console.error(t)}}}_drawDebugInfoOnTile(t,n,s,o,i){var r,c,l=this.viewer.world.getIndexOfItem(o)%this.debugGridColor.length,a=this.context;a.save(),a.lineWidth=2*e.pixelDensityRatio,a.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",a.strokeStyle=this.debugGridColor[l],a.fillStyle=this.debugGridColor[l],this._setRotations(o),i&&this._flip({point:t.position.plus(t.size.divide(2))}),a.strokeRect(t.position.x*e.pixelDensityRatio,t.position.y*e.pixelDensityRatio,t.size.x*e.pixelDensityRatio,t.size.y*e.pixelDensityRatio),r=(t.position.x+t.size.x/2)*e.pixelDensityRatio,c=(t.position.y+t.size.y/2)*e.pixelDensityRatio,a.translate(r,c);const d=this.viewport.getRotation(!0);a.rotate(Math.PI/180*-d),a.translate(-r,-c),t.x===0&&t.y===0&&(a.fillText("Zoom: "+this.viewport.getZoom(),t.position.x*e.pixelDensityRatio,(t.position.y-30)*e.pixelDensityRatio),a.fillText("Pan: "+this.viewport.getBounds().toString(),t.position.x*e.pixelDensityRatio,(t.position.y-20)*e.pixelDensityRatio)),a.fillText("Level: "+t.level,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+20)*e.pixelDensityRatio),a.fillText("Column: "+t.x,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+30)*e.pixelDensityRatio),a.fillText("Row: "+t.y,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+40)*e.pixelDensityRatio),a.fillText("Order: "+s+" of "+n,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+50)*e.pixelDensityRatio),a.fillText("Size: "+t.size.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+60)*e.pixelDensityRatio),a.fillText("Position: "+t.position.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+70)*e.pixelDensityRatio),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(),o.getRotation(!0)%360!==0&&this._restoreRotationChanges(),a.restore()}_drawPlaceholder(e){const o=e.getBounds(!0),t=this.viewportToDrawerRectangle(e.getBounds(!0)),n=this._outputContext;let s;typeof e.placeholderFillStyle=="function"?s=e.placeholderFillStyle(e,n):s=e.placeholderFillStyle,this._offsetForRotation({degrees:this.viewer.viewport.getRotation(!0)}),n.fillStyle=s,n.translate(t.x,t.y),n.rotate(Math.PI/180*o.degrees),n.translate(-t.x,-t.y),n.fillRect(t.x,t.y,t.width,t.height),this._restoreRotationChanges()}_getCanvasCenter(){return new e.Point(this.canvas.width/2,this.canvas.height/2)}_restoreRotationChanges(){var e=this._outputContext;e.restore()}static initShaderProgram(t,n,s){function i(t,n,s){const o=t.createShader(n);return t.shaderSource(o,s),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)?o:(e.console.error(`An error occurred compiling the shaders: ${t.getShaderInfoLog(o)}`),t.deleteShader(o),null)}const a=i(t,t.VERTEX_SHADER,n),r=i(t,t.FRAGMENT_SHADER,s),o=t.createProgram();return t.attachShader(o,a),t.attachShader(o,r),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS)?o:(e.console.error(`Unable to initialize the shader program: ${t.getProgramInfoLog(o)}`),null)}}}(t),function(e){e.Viewport=function(t){var n=arguments;n.length&&n[0]instanceof e.Point&&(t={containerSize:n[0],contentSize:n[1],config:n[2]}),t.config&&(e.extend(!0,t,t.config),delete t.config),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t.margins||{}),delete t.margins,t.initialDegrees=t.degrees,delete t.degrees,e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,rotationPivot:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,initialDegrees:e.DEFAULT_SETTINGS.degrees,flipped:e.DEFAULT_SETTINGS.flipped,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer,silenceMultiImageWarnings:e.DEFAULT_SETTINGS.silenceMultiImageWarnings},t),this._updateContainerInnerSize(),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.degreesSpring=new e.Spring({initial:t.initialDegrees,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,this._setContentBounds(new e.Rect(0,0,1,1),1),this.goHome(!0),this.update()},e.Viewport.prototype={get degrees(){return e.console.warn("Accessing [Viewport.degrees] is deprecated. Use viewport.getRotation instead."),this.getRotation()},set degrees(t){e.console.warn("Setting [Viewport.degrees] is deprecated. Use viewport.rotateTo, viewport.rotateBy, or viewport.setRotation instead."),this.rotateTo(t)},resetContentSize:function(t){return e.console.assert(t,"[Viewport.resetContentSize] contentSize is required"),e.console.assert(t instanceof e.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),e.console.assert(t.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),e.console.assert(t.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new e.Rect(0,0,1,t.y/t.x),t.x),this},setHomeBounds:function(t,n){e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(t,n)},_setContentBounds:function(t,n){e.console.assert(t,"[Viewport._setContentBounds] bounds is required"),e.console.assert(t instanceof e.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),e.console.assert(t.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),e.console.assert(t.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=t.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(n),this._contentBounds=t.rotate(this.getRotation()).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(n),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:n,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var t,e=this._contentAspectRatio/this.getAspectRatio();return this.homeFillsViewer?t=e>=1?e:1:t=e>=1?1:e,t/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var n=this._contentBounds.getCenter(),t=1/this.getHomeZoom(),s=t/this.getAspectRatio();return new e.Rect(n.x-t/2,n.y-s/2,t,s)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom(),t=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*e;return t},getMaxZoom:function(){var e=this.maxZoomLevel;return e||(e=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,e/=this._contentBounds.width),Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return e.extend({},this._margins)},setMargins:function(t){e.console.assert(e.type(t)==="object","[Viewport.setMargins] margins must be an object"),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(-this.getRotation(e))},getBoundsNoRotate:function(t){var s=this.getCenter(t),n=1/this.getZoom(t),o=n/this.getAspectRatio();return new e.Rect(s.x-n/2,s.y-o/2,n,o)},getBoundsWithMargins:function(e){return this.getBoundsNoRotateWithMargins(e).rotate(-this.getRotation(e),this.getCenter(e))},getBoundsNoRotateWithMargins:function(e){var t=this.getBoundsNoRotate(e),n=this._containerInnerSize.x*this.getZoom(e);return t.x-=this._margins.left/n,t.y-=this._margins.top/n,t.width+=(this._margins.left+this._margins.right)/n,t.height+=(this._margins.top+this._margins.bottom)/n,t},getCenter:function(t){var n,o,i,r,c,l,d,u,s=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),a=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return t?s:this.zoomPoint?(r=this.pixelFromPoint(this.zoomPoint,!0),o=this.getZoom(),n=1/o,i=n/this.getAspectRatio(),c=new e.Rect(s.x-n/2,s.y-i/2,n,i),l=this._pixelFromPoint(this.zoomPoint,c),d=l.minus(r).rotate(-this.getRotation(!0)),u=d.divide(this._containerInnerSize.x*o),a.plus(u)):a},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(e){return Math.max(Math.min(e,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(e){var s,a,r,c,l,d,u,h,m,f,p,g,t=this.viewportToViewerElementRectangle(e).getBoundingBox(),n=this.viewportToViewerElementRectangle(this._contentBoundsNoRotate).getBoundingBox(),o=!1,i=!1;return this.wrapHorizontal||(g=t.x+t.width,p=n.x+n.width,t.width>n.width?r=this.visibilityRatio*n.width:r=this.visibilityRatio*t.width,d=n.x-g+r,l=p-t.x-r,r>n.width?(t.x+=(d+l)/2,o=!0):l<0?(t.x+=l,o=!0):d>0&&(t.x+=d,o=!0)),this.wrapVertical||(m=t.y+t.height,f=n.y+n.height,t.height>n.height?s=this.visibilityRatio*n.height:s=this.visibilityRatio*t.height,c=n.y-m+s,u=f-t.y-s,s>n.height?(t.y+=(c+u)/2,i=!0):u<0?(t.y+=u,i=!0):c>0&&(t.y+=c,i=!0)),h=o||i,a=h?this.viewerElementToViewportRectangle(t):e.clone(),a.xConstrained=o,a.yConstrained=i,a.constraintApplied=h,a},_raiseConstraintsEvent:function(e){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e})},applyConstraints:function(e){var t,n=this.getZoom(),s=this._applyZoomConstraints(n);return n!==s&&this.zoomTo(s,this.zoomPoint,e),t=this.getConstrainedBounds(!1),t.constraintApplied&&(this.fitBounds(t,e),this._raiseConstraintsEvent(e)),this},ensureVisible:function(e){return this.applyConstraints(e)},_fitBounds:function(t,n){n=n||{};var o,i,l,d,h,m,f,p,u=n.immediately,c=n.constraints,r=this.getAspectRatio(),a=t.getCenter(),s=new e.Rect(t.x,t.y,t.width,t.height,t.degrees+this.getRotation()).getBoundingBox();return s.getAspectRatio()>=r?s.height=s.width/r:s.width=s.height*r,s.x=a.x-s.width/2,s.y=a.y-s.height/2,o=1/s.width,u?(this.panTo(a,!0),this.zoomTo(o,null,!0),c&&this.applyConstraints(!0),this):(l=this.getCenter(!0),d=this.getZoom(!0),this.panTo(l,!0),this.zoomTo(d,null,!0),h=this.getBounds(),i=this.getZoom(),i===0||Math.abs(o/i-1)<1e-8?(this.zoomTo(o,null,!0),this.panTo(a,u),c&&this.applyConstraints(!1),this):(c?(this.panTo(a,!1),o=this._applyZoomConstraints(o),this.zoomTo(o,null,!1),m=this.getConstrainedBounds(),this.panTo(l,!0),this.zoomTo(d,null,!0),this.fitBounds(m)):(f=s.rotate(-this.getRotation()),p=f.getTopLeft().times(o).minus(h.getTopLeft().times(i)).divide(o-i),this.zoomTo(o,p,u)),this))},fitBounds:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!1})},fitBoundsWithConstraints:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!0})},fitVertically:function(t){var n=new e.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(n,t)},fitHorizontally:function(t){var n=new e.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(n,t)},getConstrainedBounds:function(e){var t,n;return t=this.getBounds(e),n=this._applyBoundaryConstraints(t),n},panBy:function(t,n){var s=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(s.plus(t),n)},panTo:function(e,t){return t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:t}),this},zoomBy:function(e,t,n){return this.zoomTo(this.zoomSpring.target.value*e,t,n)},zoomTo:function(t,n,s){var o=this;return this.zoomPoint=n instanceof e.Point&&!isNaN(n.x)&&!isNaN(n.y)?n:null,s?this._adjustCenterSpringsForZoomPoint(function(){o.zoomSpring.resetTo(t)}):this.zoomSpring.springTo(t),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:t,refPoint:n,immediately:s}),this},setRotation:function(e,t){return this.rotateTo(e,null,t)},getRotation:function(e){return e?this.degreesSpring.current.value:this.degreesSpring.target.value},setRotationWithPivot:function(e,t,n){return this.rotateTo(e,t,n)},rotateTo:function(t,n,s){if(!this.viewer||!this.viewer.drawer.canRotate())return this;if(this.degreesSpring.target.value===t&&this.degreesSpring.isAtTargetValue())return this;if(this.rotationPivot=n instanceof e.Point&&!isNaN(n.x)&&!isNaN(n.y)?n:null,s)if(this.rotationPivot){if(i=t-this._oldDegrees,!i)return this.rotationPivot=null,this;this._rotateAboutPivot(t)}else this.degreesSpring.resetTo(t);else{var i,c,a=e.positiveModulo(this.degreesSpring.current.value,360),o=e.positiveModulo(t,360),r=o-a;r>180?o-=360:r<-180&&(o+=360),c=a-o,this.degreesSpring.resetTo(t+c),this.degreesSpring.springTo(t)}return this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:t,immediately:!!s,pivot:this.rotationPivot||this.getCenter()}),this},rotateBy:function(e,t,n){return this.rotateTo(this.degreesSpring.target.value+e,t,n)},resize:function(e,t){var o,i,s=this.getBoundsNoRotate(),n=s;return this.containerSize.x=e.x,this.containerSize.y=e.y,this._updateContainerInnerSize(),t&&(o=e.x/this.containerSize.x,n.width=s.width*o,n.height=n.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:e,maintain:t}),i=this.fitBounds(n,!0),this.viewer&&this.viewer.raiseEvent("after-resize",{newContainerSize:e,maintain:t}),i},_updateContainerInnerSize:function(){this._containerInnerSize=new e.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var e,t,n=this;return this._adjustCenterSpringsForZoomPoint(function(){n.zoomSpring.update()}),this.degreesSpring.isAtTargetValue()&&(this.rotationPivot=null),this.centerSpringX.update(),this.centerSpringY.update(),this.rotationPivot?this._rotateAboutPivot(!0):this.degreesSpring.update(),e=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom||this.degreesSpring.current.value!==this._oldDegrees,this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,t=e||!this.zoomSpring.isAtTargetValue()||!this.centerSpringX.isAtTargetValue()||!this.centerSpringY.isAtTargetValue()||!this.degreesSpring.isAtTargetValue(),t},_rotateAboutPivot:function(e){var n,s,o=e===!0,t=this.rotationPivot.minus(this.getCenter());this.centerSpringX.shiftBy(t.x),this.centerSpringY.shiftBy(t.y),o?this.degreesSpring.update():this.degreesSpring.resetTo(e),s=this.degreesSpring.current.value-this._oldDegrees,n=t.rotate(s*-1).times(-1),this.centerSpringX.shiftBy(n.x),this.centerSpringY.shiftBy(n.y)},_adjustCenterSpringsForZoomPoint:function(e){if(this.zoomPoint){t=this.pixelFromPoint(this.zoomPoint,!0),e();var t,s=this.pixelFromPoint(this.zoomPoint,!0),o=s.minus(t),n=this.deltaPointsFromPixels(o,!0);this.centerSpringX.shiftBy(n.x),this.centerSpringY.shiftBy(n.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else e()},deltaPixelsFromPointsNoRotate:function(e,t){return e.times(this._containerInnerSize.x*this.getZoom(t))},deltaPixelsFromPoints:function(e,t){return this.deltaPixelsFromPointsNoRotate(e.rotate(this.getRotation(t)),t)},deltaPointsFromPixelsNoRotate:function(e,t){return e.divide(this._containerInnerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return this.deltaPointsFromPixelsNoRotate(e,t).rotate(-this.getRotation(t))},pixelFromPointNoRotate:function(e,t){return this._pixelFromPointNoRotate(e,this.getBoundsNoRotate(t))},pixelFromPoint:function(e,t){return this._pixelFromPoint(e,this.getBoundsNoRotate(t))},_pixelFromPointNoRotate:function(t,n){return t.minus(n.getTopLeft()).times(this._containerInnerSize.x/n.width).plus(new e.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(e,t){return this._pixelFromPointNoRotate(e.rotate(this.getRotation(!0),this.getCenter(!0)),t)},pointFromPixelNoRotate:function(t,n){var s=this.getBoundsNoRotate(n);return t.minus(new e.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/s.width).plus(s.getTopLeft())},pointFromPixel:function(e,t){return this.pointFromPixelNoRotate(e,t).rotate(-this.getRotation(t),this.getCenter(t))},_viewportToImageDelta:function(t,n){var s=this._contentBoundsNoRotate.width;return new e.Point(t*this._contentSizeNoRotate.x/s,n*this._contentSizeNoRotate.x/s)},viewportToImageCoordinates:function(t,n){if(t instanceof e.Point)return this.viewportToImageCoordinates(t.x,t.y);if(this.viewer){var o,s=this.viewer.world.getItemCount();if(s>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(s===1)return o=this.viewer.world.getItemAt(0),o.viewportToImageCoordinates(t,n,!0)}return this._viewportToImageDelta(t-this._contentBoundsNoRotate.x,n-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(t,n){var s=this._contentBoundsNoRotate.width;return new e.Point(t/this._contentSizeNoRotate.x*s,n/this._contentSizeNoRotate.x*s)},imageToViewportCoordinates:function(t,n){if(t instanceof e.Point)return this.imageToViewportCoordinates(t.x,t.y);if(this.viewer){var s,i,o=this.viewer.world.getItemCount();if(o>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(o===1)return i=this.viewer.world.getItemAt(0),i.imageToViewportCoordinates(t,n,!0)}return s=this._imageToViewportDelta(t,n),s.x+=this._contentBoundsNoRotate.x,s.y+=this._contentBoundsNoRotate.y,s},imageToViewportRectangle:function(t,n,s,o){if(i=t,i instanceof e.Rect||(i=new e.Rect(t,n,s,o)),this.viewer)if(a=this.viewer.world.getItemCount(),a>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(a===1)return r=this.viewer.world.getItemAt(0),r.imageToViewportRectangle(t,n,s,o,!0);var i,a,r,c=this.imageToViewportCoordinates(i.x,i.y),l=this._imageToViewportDelta(i.width,i.height);return new e.Rect(c.x,c.y,l.x,l.y,i.degrees)},viewportToImageRectangle:function(t,n,s,o){if(i=t,i instanceof e.Rect||(i=new e.Rect(t,n,s,o)),this.viewer)if(a=this.viewer.world.getItemCount(),a>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(a===1)return r=this.viewer.world.getItemAt(0),r.viewportToImageRectangle(t,n,s,o,!0);var i,a,r,c=this.viewportToImageCoordinates(i.x,i.y),l=this._viewportToImageDelta(i.width,i.height);return new e.Rect(c.x,c.y,l.x,l.y,i.degrees)},viewerElementToImageCoordinates:function(e){var t=this.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.pixelFromPoint(t,!0)},windowToImageCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var n=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(n)},imageToWindowCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var n=this.imageToViewerElementCoordinates(t);return n.plus(e.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},viewerElementToViewportRectangle:function(t){return e.Rect.fromSummits(this.pointFromPixel(t.getTopLeft(),!0),this.pointFromPixel(t.getTopRight(),!0),this.pointFromPixel(t.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(t){return e.Rect.fromSummits(this.pixelFromPoint(t.getTopLeft(),!0),this.pixelFromPoint(t.getTopRight(),!0),this.pixelFromPoint(t.getBottomLeft(),!0))},windowToViewportCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var n=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(n)},viewportToWindowCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var n=this.viewportToViewerElementCoordinates(t);return n.plus(e.getElementPosition(this.viewer.element))},viewportToImageZoom:function(t){if(this.viewer)if(n=this.viewer.world.getItemCount(),n>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(n===1)return s=this.viewer.world.getItemAt(0),s.viewportToImageZoom(t);var n,s,o=this._contentSizeNoRotate.x,i=this._containerInnerSize.x,a=this._contentBoundsNoRotate.width,r=i/o*a;return t*r},imageToViewportZoom:function(t){if(this.viewer)if(n=this.viewer.world.getItemCount(),n>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image. Instead, use [TiledImage.imageToViewportZoom] for the specific image of interest");else if(n===1)return s=this.viewer.world.getItemAt(0),s.imageToViewportZoom(t);var n,s,o=this._contentSizeNoRotate.x,i=this._containerInnerSize.x,a=this._contentBoundsNoRotate.width,r=o/i/a;return t*r},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(e){return this.flipped===e?this:(this.flipped=e,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:e}),this)},getMaxZoomPixelRatio:function(){return this.maxZoomPixelRatio},setMaxZoomPixelRatio:function(t,n=!0,s=!1){e.console.assert(!isNaN(t),"[Viewport.setMaxZoomPixelRatio] ratio must be a number"),!isNaN(t)&&(this.maxZoomPixelRatio=t,n&&this.getZoom()>this.getMaxZoom()&&this.applyConstraints(s))}}}(t),function(e){e.TiledImage=function(n){this._initialized=!1,e.console.assert(n.tileCache,"[TiledImage] options.tileCache is required"),e.console.assert(n.drawer,"[TiledImage] options.drawer is required"),e.console.assert(n.viewer,"[TiledImage] options.viewer is required"),e.console.assert(n.imageLoader,"[TiledImage] options.imageLoader is required"),e.console.assert(n.source,"[TiledImage] options.source is required"),e.console.assert(!n.clip||n.clip instanceof e.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),e.EventSource.call(this),this._tileCache=n.tileCache,delete n.tileCache,this._drawer=n.drawer,delete n.drawer,this._imageLoader=n.imageLoader,delete n.imageLoader,n.clip instanceof e.Rect&&(this._clip=n.clip.clone()),delete n.clip;var s,o,i,a,r,c,l=n.x||0;delete n.x,i=n.y||0,delete n.y,this.normHeight=n.source.dimensions.y/n.source.dimensions.x,this.contentAspectX=n.source.dimensions.x/n.source.dimensions.y,s=1,n.width?(s=n.width,delete n.width,n.height&&(e.console.error("specifying both width and height to a tiledImage is not supported"),delete n.height)):n.height&&(s=n.height/this.normHeight,delete n.height),o=n.fitBounds,delete n.fitBounds,a=n.fitBoundsPlacement||t.Placement.CENTER,delete n.fitBoundsPlacement,r=n.degrees||0,delete n.degrees,c=n.ajaxHeaders,delete n.ajaxHeaders,e.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_needsDraw:!0,_needsUpdate:!0,_hasOpaqueTile:!1,_tilesLoading:0,_tilesToDraw:[],_lastDrawn:[],_isBlending:!1,_wasBlending:!1,_isTainted:!1,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:e.DEFAULT_SETTINGS.iOSDevice,debugMode:e.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:e.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:e.DEFAULT_SETTINGS.placeholderFillStyle,opacity:e.DEFAULT_SETTINGS.opacity,preload:e.DEFAULT_SETTINGS.preload,compositeOperation:e.DEFAULT_SETTINGS.compositeOperation,subPixelRoundingForTransparency:e.DEFAULT_SETTINGS.subPixelRoundingForTransparency,maxTilesPerFrame:e.DEFAULT_SETTINGS.maxTilesPerFrame},n),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new e.Spring({initial:l,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new e.Spring({initial:i,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new e.Spring({initial:s,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new e.Spring({initial:r,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),o&&this.fitBounds(o,a,!0),this._ownAjaxHeaders={},this.setAjaxHeaders(c,!1),this._initialized=!0},e.extend(e.TiledImage.prototype,e.EventSource.prototype,{needsDraw:function(){return this._needsDraw},redraw:function(){this._needsDraw=!0},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(e){e!==this._fullyLoaded&&(this._fullyLoaded=e,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=e.now(),this._needsDraw=!0},update:function(e){let n=this._xSpring.update(),s=this._ySpring.update(),o=this._scaleSpring.update(),i=this._degreesSpring.update(),t=n||s||o||i||this._needsUpdate;if(t||e||!this._fullyLoaded){let e=this._updateLevelsForViewport();this._setFullyLoaded(e)}return this._needsUpdate=!1,!!t&&(this._updateForScale(),this._raiseBoundsChange(),this._needsDraw=!0,!0)},setDrawn:function(){return this._needsDraw=this._isBlending||this._wasBlending,this._needsDraw},setTainted(e){this._isTainted=e},isTainted(){return this._isTainted},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy(this.viewer)},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(this.getRotation(e),this._getRotationPoint(e))},getBoundsNoRotate:function(t){return t?new e.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new e.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(t){if(n=this.getBoundsNoRotate(t),this._clip){var n,o=t?this._worldWidthCurrent:this._worldWidthTarget,i=o/this.source.dimensions.x,s=this._clip.times(i);n=new e.Rect(n.x+s.x,n.y+s.y,s.width,s.height)}return n.rotate(this.getRotation(t),this._getRotationPoint(t))},getTileBounds:function(e,t,n){var s=this.source.getNumTiles(e),i=(s.x+t%s.x)%s.x,a=(s.y+n%s.y)%s.y,o=this.source.getTileBounds(e,i,a);return this.getFlip()&&(o.x=Math.max(0,1-o.x-o.width)),o.x+=(t-i)/s.x,o.y+=this._worldHeightCurrent/this._worldWidthCurrent*((n-a)/s.y),o},getContentSize:function(){return new e.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var t=this.imageToWindowCoordinates(new e.Point(0,0)),n=this.imageToWindowCoordinates(this.getContentSize());return new e.Point(n.x-t.x,n.y-t.y)},_viewportToImageDelta:function(t,n,s){var o=s?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(t*(this.source.dimensions.x/o),n*(this.source.dimensions.y*this.contentAspectX/o))},viewportToImageCoordinates:function(t,n,s){var o;return t instanceof e.Point?(s=n,o=t):o=new e.Point(t,n),o=o.rotate(-this.getRotation(s),this._getRotationPoint(s)),s?this._viewportToImageDelta(o.x-this._xSpring.current.value,o.y-this._ySpring.current.value):this._viewportToImageDelta(o.x-this._xSpring.target.value,o.y-this._ySpring.target.value)},_imageToViewportDelta:function(t,n,s){var o=s?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(t/this.source.dimensions.x*o,n/this.source.dimensions.y/this.contentAspectX*o)},imageToViewportCoordinates:function(t,n,s){t instanceof e.Point&&(s=n,n=t.y,t=t.x);var o=this._imageToViewportDelta(t,n,s);return s?(o.x+=this._xSpring.current.value,o.y+=this._ySpring.current.value):(o.x+=this._xSpring.target.value,o.y+=this._ySpring.target.value),o.rotate(this.getRotation(s),this._getRotationPoint(s))},imageToViewportRectangle:function(t,n,s,o,i){a=t,a instanceof e.Rect?i=n:a=new e.Rect(t,n,s,o);var a,r=this.imageToViewportCoordinates(a.getTopLeft(),i),c=this._imageToViewportDelta(a.width,a.height,i);return new e.Rect(r.x,r.y,c.x,c.y,a.degrees+this.getRotation(i))},viewportToImageRectangle:function(t,n,s,o,i){a=t,t instanceof e.Rect?i=n:a=new e.Rect(t,n,s,o);var a,r=this.viewportToImageCoordinates(a.getTopLeft(),i),c=this._viewportToImageDelta(a.width,a.height,i);return new e.Rect(r.x,r.y,c.x,c.y,a.degrees-this.getRotation(i))},viewerElementToImageCoordinates:function(e){var t=this.viewport.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.viewport.pixelFromPoint(t,!0)},windowToImageCoordinates:function(e){var n=e.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(n)},imageToWindowCoordinates:function(e){var n=this.imageToViewerElementCoordinates(e);return n.plus(t.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(t){var n=this._scaleSpring.current.value;return t=t.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new e.Rect((t.x-this._xSpring.current.value)/n,(t.y-this._ySpring.current.value)/n,t.width/n,t.height/n,t.degrees)},viewportToImageZoom:function(e){var t=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return t*e},imageToViewportZoom:function(e){var t=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return e/t},setPosition:function(e,t){var n=this._xSpring.target.value===e.x&&this._ySpring.target.value===e.y;if(t){if(n&&this._xSpring.current.value===e.x&&this._ySpring.current.value===e.y)return;this._xSpring.resetTo(e.x),this._ySpring.resetTo(e.y),this._needsDraw=!0,this._needsUpdate=!0}else{if(n)return;this._xSpring.springTo(e.x),this._ySpring.springTo(e.y),this._needsDraw=!0,this._needsUpdate=!0}n||this._raiseBoundsChange()},setWidth:function(e,t){this._setScale(e,t)},setHeight:function(e,t){this._setScale(e/this.normHeight,t)},setCroppingPolygons:function(t){var n=function(t){return t instanceof e.Point||typeof t.x=="number"&&typeof t.y=="number"},s=function(e){return e.map(function(e){try{if(n(e))return{x:e.x,y:e.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!e.isArray(t))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=t.map(function(e){return s(e)}),this._needsDraw=!0}catch(t){e.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),e.console.error(t),this.resetCroppingPolygons()}},resetCroppingPolygons:function(){this._croppingPolygons=null,this._needsDraw=!0},fitBounds:function(t,n,s){n=n||e.Placement.CENTER;var c,l,h,m,i=e.Placement.properties[n],o=this.contentAspectX,a=0,r=0,d=1,u=1;this._clip&&(o=this._clip.getAspectRatio(),d=this._clip.width/this.source.dimensions.x,u=this._clip.height/this.source.dimensions.y,t.getAspectRatio()>o?(a=this._clip.x/this._clip.height*t.height,r=this._clip.y/this._clip.height*t.height):(a=this._clip.x/this._clip.width*t.width,r=this._clip.y/this._clip.width*t.width)),t.getAspectRatio()>o?(h=t.height/u,c=0,i.isHorizontallyCentered?c=(t.width-t.height*o)/2:i.isRight&&(c=t.width-t.height*o),this.setPosition(new e.Point(t.x-a+c,t.y-r),s),this.setHeight(h,s)):(m=t.width/d,l=0,i.isVerticallyCentered?l=(t.height-t.width/o)/2:i.isBottom&&(l=t.height-t.width/o),this.setPosition(new e.Point(t.x-a,t.y-r+l),s),this.setWidth(m,s))},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(t){e.console.assert(!t||t instanceof e.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),t instanceof e.Rect?this._clip=t.clone():this._clip=null,this._needsUpdate=!0,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return this.flipped},setFlip:function(e){this.flipped=e},get flipped(){return this._flipped},set flipped(e){let t=this._flipped!==!!e;this._flipped=!!e,t&&(this.update(!0),this._needsDraw=!0,this._raiseBoundsChange())},get wrapHorizontal(){return this._wrapHorizontal},set wrapHorizontal(e){let t=this._wrapHorizontal!==!!e;this._wrapHorizontal=!!e,this._initialized&&t&&(this.update(!0),this._needsDraw=!0)},get wrapVertical(){return this._wrapVertical},set wrapVertical(e){let t=this._wrapVertical!==!!e;this._wrapVertical=!!e,this._initialized&&t&&(this.update(!0),this._needsDraw=!0)},get debugMode(){return this._debugMode},set debugMode(e){this._debugMode=!!e,this._needsDraw=!0},getOpacity:function(){return this.opacity},setOpacity:function(e){this.opacity=e},get opacity(){return this._opacity},set opacity(e){e!==this.opacity&&(this._opacity=e,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(e){this._preload=!!e,this._needsDraw=!0},getRotation:function(e){return e?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(e,t){this._degreesSpring.target.value===e&&this._degreesSpring.isAtTargetValue()||(t?this._degreesSpring.resetTo(e):this._degreesSpring.springTo(e),this._needsDraw=!0,this._needsUpdate=!0,this._raiseBoundsChange())},getDrawArea:function(){if(this._opacity===0&&!this._preload)return!1;var t,e=this._viewportToTiledImageRectangle(this.viewport.getBoundsWithMargins(!0));return!this.wrapHorizontal&&!this.wrapVertical&&(t=this._viewportToTiledImageRectangle(this.getClippedBounds(!0)),e=e.intersection(t)),e},getTilesToDraw:function(){let e=this._tilesToDraw.flat();return this._updateTilesInViewport(e),e=this._tilesToDraw.flat(),e.forEach(e=>{e.tile.beingDrawn=!0}),this._lastDrawn=e,e},_getRotationPoint:function(e){return this.getBoundsNoRotate(e).getCenter()},get compositeOperation(){return this._compositeOperation},set compositeOperation(e){e!==this._compositeOperation&&(this._compositeOperation=e,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this._compositeOperation}))},getCompositeOperation:function(){return this._compositeOperation},setCompositeOperation:function(e){this.compositeOperation=e},setAjaxHeaders:function(t,n){if(t===null&&(t={}),!e.isPlainObject(t)){console.error("[TiledImage.setAjaxHeaders] Ignoring invalid headers, must be a plain object");return}this._ownAjaxHeaders=t,this._updateAjaxHeaders(n)},_updateAjaxHeaders:function(t){if(t===0[0]&&(t=!0),e.isPlainObject(this.viewer.ajaxHeaders)?this.ajaxHeaders=e.extend({},this.viewer.ajaxHeaders,this._ownAjaxHeaders):this.ajaxHeaders=this._ownAjaxHeaders,t){for(i in this.tilesMatrix){n=this.source.getNumTiles(i);for(r in this.tilesMatrix[i]){c=(n.x+r%n.x)%n.x;for(d in this.tilesMatrix[i][r])if(l=(n.y+d%n.y)%n.y,o=this.tilesMatrix[i][r][d],o.loadWithAjax=this.loadTilesWithAjax,o.loadWithAjax){var n,s,o,i,a,r,c,l,d,u=this.source.getTileAjaxHeaders(i,c,l);o.ajaxHeaders=e.extend({},this.ajaxHeaders,u)}else o.ajaxHeaders=null}}for(a=0;a<this._imageLoader.jobQueue.length;a++)s=this._imageLoader.jobQueue[a],s.loadWithAjax=s.tile.loadWithAjax,s.ajaxHeaders=s.tile.loadWithAjax?s.tile.ajaxHeaders:null}},_setScale:function(e,t){var n=this._scaleSpring.target.value===e;if(t){if(n&&this._scaleSpring.current.value===e)return;this._scaleSpring.resetTo(e),this._updateForScale(),this._needsDraw=!0,this._needsUpdate=!0}else{if(n)return;this._scaleSpring.springTo(e),this._updateForScale(),this._needsDraw=!0,this._needsUpdate=!0}n||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var t=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),n=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,e=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(n/this.minPixelRatio)/Math.log(2))));return e=Math.max(e,this.source.minLevel||0),t=Math.min(t,e),{lowestLevel:t,highestLevel:e}},_updateLevelsForViewport:function(){var t,s,o,f,p,l=this._getLevelsInterval(),d=l.lowestLevel,i=l.highestLevel,n=[],c=this.getDrawArea(),a=e.now();if(this._lastDrawn.forEach(e=>{e.tile.beingDrawn=!1}),this._tilesToDraw=[],this._tilesLoading=0,this.loadingCoverage={},!c)return this._needsDraw=!1,this._fullyLoaded;t=new Array(i-d+1);for(let n=0,e=i;e>=d;e--,n++)t[n]=e;for(let e=i+1;e<=this.source.maxLevel;e++)if(s=this.tilesMatrix[e]&&this.tilesMatrix[e][0]&&this.tilesMatrix[e][0][0],s&&s.isBottomMost&&s.isRightMost&&s.loaded){t.push(e);break}let r=!1;for(let s=0;s<t.length;s++){let e=t[s];if(o=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(e),!0).x*this._scaleSpring.current.value,s===t.length-1||o>=this.minPixelRatio)r=!0;else if(!r)continue;var g=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(e),!1).x*this._scaleSpring.current.value,v=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,u=this.immediateRender?1:v,h=Math.min(1,(o-.5)/.5),b=u/Math.abs(u-g),m=this._updateLevel(e,h,b,c,a,n);if(n=m.bestTiles,f=m.updatedTiles.filter(e=>e.loaded),p=function(e,t,n){return function(s){return{tile:s,level:e,levelOpacity:t,currentTime:n}}}(e,h,a),this._tilesToDraw[e]=f.map(p),this._providesCoverage(this.coverage,e))break}return n&&n.length>0?(n.forEach(function(e){e&&!e.context2D&&this._loadTile(e,a)},this),this._needsDraw=!0,!1):this._tilesLoading===0},_updateTilesInViewport:function(t){let o=e.now(),n=this;this._tilesLoading=0,this._wasBlending=this._isBlending,this._isBlending=!1,this.loadingCoverage={};let i=t.length?t[0].level:0;if(!this.getDrawArea())return;function a(e){let t=e.tile;if(t&&t.loaded){let s=n._blendTile(t,t.x,t.y,e.level,e.levelOpacity,o,i);n._isBlending=n._isBlending||s,n._needsDraw=n._needsDraw||s||n._wasBlending}}let s=0;for(let e=0;e<t.length;e++){let n=t[e];a(n),this._providesCoverage(this.coverage,n.level)&&(s=Math.max(s,n.level))}if(s>0)for(let e in this._tilesToDraw)e<s&&delete this._tilesToDraw[e]},_blendTile:function(e,t,n,s,o,i,a){let c=1e3*this.blendTime,l,r;return e.blendStart||(e.blendStart=i),l=i-e.blendStart,r=c?Math.min(1,l/c):1,s===a&&(r=1,l=c),this.alwaysBlend&&(r*=o),e.opacity=r,r===1&&(this._setCoverage(this.coverage,s,t,n,!0),this._hasOpaqueTile=!0),l<c},_updateLevel:function(e,t,n,s,o,i){p=s.getBoundingBox().getTopLeft(),h=s.getBoundingBox().getBottomRight(),this.viewer&&this.viewer.raiseEvent("update-level",{tiledImage:this,havedrawn:!0,level:e,opacity:t,visibility:n,drawArea:s,topleft:p,bottomright:h,currenttime:o,best:i}),this._resetCoverage(this.coverage,e),this._resetCoverage(this.loadingCoverage,e);var l,u,h,m,f,p,b=this._getCornerTiles(e,p,h),d=b.topLeft,a=b.bottomRight,r=this.source.getNumTiles(e),y=this.viewport.pixelFromPoint(this.viewport.getCenter());this.getFlip()&&(a.x+=1,this.wrapHorizontal||(a.x=Math.min(a.x,r.x-1)));for(var j=Math.max(0,(a.x-d.x)*(a.y-d.y)),v=new Array(j),g=0,c=d.x;c<=a.x;c++)for(l=d.y;l<=a.y;l++)this.getFlip()?(f=(r.x+c%r.x)%r.x,u=c+r.x-f-f-1):u=c,s.intersection(this.getTileBounds(e,u,l))!==null&&(m=this._updateTile(u,l,e,n,y,r,o,i),i=m.bestTiles,v[g]=m.tile,g+=1);return{bestTiles:i,updatedTiles:v}},_positionTile:function(t,n,s,o,i){a=t.bounds.getTopLeft(),a.x*=this._scaleSpring.current.value,a.y*=this._scaleSpring.current.value,a.x+=this._xSpring.current.value,a.y+=this._ySpring.current.value,r=t.bounds.getSize(),r.x*=this._scaleSpring.current.value,r.y*=this._scaleSpring.current.value,t.positionedBounds.x=a.x,t.positionedBounds.y=a.y,t.positionedBounds.width=r.x,t.positionedBounds.height=r.y;var a,r,l=s.pixelFromPointNoRotate(a,!0),d=s.pixelFromPointNoRotate(a,!1),c=s.deltaPixelsFromPointsNoRotate(r,!0),u=s.deltaPixelsFromPointsNoRotate(r,!1),h=d.plus(u.divide(2)),m=o.squaredDistanceTo(h);this.viewer.drawer.minimumOverlapRequired(this)&&(n||(c=c.plus(new e.Point(1,1))),t.isRightMost&&this.wrapHorizontal&&(c.x+=.75),t.isBottomMost&&this.wrapVertical&&(c.y+=.75)),t.position=l,t.size=c,t.squaredDistance=m,t.visibility=i},_updateTile:function(e,t,n,s,o,i,a,r){var l,d,c=this._getTile(e,t,n,a,i);return this.viewer&&this.viewer.raiseEvent("update-tile",{tiledImage:this,tile:c}),this._setCoverage(this.coverage,n,e,t,!1),l=c.loaded||c.loading||this._isCovered(this.loadingCoverage,n,e,t),this._setCoverage(this.loadingCoverage,n,e,t,l),c.exists?((c.loaded&&c.opacity===1&&this._setCoverage(this.coverage,n,e,t,!0),this._positionTile(c,this.source.tileOverlap,this.viewport,o,s),!c.loaded)&&(c.context2D?this._setTileLoaded(c):(d=this._tileCache.getImageRecord(c.cacheKey),d&&this._setTileLoaded(c,d.getData()))),c.loading?this._tilesLoading++:l||(r=this._compareTiles(r,c,this.maxTilesPerFrame)),{bestTiles:r,tile:c}):{bestTiles:r,tile:c}},_getCornerTiles:function(t,n,s){this.wrapHorizontal?(a=e.positiveModulo(n.x,1),r=e.positiveModulo(s.x,1)):(a=Math.max(0,n.x),r=Math.min(1,s.x)),o=1/this.source.aspectRatio,this.wrapVertical?(c=e.positiveModulo(n.y,o),l=e.positiveModulo(s.y,o)):(c=Math.max(0,n.y),l=Math.min(o,s.y));var o,a,r,c,l,d=this.source.getTileAtPoint(t,new e.Point(a,c)),u=this.source.getTileAtPoint(t,new e.Point(r,l)),i=this.source.getNumTiles(t);return this.wrapHorizontal&&(d.x+=i.x*Math.floor(n.x),u.x+=i.x*Math.floor(s.x)),this.wrapVertical&&(d.y+=i.y*Math.floor(n.y/o),u.y+=i.y*Math.floor(s.y/o)),{topLeft:d,bottomRight:u}},_getTile:function(t,n,s,o,i){var a,r,c,u,h,m,f,p,g,v,l=this.tilesMatrix,d=this.source;return l[s]||(l[s]={}),l[s][t]||(l[s][t]={}),(!l[s][t][n]||!l[s][t][n].flipped!=!this.flipped)&&(a=(i.x+t%i.x)%i.x,r=(i.y+n%i.y)%i.y,f=this.getTileBounds(s,t,n),p=d.getTileBounds(s,a,r,!0),g=d.tileExists(s,a,r),h=d.getTileUrl(s,a,r),m=d.getTilePostData(s,a,r),this.loadTilesWithAjax?(u=d.getTileAjaxHeaders(s,a,r),e.isPlainObject(this.ajaxHeaders)&&(u=e.extend({},this.ajaxHeaders,u))):u=null,v=d.getContext2D?d.getContext2D(s,a,r):0[0],c=new e.Tile(s,t,n,f,g,h,v,this.loadTilesWithAjax,u,p,m,d.getTileHashKey(s,a,r,h,u,m)),this.getFlip()?a===0&&(c.isRightMost=!0):a===i.x-1&&(c.isRightMost=!0),r===i.y-1&&(c.isBottomMost=!0),c.flipped=this.flipped,l[s][t][n]=c),c=l[s][t][n],c.lastTouchTime=o,c},_loadTile:function(e,t){var n=this;e.loading=!0,this._imageLoader.addJob({src:e.getUrl(),tile:e,source:this.source,postData:e.postData,loadWithAjax:e.loadWithAjax,ajaxHeaders:e.ajaxHeaders,crossOriginPolicy:this.crossOriginPolicy,ajaxWithCredentials:this.ajaxWithCredentials,callback:function(s,o,i){n._onTileLoad(e,t,s,o,i)},abort:function(){e.loading=!1}})},_onTileLoad:function(t,n,s,o,i){if(s)t.exists=!0;else{e.console.error("Tile %s failed to load: %s - error: %s",t,t.getUrl(),o),this.viewer.raiseEvent("tile-load-failed",{tile:t,tiledImage:this,time:n,message:o,tileRequest:i}),t.loading=!1,t.exists=!1;return}if(n<this.lastResetTime){e.console.warn("Ignoring tile %s loaded before reset: %s",t,t.getUrl()),t.loading=!1;return}var a=this,r=function(){var e=a.source,n=e.getClosestLevel();a._setTileLoaded(t,s,n,i)};r()},_setTileLoaded:function(t,n,s,o){var l,a=0,r=!1,i=this;function c(){return r&&e.console.error("Event 'tile-loaded' argument getCompletionCallback must be called synchronously. Its return value should be called asynchronously."),a++,d}function d(){a--,a===0&&(t.loading=!1,t.loaded=!0,t.hasTransparency=i.source.hasTransparency(t.context2D,t.getUrl(),t.ajaxHeaders,t.postData),t.context2D||i._tileCache.cacheTile({data:n,tile:t,cutoff:s,tiledImage:i}),i.viewer.raiseEvent("tile-ready",{tile:t,tiledImage:i,tileRequest:o}),i._needsDraw=!0)}l=c(),this.viewer.raiseEvent("tile-loaded",{tile:t,tiledImage:this,tileRequest:o,get image(){return e.console.error("[tile-loaded] event 'image' has been deprecated. Use 'data' property instead."),n},data:n,getCompletionCallback:c}),r=!0,l()},_compareTiles:function(e,t,n){return e?(e.push(t),this._sortTiles(e),e.length>n&&e.pop(),e):[t]},_sortTiles:function(e){e.sort(function(e,t){return e===null?1:t===null?-1:e.visibility===t.visibility?e.squaredDistance-t.squaredDistance:t.visibility-e.visibility})},_providesCoverage:function(e,t,n,s){var o,i,a,r;if(!e[t])return!1;if(n===0[0]||s===0[0]){o=e[t];for(a in o)if(Object.prototype.hasOwnProperty.call(o,a)){i=o[a];for(r in i)if(Object.prototype.hasOwnProperty.call(i,r)&&!i[r])return!1}return!0}return e[t][n]===0[0]||e[t][n][s]===0[0]||e[t][n][s]===!0},_isCovered:function(e,t,n,s){return n===0[0]||s===0[0]?this._providesCoverage(e,t+1):this._providesCoverage(e,t+1,2*n,2*s)&&this._providesCoverage(e,t+1,2*n,2*s+1)&&this._providesCoverage(e,t+1,2*n+1,2*s)&&this._providesCoverage(e,t+1,2*n+1,2*s+1)},_setCoverage:function(t,n,s,o,i){if(!t[n]){e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",n);return}t[n][s]||(t[n][s]={}),t[n][s][o]=i},_resetCoverage:function(e,t){e[t]={}}})}(t),function(e){var n=function(t){e.console.assert(t,"[TileCache.cacheTile] options is required"),e.console.assert(t.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(t.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=t.tile,this.tiledImage=t.tiledImage},t=function(t){e.console.assert(t,"[ImageRecord] options is required"),e.console.assert(t.data,"[ImageRecord] options.data is required"),this._tiles=[],t.create.apply(null,[this,t.data,t.ownerTile]),this._destroyImplementation=t.destroy.bind(null,this),this.getImage=t.getImage.bind(null,this),this.getData=t.getData.bind(null,this),this.getRenderedContext=t.getRenderedContext.bind(null,this)};t.prototype={destroy:function(){this._destroyImplementation(),this._tiles=null},addTile:function(t){e.console.assert(t,"[ImageRecord.addTile] tile is required"),this._tiles.push(t)},removeTile:function(t){for(var n=0;n<this._tiles.length;n++)if(this._tiles[n]===t){this._tiles.splice(n,1);return}e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",t)},getTileCount:function(){return this._tiles.length}},e.TileCache=function(t){t=t||{},this._maxImageCacheCount=t.maxImageCacheCount||e.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},e.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(s){e.console.assert(s,"[TileCache.cacheTile] options is required"),e.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(s.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),e.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var g=s.cutoff||0,m=this._tilesLoaded.length,r=this._imagesLoaded[s.tile.cacheKey];if(r||(s.data||(e.console.error("[TileCache.cacheTile] options.image was renamed to options.data. '.image' attribute has been deprecated and will be removed in the future."),s.data=s.image),e.console.assert(s.data,"[TileCache.cacheTile] options.data is required to create an ImageRecord"),r=this._imagesLoaded[s.tile.cacheKey]=new t({data:s.data,ownerTile:s.tile,create:s.tiledImage.source.createTileCache,destroy:s.tiledImage.source.destroyTileCache,getImage:s.tiledImage.source.getTileCacheDataAsImage,getData:s.tiledImage.source.getTileCacheData,getRenderedContext:s.tiledImage.source.getTileCacheDataAsContext2D}),this._imagesLoadedCount++),r.addTile(s.tile),s.tile.cacheImageRecord=r,this._imagesLoadedCount>this._maxImageCacheCount){for(var o,l,u,h,f,p,i=null,c=-1,d=null,a=this._tilesLoaded.length-1;a>=0;a--)if(l=this._tilesLoaded[a],o=l.tile,!(o.level<=g||o.beingDrawn)){if(!i){i=o,c=a,d=l;continue}h=o.lastTouchTime,u=i.lastTouchTime,p=o.level,f=i.level,(h<u||h===u&&p>f)&&(i=o,c=a,d=l)}i&&c>=0&&(this._unloadTile(d),m=c)}this._tilesLoaded[m]=new n({tile:s.tile,tiledImage:s.tiledImage})},clearTilesFor:function(t){e.console.assert(t,"[TileCache.clearTilesFor] tiledImage is required");for(var s,n=0;n<this._tilesLoaded.length;++n)s=this._tilesLoaded[n],s.tiledImage===t&&(this._unloadTile(s),this._tilesLoaded.splice(n,1),n--)},getImageRecord:function(t){return e.console.assert(t,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[t]},_unloadTile:function(t){e.console.assert(t,"[TileCache._unloadTile] tileRecord is required");var s,n=t.tile,i=t.tiledImage;let o=n.getCanvasContext&&n.getCanvasContext();n.unload(),n.cacheImageRecord=null,s=this._imagesLoaded[n.cacheKey],s&&(s.removeTile(n),s.getTileCount()||(s.destroy(),delete this._imagesLoaded[n.cacheKey],this._imagesLoadedCount--,o&&(o.canvas.width=0,o.canvas.height=0,i.viewer.raiseEvent("image-unloaded",{context2D:o,tile:n}))),i.viewer.raiseEvent("tile-unloaded",{tile:n,tiledImage:i}))}}}(t),function(e){e.World=function(t){var n=this;e.console.assert(t.viewer,"[World] options.viewer is required"),e.EventSource.call(this),this.viewer=t.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(){n._autoRefigureSizes?n._figureSizes():n._needsSizesFigured=!0},this._figureSizes()},e.extend(e.World.prototype,e.EventSource.prototype,{addItem:function(t,n){if(e.console.assert(t,"[World.addItem] item is required"),e.console.assert(t instanceof e.TiledImage,"[World.addItem] only TiledImages supported at this time"),n=n||{},n.index!==0[0]){var s=Math.max(0,Math.min(this._items.length,n.index));this._items.splice(s,0,t)}else this._items.push(t);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,t.addHandler("bounds-change",this._delegatedFigureSizes),t.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:t})},getItemAt:function(t){return e.console.assert(t!==0[0],"[World.getItemAt] index is required"),this._items[t]},getIndexOfItem:function(t){return e.console.assert(t,"[World.getIndexOfItem] item is required"),e.indexOf(this._items,t)},getItemCount:function(){return this._items.length},setItemIndex:function(t,n){e.console.assert(t,"[World.setItemIndex] item is required"),e.console.assert(n!==0[0],"[World.setItemIndex] index is required");var s=this.getIndexOfItem(t);if(n>=this._items.length)throw new Error("Index bigger than number of layers.");n===s||s===-1||(this._items.splice(s,1),this._items.splice(n,0,t),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:t,previousIndex:s,newIndex:n}))},removeItem:function(t){e.console.assert(t,"[World.removeItem] item is required");var n=e.indexOf(this._items,t);n!==-1&&(t.removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy(),this._items.splice(n,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(t))},removeAll:function(){this.viewer._cancelPendingImages();for(e=0;e<this._items.length;e++)t=this._items[e],t.removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy();var e,t,n=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,e=0;e<n.length;e++)t=n[e],this._raiseRemoveItem(t)},resetItems:function(){for(var e=0;e<this._items.length;e++)this._items[e].reset()},update:function(e){for(var t=!1,n=0;n<this._items.length;n++)t=this._items[n].update(e)||t;return t},draw:function(){this.viewer.drawer.draw(this._items),this._needsDraw=!1,this._items.forEach(e=>{this._needsDraw=e.setDrawn()||this._needsDraw})},needsDraw:function(){for(var e=0;e<this._items.length;e++)if(this._items[e].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(e){this._autoRefigureSizes=e,e&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(t){t=t||{};var n,s,o,i,r,l,d,m,f,u=t.immediately,p=t.layout||e.DEFAULT_SETTINGS.collectionLayout,v=t.rows||e.DEFAULT_SETTINGS.collectionRows,h=t.columns||e.DEFAULT_SETTINGS.collectionColumns,a=t.tileSize||e.DEFAULT_SETTINGS.collectionTileSize,g=t.tileMargin||e.DEFAULT_SETTINGS.collectionTileMargin,c=a+g;!t.rows&&h?d=h:d=Math.ceil(this._items.length/v),o=0,r=0,this.setAutoRefigureSizes(!1);for(s=0;s<this._items.length;s++)s&&s%d===0&&(p==="horizontal"?(r+=c,o=0):(o+=c,r=0)),l=this._items[s],n=l.getBounds(),n.width>n.height?i=a:i=a*(n.width/n.height),m=i*(n.height/n.width),f=new e.Point(o+(a-i)/2,r+(a-m)/2),l.setPosition(f,u),l.setWidth(i,u),p==="horizontal"?o+=c:r+=c;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var l=this._homeBounds?this._homeBounds.clone():null,d=this._contentSize?this._contentSize.clone():null,u=this._contentFactor||0;if(this._items.length){n=this._items[0],s=n.getBounds(),this._contentFactor=n.getContentSize().x/s.width;for(var n,s,t=n.getClippedBounds().getBoundingBox(),o=t.x,i=t.y,a=t.x+t.width,r=t.y+t.height,c=1;c<this._items.length;c++)n=this._items[c],s=n.getBounds(),this._contentFactor=Math.max(this._contentFactor,n.getContentSize().x/s.width),t=n.getClippedBounds().getBoundingBox(),o=Math.min(o,t.x),i=Math.min(i,t.y),a=Math.max(a,t.x+t.width),r=Math.max(r,t.y+t.height);this._homeBounds=new e.Rect(o,i,a-o,r-i),this._contentSize=new e.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new e.Rect(0,0,1,1),this._contentSize=new e.Point(1,1),this._contentFactor=1;(this._contentFactor!==u||!this._homeBounds.equals(l)||!this._contentSize.equals(d))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(e){this.raiseEvent("remove-item",{item:e})}})}(t)}(hn)),hn.exports}Z1=N0(),un=br(Z1);function e4(e){if(typeof e!="string")return null;const t=e.match(/xywh=(\d+),(\d+),(\d+),(\d+)$/);return t?t.slice(1).map(Number):null}function bn(){let t,n;const e=new Promise((e,s)=>{t=e,n=s});return e.resolve=t,e.reject=n,e}ln=.005,Sn=1.5,o4={data(){return{defaultCanvasCss:"",loadingTimeout:null,avResource:null,overlayElements:[],promise:bn(),tileSources:[],viewer:null,viewerState:{isReset:!0}}},computed:{filtersActive(){return Object.keys(this.$store.options.filters).length>0},paginationButtons(){var e;const t=((e=this.$store.manifest.viewingDirection)==null?0[0]:e.split("-to-"))||["left","right"],n=[{hidden:this.$store.isFirstPage,title:this.$translate("Previous page"),onClick:this.$store.goToPreviousPage,position:t[0]},{hidden:this.$store.isLastPage,title:this.$translate("Next page"),onClick:this.$store.goToNextPage,position:t[1]}];return this.$store.isReversed&&n.reverse(),n.filter(e=>!e.hidden)},multiLayerResources(){return this.$store.options.pages.filter(e=>e>0).map((e,t)=>{var n,s,o,i,a;return{pageIndex:t,items:(a=(i=(o=(s=(n=this.$store.manifest.items[e-1].items)==null?0[0]:n[0])==null?0[0]:s.items)==null?0[0]:o[0])==null?0[0]:i.body)==null?0[0]:a.items}}).filter(e=>{var t;return((t=e.items)==null?0[0]:t.length)>1})}},watch:{"$store.annotations":{handler(){this.updateOverlays()},deep:!0},"$store.options.annotationId":function(e){var s;if(!this.viewer||((s=this.overlayElements.find(e=>e.classList.contains("-current")))==null||s.classList.remove("-current"),!e))return;const o=this.viewer.viewport.getBounds(),n=this.overlayElements.find(t=>t.id===e);if(!n)return;n.classList.add("-current");const t=this.viewer.getOverlayById(n).getBounds(this.viewer.viewport);o.intersection(t)||(t.x-=.03,t.y-=.03,t.width+=.06,t.height+=.06,this.viewer.viewport.fitBoundsWithConstraints(t))},"$store.options.pages":function(e,t){const n=e.length!==t.length;this.loadInfo(n)},"$store.options.view":function(){this.updateOverlays()}},mounted(){this.loadInfo(),this.$store.readyPromises.push(this.promise),this.$store.rootElement.addEventListener("keydown",this.onKeydown),this.$store.rootElement.addEventListener("keypress",this.onKeypress)},beforeUnmount(){this.viewer&&this.viewer.destroy(),this.$store.rootElement.removeEventListener("keydown",this.onKeydown),this.$store.rootElement.removeEventListener("keypress",this.onKeypress)},methods:{initViewer(e){const t=[];let n=0,s=0;const o=this.$store.isReversed?this.$store.options.pages.toReversed():this.$store.options.pages;if(o.filter(e=>e>0).forEach((e,o)=>{this.tileSources.filter(t=>t.$meta.page===e&&t.$meta.layerIndex===(this.$store.options.layers[o]||0)).forEach((o,i)=>{var l;n=n||o[this.$store.isVertical?"height":"width"];const a=o[this.$store.isVertical?"height":"width"]/n;this.$store.options.pages[0]===0&&(!this.$store.isReversed&&e===1||this.$store.isReversed&&e===this.$store.pageCount)&&(t.push({opacity:0,tileSource:o,[this.$store.isVertical?"y":"x"]:0,[this.$store.isVertical?"height":"width"]:a}),s+=1+ln);const r={tileSource:o,[this.$store.isVertical?"y":"x"]:s,[this.$store.isVertical?"height":"width"]:a},{target:c}=((l=this.$store.manifest.items[e-1].items[0])==null?0[0]:l.items[i])||{},d=e4(c?.id||c);d?[r.x,r.y,r.width]=d.map(e=>e/n):s+=a+ln,this.$store.options.pages[0]===0&&(!this.$store.isReversed&&e===this.$store.pageCount||this.$store.isReversed&&e===1)&&t.push({opacity:0,tileSource:o,[this.$store.isVertical?"y":"x"]:s,[this.$store.isVertical?"height":"width"]:a}),t.push(r)})}),this.viewer){this.viewer.addOnceHandler("open",()=>{if(this.viewerState.isReset||e)this.resetImage();else{if(this.viewer.viewport.applyConstraints(!0),!this.$store.options.optionsResetOnPageChange)return;this.$store.options.optionsResetOnPageChange.forEach(e=>{if(e==="filters")this.resetFilters();else if(e==="pan"){const e=this.viewer.viewport.getBounds();if(e.x<=0&&e.y<=0)return;const t=o[0]?0:1;this.viewer.viewport.panTo({x:e.x>0?e.width/2+t:this.$store.options.pan.x,y:e.y>0?e.height/2:this.$store.options.pan.y}),this.$store.updateOptions({pan:{}})}else e==="rotation"?(this.viewer.viewport.setRotation(0),this.$store.updateOptions({rotation:null})):e==="zoom"&&(this.viewer.viewport.goHome(),this.$store.updateOptions({zoom:null}))})}}),this.viewer.open(t);return}this.viewer=un({animationTime:.4,drawer:"canvas",element:this.$refs.image,immediateRender:this.$store.isContainerWidthAtLeast("small"),placeholderFillStyle:"grey",preserveImageSizeOnResize:!0,preserveViewport:!0,showNavigationControl:!1,showZoomControl:!1,tileSources:t,visibilityRatio:.2,...this.$store.options.viewer}),this.viewer.addHandler("canvas-key",e=>{var t;["f","F","r","R","S","W","+","=","-","_"].includes((t=e.originalEvent)==null?0[0]:t.key)&&(e.preventDefaultAction=!0)}),this.viewer.gestureSettingsMouse.clickToZoom=!1,this.viewer.addHandler("animation-finish",()=>{if(this.viewerState.isReset){this.removeImageOptions();return}const e=this.viewer.viewport.getCenter();this.$store.updateOptions({pan:{x:Math.round(e.x*1e3)/1e3,y:Math.round(e.y*1e3)/1e3},zoom:Math.round(this.viewer.viewport.getZoom()*1e3)/1e3})}),this.viewer.addHandler("open",()=>{this.startLoadingWatch(),this.$store.options.pan.x!==0[0]||this.$store.options.pan.y!==0[0]||this.$store.options.zoom?((this.$store.options.pan.x!==0[0]||this.$store.options.pan.y!==0[0])&&this.viewer.viewport.panTo({x:this.$store.options.pan.x,y:this.$store.options.pan.y},!0),this.$store.options.zoom&&this.viewer.viewport.zoomTo(this.$store.options.zoom,null,!0)):this.viewer.viewport.goHome(),this.$store.options.rotation!==null&&this.viewer.viewport.setRotation(this.$store.options.rotation),this.updateOverlays()}),this.viewer.addHandler("pan",this.updateViewerState),this.viewer.addHandler("resize",()=>{this.viewerState.isReset&&this.$nextTick(()=>this.viewer.viewport.goHome(!0)),this.updateViewerState()}),this.viewer.addHandler("rotate",this.updateViewerState),this.viewer.addHandler("zoom",this.updateViewerState),this.viewer.addHandler("tile-load-failed",e=>{this.$store.addError(`Error loading image: ${e.message}`)}),this.defaultCanvasCss=this.viewer.drawer.canvas.style.cssText,this.updateFilterStyle(),this.$api.expose(this.resetImage),this.$api.expose(this.viewer,"viewer"),this.promise.resolve()},loadInfo(e=!1){this.stopLoadingWatch(),this.avResource=null;let t,n;const s=[];this.$store.options.pages.filter(e=>e>0).forEach((e,o)=>{var r,c,l;const a=this.$store.manifest.items[e-1],i=this.$store.options.layers[o]||0;(l=(c=(r=a.items)==null?0[0]:r[0])==null?0[0]:c.items)==null||l.forEach((o,r)=>{var l,d,u,h,m,f,p,g;const c=((d=(l=o.body)==null?0[0]:l.items)==null?0[0]:d[i])||o.body;if(!c){this.$store.addError(`Resource missing for page ${e}`);return}if(["Sound","Video"].includes(c?.type)){if(this.$store.options.pages[1]>-1){this.$store.updateOptions({pages:[e]});return}this.avResource={},n={format:c.format,type:c.type,url:c.id},this.$nextTick(()=>{this.avResource=n});const o=a.accompanyingCanvas||a.placeholderCanvas,s=(f=(m=(h=(u=o?.items)==null?0[0]:u[0])==null?0[0]:h.items)==null?0[0]:m[0])==null?0[0]:f.body;t=((p=s?.items)==null?0[0]:p[i])||s}else t=c;if(t&&this.tileSources.find(t=>t.$meta.page===e&&t.$meta.itemIndex===r&&t.$meta.layerIndex===i))return;const v=((g=t?.source)==null?0[0]:g.service)||t?.service;if(v){const t=[].concat(v)[0],n=t.id||t["@id"],o=`${n}${n.at(-1)==="/"?"":"/"}info.json`;s.push(this.$store.fetchJson(o).then(t=>({...t,$meta:{page:e,itemIndex:r,layerIndex:i}}),t=>{let n;t.response&&t.response.statusText?n=t.response.statusText:t.message&&(n=t.message),this.$store.addError(`Error loading info file for page ${e}${n?`: ${n}`:""}`)}))}else t!=null&&t.id&&this.tileSources.push({$meta:{page:e,itemIndex:r,layerIndex:i},type:"image",url:t.id,width:t.width,height:t.height})}),!t&&!n&&this.$store.addError(`Image missing for page ${e}`)}),s.length?Promise.all(s).then(t=>{t.filter(Boolean).forEach(e=>{var t,n;if(this.$store.options.preferredImageFormat){const s=e.extraFormats||((n=(t=e.profile)==null?0[0]:t[1])==null?0[0]:n.formats);s!=null&&s.includes(this.$store.options.preferredImageFormat)&&(e.tileFormat=this.$store.options.preferredImageFormat)}this.tileSources.push(e)}),this.$store.options.pages.filter(e=>e>0).every((e,n)=>{var s;return((s=t[n])==null?0[0]:s.$meta.page)===e})&&this.initViewer(e)}):t&&this.initViewer(e)},onKeydown(e){e.key==="Escape"&&this.$store.rootElement.focus(),[45,48,96].includes(e.keyCode)&&(e.shiftKey?this.resetImage(e):this.viewer.viewport.goHome())},onKeypress(e){if(!Rn(e))switch(e.key){case"I":this.resetFilters();break;case"r":case"R":this.rotateRight(e);break;case"+":case"=":case"W":this.zoomIn();break;case"-":case"_":case"S":this.zoomOut();break}},removeImageOptions(){this.$store.updateOptions({pan:{},zoom:null})},resetFilters(){this.viewer.drawer.canvas.style.cssText=this.defaultCanvasCss,this.$store.updateOptions({filters:{}})},resetImage(e){e&&(this.viewer.viewport.setRotation(0),this.$store.updateOptions({rotation:null}),this.filtersActive&&this.resetFilters()),this.viewer.viewport.goHome(),this.removeImageOptions()},rotateRight(e){const{viewport:t}=this.viewer,n=e&&e.shiftKey?0:(t.getRotation()+90)%360;t.setRotation(n),this.$store.updateOptions({rotation:n||null})},setFilter(e,t){const n=t.target.valueAsNumber;n===1?delete this.$store.options.filters[e]:this.$store.options.filters[e]=n,this.$store.updateOptions({filters:this.$store.options.filters}),this.updateFilterStyle()},startLoadingWatch(){this.$store.loading=0;for(let e=this.viewer.world.getItemCount()-1;e>=0;e-=1){const t=this.viewer.world.getItemAt(e);if(t&&t._tilesLoading){this.$store.loading=1;break}}this.loadingTimeout=setTimeout(this.startLoadingWatch,200)},stopLoadingWatch(){clearTimeout(this.loadingTimeout)},toggleOverlays(){this.$store.updateOptions({annotationsVisible:this.$store.options.annotationsVisible===!1&&null})},updateFilterStyle(){if(!this.filtersActive)return;const e=[];Object.keys(this.$store.options.filters).forEach(t=>{e.push(`${t}(${this.$store.options.filters[t]})`)});const t=e.join(" ");this.viewer.drawer.canvas.style.cssText=`${this.defaultCanvasCss} filter: ${t}`},updateOverlays(){if(!this.viewer||!this.$store.options.pages.filter(e=>e>0).every(e=>this.tileSources.some(t=>t.$meta.page===e))||(this.viewer.clearOverlays(),this.overlayElements=[],!this.$store.annotationsActive))return;let e,t=0;this.$store.options.pages.filter(e=>e>-1).forEach((n,s)=>{var o,i,a,r;const c=this.tileSources.find(e=>e.$meta.page===(n===0?1:n)&&e.$meta.layerIndex===(this.$store.options.layers[s]||0));if(s===0){if(e=c[this.$store.isVertical?"height":"width"],n===0)return}else{const n=this.$store.options.pages[s-1],i=((o=this.$store.manifest.items[n-1])==null?0[0]:o[this.$store.isVertical?"height":"width"])||e;t+=(ln+i/e)*(this.$store.isReversed?-1:1)}(a=(i=this.$store.annotations[n])==null?0[0]:i[0])!=null&&a.coords&&((r=this.$store.annotations[n])==null||r.forEach((s,o)=>{const i=document.createElement("button");i.ariaLabel=`${n}/${o}`,i.className=`tify-media-overlay${this.$store.options.annotationId===s.id?" -current":""}`,i.id=s.id,i.type="button",new un.MouseTracker({element:i,clickHandler:e=>{e.quick&&setTimeout(()=>this.$store.toggleAnnotationId(s.id),5)},keyDownHandler:e=>e.keyCode===13&&this.$store.toggleAnnotationId(s.id)}),this.viewer.addOverlay({element:i,location:new un.Rect(s.coords[0]/e+(this.$store.isVertical?0:t),s.coords[1]/e+(this.$store.isVertical?t:0),s.coords[2]/e,s.coords[3]/e)}),this.overlayElements.push(i)}))})},updateViewerState(){const n=this.viewer.viewport.getZoom();this.viewerState.isMaxZoom=n>=this.viewer.viewport.getMaxZoom(),this.viewerState.isMinZoom=n<=this.viewer.viewport.getMinZoom();const e=this.viewer.viewport.getHomeBounds(),t=this.viewer.viewport.getBounds();this.viewerState.isReset=Math.abs(e.height-t.height)<1e-9&&Math.abs(e.width-t.width)<1e-9&&Math.abs(e.x-t.x)<1e-9&&Math.abs(e.y-t.y)<1e-9},zoomIn(){this.viewer.viewport.zoomBy(Sn),this.viewer.viewport.applyConstraints()},zoomOut(){this.viewer.viewport.zoomBy(1/Sn),this.viewer.viewport.applyConstraints()}}},i4={class:"tify-media","aria-live":"polite"},a4={class:"tify-sr-only"},r4={key:0,class:"tify-media-buttons -controls"},c4=["disabled","title","aria-label"],l4=["disabled","title","aria-label"],d4=["disabled","title","aria-label"],u4=["title","aria-label"],h4={class:"tify-sr-only"},m4=["disabled"],f4=["title","aria-label"],p4={class:"tify-sr-only"},g4={key:0},v4={class:"tify-button-list"},b4=["aria-pressed","onClick"],j4={class:"tify-media-buttons -pagination"},y4=["title","aria-label","onClick"];function z0(i,l,d,u,h,m){var f;const x=Qt,y=Kt,C=q1,v=$1,_=H1,w=N1,O=v1,p=tn,b=m1,E=l1,k=i1,A=be,S=vn,M=Nn,F=js,z=_s,D=qu;return e(),n("section",i4,[t("h2",a4,s(i.$translate("Media")),1),t("div",{ref:"image",class:j(["tify-media-image",{"-annotations-hidden":i.$store.options.annotationsVisible===!1}])},null,2),h.viewer?(e(),n("div",r4,[t("button",{type:"button",class:"tify-media-button",disabled:h.viewerState.isMaxZoom,title:i.$translate("Zoom in"),"aria-label":i.$translate("Zoom in"),onClick:l[0]||(l[0]=e=>m.zoomIn())},[a(x)],8,c4),t("button",{type:"button",class:"tify-media-button",disabled:h.viewerState.isMinZoom,title:i.$translate("Zoom out"),"aria-label":i.$translate("Zoom out"),onClick:l[1]||(l[1]=e=>m.zoomOut())},[a(y)],8,l4),t("button",{type:"button",class:"tify-media-button",disabled:h.viewerState.isReset,title:i.$translate("Reset"),"aria-label":i.$translate("Reset"),onClick:l[2]||(l[2]=e=>m.resetImage(!!e.shiftKey))},[a(C)],8,d4),t("button",{type:"button",class:j(["tify-media-button",{"-active":!!i.$store.options.rotation}]),title:i.$translate("Rotate"),"aria-label":i.$translate("Rotate"),onClick:l[3]||(l[3]=e=>m.rotateRight(e))},[a(v)],10,u4),a(p,{class:j(["tify-media-dropdown -filters",{"-active":m.filtersActive}]),alignment:"center",position:"right",label:i.$translate("Toggle image filters"),shortcut:"i"},{button:I(()=>[a(_)]),default:I(()=>[t("h3",h4,s(i.$translate("Image filters")),1),a(w,{onUpdate:l[4]||(l[4]=(e,t)=>m.setFilter(e,t))}),t("p",null,[t("button",{type:"button",class:"tify-media-reset",disabled:!m.filtersActive,onClick:l[5]||(l[5]=de(e=>m.resetFilters(),["stop"]))},[a(O),T(" "+s(i.$translate("Reset")),1)],8,m4)])]),_:1},8,["class","label"]),i.$store.annotations.length&&(i.$store.options.view==="text"||!i.$store.isContainerWidthAtLeast("medium"))?(e(),n("button",{key:0,type:"button",class:"tify-media-button",title:i.$translate("Toggle annotations"),"aria-label":i.$translate("Toggle annotations"),onClick:l[6]||(l[6]=e=>m.toggleOverlays())},[i.$store.options.annotationsVisible!==!1?(e(),r(b,{key:0})):(e(),r(E,{key:1}))],8,f4)):o("",!0),m.multiLayerResources.length?(e(),r(p,{key:1,class:j(["tify-media-dropdown -layers",{"-active":i.$store.options.layers.some(Boolean)}]),alignment:"center",position:"right",label:i.$translate("Toggle image layer select"),shortcut:"c"},{button:I(()=>[a(k)]),default:I(()=>[t("h3",p4,s(i.$translate("Layer")),1),(e(!0),n(c,null,g(m.multiLayerResources,r=>(e(),n(c,{key:r.pageIndex},[i.$store.options.pages.filter(e=>e>0).length>1?(e(),n("h4",g4,[a(A,{number:i.$store.options.pages[r.pageIndex],wrap:!0},null,8,["number"])])):o("",!0),t("ol",v4,[(e(!0),n(c,null,g(r.items,(o,a)=>(e(),n("li",{key:o.id},[t("button",{type:"button","aria-pressed":a===(i.$store.options.layers[r.pageIndex]||0),onClick:e=>{i.$store.options.layers[r.pageIndex]=a,m.loadInfo()}},s(i.$store.localize(o.label)),9,b4)]))),128))])],64))),128))]),_:1},8,["class","label"])):o("",!0)])):o("",!0),t("div",j4,[(e(!0),n(c,null,g(m.paginationButtons,t=>(e(),n("button",{key:t.position,type:"button",class:j(["tify-media-button",`-${t.position}`]),title:t.title,"aria-label":t.title,onClick:t.onClick},[t.position==="left"?(e(),r(S,{key:0})):t.position==="right"?(e(),r(M,{key:1})):t.position==="top"?(e(),r(F,{key:2})):t.position==="bottom"?(e(),r(z,{key:3})):o("",!0)],10,y4))),128))]),(f=h.avResource)!=null&&f.url?(e(),r(D,{key:1,src:h.avResource.url,format:h.avResource.format,hasImage:!!h.viewer},null,8,["src","format","hasImage"])):o("",!0)])}w4=i(o4,[["render",z0]]),O4={},x4={class:"tify-icon -fullscreen-exit","aria-hidden":"true",viewBox:"0 0 24 24"};function F0(s,o){return e(),n("svg",x4,[...o[0]||(o[0]=[t("path",{d:"M14,14H19V16H16V19H14V14M5,14H10V19H8V16H5V14M8,5H10V10H5V8H8V5M19,8V10H14V5H16V8H19Z"},null,-1)])])}E4=i(O4,[["render",F0]]),k4={},A4={class:"tify-icon -fullscreen","aria-hidden":"true",viewBox:"0 0 24 24"};function M0(s,o){return e(),n("svg",A4,[...o[0]||(o[0]=[t("path",{d:"M5,5H10V7H7V10H5V5M14,5H19V10H17V7H14V5M17,14H19V19H14V17H17V14M10,17V19H5V14H7V17H10Z"},null,-1)])])}M4=i(k4,[["render",M0]]),F4={},T4={class:"tify-icon -help-circle-outline","aria-hidden":"true",viewBox:"0 0 24 24"};function S0(s,o){return e(),n("svg",T4,[...o[0]||(o[0]=[t("path",{d:"M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"},null,-1)])])}D4=i(F4,[["render",S0]]),N4={},L4={class:"tify-icon -list-box-outline","aria-hidden":"true",viewBox:"0 0 24 24"};function A0(s,o){return e(),n("svg",L4,[...o[0]||(o[0]=[t("path",{d:"M11 15H17V17H11V15M9 7H7V9H9V7M11 13H17V11H11V13M11 9H17V7H11V9M9 11H7V13H9V11M21 5V19C21 20.1 20.1 21 19 21H5C3.9 21 3 20.1 3 19V5C3 3.9 3.9 3 5 3H19C20.1 3 21 3.9 21 5M19 5H5V19H19V5M9 15H7V17H9V15Z"},null,-1)])])}P4=i(N4,[["render",A0]]),H4={},I4={class:"tify-icon -tray-arrow-down","aria-hidden":"true",viewBox:"0 0 24 24"};function k0(s,o){return e(),n("svg",I4,[...o[0]||(o[0]=[t("path",{d:"M2 12H4V17H20V12H22V17C22 18.11 21.11 19 20 19H4C2.9 19 2 18.11 2 17V12M12 15L17.55 9.54L16.13 8.13L13 11.25V2H11V11.25L7.88 8.13L6.46 9.55L12 15Z"},null,-1)])])}V4=i(H4,[["render",k0]]),$4={},W4={class:"tify-icon -information-variant","aria-hidden":"true",viewBox:"0 0 24 24"};function E0(s,o){return e(),n("svg",W4,[...o[0]||(o[0]=[t("path",{d:"M13.5,4A1.5,1.5 0 0,0 12,5.5A1.5,1.5 0 0,0 13.5,7A1.5,1.5 0 0,0 15,5.5A1.5,1.5 0 0,0 13.5,4M13.14,8.77C11.95,8.87 8.7,11.46 8.7,11.46C8.5,11.61 8.56,11.6 8.72,11.88C8.88,12.15 8.86,12.17 9.05,12.04C9.25,11.91 9.58,11.7 10.13,11.36C12.25,10 10.47,13.14 9.56,18.43C9.2,21.05 11.56,19.7 12.17,19.3C12.77,18.91 14.38,17.8 14.54,17.69C14.76,17.54 14.6,17.42 14.43,17.17C14.31,17 14.19,17.12 14.19,17.12C13.54,17.55 12.35,18.45 12.19,17.88C12,17.31 13.22,13.4 13.89,10.71C14,10.07 14.3,8.67 13.14,8.77Z"},null,-1)])])}K4=i($4,[["render",E0]]),q4={},Y4={class:"tify-icon -table-of-contents","aria-hidden":"true",viewBox:"0 0 24 24"};function C0(s,o){return e(),n("svg",Y4,[...o[0]||(o[0]=[t("path",{d:"M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z"},null,-1)])])}X4=i(q4,[["render",C0]]),Q4={},Z4={class:"tify-icon -text","aria-hidden":"true",viewBox:"0 0 24 24"};function x0(s,o){return e(),n("svg",Z4,[...o[0]||(o[0]=[t("path",{d:"M21,6V8H3V6H21M3,18H12V16H3V18M3,13H21V11H3V13Z"},null,-1)])])}e0=i(Q4,[["render",x0]]),t0={},n0={class:"tify-icon -image-area","aria-hidden":"true",viewBox:"0 0 24 24"};function w0(s,o){return e(),n("svg",n0,[...o[0]||(o[0]=[t("path",{d:"M20,5A2,2 0 0,1 22,7V17A2,2 0 0,1 20,19H4C2.89,19 2,18.1 2,17V7C2,5.89 2.89,5 4,5H20M5,16H19L14.5,10L11,14.5L8.5,11.5L5,16Z"},null,-1)])])}o0=i(t0,[["render",w0]]),i0={},a0={class:"tify-icon -dots-grid","aria-hidden":"true",viewBox:"0 0 24 24"};function _0(s,o){return e(),n("svg",a0,[...o[0]||(o[0]=[t("path",{d:"M12 16C13.1 16 14 16.9 14 18S13.1 20 12 20 10 19.1 10 18 10.9 16 12 16M12 10C13.1 10 14 10.9 14 12S13.1 14 12 14 10 13.1 10 12 10.9 10 12 10M12 4C13.1 4 14 4.9 14 6S13.1 8 12 8 10 7.1 10 6 10.9 4 12 4M6 16C7.1 16 8 16.9 8 18S7.1 20 6 20 4 19.1 4 18 4.9 16 6 16M6 10C7.1 10 8 10.9 8 12S7.1 14 6 14 4 13.1 4 12 4.9 10 6 10M6 4C7.1 4 8 4.9 8 6S7.1 8 6 8 4 7.1 4 6 4.9 4 6 4M18 16C19.1 16 20 16.9 20 18S19.1 20 18 20 16 19.1 16 18 16.9 16 18 16M18 10C19.1 10 20 10.9 20 12S19.1 14 18 14 16 13.1 16 12 16.9 10 18 10M18 4C19.1 4 20 4.9 20 6S19.1 8 18 8 16 7.1 16 6 16.9 4 18 4Z"},null,-1)])])}c0=i(i0,[["render",_0]]),l0={},d0={class:"tify-icon -page-last","aria-hidden":"true",viewBox:"0 0 24 24"};function y0(s,o){return e(),n("svg",d0,[...o[0]||(o[0]=[t("path",{d:"M5.59,7.41L10.18,12L5.59,16.59L7,18L13,12L7,6L5.59,7.41M16,6H18V18H16V6Z"},null,-1)])])}h0=i(l0,[["render",y0]]),m0={},ao={class:"tify-icon -skip-next","aria-hidden":"true",viewBox:"0 0 24 24"};function g2(s,o){return e(),n("svg",ao,[...o[0]||(o[0]=[t("path",{d:"M16,18H18V6H16M6,18L14.5,12L6,6V18Z"},null,-1)])])}g0=i(m0,[["render",g2]]),v0={},p0={class:"tify-icon -skip-previous","aria-hidden":"true",viewBox:"0 0 24 24"};function J2(s,o){return e(),n("svg",p0,[...o[0]||(o[0]=[t("path",{d:"M6,18V6H8V18H6M9.5,12L18,6V18L9.5,12Z"},null,-1)])])}u0=i(v0,[["render",J2]]),r0={},s0={class:"tify-icon -page-first","aria-hidden":"true",viewBox:"0 0 24 24"};function O0(s,o){return e(),n("svg",s0,[...o[0]||(o[0]=[t("path",{d:"M18.41,16.59L13.82,12L18.41,7.41L17,6L11,12L17,18L18.41,16.59M6,6H8V18H6V6Z"},null,-1)])])}J4=i(r0,[["render",O0]]),G4={},U4=["disabled","title","aria-label"],B4=["disabled","title","aria-label"],R4=["disabled","title","aria-label"],z4=["disabled","title","aria-label"],S4=["disabled","title","aria-label"],C4=["disabled","title","aria-label"];function T0(s,i){const r=J4,c=u0,l=vn,d=Nn,u=g0,h=h0;return e(),n("div",{class:j(["tify-header-button-group -pagination",{"-reversed":s.$store.isReversed,"-vertical":s.$store.isVertical}])},[t("button",{type:"button",class:"tify-header-button",disabled:s.$store.isFirstPage,title:s.$translate("First page"),"aria-label":s.$translate("First page"),onClick:i[0]||(i[0]=e=>s.$store.goToFirstPage())},[a(r)],8,U4),s.$store.sections.length>1?(e(),n("button",{key:0,type:"button",class:"tify-header-button",disabled:s.$store.isFirstPage,title:s.$translate("Previous section"),"aria-label":s.$translate("Previous section"),onClick:i[1]||(i[1]=e=>s.$store.goToPreviousSection())},[a(c)],8,B4)):o("",!0),t("button",{type:"button",class:"tify-header-button",disabled:s.$store.isFirstPage,title:s.$translate("Previous page"),"aria-label":s.$translate("Previous page"),onClick:i[2]||(i[2]=e=>s.$store.goToPreviousPage())},[a(l)],8,R4),t("button",{type:"button",class:"tify-header-button",disabled:s.$store.isLastPage,title:s.$translate("Next page"),"aria-label":s.$translate("Next page"),onClick:i[3]||(i[3]=e=>s.$store.goToNextPage())},[a(d)],8,z4),s.$store.sections.length>1?(e(),n("button",{key:1,type:"button",class:"tify-header-button",disabled:s.$store.isLastSection,title:s.$translate("Next section"),"aria-label":s.$translate("Next section"),onClick:i[4]||(i[4]=e=>s.$store.goToNextSection())},[a(u)],8,S4)):o("",!0),t("button",{type:"button",class:"tify-header-button",disabled:s.$store.isLastPage,title:s.$translate("Last page"),"aria-label":s.$translate("Last page"),onClick:i[5]||(i[5]=e=>s.$store.goToLastPage())},[a(h)],8,C4)],2)}_4=i(G4,[["render",T0]]),s4={},Q1={class:"tify-icon -book-open-blank-outline","aria-hidden":"true",viewBox:"0 0 24 24"};function L0(s,o){return e(),n("svg",Q1,[...o[0]||(o[0]=[t("path",{d:"M21,4H3A2,2 0 0,0 1,6V19A2,2 0 0,0 3,21H21A2,2 0 0,0 23,19V6A2,2 0 0,0 21,4M3,19V6H11V19H3M21,19H13V6H21V19Z"},null,-1)])])}K1=i(s4,[["render",L0]]),V1={},P1={class:"tify-icon -view-module","aria-hidden":"true",viewBox:"0 0 24 24"};function I0(s,o){return e(),n("svg",P1,[...o[0]||(o[0]=[t("path",{d:"M16,5V11H21V5M10,11H15V5H10M16,18H21V12H16M10,18H15V12H10M4,18H9V12H4M4,11H9V5H4V11Z"},null,-1)])])}D1=i(V1,[["render",I0]]),A1={data(){return{filter:"",filteredCanvases:[],highlightIndex:0}},watch:{filter(){this.updateFilteredCanvases(),this.$nextTick(()=>this.updateScroll())}},mounted(){this.updateFilteredCanvases()},methods:{onKeyDownArrow(){this.highlightIndex<this.filteredCanvases.length-1&&(this.highlightIndex+=1,this.updateScroll())},onKeyUpArrow(){this.highlightIndex>0&&(this.highlightIndex-=1,this.updateScroll())},onOpen(){this.filter="",this.highlightIndex=this.$store.options.pages.at(-1)-1,this.$nextTick(()=>{window.matchMedia("(pointer: coarse)").matches||this.$refs.search.focus(),this.updateScroll()})},resetFilter(e){this.filter&&(this.filter="",e.stopPropagation())},setPage(e){this.$store.setPage(e),this.$store.isContainerWidthAtLeast("medium")||this.$store.updateOptions({view:null})},updateFilteredCanvases(){const e=[],n=this.filter.toLowerCase();let t=-1;this.$store.manifest.items.forEach((s,o)=>{const i=this.$store.localize(s.label).toLowerCase().includes(n),a=(o+1).toFixed().includes(n);if(i||a){const n=s;n.page=o+1,n.page===this.$store.options.pages[0]&&(t=e.length),e.push(n)}}),this.highlightIndex=t<0?0:t,this.filteredCanvases=e},updateScroll(){const{list:e}=this.$refs,t=e.children[this.highlightIndex];e&&t&&(e.scrollTop=t.offsetTop-e.offsetHeight/2+t.offsetHeight/2)}}},x1={class:"tify-sr-only"},y1={class:"tify-sr-only"},g1={class:"tify-page-select-filter"},h1=["aria-label"],c1={ref:"list",class:"tify-button-list tify-page-select-list"},o1=["onClick"];function G0(o,i,l,d,u,h){const m=be,f=tn;return e(),r(f,{class:"tify-page-select",shortcut:"x",onOpen:h.onOpen},{button:I(()=>[t("span",x1,s(`${o.$translate("Current Page")} `),1),a(m,{number:o.$store.options.pages.find(e=>e>0)},null,8,["number"]),t("span",y1," / "+s(o.$translate("Toggle page select")),1)]),default:I(()=>[t("div",g1,[k(t("input",{ref:"search","onUpdate:modelValue":i[0]||(i[0]=e=>u.filter=e),"aria-label":o.$translate("Filter pages"),type:"text",class:"tify-page-select-input",onKeyup:i[1]||(i[1]=pe(e=>o.$refs.list.querySelectorAll("a")[u.highlightIndex].click(),["enter"])),onKeydown:[i[2]||(i[2]=pe(e=>h.resetFilter(),["esc"])),i[3]||(i[3]=pe(de(e=>h.onKeyUpArrow(),["prevent"]),["up"])),i[4]||(i[4]=pe(de(e=>h.onKeyDownArrow(),["prevent"]),["down"]))]},null,40,h1),[[Ue,u.filter]])]),t("ol",c1,[(e(!0),n(c,null,g(u.filteredCanvases,(s,i)=>(e(),n("li",{key:i},[t("a",{href:"javascript:;",class:j({"-current":o.$store.options.pages.includes(s.page),"-highlighted":u.highlightIndex===i}),onClick:e=>h.setPage(s.page)},[a(m,{number:s.page,wrap:!0},null,8,["number"])],10,o1)]))),128))],512)]),_:1},8,["onOpen"])}t1=i(A1,[["render",G0]]),e1={props:{textEnabled:Boolean,tocEnabled:Boolean},data(){return{controlsVisible:!1,fullscreen:j0(this.$store.rootElement.parentNode)}},computed:{doublePageEnabled(){var e;return!((e=this.$store.manifest.behavior)!=null&&e.some(e=>["continuous","individuals"].includes(e)))&&this.$store.manifest.items.some(e=>{var t,n,s,o,i;return((i=(o=(s=(n=(t=e.items)==null?0[0]:t[0])==null?0[0]:n.items)==null?0[0]:s[0])==null?0[0]:o.body)==null?0[0]:i.type)==="Image"})},title(){return this.$store.localize((this.$store.manifest||this.$store.collection||{}).label).replace(/(\S{1,10})\s+(\S{1,10})$/,"$1\xA0$2")}},created(){this.$api.expose(this.setView),this.$api.expose(this.toggleDoublePage),this.$api.expose(this.fullscreen.toggle,"toggleFullscreen")},mounted(){this.$store.rootElement.addEventListener("keydown",this.onKeyDown),Kd(this.$refs.controls,()=>{this.closeControlsPopup()})},beforeUnmount(){this.$store.rootElement.removeEventListener("keydown",this.onKeyDown)},methods:{closeControlsPopup(){this.controlsVisible=!1},onKeyDown(e){if(Rn(e))return;if(e.key==="Escape"){this.controlsVisible=!1;return}switch(e.key){case"Backspace":this.$refs.switchViewSmall.offsetParent&&this.toggleView(null);break;case"1":this.$store.manifest&&this.textEnabled&&this.toggleView("text");break;case"2":this.$store.manifest&&this.toggleView("thumbnails");break;case"3":this.$store.manifest&&this.tocEnabled&&this.toggleView("toc");break;case"4":this.toggleView("info");break;case"5":(this.$store.collection||this.$store.manifest)&&this.toggleView("export");break;case"6":this.$store.collection&&this.toggleView("collection");break;case"7":this.toggleView("help");break;case"b":this.$store.manifest&&this.toggleDoublePage();break;case"f":this.fullscreen.toggle();break}if(!this.$store.manifest)return;const{pages:t}=this.$store.options;switch(e.key){case"q":case",":t[0]>1&&this.$store.goToPreviousPage();break;case"e":case".":this.isLastPage||this.$store.goToNextPage();break;case"Q":t[0]>1&&this.$store.goToFirstPage();break;case"E":this.isLastPage||this.$store.goToLastPage();break}},setView(e){this.$store.updateOptions({view:e})},toggleControlsPopup(){this.controlsVisible=!this.controlsVisible},toggleDoublePage(e){const{pages:t}=this.$store.options;if(!this.doublePageEnabled)return t[0];let n;return t.length>1&&e!==!0||e===!1?n=[t[1]>0?t[1]:t[0]]:n=[t[0],this.$store.getFacingPage(t[0])].sort(),this.$store.updateOptions({pages:n}),n},toggleView(e){this.closeControlsPopup();const t=e===this.$store.options.view&&this.$store.manifest&&this.$store.isContainerWidthAtLeast("medium")?null:e;return this.$store.updateOptions({view:t}),t}}},Xu={class:"tify-header"},Ku={class:"tify-header-column -title"},Ou=["title"],ju={key:0,class:"tify-header-column -pagination"},pu={class:"tify-sr-only"},uu={class:"tify-header-button-group -page-select"},ru=["title","aria-label","aria-pressed"],tu={ref:"controls",class:"tify-header-column -controls"},Zd={class:"tify-sr-only"},Qd={ref:"switchViewSmall",class:"tify-header-button-group -toggle"},Xd=["aria-controls","aria-expanded","title","aria-label"],Gd=["id"],Yd={class:"tify-header-button-group -view"},qd=["aria-controls","aria-expanded"],Bd={class:"tify-header-button-label"},Id=["aria-controls","aria-expanded"],Pd={class:"tify-header-button-label"},Rd=["aria-controls","aria-expanded"],Ld={class:"tify-header-button-label"},Dd=["aria-controls","aria-expanded"],zd={class:"tify-header-button-label"},Td=["aria-controls","aria-expanded"],Md={class:"tify-header-button-label"},Sd=["aria-controls","aria-expanded"],Od={class:"tify-header-button-label"},jd=["aria-controls","aria-expanded"],pd={class:"tify-header-button-label"},ud={class:"tify-header-button-group -view"},rd=["aria-controls","aria-expanded","title","aria-label"],sd={class:"tify-header-button-label"},Jl=["title","aria-label"],$l={class:"tify-header-button-label"},zl=["title","aria-label"],Sl={class:"tify-header-button-label"};function T2(i,c,l,d,u,h){const y=t1,f=D1,g=K1,m=_4,v=c0,b=o0,p=e0,_=X4,w=K4,O=V4,x=P4,C=D4,E=M4,k=E4;return e(),n("header",Xu,[t("div",Ku,[t("h1",{class:"tify-header-title",title:h.title},s(h.title),9,Ou)]),i.$store.pageCount>1?(e(),n("div",ju,[t("h2",pu,s(i.$translate("Page")),1),t("div",uu,[a(y),h.doublePageEnabled?(e(),n("button",{key:0,type:"button",class:j(["tify-header-button",{"-vertical":i.$store.isVertical}]),title:i.$translate("Toggle double-page"),"aria-label":i.$translate("Toggle double-page"),"aria-pressed":i.$store.options.pages.length>1,onClick:c[0]||(c[0]=(...e)=>h.toggleDoublePage&&h.toggleDoublePage(...e))},[i.$store.isCustomPageView?(e(),r(f,{key:0})):(e(),r(g,{key:1}))],10,ru)):o("",!0)]),i.$store.pageCount>1?(e(),r(m,{key:0})):o("",!0)])):o("",!0),t("div",tu,[t("h2",Zd,s(i.$translate("View [noun]")),1),t("div",Qd,[t("button",{type:"button","aria-controls":i.$getId("controls"),"aria-expanded":u.controlsVisible,class:"tify-header-button",title:i.$translate("View [noun]"),"aria-label":i.$translate("View [noun]"),onClick:c[1]||(c[1]=(...e)=>h.toggleControlsPopup&&h.toggleControlsPopup(...e))},[a(v)],8,Xd)],512),t("div",{id:i.$getId("controls"),class:j(["tify-dropdown-content -bottom -mobile-only",{"-visible":u.controlsVisible}])},[t("div",Yd,[i.$store.manifest?(e(),n("button",{key:0,type:"button",class:"tify-header-button -media","aria-controls":i.$getId("media"),"aria-expanded":!i.$store.options.view,onClick:c[2]||(c[2]=e=>h.toggleView(null))},[a(b),t("span",Bd,s(i.$translate("Media")),1)],8,qd)):o("",!0),l.textEnabled?(e(),n("button",{key:1,type:"button",class:"tify-header-button","aria-controls":i.$getId("text"),"aria-expanded":i.$store.options.view==="text",onClick:c[3]||(c[3]=e=>h.toggleView("text"))},[a(p),t("span",Pd,s(i.$translate("Text")),1)],8,Id)):o("",!0),i.$store.manifest?(e(),n("button",{key:2,type:"button",class:"tify-header-button","aria-controls":i.$getId("thumbnails"),"aria-expanded":i.$store.options.view==="thumbnails",onClick:c[4]||(c[4]=e=>h.toggleView("thumbnails"))},[a(f),t("span",Ld,s(i.$translate("Pages")),1)],8,Rd)):o("",!0),l.tocEnabled?(e(),n("button",{key:3,type:"button",class:"tify-header-button","aria-controls":i.$getId("toc"),"aria-expanded":i.$store.options.view==="toc",onClick:c[5]||(c[5]=e=>h.toggleView("toc"))},[a(_),t("span",zd,s(i.$translate("Contents")),1)],8,Dd)):o("",!0),t("button",{type:"button",class:"tify-header-button","aria-controls":i.$getId("info"),"aria-expanded":i.$store.options.view==="info",onClick:c[6]||(c[6]=e=>h.toggleView("info"))},[a(w),t("span",Md,s(i.$translate("Info")),1)],8,Td),i.$store.collection||i.$store.manifest?(e(),n("button",{key:4,type:"button",class:"tify-header-button","aria-controls":i.$getId("export"),"aria-expanded":i.$store.options.view==="export",onClick:c[7]||(c[7]=e=>h.toggleView("export"))},[a(O),t("span",Od,s(i.$translate("Export [noun]")),1)],8,Sd)):o("",!0),i.$store.collection?(e(),n("button",{key:5,type:"button",class:"tify-header-button","aria-controls":i.$getId("collection"),"aria-expanded":i.$store.options.view==="collection",onClick:c[8]||(c[8]=e=>h.toggleView("collection"))},[a(x),t("span",pd,s(i.$translate("Collection")),1)],8,jd)):o("",!0)]),t("div",ud,[t("button",{type:"button",class:"tify-header-button -icon-only","aria-controls":i.$getId("help"),"aria-expanded":i.$store.options.view==="help",title:i.$translate("Help"),"aria-label":i.$translate("Help"),onClick:c[9]||(c[9]=e=>h.toggleView("help"))},[a(C),t("span",sd,s(i.$translate("Help")),1)],8,rd),u.fullscreen.isFullscreen?(e(),n("button",{key:1,type:"button",class:"tify-header-button -icon-only",title:i.$translate("Exit fullscreen"),"aria-label":i.$translate("Exit fullscreen"),onClick:c[11]||(c[11]=e=>u.fullscreen.toggle())},[a(k),t("span",Sl,s(i.$translate("Exit fullscreen")),1)],8,zl)):(e(),n("button",{key:0,type:"button",class:"tify-header-button -icon-only",title:i.$translate("Fullscreen"),"aria-label":i.$translate("Fullscreen"),onClick:c[10]||(c[10]=e=>u.fullscreen.toggle())},[a(E),t("span",$l,s(i.$translate("Fullscreen")),1)],8,Jl))]),i.$store.pageCount>1?(e(),r(m,{key:0})):o("",!0)],10,Gd)],512)])}yl=i(e1,[["render",T2]]),qc={version:"0.35.0"},$c={props:{readyPromise:{type:Object,default:null,required:!0}},data(){return{readyToRender:!1}},computed:{hasText(){var e,t;return(t=(e=this.$store.manifest)==null?0[0]:e.items)==null?0[0]:t.some(e=>"annotations"in e)},hasToc(){return this.$store.structures.length>0}},watch:{"$store.options.pages":function(e,t){t&&(this.$store.options.layers=[]),this.$store.annotationsActive&&this.$store.loadAnnotations()},"$store.options.view":function(){this.$store.annotationsActive&&this.$store.loadAnnotations()}},created(){this.$api.expose(this.setLanguage),this.$api.expose(this.$store.setPage),this.$api.expose(this.$store.updateOptions)},mounted(){if(this.$store.rootElement=this.$el,!this.$store.options.manifestUrl){if(this.$store.options.contentStateEnabled){const e=new URLSearchParams(window.location.search);this.$store.options.manifestUrl=e.get("iiif-content")||""}if(!this.$store.options.manifestUrl){this.$store.addError("Missing IIIF manifest URL");return}}Promise.all([this.$store.loadManifest(this.$store.options.manifestUrl),this.setLanguage(this.$store.options.language)]).then(()=>{this.readyToRender=!0,this.$nextTick(()=>{Promise.all(this.$store.readyPromises).then(()=>{setTimeout(this.readyPromise.resolve)})})},e=>{this.readyPromise.reject(e)})},beforeUnmount(){clearTimeout(this.$store.urlUpdateTimeout),window.removeEventListener("popstate",this.$store.initOptions)},methods:{setLanguage(e){const t=bn();if(e==="en")return this.$store.options.language="en",this.$translate.setTranslation(null),t.resolve(e),t;if(this.$store.options.translationsDirUrl===null)return t.reject(new Error("Could not determine translationsDirUrl")),t;const n=`${this.$store.options.translationsDirUrl}/${e}.json?${qc.version}`;return this.$store.fetchJson(n).then(n=>{this.$store.options.language=e,this.$translate.setTranslation(n),t.resolve(e)},n=>{const s=n.response?n.response.statusText:n.message;this.$store.addError(`Error loading translation â${e}â: ${s}`),t.resolve(this.$store.options.language)}),t}}},Ic={key:1,class:"tify-main"},Hc={key:2,class:"tify-loading",role:"status"},Ac={class:"tify-sr-only"},bc={key:3,class:"tify-error"},Gr=["aria-label"],qr={class:"tify-error-messages"};function V2(i,l,d,u,h,m){const f=yl,p=w4,v=ed,b=Wl,y=Ml,_=_l,w=Sc,O=vr,x=Ka,C=xn;return e(),n("article",{class:j(["tify",i.$store.options.colorMode==="auto"?"":`-${i.$store.options.colorMode}`]),tabindex:"-1"},[h.readyToRender&&(i.$store.collection||i.$store.manifest)?(e(),r(f,{key:0,textEnabled:m.hasText,tocEnabled:m.hasToc},null,8,["textEnabled","tocEnabled"])):o("",!0),h.readyToRender?(e(),n("div",Ic,[i.$store.manifest?(e(),n(c,{key:0},[a(p,{id:i.$getId("media")},null,8,["id"]),m.hasText?k((e(),r(v,{key:0,id:i.$getId("text")},null,8,["id"])),[[N,i.$store.options.view==="text"]]):o("",!0),k(a(b,{id:i.$getId("thumbnails")},null,8,["id"]),[[N,i.$store.options.view==="thumbnails"]]),m.hasToc?k((e(),r(y,{key:1,id:i.$getId("toc")},null,8,["id"])),[[N,i.$store.options.view==="toc"]]):o("",!0)],64)):o("",!0),i.$store.collection||i.$store.manifest?k((e(),r(_,{key:1,id:i.$getId("export")},null,8,["id"])),[[N,i.$store.options.view==="export"]]):o("",!0),i.$store.collection||i.$store.manifest?k((e(),r(w,{key:2,id:i.$getId("info")},null,8,["id"])),[[N,i.$store.options.view==="info"]]):o("",!0),i.$store.collection?k((e(),r(O,{key:3,id:i.$getId("collection")},null,8,["id"])),[[N,i.$store.options.view==="collection"]]):o("",!0),k(a(x,{id:i.$getId("help")},null,8,["id"]),[[N,i.$store.options.view==="help"]])])):o("",!0),i.$store.loading?(e(),n("div",Hc,[t("span",Ac,s(i.$translate("Loading")),1)])):o("",!0),i.$store.errors.size?(e(),n("section",bc,[t("button",{type:"button",class:"tify-error-close","aria-label":i.$translate("Dismiss"),onClick:l[0]||(l[0]=e=>i.$store.clearErrors())},[a(C)],8,Gr),t("div",qr,[(e(!0),n(c,null,g(i.$store.errors,t=>(e(),n("p",{key:t},s(t),1))),128))])])):o("",!0)],2)}Lr=i($c,[["render",V2]]),Nr={annotationId:null,annotationsVisible:null,childManifestAutoloaded:!0,childManifestUrl:null,colorMode:"auto",container:null,contentStateEnabled:!1,fallbackLanguage:"en",filters:{},language:"en",layers:[],manifestUrl:null,optionsResetOnPageChange:["pan"],pageLabelFormat:"P&nbsp;\xB7 L",pages:null,pan:{},preferredImageFormat:null,rotation:null,translationsDirUrl:null,urlQueryKey:null,urlQueryParams:["annotationId","annotationsVisible","childManifestUrl","layers","filters","pages","pan","rotation","view","zoom"],view:null,viewer:{},zoom:null};function U2(e){return{expose(t,n){e[n||t.name.replace("bound ","")]=t}}}Tr={install:(e,t)=>{e.config.globalProperties.$api=new U2(t.instance)}},Fr="TIFY is a slim and mobile-friendly IIIF document viewer, released under the <a href='https://www.gnu.org/licenses/agpl-3.0.html.en'>GNU Affero General Public License 3.0</a>.",kr="Copyright &copy; 2017&ndash;2026 <a href='https://www.uni-goettingen.de/en/'>G\xF6ttingen University</a>&nbsp;/ <a href='https://www.sub.uni-goettingen.de/en/'>G\xF6ttingen State and University Library</a>",xr={$info:Fr,$copyright:kr,"$n/a":"â"},wr={install:e=>{const t=ut(null);e.config.globalProperties.$translate=n=>{var s,o,i;const{language:a}=e.config.globalProperties.$store.options,r=(o=(s=e.config.globalProperties.$store.options.translations)==null?0[0]:s[a])==null?0[0]:o[n];return r||((i=t.value)!=null&&i[n]?t.value[n]:xr[n]||n.replace(/\s*\[.+?\]/g,""))},e.config.globalProperties.$translate.setTranslation=e=>{t.value=e}}},jr={install:e=>{const t=crypto!=null&&crypto.randomUUID?crypto.randomUUID():Math.random().toString().slice(2);e.config.globalProperties.$getId=e=>`${t}-${e}`}};function nt(e){return"@babel/helpers - typeof",nt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nt(e)}function e3(e,t){if(nt(e)!="object"||!e)return e;var n,s=e[Symbol.toPrimitive];if(s!==0[0]){if(n=s.call(e,t),nt(n)!="object")return n;throw TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function c2(e){var t=e3(e,"string");return nt(t)=="symbol"?t:t+""}function ir(e,t,n){return(t=c2(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n3(e){return Array.isArray(e)?e:e?[e]:[]}function q(e){for(let t in e)(e[t]===0[0]||e[t]===null)&&delete e[t];return e}Ja="http://library.stanford.edu/iiif/image-api/compliance.html#level0",Xa="http://library.stanford.edu/iiif/image-api/compliance.html#level1",Pn="http://library.stanford.edu/iiif/image-api/compliance.html#level2",Ua="http://library.stanford.edu/iiif/image-api/conformance.html#level0",Ta="http://library.stanford.edu/iiif/image-api/conformance.html#level1",In="http://library.stanford.edu/iiif/image-api/conformance.html#level2",Fa="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",ka="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",Wn="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",xa="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",_a="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",Yn="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",ua="http://iiif.io/api/image/1/level0.json",da="http://iiif.io/api/image/1/profiles/level0.json",ra="http://iiif.io/api/image/1/level1.json",aa="http://iiif.io/api/image/1/profiles/level1.json",es="http://iiif.io/api/image/1/level2.json",ds="http://iiif.io/api/image/1/profiles/level2.json",Ji="http://iiif.io/api/image/2/level0.json",Zi="http://iiif.io/api/image/2/profiles/level0.json",qi="http://iiif.io/api/image/2/level1.json",$i="http://iiif.io/api/image/2/profiles/level1.json",ps="http://iiif.io/api/image/2/level2.json",bs="http://iiif.io/api/image/2/profiles/level2.json",Pi="level0",Ri="level1",ys="level2",Ti="http://iiif.io/api/image/2/level0",xi="http://iiif.io/api/image/2/level1",xs="http://iiif.io/api/image/2/level2",_i=[xs,Pn,In,Wn,Yn,es,ds,ps,bs,ys],ji=[Ti,xi,xs,Ja,Xa,Pn,Ua,Ta,In,Fa,ka,Wn,xa,_a,Yn,ua,da,ra,aa,es,ds,Ji,Zi,qi,$i,ps,bs,Pi,Ri,ys],pi=ji,Es=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];function P3(e){if(e==null)throw Error("Null or undefined is not a valid entity.");if(Array.isArray(e))throw Error("Array is not a valid entity");if(typeof e!="object")throw Error(`${typeof e} is not a valid entity`);if(typeof e["@type"]=="string"){let t=Es.indexOf(e["@type"]);if(t!==-1)return Es[t]}if(e.profile)return"Service";if(e.format||e["@type"])return"ContentResource";throw Error("Resource type is not known")}ui=class zo{constructor(e,t={}){ir(this,"traversals",0[0]),ir(this,"options",0[0]),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...e},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...t}}static all(e){return new zo({collection:[e],manifest:[e],canvas:[e],annotationList:[e],sequence:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e],layer:[e]})}traverseCollection(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(e))),this.traversals.collection)}traverseCollectionItems(e){if(this.options.mergeMemberProperties){let n=[...(e.manifests||[]).map(e=>typeof e=="string"?{"@id":e,"@type":"sc:Manifest"}:e),...(e.collections||[]).map(e=>typeof e=="string"?{"@id":e,"@type":"sc:Collection"}:e),...e.members||[]],t=[],s=n.filter(e=>!t.includes(e["@id"])&&(t.push(e["@id"]),!0));delete e.collections,delete e.manifests,e.members=s}return e.manifests&&(e.manifests=e.manifests.map(e=>this.traverseManifest(typeof e=="string"?{"@id":e,"@type":"sc:Manifest"}:e))),e.collections&&(e.collections=e.collections.map(e=>this.traverseCollection(typeof e=="string"?{"@id":e,"@type":"sc:Collection"}:e))),e.members&&(e.members=e.members.map(e=>typeof e=="string"?e:e["@type"]==="sc:Collection"?this.traverseCollection(e):e["@type"]==="sc:Manifest"?this.traverseManifest(e):this.traverseUnknown(e))),e}traverseManifest(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e))),this.traversals.manifest)}traverseManifestItems(e){return e.sequences&&(e.sequences=e.sequences.map(e=>this.traverseSequence(e))),e.structures&&(e.structures=e.structures.map(e=>this.traverseRange(e))),e}traverseSequence(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(e))),this.traversals.sequence)}traverseSequenceItems(e){return e.canvases&&(e.canvases=e.canvases.map(e=>this.traverseCanvas(e))),e}traverseCanvas(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e))),this.traversals.canvas)}traverseCanvasItems(e){return e.images&&(e.images=e.images.map(e=>(e.on&&e["@type"]!=="oa:Annotation"&&e["@type"]!=="Annotation"&&(e["@type"]="oa:Annotation"),this.traverseAnnotation(e)))),e.otherContent&&(e.otherContent=e.otherContent.map(e=>this.traverseAnnotationList(e))),e}traverseRange(e){return e["@type"]!=="sc:Range"&&(e["@type"]="sc:Range"),this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(e))),this.traversals.range)}traverseRangeItems(e){if(this.options.mergeMemberProperties){let t=[...(e.ranges||[]).map(e=>typeof e=="string"?{"@id":e,"@type":"sc:Range"}:e),...(e.canvases||[]).map(e=>typeof e=="string"?{"@id":e,"@type":"sc:Canvas"}:e),...e.members||[]];delete e.ranges,delete e.canvases,e.members=t.length?t.map(e=>this.traverseUnknown(e)):0[0]}return e}traverseAnnotationList(e){let t=typeof e=="string"?{"@id":e,"@type":"sc:AnnotationList"}:e;return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(t)),this.traversals.annotationList)}traverseAnnotationListItems(e){return e.resources&&(e.resources=e.resources.map(e=>this.traverseAnnotation(e))),e}traverseAnnotation(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(e))),this.traversals.annotation)}traverseAnnotationItems(e){return e.resource&&(Array.isArray(e.resource)?e.resource=e.resource.map(e=>this.traverseContentResource(e)):e.resource=this.traverseContentResource(e.resource)),e.on,e}traverseLayer(e){return this.traverseType(this.traverseLinking(this.traverseLayerItems(e)),this.traversals.layer)}traverseLayerItems(e){return e.otherContent&&(e.otherContent=e.otherContent.map(e=>this.traverseAnnotationList(e))),e}traverseChoice(e){return this.traverseType(this.traverseChoiceItems(e),this.traversals.choice)}traverseChoiceItems(e){return e.default&&e.default!=="rdf:nil"&&(e.default=this.traverseContentResource(e.default)),e.item&&e.item!=="rdf:nil"&&(e.item=e.item.map(e=>this.traverseContentResource(e))),e}traverseService(e){return this.traverseType(this.traverseLinking(e),this.traversals.service)}traverseContentResource(e){return e["@type"]==="oa:Choice"?this.traverseChoice(e):this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),this.traversals.contentResource)}traverseUnknown(e){if(!e["@type"]||typeof e=="string")return e;switch(P3(e)){case"sc:Collection":return this.traverseCollection(e);case"sc:Manifest":return this.traverseManifest(e);case"sc:Canvas":return this.traverseCanvas(e);case"sc:Sequence":return this.traverseSequence(e);case"sc:Range":return this.traverseRange(e);case"oa:Annotation":return this.traverseAnnotation(e);case"sc:AnnotationList":return this.traverseAnnotationList(e);case"sc:Layer":return this.traverseLayer(e);case"Service":return this.traverseService(e);case"oa:Choice":return this.traverseChoice(e);case"ContentResource":return this.traverseContentResource(e)}return e.profile?this.traverseService(e):e}traverseImageResource(e){let n=Array.isArray(e),s=Array.isArray(e)?e:[e],t=[];for(let e of s)typeof e=="string"?t.push(this.traverseContentResource({"@id":e,"@type":"dctypes:Image"})):t.push(this.traverseContentResource(e));return!n&&!this.options.convertPropsToArray?t[0]:t}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=this.traverseImageResource(e.thumbnail)),e.logo&&(e.logo=this.traverseImageResource(e.logo)),e}traverseOneOrMoreServices(e){let n=Array.isArray(e),s=Array.isArray(e)?e:[e],t=[];for(let e of s)t.push(this.traverseService(e));return!n&&!this.options.convertPropsToArray?t[0]:t}traverseLinking(e){return e.related&&(e.related=this.traverseOneOrManyType(e.related,this.traversals.contentResource)),e.rendering&&(e.rendering=this.traverseOneOrManyType(e.rendering,this.traversals.contentResource)),e.service&&(e.service=this.traverseOneOrMoreServices(e.service)),e.seeAlso&&(e.seeAlso=this.traverseOneOrManyType(e.seeAlso,this.traversals.contentResource)),e.within&&(typeof e.within=="string"||(e.within=this.traverseOneOrManyType(e.within,this.traversals.contentResource))),e.startCanvas&&(typeof e.startCanvas=="string"?e.startCanvas=this.traverseType({"@id":e.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):e.startCanvas&&this.traverseType(e.startCanvas,this.traversals.canvas)),e.contentLayer&&(typeof e.contentLayer=="string"?e.contentLayer=this.traverseLayer({"@id":e.contentLayer,"@type":"sc:Layer"}):e.contentLayer=this.traverseLayer(e.contentLayer)),e}traverseOneOrManyType(e,t){if(!Array.isArray(e))if(this.options.convertPropsToArray)e=[e];else return this.traverseType(e,t);return e.map(e=>this.traverseType(e,t))}traverseType(e,t){return t.reduce((e,t)=>{let n=t(e);return n===0[0]&&!this.options.allowUndefinedReturn?e:n},e)}},li=["http://iiif.io/api/image/2/level1","http://iiif.io/api/image/2/level2","http://library.stanford.edu/iiif/image-api/compliance.html#level1","http://library.stanford.edu/iiif/image-api/compliance.html#level2","http://library.stanford.edu/iiif/image-api/conformance.html#level1","http://library.stanford.edu/iiif/image-api/conformance.html#level2","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2","http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1","http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2","http://iiif.io/api/image/1/level1.json","http://iiif.io/api/image/1/profiles/level1.json","http://iiif.io/api/image/1/level2.json","http://iiif.io/api/image/1/profiles/level2.json","http://iiif.io/api/image/2/level1.json","http://iiif.io/api/image/2/profiles/level1.json","http://iiif.io/api/image/2/level2.json","http://iiif.io/api/image/2/profiles/level2.json","level1","level2"],Nt={attributionLabel:"Attribution",providerId:"http://example.org/provider",providerName:""};function V3(e){if(typeof e=="string")return[e];if(!e)return[];let n=Array.isArray(e)?e:[e],t=[];for(let e of n){if(typeof e=="string"){t.push(e);continue}t.push({"@language":e["@language"]||e.language,"@value":e["@value"]||e.value})}return t}function ye(e,t="none"){if(!e)return{none:[""]};let s=V3(e),n={};for(let e of s){if(typeof e=="string"){n[t]=n[t]?n[t]:[],n[t].push(e||"");continue}if(!e["@language"]){n[t]=n[t]?n[t]:[],n[t].push(e["@value"]||"");continue}let o=e["@language"];n[o]=n[o]?n[o]:[],n[o].push(e["@value"]||"")}return Object.keys(n).length===0?{none:[""]}:n}function ti(e){if(Array.isArray(e))return ti(e.find(e=>typeof e=="string"));if(_i.indexOf(e)!==-1)return"level2";if(li.indexOf(e)!==-1)return"level1";if(pi.indexOf(e)!==-1)return"level0";if(typeof e=="string")return e}function U3(e){let t=Array.isArray(e)?e:[e];for(let e of t)switch(e){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}function K3(e){switch(e){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}function Zo(e){for(let t of["sc","oa","dcterms","dctypes","iiif"])if(e.startsWith(`${t}:`))return e.slice(t.length+1);return e}Qo=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function Ms(e){let n=e["@id"]||e.id,t=e["@type"]||e.type,s=e.profile||0[0],o=e["@context"]||0[0];if(s){let e=K3(s);if(e)return e}if(o){let e=U3(o);if(e)return e}if(t){if(Array.isArray(t)){if(t.indexOf("oa:CssStylesheet")!==-1)return"CssStylesheet";if(t.indexOf("cnt:ContentAsText")!==-1)return"TextualBody";t=t[0]}for(let e of["sc","oa","dcterms","dctypes","iiif"])if(t.startsWith(`${e}:`)){t=t.slice(e.length+1);break}switch(t){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(t&&Qo.indexOf(t)!==-1)return t;if(e.format){if(e.format.startsWith("image/"))return"Image";if(e.format.startsWith("text/")||e.format==="application/pdf")return"Text";if(e.format.startsWith("application/"))return"Dataset"}return n&&(n.endsWith(".jpg")||n.endsWith(".png")||n.endsWith(".jpeg"))?"Image":t||"unknown"}qo=/^|["'\\>]http(s)?:\/\/(creativecommons.org|rightsstatements.org)\/[^"'\\<\n]+/gm;function Q3(e){let t=e.match(qo);return t?t[0]:e}function Z3(e,t="Rights/License",n="none"){let s=null,o=[],i=Array.isArray(e)?e:[e];for(let a of i){let e=a?Q3(a):0[0];if(e&&(e.indexOf("creativecommons.org")!==-1||e.indexOf("rightsstatements.org")!==-1)){s=e.startsWith("https://")?`http://${e.slice(8)}`:e;continue}e&&o.push({label:{[n]:[t]},value:{[n]:[e]}})}return[s,o]}$o=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function eh(e){if(e){let n=Array.isArray(e)?e:[e],t=[];for(let e of n)e==="http://iiif.io/api/presentation/2/context.json"&&t.push("http://iiif.io/api/presentation/3/context.json"),$o.indexOf(e)===-1&&t.push(e);if(n.length)return t.length===1?t[0]:t}}function th(e){return e?e.map(e=>({label:ye(e.label),value:ye(e.value)})):[]}Fs=0;function Ro(e,t){let n=encodeURI(e.id||e["@id"]||"").trim();return n&&t?`${n}/${t}`:n||(Fs++,`http://example.org/${e["@type"]}${t?`/${t}`:""}/${Fs}`)}function ie(e){let t=[...e.behavior||[]];e.viewingHint&&t.push(e.viewingHint);let n;return Array.isArray(e.motivation)?n=e.motivation.map(Zo):e.motivation&&(n=Zo(e.motivation)),{"@context":e["@context"]?eh(e["@context"]):0[0],id:(e["@id"]||Ro(e)).trim(),type:Ms(e),behavior:t.length?t:0[0],height:e.height?e.height:0[0],width:e.width?e.width:0[0],motivation:n,viewingDirection:e.viewingDirection,profile:e.profile,format:e.format?e.format:0[0],duration:0[0],timeMode:0[0]}}function re(e){let[n,s]=Z3(e.license),t=[...e.metadata?th(e.metadata):[],...s];return{rights:n,metadata:t.length?t:0[0],label:e.label?ye(e.label):0[0],requiredStatement:e.attribution?{label:ye(Nt.attributionLabel),value:ye(e.attribution)}:0[0],navDate:e.navDate,summary:e.description?ye(e.description):0[0],thumbnail:ah(e.thumbnail)}}function ah(e){return e&&(Array.isArray(e)?e:[e]).map(e=>typeof e=="string"?{id:e,type:"Image"}:(e.type==="unknown"&&(e.type="Image"),e))}function rh(e){if(!e.within)return;let n=Array.isArray(e.within)?e.within:[e.within],t=[];for(let s of n)if(typeof s=="string"){if(s)switch(e["@type"]){case"sc:Manifest":t.push({id:s,type:"Collection"});break}}else s["@id"]&&t.push({id:s["@id"],type:Ms(s)});return t.length?t:0[0]}function le(e){let t=e.related?Array.isArray(e.related)?e.related:[e.related]:[],n=e.contentLayer;return{provider:e.logo||t.length?[{id:Nt.providerId,type:"Agent",homepage:t.length?[t[0]]:0[0],logo:e.logo?Array.isArray(e.logo)?e.logo:[e.logo]:0[0],label:ye(Nt.providerName)}]:0[0],partOf:rh(e),rendering:e.rendering,seeAlso:e.seeAlso,start:e.startCanvas,service:e.service?n3(e.service):0[0],supplementary:n?[n]:0[0]}}function lh(e){return{chars:e.chars,format:e.format?e.format:0[0],language:e.language}}function Ns(e,t){return e?typeof e=="string"?{id:e,type:t}:typeof e?.["@id"]=="string"?{id:e["@id"],type:t}:typeof e.id=="string"?{id:e.id,type:t}:null:null}function uh(e){let t={};if(e.first){let n=Ns(e.first,"Collection");n&&(t.first=n)}if((e.total||e.total===0)&&(t.total=e.total),e.prev){let n=Ns(e.prev,"Collection");n&&(t.prev=n)}if(e.next){let n=Ns(e.next,"Collection");n&&(t.next=n)}return t}function hh(e){let t=[];for(let s of e){let n={...s};n.items&&n.items.length===0&&delete n.items,t.push(n)}return t}function mh(e){return q({...ie(e),...re(e),...le(e),...uh(e),items:hh(e.members)})}function fh(e){let s=[],t=[],o,i;for(let n of e.sequences||[])n.canvases.length&&s.push(...n.canvases),n.behavior&&t.push(...n.behavior),n.viewingDirection&&(i=n.viewingDirection),n.startCanvas&&(o=n.startCanvas);let n=ie(e);return t.length&&(n.behavior?n.behavior.push(...t):n.behavior=t),q({...n,...re(e),...le(e),viewingDirection:i,start:o,items:s,structures:ph(e.structures)})}function ph(e){if(!e)return e;let t=new Map;for(let n of e)t.set(n.id,n);let n=[];for(let s of e)if(s.items){let e=s.items.map(e=>typeof e=="string"?(n.push(e),t.get(e)||e):e&&e.id?(n.push(e.id),t.get(e.id)||e):e);s.items=e}return e.filter(e=>n.indexOf(e.id)===-1)}function gh(e){return q({...ie(e),...re(e),...le(e),annotations:e.otherContent&&e.otherContent.length?e.otherContent:0[0],items:e.images&&e.images.length?[{id:Ro(e,"annotation-page"),type:"AnnotationPage",items:e.images}]:0[0]})}function vh(e){return q({...ie(e),...re(e),...le(e),items:e.resources&&e.resources.length?e.resources:0[0]})}function bh(e){return!e.canvases||e.canvases.length===0?{canvases:[],behavior:[]}:{canvases:e.canvases,behavior:e.viewingHint?[e.viewingHint]:[],viewingDirection:e.viewingDirection,startCanvas:e.startCanvas}}function jh(e){function t(e){if(Array.isArray(e)){if(e.length>1)return{type:"List",items:e.map(t)};e=e[0]}if(typeof e=="string")return encodeURI(e).trim();if("@type"in e){let t;if(typeof e.full=="string")t=e.full;else if(e.full["@type"]==="dctypes:Image")t={id:e.full["@id"],type:"Image"};else if(e.full["@type"]==="sc:Canvas")t={id:e.full["@id"],type:"Canvas"};else throw Error(`Unsupported source type on annotation: ${e.full["@type"]}`);return{type:"SpecificResource",source:t,selector:Ps(e.selector)}}return encodeURI(e["@id"]).trim()}return q({...ie(e),...re(e),...le(e),target:t(e.on),body:Array.isArray(e.resource)?e.resource.map(_o):_o(e.resource)})}function _o(e){return e.type==="Choice"?e:jo(e)}function jo(e){let t=e;return q({...ie(t),...re(t),...le(t),...lh(t)})}function wh(e){let t=[];return e.default&&e.default!=="rdf:nil"&&t.push(e.default),e.item&&e.item!=="rdf:nil"&&t.push(...e.item),q({...ie(e),...re(e),items:t})}function Oh(e){return q({...ie(e),...re(e),...le(e),items:e.members})}function xh(e){let{"@id":s,"@type":a,"@context":n,profile:o,...i}=e,t={};return s&&(t["@id"]=s),t["@type"]=Ms(e),t["@type"]==="unknown"&&(n&&n.length&&(t["@context"]=n),t["@type"]="Service"),o&&(t.profile=ti(o)),q({...t,...i})}function Ch(e){return q({...ie(e),...re(e),...le(e)})}bo=new ui({collection:[mh],manifest:[fh],canvas:[gh],annotationList:[vh],sequence:[bh],annotation:[jh],contentResource:[jo],choice:[wh],range:[Oh],service:[xh],layer:[Ch]});function kh(e){return e&&e["@context"]&&(e["@context"]==="http://iiif.io/api/presentation/2/context.json"||Array.isArray(e["@context"])&&e["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")!==-1||e["@context"]==="http://www.shared-canvas.org/ns/context.json")||e["@context"]==="http://iiif.io/api/image/2/context.json"||e["@id"]&&e["@type"]==="sc:Collection"||e["@id"]&&e["@type"]==="sc:Manifest"?(e["@context"]||(e["@context"]="http://iiif.io/api/presentation/2/context.json"),bo.traverseUnknown(e)):e}function Ps(e){if((Array.isArray(e["@type"])&&e["@type"].includes("oa:SvgSelector")||e["@type"]=="oa:SvgSelector")&&("chars"in e||"value"in e))return{type:"SvgSelector",value:"chars"in e?e.chars:e.value};if(e["@type"]==="oa:FragmentSelector")return{type:"FragmentSelector",value:e.value};if(e["@type"]==="oa:Choice")return[Ps(e.default),...(Array.isArray(e.item)?e.item:[e.item]).map(Ps)];if(e["@type"]=="iiif:ImageApiSelector")return{type:"ImageApiSelector",region:"region"in e?e.region:0[0],rotation:"rotation"in e?e.rotation:0[0]};throw Error(`Unsupported selector type: ${e["@type"]}`)}go=kh;function Ws(e){var n,s,o,i,a;const{related:c}=e,{requiredStatement:r}=e,{viewingDirection:l}=e,t=go(e);return e["@context"]==="http://iiif.io/api/presentation/2/context.json"&&([].concat(c||[]).forEach(e=>{t.homepage=t.homepage||[],t.homepage.push(typeof e=="string"?e:{id:e["@id"],label:e.label,format:e.format})}),(n=t.provider)==null||n.forEach((e,n)=>{e.homepage&&(t.provider[n].homepage=e.homepage.filter(e=>e.id!=="http://example.org/undefined/1"&&!t.homepage.find(t=>t.id===e.id)))}),((a=(i=(o=(s=t.provider)==null?0[0]:s[0])==null?0[0]:o.label)==null?0[0]:i.none)==null?0[0]:a[0])==="Unknown"&&(delete t.provider[0].label,r&&!t.requiredStatement&&(t.requiredStatement=r)),t.viewingDirection=l),t}function Fh(e={}){const t=xt({annotations:[],annotationsAvailable:null,collection:null,errors:new Set,loading:0,manifest:e.manifest?Ws(e.manifest):null,options:e.options||{},readyPromises:[],rootElement:e.rootElement||null,urlUpdateTimeout:null,annotationsActive:_(()=>t.options.view==="text"||!t.options.view&&!t.isContainerWidthAtLeast("medium")),currentStructure:_(()=>{if(!(t.manifest.structures instanceof Array))return!1;const s=[];t.options.pages.filter(e=>e>0).forEach(e=>{s.push(t.manifest.items[e-1].id)});const{length:o}=t.manifest.structures;let e,n;for(let i=o-1;i>=0;i-=1){const a=t.manifest.structures[i],{items:r}=a;if(r!=null&&r.some(e=>s.includes(e.id))){const t=a.items.length;if((t<n||!n)&&(e=i,n=t,n===0))break}}return typeof e=="number"&&e>=0&&t.manifest.structures[e]}),isCustomPageView:_(()=>{const{pages:e}=t.options;return e.length!==1&&(e.length>2||!(e[0]<1||e[1]<1)&&e[1]-e[0]!==1)}),isFirstPage:_(()=>t.options.pages[0]===1||t.options.pages[1]===1),isLastPage:_(()=>t.options.pages.at(-1)===t.pageCount),isLastSection:_(()=>{var s;const{pages:e}=t.options,n=e.length-1;return(e[n]?e[n]:e[n-1])>=((s=t.sections[t.sections.length-1])==null?0[0]:s.firstPage)}),isReversed:_(()=>["right-to-left","bottom-to-top"].includes(t.manifest.viewingDirection)),isVertical:_(()=>["top-to-bottom","bottom-to-top"].includes(t.manifest.viewingDirection)),pageCount:_(()=>{var e,n;return(n=(e=t.manifest)==null?0[0]:e.items)==null?0[0]:n.length}),sections:_(()=>{if(!t.manifest.structures)return[];const e=[];return t.manifest.structures.forEach(n=>{if(!n.items){e.push({firstPage:1,lastPage:t.pageCount});return}const s=n.items[0].id,o=t.manifest.items.findIndex(e=>e.id===s)+1,i=n.items[n.items.length-1].id,a=t.manifest.items.findIndex(e=>e.id===i)+1;e.push({firstPage:o,lastPage:a})}),e}),structures:_(()=>{var s,o,i;if((s=t.manifest)==null||!s.structures)return[];const a=(i=(o=t.manifest.structures[0])==null?0[0]:o.behavior)!=null&&i.includes("top")?t.manifest.structures[0].items||[]:t.manifest.structures,e=[],r=t.manifest.items,l=a.length;for(let n=0;n<l;n+=1){const t={...a[n]};if(t.items){const e=t.items[0].id;t.firstPage=r.findIndex(t=>t.id===e)+1;const n=t.items.at(-1).id;t.lastPage=r.findIndex(e=>e.id===n)+1}t.level=0,e.push(t)}let n=0;for(let s=0;s<e.length;s+=1){const t=e[s];for(let i=s+1;i<e.length;i+=1){const o=e[i];o.firstPage>=t.firstPage&&o.lastPage<=t.lastPage&&(t.items=(t.items||[]).filter(e=>e.label),t.items.push(o),o.level+=1,n=Math.max(n,o.level))}}const c=(e,t=0)=>{for(let n=0;n<e.length;n+=1){const s=e[n];s.level>t?e.splice(n,1):s.items&&c(s.items,t+1)}};for(let t=0;t<n;t+=1)c(e);return e}),addError(e){t.errors.add(e),console.warn(e)},clearErrors(){t.errors.clear()},async fetchJson(e){t.loading+=1;const n=await fetch(e).catch(e=>(t.loading=0,Promise.reject(e)));if(!n.ok)return t.loading=0,Promise.reject(new Error(n.status));const s=await n.json().catch(e=>(t.loading=0,Promise.reject(e)));return t.loading>0&&(t.loading-=1),s},async fetchText(e){t.loading+=1;const n=await fetch(e).catch(e=>(t.loading=0,Promise.reject(e)));if(!n.ok)return console.warn("Error loading annotation"),"";const s=await n.text().catch(e=>(t.loading=0,Promise.reject(e)));return t.loading>0&&(t.loading-=1),s},getFacingPage(e){var n,s,o,i,a;if((n=t.manifest.items[e-1].behavior)!=null&&n.includes("non-paged"))return-1;if(e===1)return 0;const r=t.manifest.items.slice(0,e-1).filter(e=>{var t;return(t=e.behavior)==null?0[0]:t.includes("non-paged")});return(e+r.length%2)%2===1?(o=(s=t.manifest.items[e-1-1])==null?0[0]:s.behavior)!=null&&o.includes("non-paged")?-1:e-1:(a=(i=t.manifest.items[e-1+1])==null?0[0]:i.behavior)!=null&&a.includes("non-paged")?-1:e<t.pageCount?e+1:0},getPageLabel(e,n){const s=t.localize(n,"");return s?t.options.pageLabelFormat.replace("P",e).replace("L",s):t.options.pageLabelFormat.includes("P")?`${e}`:"â"},getStartPages(){var n;let e=1;if(t.manifest.items&&t.manifest.start){const n=t.manifest.items.findIndex(e=>e.id===t.manifest.start.id);e=n>=0?n+1:1}return t.isContainerWidthAtLeast("medium")&&(n=t.manifest.behavior)!=null&&n.includes("paged")?[e,t.getFacingPage(e)].sort():[e]},getThumbnailUrl(e,n,s=0,o=0){var c,l,d,u,h,m,f;const p=t.manifest.items[e-1],i=(c=p.thumbnail)==null?0[0]:c[0];if(i!=null&&i.id&&i?.width>=n)return i.id;const r=(h=(u=(d=(l=p.items)==null?0[0]:l[0])==null?0[0]:d.items)==null?0[0]:u[s])==null?0[0]:h.body,a=r!=null&&r.items?r.items[o]:r,g=i?.service||((m=a?.source)==null?0[0]:m.service)||a?.service;if(g){const e=[].concat(g)[0],o=["ImageService2","ImageService3"].includes(e.type||e["@type"])?"default":"native",s=e.id||e["@id"];let t=n;i!=null&&i.service&&((f=e.sizes)==null||f.forEach(e=>{e.width>=t&&e.width<=t*2&&(t=e.width)}));const a="jpg",r=s.at(-1)==="/"?"":"/";return`${s}${r}full/${t},/0/${o}.${a}`}return a?.type==="Image"?i?.id||a?.id:""},goToFirstPage(){t.setPage(1)},goToNextPage(){const e=t.options.pages.at(-1);e<t.pageCount&&t.setPage(e+1)},goToNextSection(){const{pages:e}=t.options,s=e.length-1,o=e[s]?e[s]:e[s-1];let n=0;for(;o>=t.sections[n].firstPage||o&&o>=t.sections[n].firstPage;)n+=1;t.setPage(t.sections[n].firstPage)},goToLastPage(){t.setPage(t.pageCount)},goToPreviousPage(){const e=t.options.pages.find(e=>e>0);e>1&&t.setPage(e-1)},goToPreviousSection(){const{pages:n}=t.options,s=n[0]?n[0]:n[1];let e=t.sections.length-1;for(;s<=t.sections[e].firstPage||s&&s<=t.sections[e].firstPage;)e-=1;t.setPage(t.sections[e].firstPage)},isContainerWidthAtLeast(e){return t.rootElement&&window.getComputedStyle(t.rootElement,"::after").content.includes(e)},loadAnnotations(){var e;t.annotationsAvailable=null,(e=t.options.pages)==null||e.filter(e=>e>0).forEach(async e=>{if(t.annotations[e])return;const s=t.manifest.items[e-1];if(!("annotations"in s)){t.annotationsAvailable=!1;return}t.annotations[e]=[];let n=s.annotations[0].items;if(!n){const e=s.annotations[0].id;try{const s=await t.fetchJson(e);n=s.resources||s.items}catch(e){const n=e.response?e.response.statusText:e.message;console.warn(`Could not load annotations: ${n}`),t.annotationsAvailable=!1;return}}n instanceof Array&&n.forEach(async(n,s)=>{var i,a,r,c,l,d,u,h,m,f,p,g;let o;const v=n.id||n["@id"]||((c=n.resource)==null?0[0]:c.id)||((g=n.resource)==null?0[0]:g["@id"]);if((u=n.resource)!=null&&u.chars)o=n.resource.chars;else if((i=(r=n.resource)==null?0[0]:r[0])!=null&&i.chars)o=(d=(l=n.resource)==null?0[0]:l[0])==null?0[0]:d.chars;else if((h=n.resource)!=null&&h.label)o=`<i>${n.resource.label}</i>`;else{const e=[].concat(n.body);o=(await Promise.all(e.map(async e=>{var n,s,o,i;if(e?.type==="Image")return`<img src="${e.id}" alt="">`;if(e!=null&&e.value)return e.value;if((n=e?.body)!=null&&n.value)return e.body.value;const a=((s=e?.items)==null?0[0]:s[0].id)||((o=e?.body)==null?0[0]:o.id)||((i=e?.body)==null?0[0]:i["@id"])||e?.id||v;return Cs(a)?t.fetchText(a):""}))).join("<br>")}if(!o)return;(n.format||((f=n.body)==null?0[0]:f.format))==="text/plain"&&(o=o.replace(/\n/g," <br>")),t.annotationsAvailable=!0;const b={id:v,html:Rt(o)},y=((a=(m=n.on)==null?0[0]:m.selector)==null?0[0]:a.value)||(typeof n.on=="string"?n.on:null)||((p=n.target)==null?0[0]:p.id)||n.target,j=e4(y);j&&(b.coords=j),t.annotations[e][s]=b})})},initOptions(e){let n={};if(t.options.urlQueryKey)try{const e=new URLSearchParams(window.location.search);n=JSON.parse(e.get(t.options.urlQueryKey))||{}}catch{}n.view==="fulltext"?n.view="text":["scan",""].includes(n.view)&&(n.view=null),n.pages&&!Pr(n.pages,t.pageCount)&&(t.addError("Invalid pages, reset to start page"),n.pages=null),t.options.urlQueryParams.forEach(e=>{t.options[e]=n[e]??t.options[e]}),t.options.pages=e&&e.type==="popstate"?n.pages||t.getStartPages():n.pages||t.options.pages||t.getStartPages(),t.options.pan=n.panX||n.panY?{x:n.panX,y:n.panY}:n.pan||t.options.pan,t.options.rotation=parseInt(n.rotation,10)||t.options.rotation,t.options.view=n.view||n.view===""?n.view:t.options.view,t.options.zoom=parseFloat(n.zoom)||t.options.zoom},loadManifest(e,n={}){const s=bn();return t.fetchJson(e).then(async o=>{const i=Ws(o);if(n.expectedType&&i.type!==n.expectedType){const e=`Expected manifest of type ${n.expectedType}, but got ${i.type}`;return t.addError(e),s.reject(e),s}if(t.manifest=null,await En(),i.type==="Manifest")return t.manifest=i,t.initOptions(),window.addEventListener("popstate",t.initOptions),n.reset&&t.updateOptions({childManifestUrl:e,pages:t.getStartPages(),pan:{},rotation:null,view:t.isContainerWidthAtLeast("medium")?"collection":null,zoom:null}),s.resolve(),s;if(i.type==="Collection"){t.collection=i;const o=new URLSearchParams(window.location.search);let n={};try{n=JSON.parse(o.get(t.options.urlQueryKey))||{}}catch{}let e="";if(t.options.urlQueryParams.includes("childManifestUrl")&&n.childManifestUrl?e=n.childManifestUrl:t.collection.manifests&&t.options.childManifestAutoloaded&&(e=t.collection.manifests[0].id),e)await t.loadManifest(e,{expectedType:"Manifest"}),t.updateOptions({childManifestUrl:e});else{const e=n.view||t.options.view;t.updateOptions({view:["collection","help","info"].includes(e)?e:"collection"})}return s.resolve(),s}const a="Please provide a valid IIIF Presentation API manifest";return t.addError(a),s.reject(a),s},e=>{const n=`Error loading IIIF manifest: ${e.response&&(e.response.statusText||e.response.data)||e.message}`;return t.addError(n),s.reject(n),s})},localize(e){if(!t.options.language)throw new Error("language not set");if(!e)return"";if(typeof e=="string")return e;const n=e[t.options.language]||e[t.options.fallbackLanguage]||Object.values(e)[0]||"";return([].concat(n).join("\xA0\xB7 ")||"").trim()},setPage(e){var s;let n=[].concat(e);if(!Pr(n,t.pageCount))throw new RangeError("Invalid pages");return n.length===1&&((s=t.options.pages)==null?0[0]:s.length)===2&&!this.isCustomPageView&&(n=[n[0],t.getFacingPage(n[0])].sort()),t.updateOptions({pages:n}),n},toggleAnnotationId(e){const n={annotationId:t.options.annotationId===e?null:e,annotationsVisible:t.options.annotationId?null:t.annotationsVisible};n.annotationId&&!t.isContainerWidthAtLeast("medium")&&(n.view=t.options.view?null:"text"),t.updateOptions(n)},updateOptions(e){clearTimeout(t.urlUpdateTimeout),Object.assign(t.options,e),e.pages&&t.clearErrors(),t.options.urlQueryKey&&(t.urlUpdateTimeout=setTimeout(()=>{const n={};t.options.urlQueryParams.forEach(e=>{const s=t.options[e];s===null||e==="layers"&&!s.some(Boolean)||e==="pages"&&s.toString()===t.getStartPages().toString()||typeof s=="object"&&!Object.keys(s).length?delete n[e]:n[e]=t.options[e]});const s=new URL(window.location);Object.keys(n).length?s.searchParams.set(t.options.urlQueryKey,JSON.stringify(n)):s.searchParams.delete(t.options.urlQueryKey),window.history&&(e.pages||e.view?window.history.pushState({},"",s):window.history.replaceState({},"",s))},100))}});return t}fo={convertManifest:Ws,install:(e,t={})=>{e.config.globalProperties.$store=new Fh(t)}},window.Tify=function(e={}){if(this.options={...JSON.parse(JSON.stringify(Nr)),...e},!this.options.translationsDirUrl)try{const{url:e}=H2;this.options.translationsDirUrl=`${e.slice(0,e.lastIndexOf("/"))}/translations`}catch{}let t=null;this.ready=new Promise((e,n)=>{t={resolve:e,reject:n}});const s=this;this.app=Ca({render:()=>T3(Lr,{readyPromise:t})}).use(Tr,{instance:s}).use(wr).use(jr).use(fo,{options:this.options});let n=!1;this.mount=e=>{if(n)throw new Error("TIFY is already mounted");const t=typeof e=="string"?document.querySelector(e):e;if(!t)throw new Error("Container element not found");this.app.mount(t),n=!0},this.destroy=()=>{this.app.unmount()},this.options.container&&this.mount(this.options.container)},zh=window.Tify;function Dh(e,t,n="en"){document.documentElement.lang!==0[0]&&(n=document.documentElement.lang);const s=new Tify({container:e,manifestUrl:t,language:n,translationsDirUrl:"/tify/translations/"});return s}window.iiifPresentationViewer=Dh})()